<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content=" NVIDIA GeForce RTX 3050 æ­å»ºPyTorchç¯å¢ƒ æŸ¥çœ‹cudaç‰ˆæœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 $ nvidia-smi Wed Jan 21 16:40:58 2026 +---------------------------------------------------------------------------------------+ | NVIDIA-SMI 546.30 Driver Version: 546.30 CUDA Version: 12.3 | |-----------------------------------------+----------------------+----------------------+ | GPU Name TCC/WDDM | Bus-Id Disp.A | Volatile Uncorr. ECC | | Fan Temp Perf Pwr:Usage/Cap | Memory-Usage | GPU-Util Compute M. | | | | MIG M. | |=========================================+======================+======================| | 0 NVIDIA GeForce RTX 3050 ... WDDM | 00000000:01:00.0 On | N/A | | N/A 47C P8 6W / 60W | 807MiB / 4096MiB | 6% Default | | | | N/A | +-----------------------------------------+----------------------+----------------------+ +---------------------------------------------------------------------------------------+ | Processes: | | GPU GI CI PID Type Process name GPU Memory | | ID ID Usage | |=======================================================================================| | 0 N/A N/A 2804 C+G ...4034\\office6\\promecefpluginhost.exe N/A | | 0 N/A N/A 2820 C+G ...ekyb3d8bbwe\\PhoneExperienceHost.exe N/A | | 0 N/A N/A 4688 C+G ...oogle\\Chrome\\Application\\chrome.exe N/A | | 0 N/A N/A 6344 C+G ...__8wekyb3d8bbwe\\WindowsTerminal.exe N/A | | 0 N/A N/A 6444 C+G ...n\\143.0.3650.139\\msedgewebview2.exe N/A | | 0 N/A N/A 10564 C+G ...siveControlPanel\\SystemSettings.exe N/A | | 0 N/A N/A 10688 C+G ...t.LockApp_cw5n1h2txyewy\\LockApp.exe N/A | | 0 N/A N/A 11740 C+G ...s\\System32\\ApplicationFrameHost.exe N/A | | 0 N/A N/A 13708 C+G C:\\Windows\\explorer.exe N/A | | 0 N/A N/A 13780 C+G C:\\Windows\\System32\\ShellHost.exe N/A | | 0 N/A N/A 14856 C+G ...1\\extracted\\runtime\\WeChatAppEx.exe N/A | | 0 N/A N/A 15552 C+G ...2txyewy\\StartMenuExperienceHost.exe N/A | | 0 N/A N/A 17604 C+G ...4657\\office6\\promecefpluginhost.exe N/A | | 0 N/A N/A 18544 C+G ...CBS_cw5n1h2txyewy\\TextInputHost.exe N/A | | 0 N/A N/A 18748 C+G ...5n1h2txyewy\\ShellExperienceHost.exe N/A | | 0 N/A N/A 22696 C+G ...n\\143.0.3650.139\\msedgewebview2.exe N/A | | 0 N/A N/A 24724 C+G ...nt.CBS_cw5n1h2txyewy\\SearchHost.exe N/A | | 0 N/A N/A 25112 C+G ...ndows\\System32\\DataExchangeHost.exe N/A | | 0 N/A N/A 28452 C+G ...oogle\\Chrome\\Application\\chrome.exe N/A | +---------------------------------------------------------------------------------------+ å¯ä»¥çœ‹åˆ°CUDAç‰ˆæœ¬ï¼šCUDA Version: 12.3\n">
<title>NVIDIA GeForce RTX 3050 æ­å»ºPyTorchç¯å¢ƒ</title>

<link rel='canonical' href='https://ynhugo.github.io/p/nvidia-geforce-rtx-3050-%E6%90%AD%E5%BB%BApytorch%E7%8E%AF%E5%A2%83/'>

<link rel="stylesheet" href="/scss/style.min.6a692fd055deae459f2a9767f57f3855ba80cafd5041317f24f7360f6ca47cdf.css"><meta property='og:title' content="NVIDIA GeForce RTX 3050 æ­å»ºPyTorchç¯å¢ƒ">
<meta property='og:description' content=" NVIDIA GeForce RTX 3050 æ­å»ºPyTorchç¯å¢ƒ æŸ¥çœ‹cudaç‰ˆæœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 $ nvidia-smi Wed Jan 21 16:40:58 2026 +---------------------------------------------------------------------------------------+ | NVIDIA-SMI 546.30 Driver Version: 546.30 CUDA Version: 12.3 | |-----------------------------------------+----------------------+----------------------+ | GPU Name TCC/WDDM | Bus-Id Disp.A | Volatile Uncorr. ECC | | Fan Temp Perf Pwr:Usage/Cap | Memory-Usage | GPU-Util Compute M. | | | | MIG M. | |=========================================+======================+======================| | 0 NVIDIA GeForce RTX 3050 ... WDDM | 00000000:01:00.0 On | N/A | | N/A 47C P8 6W / 60W | 807MiB / 4096MiB | 6% Default | | | | N/A | +-----------------------------------------+----------------------+----------------------+ +---------------------------------------------------------------------------------------+ | Processes: | | GPU GI CI PID Type Process name GPU Memory | | ID ID Usage | |=======================================================================================| | 0 N/A N/A 2804 C+G ...4034\\office6\\promecefpluginhost.exe N/A | | 0 N/A N/A 2820 C+G ...ekyb3d8bbwe\\PhoneExperienceHost.exe N/A | | 0 N/A N/A 4688 C+G ...oogle\\Chrome\\Application\\chrome.exe N/A | | 0 N/A N/A 6344 C+G ...__8wekyb3d8bbwe\\WindowsTerminal.exe N/A | | 0 N/A N/A 6444 C+G ...n\\143.0.3650.139\\msedgewebview2.exe N/A | | 0 N/A N/A 10564 C+G ...siveControlPanel\\SystemSettings.exe N/A | | 0 N/A N/A 10688 C+G ...t.LockApp_cw5n1h2txyewy\\LockApp.exe N/A | | 0 N/A N/A 11740 C+G ...s\\System32\\ApplicationFrameHost.exe N/A | | 0 N/A N/A 13708 C+G C:\\Windows\\explorer.exe N/A | | 0 N/A N/A 13780 C+G C:\\Windows\\System32\\ShellHost.exe N/A | | 0 N/A N/A 14856 C+G ...1\\extracted\\runtime\\WeChatAppEx.exe N/A | | 0 N/A N/A 15552 C+G ...2txyewy\\StartMenuExperienceHost.exe N/A | | 0 N/A N/A 17604 C+G ...4657\\office6\\promecefpluginhost.exe N/A | | 0 N/A N/A 18544 C+G ...CBS_cw5n1h2txyewy\\TextInputHost.exe N/A | | 0 N/A N/A 18748 C+G ...5n1h2txyewy\\ShellExperienceHost.exe N/A | | 0 N/A N/A 22696 C+G ...n\\143.0.3650.139\\msedgewebview2.exe N/A | | 0 N/A N/A 24724 C+G ...nt.CBS_cw5n1h2txyewy\\SearchHost.exe N/A | | 0 N/A N/A 25112 C+G ...ndows\\System32\\DataExchangeHost.exe N/A | | 0 N/A N/A 28452 C+G ...oogle\\Chrome\\Application\\chrome.exe N/A | +---------------------------------------------------------------------------------------+ å¯ä»¥çœ‹åˆ°CUDAç‰ˆæœ¬ï¼šCUDA Version: 12.3\n">
<meta property='og:url' content='https://ynhugo.github.io/p/nvidia-geforce-rtx-3050-%E6%90%AD%E5%BB%BApytorch%E7%8E%AF%E5%A2%83/'>
<meta property='og:site_name' content='ynhugo'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='nvidia' /><meta property='article:tag' content='gpu' /><meta property='article:tag' content='pytorch' /><meta property='article:published_time' content='2026-01-22T00:37:43&#43;08:00'/><meta property='article:modified_time' content='2026-01-22T00:37:43&#43;08:00'/>
<meta name="twitter:title" content="NVIDIA GeForce RTX 3050 æ­å»ºPyTorchç¯å¢ƒ">
<meta name="twitter:description" content=" NVIDIA GeForce RTX 3050 æ­å»ºPyTorchç¯å¢ƒ æŸ¥çœ‹cudaç‰ˆæœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 $ nvidia-smi Wed Jan 21 16:40:58 2026 +---------------------------------------------------------------------------------------+ | NVIDIA-SMI 546.30 Driver Version: 546.30 CUDA Version: 12.3 | |-----------------------------------------+----------------------+----------------------+ | GPU Name TCC/WDDM | Bus-Id Disp.A | Volatile Uncorr. ECC | | Fan Temp Perf Pwr:Usage/Cap | Memory-Usage | GPU-Util Compute M. | | | | MIG M. | |=========================================+======================+======================| | 0 NVIDIA GeForce RTX 3050 ... WDDM | 00000000:01:00.0 On | N/A | | N/A 47C P8 6W / 60W | 807MiB / 4096MiB | 6% Default | | | | N/A | +-----------------------------------------+----------------------+----------------------+ +---------------------------------------------------------------------------------------+ | Processes: | | GPU GI CI PID Type Process name GPU Memory | | ID ID Usage | |=======================================================================================| | 0 N/A N/A 2804 C+G ...4034\\office6\\promecefpluginhost.exe N/A | | 0 N/A N/A 2820 C+G ...ekyb3d8bbwe\\PhoneExperienceHost.exe N/A | | 0 N/A N/A 4688 C+G ...oogle\\Chrome\\Application\\chrome.exe N/A | | 0 N/A N/A 6344 C+G ...__8wekyb3d8bbwe\\WindowsTerminal.exe N/A | | 0 N/A N/A 6444 C+G ...n\\143.0.3650.139\\msedgewebview2.exe N/A | | 0 N/A N/A 10564 C+G ...siveControlPanel\\SystemSettings.exe N/A | | 0 N/A N/A 10688 C+G ...t.LockApp_cw5n1h2txyewy\\LockApp.exe N/A | | 0 N/A N/A 11740 C+G ...s\\System32\\ApplicationFrameHost.exe N/A | | 0 N/A N/A 13708 C+G C:\\Windows\\explorer.exe N/A | | 0 N/A N/A 13780 C+G C:\\Windows\\System32\\ShellHost.exe N/A | | 0 N/A N/A 14856 C+G ...1\\extracted\\runtime\\WeChatAppEx.exe N/A | | 0 N/A N/A 15552 C+G ...2txyewy\\StartMenuExperienceHost.exe N/A | | 0 N/A N/A 17604 C+G ...4657\\office6\\promecefpluginhost.exe N/A | | 0 N/A N/A 18544 C+G ...CBS_cw5n1h2txyewy\\TextInputHost.exe N/A | | 0 N/A N/A 18748 C+G ...5n1h2txyewy\\ShellExperienceHost.exe N/A | | 0 N/A N/A 22696 C+G ...n\\143.0.3650.139\\msedgewebview2.exe N/A | | 0 N/A N/A 24724 C+G ...nt.CBS_cw5n1h2txyewy\\SearchHost.exe N/A | | 0 N/A N/A 25112 C+G ...ndows\\System32\\DataExchangeHost.exe N/A | | 0 N/A N/A 28452 C+G ...oogle\\Chrome\\Application\\chrome.exe N/A | +---------------------------------------------------------------------------------------+ å¯ä»¥çœ‹åˆ°CUDAç‰ˆæœ¬ï¼šCUDA Version: 12.3\n">
    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="åˆ‡æ¢èœå•">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/avatar_hu_b5976aa1afdc1d2e.png" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">ğŸ¥</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">ynhugo</a></h1>
            <h2 class="site-description">ynhugo.github.io</h2>
        </div>
    </header><ol class="menu-social">
            
                <li>
                    <a 
                        href='https://github.com/CaiJimmy/hugo-theme-stack'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://x.com'
                        target="_blank"
                        title="x"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M22 4.01c-1 .49 -1.98 .689 -3 .99c-1.121 -1.265 -2.783 -1.335 -4.38 -.737s-2.643 2.06 -2.62 3.737v1c-3.245 .083 -6.135 -1.395 -8 -4c0 0 -4.182 7.433 4 11c-1.872 1.247 -3.739 2.088 -6 2c3.308 1.803 6.913 2.423 10.034 1.517c3.58 -1.04 6.522 -3.723 7.651 -7.742a13.84 13.84 0 0 0 .497 -3.753c-.002 -.249 1.51 -2.772 1.818 -4.013z" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>ä¸»é¡µ</span>
            </a>
        </li>
        
        
        <li >
            <a href='/book/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 512 512" fill="none" stroke="#808080" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <path d="m443.6,11h-321c-35.4,0-64.6,26.1-64.6,59.4v371.1c0,33.4 26.1,59.4 59.4,59.4h326.2c6.3,0 10.4-4.2 10.4-11.5v-468c0-6.2-4.2-10.4-10.4-10.4zm-321,20.9h310.5v350.3h-315.7c-14.9,0-28.3,5.2-38.6,13.9v-325.7c-1.42109e-14-21.9 19.8-38.5 43.8-38.5zm310.6,449.3h-315.8c-21.9,0-38.6-16.7-38.6-38.6 0-21.9 17.7-38.6 38.6-38.6l315.8,.1v77.1z"/>
</svg>
                
                <span>Book</span>
            </a>
        </li>
        
        
        <li >
            <a href='/%E5%85%B3%E4%BA%8E/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>å…³äº</span>
            </a>
        </li>
        
        
        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>Archives</span>
            </a>
        </li>
        
        
        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>Search</span>
            </a>
        </li>
        
        
        <li >
            <a href='/links/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                
                <span>Links</span>
            </a>
        </li>
        
        <li class="menu-bottom-section">
            <ol class="menu">
                    
                        <li id="i18n-switch">  
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M4 5h7" />
  <path d="M9 3v2c0 4.418 -2.239 8 -5 8" />
  <path d="M5 9c-.003 2.144 2.952 3.908 6.7 4" />
  <path d="M12 20l4 -9l4 9" />
  <path d="M19.1 18h-6.2" />
</svg>



                            <select name="language" title="language" onchange="window.location.href = this.selectedOptions[0].value">
                                
                                    <option value="https://ynhugo.github.io/en/" >English</option>
                                
                                    <option value="https://ynhugo.github.io/" selected>ä¸­æ–‡</option>
                                
                                    <option value="https://ynhugo.github.io/ar/" >Ø¹Ø±Ø¨ÙŠ</option>
                                
                            </select>
                        </li>
                    
                

                
                    <li id="dark-mode-toggle">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <span>æš—è‰²æ¨¡å¼</span>
                    </li>
                
            </ol>
        </li>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">ç›®å½•</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
<ul>
<li><a href="#headline-1">NVIDIA GeForce RTX 3050 æ­å»ºPyTorchç¯å¢ƒ</a>
<ul>
<li><a href="#headline-2">æŸ¥çœ‹cudaç‰ˆæœ¬</a>
</li>
<li><a href="#headline-3">pytorché€‰æ‹©å¯¹åº”cudaç‰ˆæœ¬çš„å®‰è£…å‘½ä»¤</a>
</li>
<li><a href="#headline-4">PyTorchåŸºç¡€ï¼šå¼ é‡ä¸è®¡ç®—</a>
<ul>
<li><a href="#headline-5">å¼ é‡æ“ä½œä¸åŠ é€ŸåŸç†</a>
<ul>
<li><a href="#headline-6">ts1.py</a>
</li>
<li><a href="#headline-7">è¿è¡Œts1.py</a>
</li>
</ul>
</li>
<li><a href="#headline-8">è‡ªåŠ¨æ±‚å¯¼ï¼ˆAutogradï¼‰æœºåˆ¶</a>
<ul>
<li><a href="#headline-9">ts2.py</a>
</li>
<li><a href="#headline-10">è¿è¡Œts2.py</a>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#headline-11">æ¨¡å‹è®­ç»ƒä¸ä¿å­˜</a>
<ul>
<li><a href="#headline-12">å®‰è£… transformers åº“</a>
</li>
<li><a href="#headline-13">ä½¿ç”¨ Hugging Face æ•°æ®é›†</a>
<ul>
<li><a href="#headline-14">ts3.py</a>
</li>
<li><a href="#headline-15">ts3.pyä»£ç ä½œç”¨</a>
</li>
<li><a href="#headline-16">è¿è¡Œts3.py</a>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#headline-17">æ¨¡å‹åŠ è½½ä¸æ¨ç†</a>
<ul>
<li><a href="#headline-18">ä½¿ç”¨ Hugging Face æ•°æ®é›†</a>
<ul>
<li><a href="#headline-19">ts4.py</a>
</li>
<li><a href="#headline-20">ts4.pyçš„ä½œç”¨</a>
</li>
<li><a href="#headline-21">è¿è¡Œts4.py</a>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#headline-22">ä½¿ç”¨è‡ªå®šä¹‰æ•°æ®ï¼Œæ•°æ®åŠ è½½ä¸é¢„å¤„ç†ã€æ¨¡å‹åŠ è½½ä¸ä¿å­˜ã€æ¨¡å‹æ¨ç†ä¸åŠ è½½</a>
<ul>
<li><a href="#headline-23">ts5.py</a>
</li>
<li><a href="#headline-24">ts5.pyè¿è¡Œæ•ˆæœ</a>
</li>
</ul>
</li>
<li><a href="#headline-25">å‚è€ƒé“¾æ¥</a>
</li>
</ul>
</li>
</ul>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="main-article">
    <header class="article-header">

    <div class="article-details">
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/p/nvidia-geforce-rtx-3050-%E6%90%AD%E5%BB%BApytorch%E7%8E%AF%E5%A2%83/">NVIDIA GeForce RTX 3050 æ­å»ºPyTorchç¯å¢ƒ</a>
        </h2>
    
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">Jan 22, 2026</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    é˜…è¯»æ—¶é•¿: 22 åˆ†é’Ÿ
                </time>
            </div>
        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    
<div id="outline-container-headline-1" class="outline-2">
<h2 id="headline-1">
NVIDIA GeForce RTX 3050 æ­å»ºPyTorchç¯å¢ƒ
</h2>
<div id="outline-text-headline-1" class="outline-text-2">
<div id="outline-container-headline-2" class="outline-3">
<h3 id="headline-2">
æŸ¥çœ‹cudaç‰ˆæœ¬
</h3>
<div id="outline-text-headline-2" class="outline-text-3">
<div class="src src-bash">
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ nvidia-smi
</span></span><span class="line"><span class="cl">Wed Jan <span class="m">21</span> 16:40:58 <span class="m">2026</span>       
</span></span><span class="line"><span class="cl">+---------------------------------------------------------------------------------------+
</span></span><span class="line"><span class="cl">  <span class="p">|</span> NVIDIA-SMI 546.30                 Driver Version: 546.30       CUDA Version: 12.3     <span class="p">|</span>
</span></span><span class="line"><span class="cl">  <span class="p">|</span>-----------------------------------------+----------------------+----------------------+
</span></span><span class="line"><span class="cl">  <span class="p">|</span> GPU  Name                     TCC/WDDM  <span class="p">|</span> Bus-Id        Disp.A <span class="p">|</span> Volatile Uncorr. ECC <span class="p">|</span>
</span></span><span class="line"><span class="cl">  <span class="p">|</span> Fan  Temp   Perf          Pwr:Usage/Cap <span class="p">|</span>         Memory-Usage <span class="p">|</span> GPU-Util  Compute M. <span class="p">|</span>
</span></span><span class="line"><span class="cl">  <span class="p">|</span>                                         <span class="p">|</span>                      <span class="p">|</span>               MIG M. <span class="p">|</span>
</span></span><span class="line"><span class="cl">  <span class="p">|</span><span class="o">=========================================</span>+<span class="o">======================</span>+<span class="o">======================</span><span class="p">|</span>
</span></span><span class="line"><span class="cl">  <span class="p">|</span>   <span class="m">0</span>  NVIDIA GeForce RTX <span class="m">3050</span> ...  WDDM  <span class="p">|</span> 00000000:01:00.0  On <span class="p">|</span>                  N/A <span class="p">|</span>
</span></span><span class="line"><span class="cl">  <span class="p">|</span> N/A   47C    P8               6W /  60W <span class="p">|</span>    807MiB /  4096MiB <span class="p">|</span>      6%      Default <span class="p">|</span>
</span></span><span class="line"><span class="cl">  <span class="p">|</span>                                         <span class="p">|</span>                      <span class="p">|</span>                  N/A <span class="p">|</span>
</span></span><span class="line"><span class="cl">  +-----------------------------------------+----------------------+----------------------+
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  +---------------------------------------------------------------------------------------+
</span></span><span class="line"><span class="cl">  <span class="p">|</span> Processes:                                                                            <span class="p">|</span>
</span></span><span class="line"><span class="cl">  <span class="p">|</span>  GPU   GI   CI        PID   Type   Process name                            GPU Memory <span class="p">|</span>
</span></span><span class="line"><span class="cl">  <span class="p">|</span>        ID   ID                                                             Usage      <span class="p">|</span>
</span></span><span class="line"><span class="cl">  <span class="p">|</span><span class="o">=======================================================================================</span><span class="p">|</span>
</span></span><span class="line"><span class="cl">  <span class="p">|</span>    <span class="m">0</span>   N/A  N/A      <span class="m">2804</span>    C+G   ...4034<span class="se">\o</span>ffice6<span class="se">\p</span>romecefpluginhost.exe    N/A      <span class="p">|</span>
</span></span><span class="line"><span class="cl">  <span class="p">|</span>    <span class="m">0</span>   N/A  N/A      <span class="m">2820</span>    C+G   ...ekyb3d8bbwe<span class="se">\P</span>honeExperienceHost.exe    N/A      <span class="p">|</span>
</span></span><span class="line"><span class="cl">  <span class="p">|</span>    <span class="m">0</span>   N/A  N/A      <span class="m">4688</span>    C+G   ...oogle<span class="se">\C</span>hrome<span class="se">\A</span>pplication<span class="se">\c</span>hrome.exe    N/A      <span class="p">|</span>
</span></span><span class="line"><span class="cl">  <span class="p">|</span>    <span class="m">0</span>   N/A  N/A      <span class="m">6344</span>    C+G   ...__8wekyb3d8bbwe<span class="se">\W</span>indowsTerminal.exe    N/A      <span class="p">|</span>
</span></span><span class="line"><span class="cl">  <span class="p">|</span>    <span class="m">0</span>   N/A  N/A      <span class="m">6444</span>    C+G   ...n<span class="se">\1</span>43.0.3650.139<span class="se">\m</span>sedgewebview2.exe    N/A      <span class="p">|</span>
</span></span><span class="line"><span class="cl">  <span class="p">|</span>    <span class="m">0</span>   N/A  N/A     <span class="m">10564</span>    C+G   ...siveControlPanel<span class="se">\S</span>ystemSettings.exe    N/A      <span class="p">|</span>
</span></span><span class="line"><span class="cl">  <span class="p">|</span>    <span class="m">0</span>   N/A  N/A     <span class="m">10688</span>    C+G   ...t.LockApp_cw5n1h2txyewy<span class="se">\L</span>ockApp.exe    N/A      <span class="p">|</span>
</span></span><span class="line"><span class="cl">  <span class="p">|</span>    <span class="m">0</span>   N/A  N/A     <span class="m">11740</span>    C+G   ...s<span class="se">\S</span>ystem32<span class="se">\A</span>pplicationFrameHost.exe    N/A      <span class="p">|</span>
</span></span><span class="line"><span class="cl">  <span class="p">|</span>    <span class="m">0</span>   N/A  N/A     <span class="m">13708</span>    C+G   C:<span class="se">\W</span>indows<span class="se">\e</span>xplorer.exe                   N/A      <span class="p">|</span>
</span></span><span class="line"><span class="cl">  <span class="p">|</span>    <span class="m">0</span>   N/A  N/A     <span class="m">13780</span>    C+G   C:<span class="se">\W</span>indows<span class="se">\S</span>ystem32<span class="se">\S</span>hellHost.exe         N/A      <span class="p">|</span>
</span></span><span class="line"><span class="cl">  <span class="p">|</span>    <span class="m">0</span>   N/A  N/A     <span class="m">14856</span>    C+G   ...1<span class="se">\e</span>xtracted<span class="se">\r</span>untime<span class="se">\W</span>eChatAppEx.exe    N/A      <span class="p">|</span>
</span></span><span class="line"><span class="cl">  <span class="p">|</span>    <span class="m">0</span>   N/A  N/A     <span class="m">15552</span>    C+G   ...2txyewy<span class="se">\S</span>tartMenuExperienceHost.exe    N/A      <span class="p">|</span>
</span></span><span class="line"><span class="cl">  <span class="p">|</span>    <span class="m">0</span>   N/A  N/A     <span class="m">17604</span>    C+G   ...4657<span class="se">\o</span>ffice6<span class="se">\p</span>romecefpluginhost.exe    N/A      <span class="p">|</span>
</span></span><span class="line"><span class="cl">  <span class="p">|</span>    <span class="m">0</span>   N/A  N/A     <span class="m">18544</span>    C+G   ...CBS_cw5n1h2txyewy<span class="se">\T</span>extInputHost.exe    N/A      <span class="p">|</span>
</span></span><span class="line"><span class="cl">  <span class="p">|</span>    <span class="m">0</span>   N/A  N/A     <span class="m">18748</span>    C+G   ...5n1h2txyewy<span class="se">\S</span>hellExperienceHost.exe    N/A      <span class="p">|</span>
</span></span><span class="line"><span class="cl">  <span class="p">|</span>    <span class="m">0</span>   N/A  N/A     <span class="m">22696</span>    C+G   ...n<span class="se">\1</span>43.0.3650.139<span class="se">\m</span>sedgewebview2.exe    N/A      <span class="p">|</span>
</span></span><span class="line"><span class="cl">  <span class="p">|</span>    <span class="m">0</span>   N/A  N/A     <span class="m">24724</span>    C+G   ...nt.CBS_cw5n1h2txyewy<span class="se">\S</span>earchHost.exe    N/A      <span class="p">|</span>
</span></span><span class="line"><span class="cl">  <span class="p">|</span>    <span class="m">0</span>   N/A  N/A     <span class="m">25112</span>    C+G   ...ndows<span class="se">\S</span>ystem32<span class="se">\D</span>ataExchangeHost.exe    N/A      <span class="p">|</span>
</span></span><span class="line"><span class="cl">  <span class="p">|</span>    <span class="m">0</span>   N/A  N/A     <span class="m">28452</span>    C+G   ...oogle<span class="se">\C</span>hrome<span class="se">\A</span>pplication<span class="se">\c</span>hrome.exe    N/A      <span class="p">|</span>
</span></span><span class="line"><span class="cl">  +---------------------------------------------------------------------------------------+</span></span></code></pre></td></tr></table>
</div>
</div>
</div>
<p>å¯ä»¥çœ‹åˆ°CUDAç‰ˆæœ¬ï¼šCUDA Version: 12.3</p>
</div>
</div>
<div id="outline-container-headline-3" class="outline-3">
<h3 id="headline-3">
pytorché€‰æ‹©å¯¹åº”cudaç‰ˆæœ¬çš„å®‰è£…å‘½ä»¤
</h3>
<div id="outline-text-headline-3" class="outline-text-3">
<p>å› ä¸ºCUDAæœ‰å‘ä¸‹å…¼å®¹æ€§ï¼Œæœ€æ–°çš„&#34;# CUDA 12.1&#34;çš„å®‰è£…å‘½ä»¤å¦‚ä¸‹</p>
<div class="src src-bash">
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># åˆ›å»ºæ–°ç¯å¢ƒå¹¶æŒ‡å®šPythonç‰ˆæœ¬</span>
</span></span><span class="line"><span class="cl">conda create -n pytorch2.5 <span class="nv">python</span><span class="o">=</span>3.10 -y
</span></span><span class="line"><span class="cl">conda activate pytorch2.5
</span></span><span class="line"><span class="cl"><span class="c1"># å®‰è£…PyTorch</span>
</span></span><span class="line"><span class="cl">conda install <span class="nv">pytorch</span><span class="o">==</span>2.5.1 <span class="nv">torchvision</span><span class="o">==</span>0.20.1 <span class="nv">torchaudio</span><span class="o">==</span>2.5.1 pytorch-cuda<span class="o">=</span>12.1 -c pytorch -c nvidia -y</span></span></code></pre></td></tr></table>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-headline-4" class="outline-3">
<h3 id="headline-4">
PyTorchåŸºç¡€ï¼šå¼ é‡ä¸è®¡ç®—
</h3>
<div id="outline-text-headline-4" class="outline-text-3">
<div id="outline-container-headline-5" class="outline-4">
<h4 id="headline-5">
å¼ é‡æ“ä½œä¸åŠ é€ŸåŸç†
</h4>
<div id="outline-text-headline-5" class="outline-text-4">
<div id="outline-container-headline-6" class="outline-5">
<h5 id="headline-6">
ts1.py
</h5>
<div id="outline-text-headline-6" class="outline-text-5">
<div class="src src-python">
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">torch</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># åˆ›å»ºå¼ é‡å¹¶å¯ç”¨GPUåŠ é€Ÿï¼Œç»Ÿä¸€æ•°æ®ç±»å‹ä¸ºfloat32</span>
</span></span><span class="line"><span class="cl"><span class="n">tensor_a</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]],</span> <span class="n">device</span><span class="o">=</span><span class="s1">&#39;cuda&#39;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>  <span class="c1"># æŒ‡å®šä¸ºfloat32</span>
</span></span><span class="line"><span class="cl"><span class="n">tensor_b</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">cuda</span><span class="p">()</span>  <span class="c1"># éšæœºå¼ é‡ç§»è‡³GPUï¼Œé»˜è®¤æ˜¯float32</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># æ£€æŸ¥æ•°æ®ç±»å‹</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;tensor_a dtype: </span><span class="si">{</span><span class="n">tensor_a</span><span class="o">.</span><span class="n">dtype</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;tensor_b dtype: </span><span class="si">{</span><span class="n">tensor_b</span><span class="o">.</span><span class="n">dtype</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># å¸¸è§è®¡ç®—</span>
</span></span><span class="line"><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">tensor_a</span><span class="p">,</span> <span class="n">tensor_b</span><span class="p">)</span>  <span class="c1"># çŸ©é˜µä¹˜æ³•</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Result:</span><span class="se">\n</span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ç­‰ä»·å†™æ³•</span>
</span></span><span class="line"><span class="cl"><span class="n">result2</span> <span class="o">=</span> <span class="n">tensor_a</span> <span class="o">@</span> <span class="n">tensor_b</span><span class="o">.</span><span class="n">T</span>  <span class="c1"># ç­‰ä»·å†™æ³•ï¼ˆè½¬ç½®åä¹˜ï¼‰</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Result with transpose:</span><span class="se">\n</span><span class="si">{</span><span class="n">result2</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span></span></span></code></pre></td></tr></table>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-headline-7" class="outline-5">
<h5 id="headline-7">
è¿è¡Œts1.py
</h5>
<div id="outline-text-headline-7" class="outline-text-5">
<div class="src src-bash">
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ python ts1.py
</span></span><span class="line"><span class="cl">tensor_a dtype: torch.float32
</span></span><span class="line"><span class="cl">tensor_b dtype: torch.float32
</span></span><span class="line"><span class="cl">Result:
</span></span><span class="line"><span class="cl">tensor<span class="o">([[</span> 3.6182, -2.2474<span class="o">]</span>,
</span></span><span class="line"><span class="cl">        <span class="o">[</span> 9.4193, -3.6061<span class="o">]]</span>, <span class="nv">device</span><span class="o">=</span><span class="s1">&#39;cuda:0&#39;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">Result with transpose:
</span></span><span class="line"><span class="cl">tensor<span class="o">([[</span> 3.9601, -2.4183<span class="o">]</span>,
</span></span><span class="line"><span class="cl">        <span class="o">[</span>10.1031, -4.1190<span class="o">]]</span>, <span class="nv">device</span><span class="o">=</span><span class="s1">&#39;cuda:0&#39;</span><span class="o">)</span></span></span></code></pre></td></tr></table>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-headline-8" class="outline-4">
<h4 id="headline-8">
è‡ªåŠ¨æ±‚å¯¼ï¼ˆAutogradï¼‰æœºåˆ¶
</h4>
<div id="outline-text-headline-8" class="outline-text-4">
<div class="src src-python">
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="mf">3.0</span><span class="p">,</span> <span class="n">requires_grad</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">y</span> <span class="o">=</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="n">y</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>  <span class="c1"># è‡ªåŠ¨è®¡ç®—æ¢¯åº¦</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">grad</span><span class="p">)</span>  <span class="c1"># è¾“å‡ºï¼š8.0 (dy/dx = 2x+2)</span></span></span></code></pre></td></tr></table>
</div>
</div>
</div>
<div id="outline-container-headline-9" class="outline-5">
<h5 id="headline-9">
ts2.py
</h5>
<div id="outline-text-headline-9" class="outline-text-5">
<div class="src src-python">
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">torch</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># åˆ›å»ºå¼ é‡å¹¶å¯ç”¨GPUåŠ é€Ÿï¼Œç»Ÿä¸€æ•°æ®ç±»å‹ä¸ºfloat32</span>
</span></span><span class="line"><span class="cl"><span class="n">tensor_a</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]],</span> <span class="n">device</span><span class="o">=</span><span class="s1">&#39;cuda&#39;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>  <span class="c1"># æŒ‡å®šä¸ºfloat32</span>
</span></span><span class="line"><span class="cl"><span class="n">tensor_b</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">cuda</span><span class="p">()</span>  <span class="c1"># éšæœºå¼ é‡ç§»è‡³GPUï¼Œé»˜è®¤æ˜¯float32</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># æ£€æŸ¥æ•°æ®ç±»å‹</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;tensor_a dtype: </span><span class="si">{</span><span class="n">tensor_a</span><span class="o">.</span><span class="n">dtype</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;tensor_b dtype: </span><span class="si">{</span><span class="n">tensor_b</span><span class="o">.</span><span class="n">dtype</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># å¸¸è§è®¡ç®—</span>
</span></span><span class="line"><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">tensor_a</span><span class="p">,</span> <span class="n">tensor_b</span><span class="p">)</span>  <span class="c1"># çŸ©é˜µä¹˜æ³•</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Result:</span><span class="se">\n</span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ç­‰ä»·å†™æ³•</span>
</span></span><span class="line"><span class="cl"><span class="n">result2</span> <span class="o">=</span> <span class="n">tensor_a</span> <span class="o">@</span> <span class="n">tensor_b</span><span class="o">.</span><span class="n">T</span>  <span class="c1"># ç­‰ä»·å†™æ³•ï¼ˆè½¬ç½®åä¹˜ï¼‰</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Result with transpose:</span><span class="se">\n</span><span class="si">{</span><span class="n">result2</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="mf">3.0</span><span class="p">,</span> <span class="n">requires_grad</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">y</span> <span class="o">=</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="n">y</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>  <span class="c1"># è‡ªåŠ¨è®¡ç®—æ¢¯åº¦</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">grad</span><span class="p">)</span>  <span class="c1"># è¾“å‡ºï¼š8.0 (dy/dx = 2x+2)</span></span></span></code></pre></td></tr></table>
</div>
</div>
</div>
<p>å…³é”®ç‚¹ï¼šrequires_grad=True å¼€å¯è¿½è¸ªè®¡ç®—å›¾ï¼Œbackward() åå‘ä¼ æ’­æ±‚å¯¼ã€‚</p>
</div>
</div>
<div id="outline-container-headline-10" class="outline-5">
<h5 id="headline-10">
è¿è¡Œts2.py
</h5>
<div id="outline-text-headline-10" class="outline-text-5">
<div class="src src-bash">
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ python ts3.py
</span></span><span class="line"><span class="cl">tensor_a dtype: torch.float32
</span></span><span class="line"><span class="cl">tensor_b dtype: torch.float32
</span></span><span class="line"><span class="cl">Result:
</span></span><span class="line"><span class="cl">tensor<span class="o">([[</span>2.9388, 1.2983<span class="o">]</span>,
</span></span><span class="line"><span class="cl">        <span class="o">[</span>6.5159, 3.5078<span class="o">]]</span>, <span class="nv">device</span><span class="o">=</span><span class="s1">&#39;cuda:0&#39;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">Result with transpose:
</span></span><span class="line"><span class="cl">tensor<span class="o">([[</span>2.4608, 1.5373<span class="o">]</span>,
</span></span><span class="line"><span class="cl">        <span class="o">[</span>5.5599, 4.2248<span class="o">]]</span>, <span class="nv">device</span><span class="o">=</span><span class="s1">&#39;cuda:0&#39;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">tensor<span class="o">(</span>8.<span class="o">)</span></span></span></code></pre></td></tr></table>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-headline-11" class="outline-3">
<h3 id="headline-11">
æ¨¡å‹è®­ç»ƒä¸ä¿å­˜
</h3>
<div id="outline-text-headline-11" class="outline-text-3">
<div id="outline-container-headline-12" class="outline-4">
<h4 id="headline-12">
å®‰è£… transformers åº“
</h4>
<div id="outline-text-headline-12" class="outline-text-4">
<div class="src src-bash">
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># å®‰è£… transformers åº“ï¼Œå¯èƒ½æœ‰ç‰ˆæœ¬å†²çªè­¦å‘Šï¼Œä½†ä¸å½±å“åŸºæœ¬ä½¿ç”¨ï¼Œsympy ç‰ˆæœ¬çš„å°å·®å¼‚é€šå¸¸ä¸ä¼šå½±å“ PyTorch å’Œ transformers çš„æ­£å¸¸å·¥ä½œã€‚</span>
</span></span><span class="line"><span class="cl">pip install transformers -i https://pypi.tuna.tsinghua.edu.cn/simple</span></span></code></pre></td></tr></table>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-headline-13" class="outline-4">
<h4 id="headline-13">
ä½¿ç”¨ Hugging Face æ•°æ®é›†
</h4>
<div id="outline-text-headline-13" class="outline-text-4">
<div class="src src-bash">
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># ä½¿ç”¨ Hugging Face æ•°æ®é›†ï¼ˆéœ€è¦å®‰è£… datasetsï¼‰</span>
</span></span><span class="line"><span class="cl">pip install datasets -i https://pypi.tuna.tsinghua.edu.cn/simple</span></span></code></pre></td></tr></table>
</div>
</div>
</div>
<div id="outline-container-headline-14" class="outline-5">
<h5 id="headline-14">
ts3.py
</h5>
<div id="outline-text-headline-14" class="outline-text-5">
<div class="src src-python">
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">os</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">torch</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">torch.optim</span> <span class="k">as</span> <span class="nn">optim</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">transformers</span> <span class="kn">import</span> <span class="n">AutoModelForSequenceClassification</span><span class="p">,</span> <span class="n">AutoTokenizer</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">datasets</span> <span class="kn">import</span> <span class="n">load_dataset</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">torch.utils.data</span> <span class="kn">import</span> <span class="n">DataLoader</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">warnings</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># å±è”½è­¦å‘Š</span>
</span></span><span class="line"><span class="cl"><span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&#34;ignore&#34;</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s2">&#34;Xet Storage is enabled&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&#34;TRANSFORMERS_NO_ADVISORY_WARNINGS&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&#34;1&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Loading BERT model and tokenizer...&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># åŠ è½½æ¨¡å‹å’Œåˆ†è¯å™¨</span>
</span></span><span class="line"><span class="cl"><span class="n">model</span> <span class="o">=</span> <span class="n">AutoModelForSequenceClassification</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="s2">&#34;bert-base-uncased&#34;</span><span class="p">,</span> <span class="n">num_labels</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">tokenizer</span> <span class="o">=</span> <span class="n">AutoTokenizer</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="s2">&#34;bert-base-uncased&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Loading IMDb dataset...&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># åŠ è½½IMDbç”µå½±è¯„è®ºæ•°æ®é›†ï¼ˆæƒ…æ„Ÿåˆ†æï¼‰</span>
</span></span><span class="line"><span class="cl"><span class="n">dataset</span> <span class="o">=</span> <span class="n">load_dataset</span><span class="p">(</span><span class="s2">&#34;imdb&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># æ•°æ®é¢„å¤„ç†å‡½æ•°</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">preprocess_function</span><span class="p">(</span><span class="n">examples</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># å¯¹æ–‡æœ¬è¿›è¡Œåˆ†è¯ï¼Œè®¾ç½®æˆªæ–­å’Œå¡«å……</span>
</span></span><span class="line"><span class="cl">    <span class="n">result</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">examples</span><span class="p">[</span><span class="s2">&#34;text&#34;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="n">truncation</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">padding</span><span class="o">=</span><span class="s2">&#34;max_length&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">max_length</span><span class="o">=</span><span class="mi">128</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">result</span><span class="p">[</span><span class="s2">&#34;labels&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">examples</span><span class="p">[</span><span class="s2">&#34;label&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">result</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Tokenizing data...&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># åº”ç”¨åˆ†è¯</span>
</span></span><span class="line"><span class="cl"><span class="n">tokenized_datasets</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">preprocess_function</span><span class="p">,</span> <span class="n">batched</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># è®¾ç½®æ•°æ®é›†çš„æ ¼å¼ä¸ºPyTorch tensors</span>
</span></span><span class="line"><span class="cl"><span class="n">tokenized_datasets</span><span class="o">.</span><span class="n">set_format</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&#34;torch&#34;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&#34;input_ids&#34;</span><span class="p">,</span> <span class="s2">&#34;attention_mask&#34;</span><span class="p">,</span> <span class="s2">&#34;labels&#34;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># åˆ›å»ºæ•°æ®åŠ è½½å™¨ï¼ˆåªä½¿ç”¨å°‘é‡æ•°æ®æ¼”ç¤ºï¼Œé¿å…å†…å­˜ä¸è¶³ï¼‰</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Creating data loaders...&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">train_dataset</span> <span class="o">=</span> <span class="n">tokenized_datasets</span><span class="p">[</span><span class="s2">&#34;train&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">))</span>  <span class="c1"># åªä½¿ç”¨100ä¸ªè®­ç»ƒæ ·æœ¬</span>
</span></span><span class="line"><span class="cl"><span class="n">test_dataset</span> <span class="o">=</span> <span class="n">tokenized_datasets</span><span class="p">[</span><span class="s2">&#34;test&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">))</span>     <span class="c1"># åªä½¿ç”¨20ä¸ªæµ‹è¯•æ ·æœ¬</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">train_dataloader</span> <span class="o">=</span> <span class="n">DataLoader</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">train_dataset</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">batch_size</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">test_dataloader</span> <span class="o">=</span> <span class="n">DataLoader</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">test_dataset</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">batch_size</span><span class="o">=</span><span class="mi">4</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Training samples: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">train_dataset</span><span class="p">)</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Test samples: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">test_dataset</span><span class="p">)</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># å°†æ¨¡å‹ç§»åŠ¨åˆ°GPUï¼ˆå¦‚æœå¯ç”¨ï¼‰</span>
</span></span><span class="line"><span class="cl"><span class="n">device</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s2">&#34;cuda&#34;</span> <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">()</span> <span class="k">else</span> <span class="s2">&#34;cpu&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">model</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Model moved to: </span><span class="si">{</span><span class="n">device</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># åˆ›å»ºä¼˜åŒ–å™¨</span>
</span></span><span class="line"><span class="cl"><span class="n">optimizer</span> <span class="o">=</span> <span class="n">optim</span><span class="o">.</span><span class="n">AdamW</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="mf">5e-5</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># è®­ç»ƒå¾ªç¯</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">Starting training...&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">model</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">total_loss</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">batch</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">train_dataloader</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># ç§»åŠ¨æ•°æ®åˆ°å¯¹åº”è®¾å¤‡</span>
</span></span><span class="line"><span class="cl">        <span class="n">batch</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">batch</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># å‰å‘ä¼ æ’­</span>
</span></span><span class="line"><span class="cl">        <span class="n">outputs</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="o">**</span><span class="n">batch</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">loss</span> <span class="o">=</span> <span class="n">outputs</span><span class="o">.</span><span class="n">loss</span>
</span></span><span class="line"><span class="cl">        <span class="n">total_loss</span> <span class="o">+=</span> <span class="n">loss</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># åå‘ä¼ æ’­</span>
</span></span><span class="line"><span class="cl">        <span class="n">loss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">optimizer</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">optimizer</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">5</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># æ¯5ä¸ªbatchæ‰“å°ä¸€æ¬¡</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Epoch </span><span class="si">{</span><span class="n">epoch</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">, Batch </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">train_dataloader</span><span class="p">)</span><span class="si">}</span><span class="s2">, Loss: </span><span class="si">{</span><span class="n">loss</span><span class="o">.</span><span class="n">item</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">avg_loss</span> <span class="o">=</span> <span class="n">total_loss</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">train_dataloader</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Epoch </span><span class="si">{</span><span class="n">epoch</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2"> completed, Average Loss: </span><span class="si">{</span><span class="n">avg_loss</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ä¿å­˜æ¨¡å‹</span>
</span></span><span class="line"><span class="cl"><span class="n">torch</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">state_dict</span><span class="p">(),</span> <span class="s2">&#34;model.pt&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">Model saved as &#39;model.pt&#39;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># æµ‹è¯•æ¨¡å‹</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">Testing model...&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">model</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">correct</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">batch</span> <span class="ow">in</span> <span class="n">test_dataloader</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">batch</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">batch</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
</span></span><span class="line"><span class="cl">        <span class="n">outputs</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="o">**</span><span class="n">batch</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">predictions</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">outputs</span><span class="o">.</span><span class="n">logits</span><span class="p">,</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">labels</span> <span class="o">=</span> <span class="n">batch</span><span class="p">[</span><span class="s2">&#34;labels&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">correct</span> <span class="o">+=</span> <span class="p">(</span><span class="n">predictions</span> <span class="o">==</span> <span class="n">labels</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">total</span> <span class="o">+=</span> <span class="n">labels</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">accuracy</span> <span class="o">=</span> <span class="n">correct</span> <span class="o">/</span> <span class="n">total</span> <span class="o">*</span> <span class="mi">100</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Test Accuracy: </span><span class="si">{</span><span class="n">accuracy</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">% (</span><span class="si">{</span><span class="n">correct</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">total</span><span class="si">}</span><span class="s2">)&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># å•ä¸ªæ ·æœ¬æ¨ç†ç¤ºä¾‹</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">Single sample inference:&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">test_text</span> <span class="o">=</span> <span class="s2">&#34;This movie was absolutely fantastic! I loved every minute of it.&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Input: </span><span class="si">{</span><span class="n">test_text</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># é¢„å¤„ç†è¾“å…¥</span>
</span></span><span class="line"><span class="cl"><span class="n">inputs</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="p">(</span><span class="n">test_text</span><span class="p">,</span> <span class="n">return_tensors</span><span class="o">=</span><span class="s2">&#34;pt&#34;</span><span class="p">,</span> <span class="n">truncation</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="s2">&#34;max_length&#34;</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">128</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">inputs</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">inputs</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">outputs</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="o">**</span><span class="n">inputs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">probabilities</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">softmax</span><span class="p">(</span><span class="n">outputs</span><span class="o">.</span><span class="n">logits</span><span class="p">,</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">prediction</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">outputs</span><span class="o">.</span><span class="n">logits</span><span class="p">,</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Positive score: </span><span class="si">{</span><span class="n">probabilities</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">item</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Negative score: </span><span class="si">{</span><span class="n">probabilities</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">item</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Prediction: </span><span class="si">{</span><span class="s1">&#39;Positive&#39;</span> <span class="k">if</span> <span class="n">prediction</span><span class="o">.</span><span class="n">item</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="s1">&#39;Negative&#39;</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">Training completed successfully!&#34;</span><span class="p">)</span></span></span></code></pre></td></tr></table>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-headline-15" class="outline-5">
<h5 id="headline-15">
ts3.pyä»£ç ä½œç”¨
</h5>
<div id="outline-text-headline-15" class="outline-text-5">
<div class="src src-markdown">
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-markdown" data-lang="markdown"><span class="line"><span class="cl">è¿™ä¸ªä»£ç æ˜¯ä¸€ä¸ªå®Œæ•´çš„**æ–‡æœ¬æƒ…æ„Ÿåˆ†ç±»æ¨¡å‹çš„è®­ç»ƒå’Œè¯„ä¼°æµç¨‹**ï¼Œå…·ä½“ä½œç”¨å¦‚ä¸‹ï¼š
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="gu">## ğŸ¯ **ä¸»è¦ç›®æ ‡**
</span></span></span><span class="line"><span class="cl">è®­ç»ƒä¸€ä¸ªåŸºäº BERT çš„æ·±åº¦å­¦ä¹ æ¨¡å‹ï¼Œç”¨äºåˆ¤æ–­ç”µå½±è¯„è®ºçš„æƒ…æ„Ÿå€¾å‘ï¼ˆæ­£é¢/è´Ÿé¢ï¼‰ã€‚
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="gu">## ğŸ“Š **è¯¦ç»†åŠŸèƒ½**
</span></span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="gu">### 1. **æ¨¡å‹åŠ è½½**
</span></span></span><span class="line"><span class="cl"><span class="k">-</span> ä½¿ç”¨ Hugging Face çš„ <span class="sb">`transformers`</span> åº“åŠ è½½é¢„è®­ç»ƒçš„ BERT æ¨¡å‹ï¼ˆbert-base-uncasedï¼‰
</span></span><span class="line"><span class="cl"><span class="k">-</span> æ·»åŠ ä¸€ä¸ªåˆ†ç±»å¤´ï¼Œå°† BERT çš„è¾“å‡ºè½¬æ¢ä¸ºäºŒå…ƒåˆ†ç±»ï¼ˆæ­£é¢/è´Ÿé¢ï¼‰
</span></span><span class="line"><span class="cl"><span class="k">-</span> åŠ è½½å¯¹åº”çš„åˆ†è¯å™¨ï¼ˆTokenizerï¼‰
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="gu">### 2. **æ•°æ®å‡†å¤‡**
</span></span></span><span class="line"><span class="cl"><span class="k">-</span> **æ•°æ®é›†**ï¼šIMDb ç”µå½±è¯„è®ºæ•°æ®é›†ï¼ˆ25k æ¡è®­ç»ƒ + 25k æ¡æµ‹è¯•ï¼‰
</span></span><span class="line"><span class="cl"><span class="k">-</span> **æ•°æ®é¢„å¤„ç†**ï¼š
</span></span><span class="line"><span class="cl">  <span class="k">-</span> å°†æ–‡æœ¬è½¬æ¢ä¸º BERT èƒ½ç†è§£çš„ token ID
</span></span><span class="line"><span class="cl">  <span class="k">-</span> æ·»åŠ  attention maskï¼ˆåŒºåˆ†çœŸå®å†…å®¹ä¸å¡«å……ï¼‰
</span></span><span class="line"><span class="cl">  <span class="k">-</span> è®¾ç½®å›ºå®šé•¿åº¦ï¼ˆ128ä¸ªtokenï¼‰ï¼Œè¶…è¿‡æˆªæ–­ï¼Œä¸è¶³å¡«å……
</span></span><span class="line"><span class="cl">  <span class="k">-</span> æå–æƒ…æ„Ÿæ ‡ç­¾ï¼ˆ0=è´Ÿé¢ï¼Œ1=æ­£é¢ï¼‰
</span></span><span class="line"><span class="cl"><span class="k">-</span> **æ•°æ®åˆ’åˆ†**ï¼šä¸ºäº†æ¼”ç¤ºï¼Œåªä½¿ç”¨ 100 æ¡è®­ç»ƒæ ·æœ¬å’Œ 20 æ¡æµ‹è¯•æ ·æœ¬
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="gu">### 3. **æ¨¡å‹è®­ç»ƒ**
</span></span></span><span class="line"><span class="cl"><span class="k">-</span> **ä¼˜åŒ–å™¨**ï¼šAdamWï¼ˆBERT å¸¸ç”¨çš„ä¼˜åŒ–å™¨ï¼‰
</span></span><span class="line"><span class="cl"><span class="k">-</span> **å­¦ä¹ ç‡**ï¼š5e-5ï¼ˆBERT fine-tuning çš„æ ‡å‡†å­¦ä¹ ç‡ï¼‰
</span></span><span class="line"><span class="cl"><span class="k">-</span> **è®­ç»ƒå¾ªç¯**ï¼š
</span></span><span class="line"><span class="cl">  <span class="k">-</span> 3ä¸ª epochï¼ˆå®Œæ•´éå†æ•°æ®é›†3æ¬¡ï¼‰
</span></span><span class="line"><span class="cl">  <span class="k">-</span> æ¯ä¸ª batch è¿›è¡Œå‰å‘ä¼ æ’­ã€è®¡ç®—æŸå¤±ã€åå‘ä¼ æ’­ã€æ›´æ–°å‚æ•°
</span></span><span class="line"><span class="cl">  <span class="k">-</span> ç›‘æ§å¹¶æ‰“å°æŸå¤±å€¼
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="gu">### 4. **æ¨¡å‹è¯„ä¼°**
</span></span></span><span class="line"><span class="cl"><span class="k">-</span> åœ¨æµ‹è¯•é›†ä¸Šè¯„ä¼°æ¨¡å‹å‡†ç¡®ç‡
</span></span><span class="line"><span class="cl"><span class="k">-</span> è¿›è¡Œå•ä¸ªæ ·æœ¬æ¨ç†ï¼Œè¾“å‡ºï¼š
</span></span><span class="line"><span class="cl">  <span class="k">-</span> æ­£é¢æƒ…æ„Ÿçš„æ¦‚ç‡
</span></span><span class="line"><span class="cl">  <span class="k">-</span> è´Ÿé¢æƒ…æ„Ÿçš„æ¦‚ç‡
</span></span><span class="line"><span class="cl">  <span class="k">-</span> æœ€ç»ˆé¢„æµ‹ç»“æœ
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="gu">### 5. **æ¨¡å‹ä¿å­˜**
</span></span></span><span class="line"><span class="cl"><span class="k">-</span> å°†è®­ç»ƒå¥½çš„æ¨¡å‹æƒé‡ä¿å­˜ä¸º &#34;model.pt&#34; æ–‡ä»¶
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="gu">## ğŸ”§ **æŠ€æœ¯è¦ç‚¹**
</span></span></span><span class="line"><span class="cl"><span class="k">1.</span> <span class="gs">**è¿ç§»å­¦ä¹ **</span>ï¼šåœ¨é¢„è®­ç»ƒçš„ BERT åŸºç¡€ä¸Šè¿›è¡Œå¾®è°ƒï¼ˆfine-tuningï¼‰
</span></span><span class="line"><span class="cl"><span class="k">2.</span> <span class="gs">**GPU åŠ é€Ÿ**</span>ï¼šè‡ªåŠ¨æ£€æµ‹å¹¶ä½¿ç”¨ CUDA GPU è¿›è¡Œè®­ç»ƒ
</span></span><span class="line"><span class="cl"><span class="k">3.</span> <span class="gs">**æ‰¹å¤„ç†**</span>ï¼šä½¿ç”¨ DataLoader é«˜æ•ˆåŠ è½½æ•°æ®
</span></span><span class="line"><span class="cl"><span class="k">4.</span> <span class="gs">**è‡ªåŠ¨æ¢¯åº¦**</span>ï¼šPyTorch çš„è‡ªåŠ¨å¾®åˆ†ç³»ç»Ÿ
</span></span><span class="line"><span class="cl"><span class="k">5.</span> <span class="gs">**æ¨¡å‹éƒ¨ç½²**</span>ï¼šä¿å­˜è®­ç»ƒå¥½çš„æ¨¡å‹ä¾›åç»­ä½¿ç”¨
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="gu">## ğŸ“ˆ **åº”ç”¨åœºæ™¯**
</span></span></span><span class="line"><span class="cl"><span class="k">-</span> ç”µå•†å¹³å°ï¼šåˆ†æç”¨æˆ·è¯„ä»·
</span></span><span class="line"><span class="cl"><span class="k">-</span> ç¤¾äº¤åª’ä½“ï¼šç›‘æµ‹èˆ†æƒ…
</span></span><span class="line"><span class="cl"><span class="k">-</span> å®¢æœç³»ç»Ÿï¼šè‡ªåŠ¨åˆ†æå®¢æˆ·åé¦ˆ
</span></span><span class="line"><span class="cl"><span class="k">-</span> å†…å®¹å¹³å°ï¼šæ¨èç³»ç»Ÿçš„ä¸€éƒ¨åˆ†
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="gu">## âš ï¸ **æ³¨æ„äº‹é¡¹**
</span></span></span><span class="line"><span class="cl"><span class="k">-</span> æ¼”ç¤ºä¸­åªç”¨äº†å¾ˆå°‘çš„æ•°æ®ï¼ŒçœŸå®åº”ç”¨éœ€è¦æ›´å¤šæ•°æ®
</span></span><span class="line"><span class="cl"><span class="k">-</span> æ¨¡å‹æ€§èƒ½å–å†³äºè®­ç»ƒæ•°æ®é‡å’Œè´¨é‡
</span></span><span class="line"><span class="cl"><span class="k">-</span> å¯ä»¥è°ƒæ•´è¶…å‚æ•°ï¼ˆå­¦ä¹ ç‡ã€batch sizeã€è®­ç»ƒè½®æ•°ç­‰ï¼‰ä¼˜åŒ–æ•ˆæœ
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">è¿™ä¸ªä»£ç å±•ç¤ºäº†**ä»æ•°æ®å‡†å¤‡åˆ°æ¨¡å‹è®­ç»ƒã€è¯„ä¼°ã€ä¿å­˜çš„å®Œæ•´æœºå™¨å­¦ä¹ å·¥ä½œæµç¨‹**ï¼Œæ˜¯ NLP é¢†åŸŸçš„ä¸€ä¸ªç»å…¸å…¥é—¨ç¤ºä¾‹ï¼</span></span></code></pre></td></tr></table>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-headline-16" class="outline-5">
<h5 id="headline-16">
è¿è¡Œts3.py
</h5>
<div id="outline-text-headline-16" class="outline-text-5">
<div class="src src-bash">
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ python ts3.py
</span></span><span class="line"><span class="cl">Some weights of BertForSequenceClassification were not initialized from the model checkpoint at bert-base-uncased and are newly initialized: <span class="o">[</span><span class="s1">&#39;classifier.bias&#39;</span>, <span class="s1">&#39;classifier.weight&#39;</span><span class="o">]</span>
</span></span><span class="line"><span class="cl">You should probably TRAIN this model on a down-stream task to be able to use it <span class="k">for</span> predictions and inference.
</span></span><span class="line"><span class="cl">Loading BERT model and tokenizer...
</span></span><span class="line"><span class="cl">Loading IMDb dataset...
</span></span><span class="line"><span class="cl">Tokenizing data...
</span></span><span class="line"><span class="cl">Map: 100%<span class="p">|</span>â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’<span class="p">|</span> 25000/25000 <span class="o">[</span>00:04&lt;00:00, 5796.14 examples/s<span class="o">]</span>
</span></span><span class="line"><span class="cl">Map: 100%<span class="p">|</span>â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’<span class="p">|</span> 25000/25000 <span class="o">[</span>00:04&lt;00:00, 5359.47 examples/s<span class="o">]</span>
</span></span><span class="line"><span class="cl">Map: 100%<span class="p">|</span>â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’<span class="p">|</span> 50000/50000 <span class="o">[</span>00:10&lt;00:00, 4998.96 examples/s<span class="o">]</span>
</span></span><span class="line"><span class="cl">Creating data loaders...
</span></span><span class="line"><span class="cl">Training samples: <span class="m">100</span>
</span></span><span class="line"><span class="cl">Test samples: <span class="m">20</span>
</span></span><span class="line"><span class="cl">Model moved to: cuda
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Starting training...
</span></span><span class="line"><span class="cl">Epoch 1, Batch 1/13, Loss: 0.6865
</span></span><span class="line"><span class="cl">Epoch 1, Batch 6/13, Loss: 0.0891
</span></span><span class="line"><span class="cl">Epoch 1, Batch 11/13, Loss: 0.0209
</span></span><span class="line"><span class="cl">Epoch <span class="m">1</span> completed, Average Loss: 0.1602
</span></span><span class="line"><span class="cl">Epoch 2, Batch 1/13, Loss: 0.0118
</span></span><span class="line"><span class="cl">Epoch 2, Batch 6/13, Loss: 0.0051
</span></span><span class="line"><span class="cl">Epoch 2, Batch 11/13, Loss: 0.0033
</span></span><span class="line"><span class="cl">Epoch <span class="m">2</span> completed, Average Loss: 0.0058
</span></span><span class="line"><span class="cl">Epoch 3, Batch 1/13, Loss: 0.0027
</span></span><span class="line"><span class="cl">Epoch 3, Batch 6/13, Loss: 0.0020
</span></span><span class="line"><span class="cl">Epoch 3, Batch 11/13, Loss: 0.0017
</span></span><span class="line"><span class="cl">Epoch <span class="m">3</span> completed, Average Loss: 0.0020
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Model saved as <span class="s1">&#39;model.pt&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Testing model...
</span></span><span class="line"><span class="cl">Test Accuracy: 100.00% <span class="o">(</span>20/20<span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Single sample inference:
</span></span><span class="line"><span class="cl">Input: This movie was absolutely fantastic! I loved every minute of it.
</span></span><span class="line"><span class="cl">Positive score: 0.0017
</span></span><span class="line"><span class="cl">Negative score: 0.9983
</span></span><span class="line"><span class="cl">Prediction: Negative
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Training completed successfully!</span></span></code></pre></td></tr></table>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-headline-17" class="outline-3">
<h3 id="headline-17">
æ¨¡å‹åŠ è½½ä¸æ¨ç†
</h3>
<div id="outline-text-headline-17" class="outline-text-3">
<div id="outline-container-headline-18" class="outline-4">
<h4 id="headline-18">
ä½¿ç”¨ Hugging Face æ•°æ®é›†
</h4>
<div id="outline-text-headline-18" class="outline-text-4">
<div id="outline-container-headline-19" class="outline-5">
<h5 id="headline-19">
ts4.py
</h5>
<div id="outline-text-headline-19" class="outline-text-5">
<div class="src src-bash">
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">import torch
</span></span><span class="line"><span class="cl">from transformers import AutoModelForSequenceClassification, AutoTokenizer
</span></span><span class="line"><span class="cl">import warnings
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># å±è”½è­¦å‘Š</span>
</span></span><span class="line"><span class="cl">warnings.filterwarnings<span class="o">(</span><span class="s2">&#34;ignore&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">def load_model<span class="o">(</span><span class="nv">model_path</span><span class="o">=</span><span class="s2">&#34;model.pt&#34;</span>, <span class="nv">model_name</span><span class="o">=</span><span class="s2">&#34;bert-base-uncased&#34;</span><span class="o">)</span>:
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    Load trained model
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    print<span class="o">(</span><span class="s2">&#34;Loading tokenizer...&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="nv">tokenizer</span> <span class="o">=</span> AutoTokenizer.from_pretrained<span class="o">(</span>model_name<span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    print<span class="o">(</span><span class="s2">&#34;Loading base model...&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="nv">model</span> <span class="o">=</span> AutoModelForSequenceClassification.from_pretrained<span class="o">(</span>model_name, <span class="nv">num_labels</span><span class="o">=</span>2<span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    print<span class="o">(</span>f<span class="s2">&#34;Loading fine-tuned weights from {model_path}...&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    model.load_state_dict<span class="o">(</span>torch.load<span class="o">(</span>model_path, <span class="nv">weights_only</span><span class="o">=</span>True<span class="o">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Move to GPU if available</span>
</span></span><span class="line"><span class="cl">    <span class="nv">device</span> <span class="o">=</span> torch.device<span class="o">(</span><span class="s2">&#34;cuda&#34;</span> <span class="k">if</span> torch.cuda.is_available<span class="o">()</span> <span class="k">else</span> <span class="s2">&#34;cpu&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    model.to<span class="o">(</span>device<span class="o">)</span>
</span></span><span class="line"><span class="cl">    model.eval<span class="o">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    print<span class="o">(</span>f<span class="s2">&#34;Model loaded and moved to {device}&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> model, tokenizer, device
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">def predict_single<span class="o">(</span>text, model, tokenizer, device, <span class="nv">max_length</span><span class="o">=</span>128<span class="o">)</span>:
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    Predict single text
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Preprocess input</span>
</span></span><span class="line"><span class="cl">    <span class="nv">inputs</span> <span class="o">=</span> tokenizer<span class="o">(</span>
</span></span><span class="line"><span class="cl">        text,
</span></span><span class="line"><span class="cl">        <span class="nv">return_tensors</span><span class="o">=</span><span class="s2">&#34;pt&#34;</span>,
</span></span><span class="line"><span class="cl">        <span class="nv">truncation</span><span class="o">=</span>True,
</span></span><span class="line"><span class="cl">        <span class="nv">padding</span><span class="o">=</span><span class="s2">&#34;max_length&#34;</span>,
</span></span><span class="line"><span class="cl">        <span class="nv">max_length</span><span class="o">=</span>max_length
</span></span><span class="line"><span class="cl">    <span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="nv">inputs</span> <span class="o">=</span> <span class="o">{</span>k: v.to<span class="o">(</span>device<span class="o">)</span> <span class="k">for</span> k, v in inputs.items<span class="o">()}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Inference</span>
</span></span><span class="line"><span class="cl">    with torch.no_grad<span class="o">()</span>:
</span></span><span class="line"><span class="cl">        <span class="nv">outputs</span> <span class="o">=</span> model<span class="o">(</span>**inputs<span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="nv">logits</span> <span class="o">=</span> outputs.logits
</span></span><span class="line"><span class="cl">        <span class="nv">probabilities</span> <span class="o">=</span> torch.softmax<span class="o">(</span>logits, <span class="nv">dim</span><span class="o">=</span>-1<span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="nv">prediction</span> <span class="o">=</span> torch.argmax<span class="o">(</span>logits, <span class="nv">dim</span><span class="o">=</span>1<span class="o">)</span>.item<span class="o">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;text&#34;</span>: text,
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;prediction&#34;</span>: prediction,  <span class="c1"># 0=negative, 1=positive</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;confidence&#34;</span>: probabilities<span class="o">[</span>0<span class="o">][</span>prediction<span class="o">]</span>.item<span class="o">()</span>,
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;negative_score&#34;</span>: probabilities<span class="o">[</span>0<span class="o">][</span>0<span class="o">]</span>.item<span class="o">()</span>,
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;positive_score&#34;</span>: probabilities<span class="o">[</span>0<span class="o">][</span>1<span class="o">]</span>.item<span class="o">()</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">def print_result<span class="o">(</span>result<span class="o">)</span>:
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    Print result - English only
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">sentiment</span> <span class="o">=</span> <span class="s2">&#34;Positive&#34;</span> <span class="k">if</span> result<span class="o">[</span><span class="s1">&#39;prediction&#39;</span><span class="o">]</span> <span class="o">==</span> <span class="m">1</span> <span class="k">else</span> <span class="s2">&#34;Negative&#34;</span>
</span></span><span class="line"><span class="cl">    print<span class="o">(</span>f<span class="s2">&#34;\nText: {result[&#39;text&#39;]}&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    print<span class="o">(</span>f<span class="s2">&#34;Prediction: {sentiment}&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    print<span class="o">(</span>f<span class="s2">&#34;Confidence: {result[&#39;confidence&#39;]:.2%}&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    print<span class="o">(</span>f<span class="s2">&#34;Positive score: {result[&#39;positive_score&#39;]:.4f}&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    print<span class="o">(</span>f<span class="s2">&#34;Negative score: {result[&#39;negative_score&#39;]:.4f}&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    print<span class="o">(</span><span class="s2">&#34;-&#34;</span> * 50<span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">def main<span class="o">()</span>:
</span></span><span class="line"><span class="cl">    try:
</span></span><span class="line"><span class="cl">        <span class="c1"># 1. Load model</span>
</span></span><span class="line"><span class="cl">        model, tokenizer, <span class="nv">device</span> <span class="o">=</span> load_model<span class="o">(</span><span class="s2">&#34;model.pt&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># 2. Single sample inference</span>
</span></span><span class="line"><span class="cl">        print<span class="o">(</span><span class="s2">&#34;\n&#34;</span> + <span class="s2">&#34;=&#34;</span>*50<span class="o">)</span>
</span></span><span class="line"><span class="cl">        print<span class="o">(</span><span class="s2">&#34;Single Sample Inference Test&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">        print<span class="o">(</span><span class="s2">&#34;=&#34;</span>*50<span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nv">test_cases</span> <span class="o">=</span> <span class="o">[</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;This movie was absolutely fantastic! I loved every minute of it.&#34;</span>,
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;Waste of time and money. Terrible acting and boring story.&#34;</span>,
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;It was okay, not great but not bad either.&#34;</span>,
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;The special effects were amazing but the plot was weak.&#34;</span>,
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;I&#39;ve never seen such a wonderful performance in my life!&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="o">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">for</span> text in test_cases:
</span></span><span class="line"><span class="cl">            <span class="nv">result</span> <span class="o">=</span> predict_single<span class="o">(</span>text, model, tokenizer, device<span class="o">)</span>
</span></span><span class="line"><span class="cl">            print_result<span class="o">(</span>result<span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># 3. Interactive inference</span>
</span></span><span class="line"><span class="cl">        print<span class="o">(</span><span class="s2">&#34;\n&#34;</span> + <span class="s2">&#34;=&#34;</span>*50<span class="o">)</span>
</span></span><span class="line"><span class="cl">        print<span class="o">(</span><span class="s2">&#34;Interactive Inference (Type &#39;quit&#39; or Ctrl+C to exit)&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">        print<span class="o">(</span><span class="s2">&#34;=&#34;</span>*50<span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">while</span> True:
</span></span><span class="line"><span class="cl">            try:
</span></span><span class="line"><span class="cl">                <span class="nv">user_input</span> <span class="o">=</span> input<span class="o">(</span><span class="s2">&#34;\nEnter English text to analyze: &#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> user_input.lower<span class="o">()</span> <span class="o">==</span> <span class="s1">&#39;quit&#39;</span>:
</span></span><span class="line"><span class="cl">                    <span class="nb">break</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                <span class="k">if</span> user_input.strip<span class="o">()</span>:
</span></span><span class="line"><span class="cl">                    <span class="nv">result</span> <span class="o">=</span> predict_single<span class="o">(</span>user_input, model, tokenizer, device<span class="o">)</span>
</span></span><span class="line"><span class="cl">                    print_result<span class="o">(</span>result<span class="o">)</span>
</span></span><span class="line"><span class="cl">            except KeyboardInterrupt:
</span></span><span class="line"><span class="cl">                print<span class="o">(</span><span class="s2">&#34;\n\nExited by user&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">                <span class="nb">break</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    except FileNotFoundError:
</span></span><span class="line"><span class="cl">        print<span class="o">(</span><span class="s2">&#34;Error: model.pt not found. Please run training script first.&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    except Exception as e:
</span></span><span class="line"><span class="cl">        print<span class="o">(</span>f<span class="s2">&#34;Error occurred: {e}&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="nv">__name__</span> <span class="o">==</span> <span class="s2">&#34;__main__&#34;</span>:
</span></span><span class="line"><span class="cl">    main<span class="o">()</span></span></span></code></pre></td></tr></table>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-headline-20" class="outline-5">
<h5 id="headline-20">
ts4.pyçš„ä½œç”¨
</h5>
<div id="outline-text-headline-20" class="outline-text-5">
<div class="src src-markdown">
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-markdown" data-lang="markdown"><span class="line"><span class="cl">è¿™ä¸ªä»£ç æ˜¯ä¸€ä¸ª**å®Œæ•´çš„é¢„è®­ç»ƒæ¨¡å‹åŠ è½½ä¸æ¨ç†ç³»ç»Ÿ**ï¼Œç”¨äºæƒ…æ„Ÿåˆ†æï¼ˆSentiment Analysisï¼‰ã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†çš„ä½œç”¨åˆ†æï¼š
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="gu">## ğŸ¯ **æ ¸å¿ƒåŠŸèƒ½**
</span></span></span><span class="line"><span class="cl">,**æƒ…æ„Ÿåˆ†ç±»**ï¼šåˆ¤æ–­è‹±æ–‡æ–‡æœ¬çš„æƒ…æ„Ÿå€¾å‘ï¼ˆæ­£é¢/è´Ÿé¢ï¼‰ï¼Œä¸»è¦ç”¨äºç”µå½±è¯„è®ºåˆ†æã€‚
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="gu">## ğŸ› ï¸ **æŠ€æœ¯æ¶æ„**
</span></span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="gu">### 1. **æ¨¡å‹ç®¡ç†æ¨¡å—**
</span></span></span><span class="line"><span class="cl"><span class="s">```python
</span></span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">load_model</span><span class="p">(</span><span class="n">model_path</span><span class="o">=</span><span class="s2">&#34;model.pt&#34;</span><span class="p">,</span> <span class="n">model_name</span><span class="o">=</span><span class="s2">&#34;bert-base-uncased&#34;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl"><span class="s">```</span>
</span></span><span class="line"><span class="cl"><span class="k">-</span> **åŠ è½½é¢„è®­ç»ƒæ¨¡å‹**ï¼šä½¿ç”¨ Hugging Face çš„ <span class="sb">`bert-base-uncased`</span> ä½œä¸ºåŸºç¡€
</span></span><span class="line"><span class="cl"><span class="k">-</span> **åŠ è½½å¾®è°ƒæƒé‡**ï¼šä»æœ¬åœ°æ–‡ä»¶ <span class="sb">`model.pt`</span> åŠ è½½ç‰¹å®šä»»åŠ¡çš„è®­ç»ƒç»“æœ
</span></span><span class="line"><span class="cl"><span class="k">-</span> **è®¾å¤‡ç®¡ç†**ï¼šè‡ªåŠ¨æ£€æµ‹å¹¶åˆ©ç”¨ GPU åŠ é€Ÿï¼ˆCUDAï¼‰
</span></span><span class="line"><span class="cl"><span class="k">-</span> **æ¨¡å¼åˆ‡æ¢**ï¼šè®¾ç½®ä¸ºè¯„ä¼°æ¨¡å¼ (<span class="sb">`model.eval()`</span>)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="gu">### 2. **æ¨ç†å¼•æ“æ¨¡å—**
</span></span></span><span class="line"><span class="cl"><span class="s">```python
</span></span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">predict_single</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">tokenizer</span><span class="p">,</span> <span class="n">device</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">128</span><span class="p">):</span>
</span></span><span class="line"><span class="cl"><span class="s">```</span>
</span></span><span class="line"><span class="cl"><span class="k">-</span> **æ–‡æœ¬é¢„å¤„ç†**ï¼š
</span></span><span class="line"><span class="cl">  <span class="k">-</span> åˆ†è¯ï¼ˆTokenizationï¼‰
</span></span><span class="line"><span class="cl">  <span class="k">-</span> æˆªæ–­ï¼ˆTruncationï¼‰
</span></span><span class="line"><span class="cl">  <span class="k">-</span> å¡«å……ï¼ˆPaddingï¼‰
</span></span><span class="line"><span class="cl">  <span class="k">-</span> è½¬æ¢ä¸ºå¼ é‡
</span></span><span class="line"><span class="cl"><span class="k">-</span> **æ¨¡å‹æ¨ç†**ï¼š
</span></span><span class="line"><span class="cl">  <span class="k">-</span> ç¦ç”¨æ¢¯åº¦è®¡ç®—ï¼ˆ<span class="sb">`torch.no_grad()`</span>ï¼‰
</span></span><span class="line"><span class="cl">  <span class="k">-</span> å‰å‘ä¼ æ’­
</span></span><span class="line"><span class="cl">  <span class="k">-</span> Softmax æ¦‚ç‡è½¬æ¢
</span></span><span class="line"><span class="cl">  <span class="k">-</span> åˆ†ç±»å†³ç­–
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="gu">### 3. **äº¤äº’ç³»ç»Ÿæ¨¡å—**
</span></span></span><span class="line"><span class="cl"><span class="k">-</span> **æ‰¹é‡æµ‹è¯•**ï¼šé¢„è®¾æµ‹è¯•ç”¨ä¾‹éªŒè¯æ¨¡å‹æ•ˆæœ
</span></span><span class="line"><span class="cl"><span class="k">-</span> **äº¤äº’æ¨¡å¼**ï¼šç”¨æˆ·å¯å®æ—¶è¾“å…¥æ–‡æœ¬è¿›è¡Œåˆ†æ
</span></span><span class="line"><span class="cl"><span class="k">-</span> **é”™è¯¯å¤„ç†**ï¼šæ–‡ä»¶ä¸å­˜åœ¨ã€ç”¨æˆ·ä¸­æ–­ç­‰å¼‚å¸¸å¤„ç†
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="gu">## ğŸ”„ **å·¥ä½œæµç¨‹**
</span></span></span><span class="line"><span class="cl"><span class="s">```
</span></span></span><span class="line"><span class="cl">è¾“å…¥æ–‡æœ¬ â†’ åˆ†è¯ç¼–ç  â†’ æ¨¡å‹æ¨ç† â†’ æ¦‚ç‡è®¡ç®— â†’ åˆ†ç±»è¾“å‡º
</span></span><span class="line"><span class="cl">    â†“         â†“          â†“         â†“         â†“
</span></span><span class="line"><span class="cl"> &#34;I love it&#34; â†’ [101, 1045, ...] â†’ Logits â†’ Softmax â†’ &#34;Positive (99%)&#34;
</span></span><span class="line"><span class="cl"><span class="s">```</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="gu">## ğŸ“Š **è¾“å‡ºæ ¼å¼**
</span></span></span><span class="line"><span class="cl"><span class="s">```python
</span></span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;text&#34;</span><span class="p">:</span> <span class="s2">&#34;This movie was fantastic!&#34;</span><span class="p">,</span>      <span class="c1"># åŸå§‹æ–‡æœ¬</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;prediction&#34;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>                          <span class="c1"># 0=è´Ÿé¢, 1=æ­£é¢</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;confidence&#34;</span><span class="p">:</span> <span class="mf">0.9983</span><span class="p">,</span>                     <span class="c1"># é¢„æµ‹ç½®ä¿¡åº¦</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;negative_score&#34;</span><span class="p">:</span> <span class="mf">0.0017</span><span class="p">,</span>                 <span class="c1"># è´Ÿé¢æ¦‚ç‡</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;positive_score&#34;</span><span class="p">:</span> <span class="mf">0.9983</span>                  <span class="c1"># æ­£é¢æ¦‚ç‡</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="s">```</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="gu">## ğŸ”§ **å…³é”®æŠ€æœ¯ç‚¹**
</span></span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="gu">### 1. **è¿ç§»å­¦ä¹ **
</span></span></span><span class="line"><span class="cl"><span class="s">```python
</span></span></span><span class="line"><span class="cl"><span class="c1"># é¢„è®­ç»ƒæ¨¡å‹ + å¾®è°ƒæƒé‡</span>
</span></span><span class="line"><span class="cl"><span class="n">base_model</span> <span class="o">=</span> <span class="n">AutoModelForSequenceClassification</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="s2">&#34;bert-base-uncased&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">base_model</span><span class="o">.</span><span class="n">load_state_dict</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&#34;model.pt&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="s">```</span>
</span></span><span class="line"><span class="cl"><span class="k">-</span> **é¢„è®­ç»ƒ**ï¼šåœ¨å¤§è§„æ¨¡è¯­æ–™ä¸Šè®­ç»ƒçš„é€šç”¨è¯­è¨€ç†è§£èƒ½åŠ›
</span></span><span class="line"><span class="cl"><span class="k">-</span> **å¾®è°ƒ**ï¼šåœ¨ç‰¹å®šä»»åŠ¡ï¼ˆæƒ…æ„Ÿåˆ†æï¼‰ä¸Šè¿›ä¸€æ­¥è®­ç»ƒ
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="gu">### 2. **GPUåŠ é€Ÿ**
</span></span></span><span class="line"><span class="cl"><span class="s">```python
</span></span></span><span class="line"><span class="cl"><span class="n">device</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s2">&#34;cuda&#34;</span> <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">()</span> <span class="k">else</span> <span class="s2">&#34;cpu&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">model</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="s">```</span>
</span></span><span class="line"><span class="cl"><span class="k">-</span> è‡ªåŠ¨æ£€æµ‹ GPU å¯ç”¨æ€§
</span></span><span class="line"><span class="cl"><span class="k">-</span> å°†æ¨¡å‹å’Œæ•°æ®ç§»è‡³ GPU è¿›è¡ŒåŠ é€Ÿè®¡ç®—
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="gu">### 3. **æ¨ç†ä¼˜åŒ–**
</span></span></span><span class="line"><span class="cl"><span class="s">```python
</span></span></span><span class="line"><span class="cl"><span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>  <span class="c1"># ç¦ç”¨æ¢¯åº¦è®¡ç®—</span>
</span></span><span class="line"><span class="cl">    <span class="n">outputs</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="o">**</span><span class="n">inputs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="s">```</span>
</span></span><span class="line"><span class="cl"><span class="k">-</span> **å†…å­˜ä¼˜åŒ–**ï¼šä¸ä¿å­˜ä¸­é—´æ¢¯åº¦å€¼
</span></span><span class="line"><span class="cl"><span class="k">-</span> **é€Ÿåº¦ä¼˜åŒ–**ï¼šå‡å°‘ä¸å¿…è¦çš„è®¡ç®—
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="gu">## ğŸª **ä½¿ç”¨åœºæ™¯**
</span></span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="gu">### 1. **è´¨é‡ç›‘æ§**
</span></span></span><span class="line"><span class="cl"><span class="s">```python
</span></span></span><span class="line"><span class="cl"><span class="c1"># æ‰¹é‡åˆ†æç”¨æˆ·è¯„è®º</span>
</span></span><span class="line"><span class="cl"><span class="n">reviews</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;Great product!&#34;</span><span class="p">,</span> <span class="s2">&#34;Terrible service&#34;</span><span class="p">,</span> <span class="s2">&#34;Average experience&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">review</span> <span class="ow">in</span> <span class="n">reviews</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">result</span> <span class="o">=</span> <span class="n">predict_single</span><span class="p">(</span><span class="n">review</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">tokenizer</span><span class="p">,</span> <span class="n">device</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="s">```</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="gu">### 2. **å®æ—¶åˆ†æ**
</span></span></span><span class="line"><span class="cl"><span class="s">```python
</span></span></span><span class="line"><span class="cl"><span class="c1"># å®¢æœç³»ç»Ÿå®æ—¶æƒ…æ„Ÿåˆ†æ</span>
</span></span><span class="line"><span class="cl"><span class="k">while</span> <span class="n">user_is_talking</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">text</span> <span class="o">=</span> <span class="n">get_latest_message</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">sentiment</span> <span class="o">=</span> <span class="n">predict_single</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">tokenizer</span><span class="p">,</span> <span class="n">device</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">sentiment</span><span class="p">[</span><span class="s2">&#34;prediction&#34;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">escalate_to_supervisor</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="s">```</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="gu">### 3. **æ•°æ®æ ‡æ³¨è¾…åŠ©**
</span></span></span><span class="line"><span class="cl"><span class="s">```python
</span></span></span><span class="line"><span class="cl"><span class="c1"># åŠè‡ªåŠ¨æ ‡æ³¨å·¥å…·</span>
</span></span><span class="line"><span class="cl"><span class="n">unlabeled_texts</span> <span class="o">=</span> <span class="p">[</span><span class="o">...</span><span class="p">]</span>  <span class="c1"># å¤§é‡æœªæ ‡æ³¨æ•°æ®</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">text</span> <span class="ow">in</span> <span class="n">unlabeled_texts</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">prediction</span> <span class="o">=</span> <span class="n">predict_single</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">tokenizer</span><span class="p">,</span> <span class="n">device</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">prediction</span><span class="p">[</span><span class="s2">&#34;confidence&#34;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.95</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">auto_label</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">prediction</span><span class="p">[</span><span class="s2">&#34;prediction&#34;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="s">```</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="gu">## âš¡ **æ€§èƒ½ç‰¹å¾**
</span></span></span><span class="line"><span class="cl"><span class="k">-</span> **å»¶è¿Ÿ**ï¼šå•æ¬¡æ¨ç†çº¦ 10-50msï¼ˆå–å†³äºæ–‡æœ¬é•¿åº¦å’Œç¡¬ä»¶ï¼‰
</span></span><span class="line"><span class="cl"><span class="k">-</span> **ååé‡**ï¼šæ‰¹é‡å¤„ç†å¯å¤§å¹…æé«˜æ•ˆç‡
</span></span><span class="line"><span class="cl"><span class="k">-</span> **å†…å­˜å ç”¨**ï¼šBERT-base çº¦ 440MBï¼Œå¾®è°ƒéƒ¨åˆ†å¾ˆå°
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="gu">## ğŸ” **æ‰©å±•å¯èƒ½æ€§**
</span></span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="gu">### 1. **å¤šè¯­è¨€æ”¯æŒ**
</span></span></span><span class="line"><span class="cl"><span class="s">```python
</span></span></span><span class="line"><span class="cl"><span class="c1"># åˆ‡æ¢ä¸ºå¤šè¯­è¨€æ¨¡å‹</span>
</span></span><span class="line"><span class="cl"><span class="n">model_name</span> <span class="o">=</span> <span class="s2">&#34;bert-base-multilingual-cased&#34;</span>
</span></span><span class="line"><span class="cl"><span class="s">```</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="gu">### 2. **å¤šåˆ†ç±»ä»»åŠ¡**
</span></span></span><span class="line"><span class="cl"><span class="s">```python
</span></span></span><span class="line"><span class="cl"><span class="c1"># ä¿®æ”¹ä¸º5åˆ†ç±»ï¼ˆéå¸¸è´Ÿé¢ã€è´Ÿé¢ã€ä¸­æ€§ã€æ­£é¢ã€éå¸¸æ­£é¢ï¼‰</span>
</span></span><span class="line"><span class="cl"><span class="n">model</span> <span class="o">=</span> <span class="n">AutoModelForSequenceClassification</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;bert-base-uncased&#34;</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">    <span class="n">num_labels</span><span class="o">=</span><span class="mi">5</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="s">```</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="gu">### 3. **APIæœåŠ¡åŒ–**
</span></span></span><span class="line"><span class="cl"><span class="s">```python
</span></span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">jsonify</span>
</span></span><span class="line"><span class="cl"><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/predict&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">predict_api</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">text</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;text&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">result</span> <span class="o">=</span> <span class="n">predict_single</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">tokenizer</span><span class="p">,</span> <span class="n">device</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="s">```</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="gu">## ğŸ“ˆ **æ¨¡å‹è¯„ä¼°**
</span></span></span><span class="line"><span class="cl">ä»ä½ çš„è¾“å‡ºå¯ä»¥çœ‹åˆ°ï¼š
</span></span><span class="line"><span class="cl"><span class="k">-</span> **é«˜ç½®ä¿¡åº¦é—®é¢˜**ï¼šæ‰€æœ‰é¢„æµ‹ç½®ä¿¡åº¦ &gt;98%
</span></span><span class="line"><span class="cl"><span class="k">-</span> **å¯èƒ½çš„è¿‡æ‹Ÿåˆ**ï¼šæ¨¡å‹å¯èƒ½è¿‡äºåå‘æŸä¸ªç±»åˆ«
</span></span><span class="line"><span class="cl"><span class="k">-</span> **æ”¹è¿›æ–¹å‘**ï¼š
</span></span><span class="line"><span class="cl">  <span class="k">1.</span> å¢åŠ è®­ç»ƒæ•°æ®é‡
</span></span><span class="line"><span class="cl">  <span class="k">2.</span> å¹³è¡¡æ­£è´Ÿæ ·æœ¬
</span></span><span class="line"><span class="cl">  <span class="k">3.</span> æ·»åŠ æ­£åˆ™åŒ–
</span></span><span class="line"><span class="cl">  <span class="k">4.</span> è°ƒæ•´å­¦ä¹ ç‡
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="gu">## ğŸ’¡ **æ€»ç»“**
</span></span></span><span class="line"><span class="cl">è¿™ä¸ªä»£ç å±•ç¤ºäº†**å·¥ä¸šçº§ NLP æ¨ç†ç³»ç»Ÿçš„æ ¸å¿ƒç»„ä»¶**ï¼š
</span></span><span class="line"><span class="cl"><span class="k">-</span> **æ¨¡å—åŒ–è®¾è®¡**ï¼šæ¨¡å‹åŠ è½½ã€æ¨ç†ã€äº¤äº’åˆ†ç¦»
</span></span><span class="line"><span class="cl"><span class="k">-</span> **ç”Ÿäº§å°±ç»ª**ï¼šé”™è¯¯å¤„ç†ã€è®¾å¤‡ç®¡ç†ã€æ€§èƒ½ä¼˜åŒ–
</span></span><span class="line"><span class="cl"><span class="k">-</span> **æ˜“äºæ‰©å±•**ï¼šæ”¯æŒæ‰¹å¤„ç†ã€API é›†æˆç­‰
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">å®ƒæ˜¯å°†å­¦æœ¯ç ”ç©¶è½¬åŒ–ä¸ºå®é™…åº”ç”¨çš„å…¸å‹ç¤ºä¾‹ï¼</span></span></code></pre></td></tr></table>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-headline-21" class="outline-5">
<h5 id="headline-21">
è¿è¡Œts4.py
</h5>
<div id="outline-text-headline-21" class="outline-text-5">
<p>quité€€å‡º</p>
<div class="src src-bash">
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ python ts4.py
</span></span><span class="line"><span class="cl">Some weights of BertForSequenceClassification were not initialized from the model checkpoint at bert-base-uncased and are newly initialized: <span class="o">[</span><span class="s1">&#39;classifier.bias&#39;</span>, <span class="s1">&#39;classifier.weight&#39;</span><span class="o">]</span>
</span></span><span class="line"><span class="cl">You should probably TRAIN this model on a down-stream task to be able to use it <span class="k">for</span> predictions and inference.
</span></span><span class="line"><span class="cl">Loading tokenizer...
</span></span><span class="line"><span class="cl">Loading base model...
</span></span><span class="line"><span class="cl">Loading fine-tuned weights from model.pt...
</span></span><span class="line"><span class="cl">Model loaded and moved to <span class="nv">cuda</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">==================================================</span>
</span></span><span class="line"><span class="cl">Single Sample Inference <span class="nv">Test</span>
</span></span><span class="line"><span class="cl"><span class="o">==================================================</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Text: This movie was absolutely fantastic! I loved every minute of it.
</span></span><span class="line"><span class="cl">Prediction: Negative
</span></span><span class="line"><span class="cl">Confidence: 99.83%
</span></span><span class="line"><span class="cl">Positive score: 0.0017
</span></span><span class="line"><span class="cl">Negative score: 0.9983
</span></span><span class="line"><span class="cl">--------------------------------------------------
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Text: Waste of <span class="nb">time</span> and money. Terrible acting and boring story.
</span></span><span class="line"><span class="cl">Prediction: Negative
</span></span><span class="line"><span class="cl">Confidence: 99.85%
</span></span><span class="line"><span class="cl">Positive score: 0.0015
</span></span><span class="line"><span class="cl">Negative score: 0.9985
</span></span><span class="line"><span class="cl">--------------------------------------------------
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Text: It was okay, not great but not bad either.
</span></span><span class="line"><span class="cl">Prediction: Negative
</span></span><span class="line"><span class="cl">Confidence: 99.83%
</span></span><span class="line"><span class="cl">Positive score: 0.0017
</span></span><span class="line"><span class="cl">Negative score: 0.9983
</span></span><span class="line"><span class="cl">--------------------------------------------------
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Text: The special effects were amazing but the plot was weak.
</span></span><span class="line"><span class="cl">Prediction: Negative
</span></span><span class="line"><span class="cl">Confidence: 99.85%
</span></span><span class="line"><span class="cl">Positive score: 0.0015
</span></span><span class="line"><span class="cl">Negative score: 0.9985
</span></span><span class="line"><span class="cl">--------------------------------------------------
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Text: I<span class="s1">&#39;ve never seen such a wonderful performance in my life!
</span></span></span><span class="line"><span class="cl"><span class="s1">Prediction: Negative
</span></span></span><span class="line"><span class="cl"><span class="s1">Confidence: 99.83%
</span></span></span><span class="line"><span class="cl"><span class="s1">Positive score: 0.0017
</span></span></span><span class="line"><span class="cl"><span class="s1">Negative score: 0.9983
</span></span></span><span class="line"><span class="cl"><span class="s1">--------------------------------------------------
</span></span></span><span class="line"><span class="cl"><span class="s1">
</span></span></span><span class="line"><span class="cl"><span class="s1">==================================================
</span></span></span><span class="line"><span class="cl"><span class="s1">Interactive Inference (Type &#39;</span>quit<span class="err">&#39;</span> or Ctrl+C to <span class="nb">exit</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">==================================================</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Enter English text to analyze: quit</span></span></code></pre></td></tr></table>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-headline-22" class="outline-3">
<h3 id="headline-22">
ä½¿ç”¨è‡ªå®šä¹‰æ•°æ®ï¼Œæ•°æ®åŠ è½½ä¸é¢„å¤„ç†ã€æ¨¡å‹åŠ è½½ä¸ä¿å­˜ã€æ¨¡å‹æ¨ç†ä¸åŠ è½½
</h3>
<div id="outline-text-headline-22" class="outline-text-3">
<div id="outline-container-headline-23" class="outline-4">
<h4 id="headline-23">
ts5.py
</h4>
<div id="outline-text-headline-23" class="outline-text-4">
<div class="src src-python">
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span><span class="lnt">202
</span><span class="lnt">203
</span><span class="lnt">204
</span><span class="lnt">205
</span><span class="lnt">206
</span><span class="lnt">207
</span><span class="lnt">208
</span><span class="lnt">209
</span><span class="lnt">210
</span><span class="lnt">211
</span><span class="lnt">212
</span><span class="lnt">213
</span><span class="lnt">214
</span><span class="lnt">215
</span><span class="lnt">216
</span><span class="lnt">217
</span><span class="lnt">218
</span><span class="lnt">219
</span><span class="lnt">220
</span><span class="lnt">221
</span><span class="lnt">222
</span><span class="lnt">223
</span><span class="lnt">224
</span><span class="lnt">225
</span><span class="lnt">226
</span><span class="lnt">227
</span><span class="lnt">228
</span><span class="lnt">229
</span><span class="lnt">230
</span><span class="lnt">231
</span><span class="lnt">232
</span><span class="lnt">233
</span><span class="lnt">234
</span><span class="lnt">235
</span><span class="lnt">236
</span><span class="lnt">237
</span><span class="lnt">238
</span><span class="lnt">239
</span><span class="lnt">240
</span><span class="lnt">241
</span><span class="lnt">242
</span><span class="lnt">243
</span><span class="lnt">244
</span><span class="lnt">245
</span><span class="lnt">246
</span><span class="lnt">247
</span><span class="lnt">248
</span><span class="lnt">249
</span><span class="lnt">250
</span><span class="lnt">251
</span><span class="lnt">252
</span><span class="lnt">253
</span><span class="lnt">254
</span><span class="lnt">255
</span><span class="lnt">256
</span><span class="lnt">257
</span><span class="lnt">258
</span><span class="lnt">259
</span><span class="lnt">260
</span><span class="lnt">261
</span><span class="lnt">262
</span><span class="lnt">263
</span><span class="lnt">264
</span><span class="lnt">265
</span><span class="lnt">266
</span><span class="lnt">267
</span><span class="lnt">268
</span><span class="lnt">269
</span><span class="lnt">270
</span><span class="lnt">271
</span><span class="lnt">272
</span><span class="lnt">273
</span><span class="lnt">274
</span><span class="lnt">275
</span><span class="lnt">276
</span><span class="lnt">277
</span><span class="lnt">278
</span><span class="lnt">279
</span><span class="lnt">280
</span><span class="lnt">281
</span><span class="lnt">282
</span><span class="lnt">283
</span><span class="lnt">284
</span><span class="lnt">285
</span><span class="lnt">286
</span><span class="lnt">287
</span><span class="lnt">288
</span><span class="lnt">289
</span><span class="lnt">290
</span><span class="lnt">291
</span><span class="lnt">292
</span><span class="lnt">293
</span><span class="lnt">294
</span><span class="lnt">295
</span><span class="lnt">296
</span><span class="lnt">297
</span><span class="lnt">298
</span><span class="lnt">299
</span><span class="lnt">300
</span><span class="lnt">301
</span><span class="lnt">302
</span><span class="lnt">303
</span><span class="lnt">304
</span><span class="lnt">305
</span><span class="lnt">306
</span><span class="lnt">307
</span><span class="lnt">308
</span><span class="lnt">309
</span><span class="lnt">310
</span><span class="lnt">311
</span><span class="lnt">312
</span><span class="lnt">313
</span><span class="lnt">314
</span><span class="lnt">315
</span><span class="lnt">316
</span><span class="lnt">317
</span><span class="lnt">318
</span><span class="lnt">319
</span><span class="lnt">320
</span><span class="lnt">321
</span><span class="lnt">322
</span><span class="lnt">323
</span><span class="lnt">324
</span><span class="lnt">325
</span><span class="lnt">326
</span><span class="lnt">327
</span><span class="lnt">328
</span><span class="lnt">329
</span><span class="lnt">330
</span><span class="lnt">331
</span><span class="lnt">332
</span><span class="lnt">333
</span><span class="lnt">334
</span><span class="lnt">335
</span><span class="lnt">336
</span><span class="lnt">337
</span><span class="lnt">338
</span><span class="lnt">339
</span><span class="lnt">340
</span><span class="lnt">341
</span><span class="lnt">342
</span><span class="lnt">343
</span><span class="lnt">344
</span><span class="lnt">345
</span><span class="lnt">346
</span><span class="lnt">347
</span><span class="lnt">348
</span><span class="lnt">349
</span><span class="lnt">350
</span><span class="lnt">351
</span><span class="lnt">352
</span><span class="lnt">353
</span><span class="lnt">354
</span><span class="lnt">355
</span><span class="lnt">356
</span><span class="lnt">357
</span><span class="lnt">358
</span><span class="lnt">359
</span><span class="lnt">360
</span><span class="lnt">361
</span><span class="lnt">362
</span><span class="lnt">363
</span><span class="lnt">364
</span><span class="lnt">365
</span><span class="lnt">366
</span><span class="lnt">367
</span><span class="lnt">368
</span><span class="lnt">369
</span><span class="lnt">370
</span><span class="lnt">371
</span><span class="lnt">372
</span><span class="lnt">373
</span><span class="lnt">374
</span><span class="lnt">375
</span><span class="lnt">376
</span><span class="lnt">377
</span><span class="lnt">378
</span><span class="lnt">379
</span><span class="lnt">380
</span><span class="lnt">381
</span><span class="lnt">382
</span><span class="lnt">383
</span><span class="lnt">384
</span><span class="lnt">385
</span><span class="lnt">386
</span><span class="lnt">387
</span><span class="lnt">388
</span><span class="lnt">389
</span><span class="lnt">390
</span><span class="lnt">391
</span><span class="lnt">392
</span><span class="lnt">393
</span><span class="lnt">394
</span><span class="lnt">395
</span><span class="lnt">396
</span><span class="lnt">397
</span><span class="lnt">398
</span><span class="lnt">399
</span><span class="lnt">400
</span><span class="lnt">401
</span><span class="lnt">402
</span><span class="lnt">403
</span><span class="lnt">404
</span><span class="lnt">405
</span><span class="lnt">406
</span><span class="lnt">407
</span><span class="lnt">408
</span><span class="lnt">409
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># åœ¨ä»£ç å¼€å¤´æ·»åŠ </span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">sys</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">io</span>
</span></span><span class="line"><span class="cl"><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">TextIOWrapper</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">buffer</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">torch</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">torch.nn</span> <span class="k">as</span> <span class="nn">nn</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">torch.optim</span> <span class="k">as</span> <span class="nn">optim</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">torch.utils.data</span> <span class="kn">import</span> <span class="n">Dataset</span><span class="p">,</span> <span class="n">DataLoader</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">transformers</span> <span class="kn">import</span> <span class="n">AutoModelForSequenceClassification</span><span class="p">,</span> <span class="n">AutoTokenizer</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Optional</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ==================== 6.2 æ•°æ®åŠ è½½ä¸é¢„å¤„ç† ====================</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">TextDataset</span><span class="p">(</span><span class="n">Dataset</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;è‡ªå®šä¹‰æ–‡æœ¬æ•°æ®é›†ç±»&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">texts</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">labels</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">tokenizer</span><span class="p">,</span> <span class="n">max_length</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">128</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">        åˆå§‹åŒ–æ•°æ®é›†
</span></span></span><span class="line"><span class="cl"><span class="s2">        
</span></span></span><span class="line"><span class="cl"><span class="s2">        å‚æ•°:
</span></span></span><span class="line"><span class="cl"><span class="s2">            texts: æ–‡æœ¬åˆ—è¡¨
</span></span></span><span class="line"><span class="cl"><span class="s2">            labels: æ ‡ç­¾åˆ—è¡¨
</span></span></span><span class="line"><span class="cl"><span class="s2">            tokenizer: åˆ†è¯å™¨
</span></span></span><span class="line"><span class="cl"><span class="s2">            max_length: æœ€å¤§åºåˆ—é•¿åº¦
</span></span></span><span class="line"><span class="cl"><span class="s2">        &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">texts</span> <span class="o">=</span> <span class="n">texts</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">labels</span> <span class="o">=</span> <span class="n">labels</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">tokenizer</span> <span class="o">=</span> <span class="n">tokenizer</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">max_length</span> <span class="o">=</span> <span class="n">max_length</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;è¿”å›æ•°æ®é›†å¤§å°&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">texts</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;è·å–å•ä¸ªæ ·æœ¬&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">text</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">texts</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">        <span class="n">label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># å¯¹æ–‡æœ¬è¿›è¡Œç¼–ç </span>
</span></span><span class="line"><span class="cl">        <span class="n">encoding</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tokenizer</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="n">text</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">truncation</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;max_length&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">max_length</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">max_length</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">return_tensors</span><span class="o">=</span><span class="s1">&#39;pt&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># ç§»é™¤batchç»´åº¦</span>
</span></span><span class="line"><span class="cl">        <span class="n">item</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;input_ids&#39;</span><span class="p">:</span> <span class="n">encoding</span><span class="p">[</span><span class="s1">&#39;input_ids&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;attention_mask&#39;</span><span class="p">:</span> <span class="n">encoding</span><span class="p">[</span><span class="s1">&#39;attention_mask&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;labels&#39;</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">long</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">item</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ==================== æ¨¡å‹è®­ç»ƒä¸è¯„ä¼°ç±» ====================</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">TextClassifierTrainer</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;æ–‡æœ¬åˆ†ç±»è®­ç»ƒå™¨&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">                 <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&#34;bert-base-uncased&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                 <span class="n">num_labels</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                 <span class="n">device</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">        åˆå§‹åŒ–è®­ç»ƒå™¨
</span></span></span><span class="line"><span class="cl"><span class="s2">        
</span></span></span><span class="line"><span class="cl"><span class="s2">        å‚æ•°:
</span></span></span><span class="line"><span class="cl"><span class="s2">            model_name: é¢„è®­ç»ƒæ¨¡å‹åç§°
</span></span></span><span class="line"><span class="cl"><span class="s2">            num_labels: æ ‡ç­¾æ•°é‡
</span></span></span><span class="line"><span class="cl"><span class="s2">            device: è®¾å¤‡ (cpu/cuda)
</span></span></span><span class="line"><span class="cl"><span class="s2">        &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">device</span> <span class="k">if</span> <span class="n">device</span> <span class="k">else</span> <span class="p">(</span><span class="s1">&#39;cuda&#39;</span> <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">()</span> <span class="k">else</span> <span class="s1">&#39;cpu&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;ä½¿ç”¨è®¾å¤‡: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># åŠ è½½åˆ†è¯å™¨å’Œæ¨¡å‹</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">tokenizer</span> <span class="o">=</span> <span class="n">AutoTokenizer</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="n">model_name</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">AutoModelForSequenceClassification</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="n">model_name</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">            <span class="n">num_labels</span><span class="o">=</span><span class="n">num_labels</span>
</span></span><span class="line"><span class="cl">        <span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">num_labels</span> <span class="o">=</span> <span class="n">num_labels</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">create_dataloader</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">                         <span class="n">texts</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> 
</span></span><span class="line"><span class="cl">                         <span class="n">labels</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> 
</span></span><span class="line"><span class="cl">                         <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">32</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                         <span class="n">shuffle</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                         <span class="n">max_length</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">128</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataLoader</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">        åˆ›å»ºæ•°æ®åŠ è½½å™¨
</span></span></span><span class="line"><span class="cl"><span class="s2">        
</span></span></span><span class="line"><span class="cl"><span class="s2">        å‚æ•°:
</span></span></span><span class="line"><span class="cl"><span class="s2">            texts: æ–‡æœ¬åˆ—è¡¨
</span></span></span><span class="line"><span class="cl"><span class="s2">            labels: æ ‡ç­¾åˆ—è¡¨
</span></span></span><span class="line"><span class="cl"><span class="s2">            batch_size: æ‰¹æ¬¡å¤§å°
</span></span></span><span class="line"><span class="cl"><span class="s2">            shuffle: æ˜¯å¦æ‰“ä¹±æ•°æ®
</span></span></span><span class="line"><span class="cl"><span class="s2">            max_length: æœ€å¤§åºåˆ—é•¿åº¦
</span></span></span><span class="line"><span class="cl"><span class="s2">        &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">dataset</span> <span class="o">=</span> <span class="n">TextDataset</span><span class="p">(</span><span class="n">texts</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tokenizer</span><span class="p">,</span> <span class="n">max_length</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">dataloader</span> <span class="o">=</span> <span class="n">DataLoader</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="n">dataset</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">            <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">            <span class="n">shuffle</span><span class="o">=</span><span class="n">shuffle</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">pin_memory</span><span class="o">=</span><span class="kc">True</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">==</span> <span class="s1">&#39;cuda&#39;</span> <span class="k">else</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">        <span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">dataloader</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">train</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">              <span class="n">train_loader</span><span class="p">:</span> <span class="n">DataLoader</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">              <span class="n">val_loader</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DataLoader</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">              <span class="n">epochs</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">              <span class="n">learning_rate</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">5e-5</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">              <span class="n">save_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&#34;model.pt&#34;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">        è®­ç»ƒæ¨¡å‹
</span></span></span><span class="line"><span class="cl"><span class="s2">        
</span></span></span><span class="line"><span class="cl"><span class="s2">        å‚æ•°:
</span></span></span><span class="line"><span class="cl"><span class="s2">            train_loader: è®­ç»ƒæ•°æ®åŠ è½½å™¨
</span></span></span><span class="line"><span class="cl"><span class="s2">            val_loader: éªŒè¯æ•°æ®åŠ è½½å™¨
</span></span></span><span class="line"><span class="cl"><span class="s2">            epochs: è®­ç»ƒè½®æ•°
</span></span></span><span class="line"><span class="cl"><span class="s2">            learning_rate: å­¦ä¹ ç‡
</span></span></span><span class="line"><span class="cl"><span class="s2">            save_path: æ¨¡å‹ä¿å­˜è·¯å¾„
</span></span></span><span class="line"><span class="cl"><span class="s2">        &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># è®¾ç½®ä¼˜åŒ–å™¨</span>
</span></span><span class="line"><span class="cl">        <span class="n">optimizer</span> <span class="o">=</span> <span class="n">optim</span><span class="o">.</span><span class="n">AdamW</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="n">learning_rate</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># è®­ç»ƒå¾ªç¯</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">epochs</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="se">\n</span><span class="si">{</span><span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="mi">50</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Epoch </span><span class="si">{</span><span class="n">epoch</span> <span class="o">+</span> <span class="mi">1</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">epochs</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="mi">50</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="c1"># è®­ç»ƒæ¨¡å¼</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="n">total_loss</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">            <span class="n">correct</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">            <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="k">for</span> <span class="n">batch_idx</span><span class="p">,</span> <span class="n">batch</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">train_loader</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">                <span class="c1"># å°†æ•°æ®ç§»åŠ¨åˆ°è®¾å¤‡</span>
</span></span><span class="line"><span class="cl">                <span class="n">batch</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">batch</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
</span></span><span class="line"><span class="cl">                
</span></span><span class="line"><span class="cl">                <span class="c1"># å‰å‘ä¼ æ’­</span>
</span></span><span class="line"><span class="cl">                <span class="n">outputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="o">**</span><span class="n">batch</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">loss</span> <span class="o">=</span> <span class="n">outputs</span><span class="o">.</span><span class="n">loss</span>
</span></span><span class="line"><span class="cl">                
</span></span><span class="line"><span class="cl">                <span class="c1"># åå‘ä¼ æ’­</span>
</span></span><span class="line"><span class="cl">                <span class="n">loss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">                <span class="n">optimizer</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">                <span class="n">optimizer</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">                
</span></span><span class="line"><span class="cl">                <span class="c1"># è®¡ç®—ç»Ÿè®¡ä¿¡æ¯</span>
</span></span><span class="line"><span class="cl">                <span class="n">total_loss</span> <span class="o">+=</span> <span class="n">loss</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">                <span class="n">predictions</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">outputs</span><span class="o">.</span><span class="n">logits</span><span class="p">,</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">correct</span> <span class="o">+=</span> <span class="p">(</span><span class="n">predictions</span> <span class="o">==</span> <span class="n">batch</span><span class="p">[</span><span class="s1">&#39;labels&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">                <span class="n">total</span> <span class="o">+=</span> <span class="n">batch</span><span class="p">[</span><span class="s1">&#39;labels&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                
</span></span><span class="line"><span class="cl">                <span class="c1"># æ¯100ä¸ªbatchæ‰“å°ä¸€æ¬¡è¿›åº¦</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="p">(</span><span class="n">batch_idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">100</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;  Batch </span><span class="si">{</span><span class="n">batch_idx</span> <span class="o">+</span> <span class="mi">1</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">train_loader</span><span class="p">)</span><span class="si">}</span><span class="s2">, &#34;</span>
</span></span><span class="line"><span class="cl">                          <span class="sa">f</span><span class="s2">&#34;Loss: </span><span class="si">{</span><span class="n">loss</span><span class="o">.</span><span class="n">item</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">, &#34;</span>
</span></span><span class="line"><span class="cl">                          <span class="sa">f</span><span class="s2">&#34;Accuracy: </span><span class="si">{</span><span class="n">correct</span><span class="o">/</span><span class="n">total</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="c1"># è®¡ç®—epochå¹³å‡æŸå¤±å’Œå‡†ç¡®ç‡</span>
</span></span><span class="line"><span class="cl">            <span class="n">avg_loss</span> <span class="o">=</span> <span class="n">total_loss</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">train_loader</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">train_acc</span> <span class="o">=</span> <span class="n">correct</span> <span class="o">/</span> <span class="n">total</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;è®­ç»ƒç»“æœ - Loss: </span><span class="si">{</span><span class="n">avg_loss</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">, Accuracy: </span><span class="si">{</span><span class="n">train_acc</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="c1"># éªŒè¯ï¼ˆå¦‚æœæä¾›äº†éªŒè¯é›†ï¼‰</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">val_loader</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">val_loss</span><span class="p">,</span> <span class="n">val_acc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">val_loader</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;éªŒè¯ç»“æœ - Loss: </span><span class="si">{</span><span class="n">val_loss</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">, Accuracy: </span><span class="si">{</span><span class="n">val_acc</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># ä¿å­˜æ¨¡å‹</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">save_model</span><span class="p">(</span><span class="n">save_path</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">æ¨¡å‹å·²ä¿å­˜åˆ°: </span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataloader</span><span class="p">:</span> <span class="n">DataLoader</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">        è¯„ä¼°æ¨¡å‹
</span></span></span><span class="line"><span class="cl"><span class="s2">        
</span></span></span><span class="line"><span class="cl"><span class="s2">        å‚æ•°:
</span></span></span><span class="line"><span class="cl"><span class="s2">            dataloader: è¯„ä¼°æ•°æ®åŠ è½½å™¨
</span></span></span><span class="line"><span class="cl"><span class="s2">            
</span></span></span><span class="line"><span class="cl"><span class="s2">        è¿”å›:
</span></span></span><span class="line"><span class="cl"><span class="s2">            (å¹³å‡æŸå¤±, å‡†ç¡®ç‡)
</span></span></span><span class="line"><span class="cl"><span class="s2">        &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">total_loss</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">        <span class="n">correct</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">        <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">            <span class="k">for</span> <span class="n">batch</span> <span class="ow">in</span> <span class="n">dataloader</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">batch</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">batch</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
</span></span><span class="line"><span class="cl">                <span class="n">outputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="o">**</span><span class="n">batch</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                
</span></span><span class="line"><span class="cl">                <span class="n">total_loss</span> <span class="o">+=</span> <span class="n">outputs</span><span class="o">.</span><span class="n">loss</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">                <span class="n">predictions</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">outputs</span><span class="o">.</span><span class="n">logits</span><span class="p">,</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">correct</span> <span class="o">+=</span> <span class="p">(</span><span class="n">predictions</span> <span class="o">==</span> <span class="n">batch</span><span class="p">[</span><span class="s1">&#39;labels&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">                <span class="n">total</span> <span class="o">+=</span> <span class="n">batch</span><span class="p">[</span><span class="s1">&#39;labels&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="n">avg_loss</span> <span class="o">=</span> <span class="n">total_loss</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataloader</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">accuracy</span> <span class="o">=</span> <span class="n">correct</span> <span class="o">/</span> <span class="n">total</span> <span class="k">if</span> <span class="n">total</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">avg_loss</span><span class="p">,</span> <span class="n">accuracy</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">        é¢„æµ‹å•ä¸ªæ–‡æœ¬
</span></span></span><span class="line"><span class="cl"><span class="s2">        
</span></span></span><span class="line"><span class="cl"><span class="s2">        å‚æ•°:
</span></span></span><span class="line"><span class="cl"><span class="s2">            text: è¾“å…¥æ–‡æœ¬
</span></span></span><span class="line"><span class="cl"><span class="s2">            
</span></span></span><span class="line"><span class="cl"><span class="s2">        è¿”å›:
</span></span></span><span class="line"><span class="cl"><span class="s2">            é¢„æµ‹ç»“æœå­—å…¸
</span></span></span><span class="line"><span class="cl"><span class="s2">        &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># ç¼–ç æ–‡æœ¬</span>
</span></span><span class="line"><span class="cl">        <span class="n">inputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tokenizer</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="n">text</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">truncation</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;max_length&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">max_length</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">return_tensors</span><span class="o">=</span><span class="s1">&#39;pt&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># ç§»åŠ¨åˆ°è®¾å¤‡</span>
</span></span><span class="line"><span class="cl">        <span class="n">inputs</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">inputs</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># é¢„æµ‹</span>
</span></span><span class="line"><span class="cl">        <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">            <span class="n">outputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="o">**</span><span class="n">inputs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">probabilities</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">softmax</span><span class="p">(</span><span class="n">outputs</span><span class="o">.</span><span class="n">logits</span><span class="p">,</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">prediction</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">outputs</span><span class="o">.</span><span class="n">logits</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;text&#39;</span><span class="p">:</span> <span class="n">text</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;prediction&#39;</span><span class="p">:</span> <span class="n">prediction</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;probabilities&#39;</span><span class="p">:</span> <span class="n">probabilities</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;confidence&#39;</span><span class="p">:</span> <span class="n">probabilities</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">save_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;ä¿å­˜æ¨¡å‹&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">torch</span><span class="o">.</span><span class="n">save</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;model_state_dict&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">state_dict</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;tokenizer_config&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tokenizer</span><span class="o">.</span><span class="n">init_kwargs</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;model_config&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;num_labels&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_labels</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span> <span class="n">path</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">load_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;åŠ è½½æ¨¡å‹&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">checkpoint</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">map_location</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">load_state_dict</span><span class="p">(</span><span class="n">checkpoint</span><span class="p">[</span><span class="s1">&#39;model_state_dict&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">num_labels</span> <span class="o">=</span> <span class="n">checkpoint</span><span class="p">[</span><span class="s1">&#39;num_labels&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ==================== ä½¿ç”¨ç¤ºä¾‹ ====================</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;ä¸»å‡½æ•°ï¼šæ¼”ç¤ºå®Œæ•´æµç¨‹&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;=&#34;</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;æ–‡æœ¬åˆ†ç±»å®Œæ•´æµç¨‹æ¼”ç¤º&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;=&#34;</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># 1. å‡†å¤‡ç¤ºä¾‹æ•°æ®</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">1. å‡†å¤‡æ•°æ®...&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">train_texts</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;This product is amazing! I really love it.&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;Terrible experience, would not recommend.&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;The quality is good but delivery was late.&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;Excellent service and fast shipping.&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;Poor customer support, very disappointed.&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;Good value for money.&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;Not as described, very misleading.&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;Perfect! Exactly what I wanted.&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">train_labels</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>  <span class="c1"># 1: æ­£é¢, 0: è´Ÿé¢</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">test_texts</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;I&#39;m very satisfied with this purchase.&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;Waste of money, completely useless.&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">test_labels</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># 2. åˆå§‹åŒ–è®­ç»ƒå™¨</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">2. åˆå§‹åŒ–è®­ç»ƒå™¨...&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">trainer</span> <span class="o">=</span> <span class="n">TextClassifierTrainer</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">model_name</span><span class="o">=</span><span class="s2">&#34;bert-base-uncased&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">num_labels</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">device</span><span class="o">=</span><span class="s1">&#39;cpu&#39;</span>  <span class="c1"># ä½¿ç”¨cpuï¼Œå¦‚éœ€GPUè¯·æ”¹ä¸º&#39;cuda&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># 3. åˆ›å»ºæ•°æ®åŠ è½½å™¨</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">3. åˆ›å»ºæ•°æ®åŠ è½½å™¨...&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">train_loader</span> <span class="o">=</span> <span class="n">trainer</span><span class="o">.</span><span class="n">create_dataloader</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">train_texts</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">        <span class="n">batch_size</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">64</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">test_loader</span> <span class="o">=</span> <span class="n">trainer</span><span class="o">.</span><span class="n">create_dataloader</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">test_texts</span><span class="p">,</span> <span class="n">test_labels</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">batch_size</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">64</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># 4. è®­ç»ƒæ¨¡å‹</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">4. å¼€å§‹è®­ç»ƒæ¨¡å‹...&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">trainer</span><span class="o">.</span><span class="n">train</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">train_loader</span><span class="o">=</span><span class="n">train_loader</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">val_loader</span><span class="o">=</span><span class="n">test_loader</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">epochs</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">learning_rate</span><span class="o">=</span><span class="mf">5e-5</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">save_path</span><span class="o">=</span><span class="s2">&#34;text_classifier_model.pt&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># 5. åŠ è½½æ¨¡å‹å¹¶è¿›è¡Œæ¨ç†</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">5. åŠ è½½æ¨¡å‹å¹¶è¿›è¡Œæ¨ç†...&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">trainer</span><span class="o">.</span><span class="n">load_model</span><span class="p">(</span><span class="s2">&#34;text_classifier_model.pt&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># 6. æµ‹è¯•æ¨ç†</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">6. æµ‹è¯•æ¨ç†...&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">test_samples</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;This is the best product I&#39;ve ever bought!&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;I&#39;m very disappointed with the quality.&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;It&#39;s okay, nothing special.&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;The service was absolutely fantastic!&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">]</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">text</span> <span class="ow">in</span> <span class="n">test_samples</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">result</span> <span class="o">=</span> <span class="n">trainer</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">sentiment</span> <span class="o">=</span> <span class="s2">&#34;æ­£é¢&#34;</span> <span class="k">if</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;prediction&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="s2">&#34;è´Ÿé¢&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">æ–‡æœ¬: </span><span class="si">{</span><span class="n">text</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;æƒ…æ„Ÿ: </span><span class="si">{</span><span class="n">sentiment</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;ç½®ä¿¡åº¦: </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;confidence&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2%</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;æ¦‚ç‡åˆ†å¸ƒ: [è´Ÿé¢: </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;probabilities&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">, æ­£é¢: </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;probabilities&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">]&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">&#34;</span> <span class="o">+</span> <span class="s2">&#34;=&#34;</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;æµç¨‹å®Œæˆï¼&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;=&#34;</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ==================== æ¨¡å‹åŠ è½½ä¸æ¨ç†çš„ç‹¬ç«‹å‡½æ•° ====================</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">load_and_predict</span><span class="p">(</span><span class="n">model_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">device</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    åŠ è½½æ¨¡å‹å¹¶è¿›è¡Œé¢„æµ‹çš„ç‹¬ç«‹å‡½æ•°
</span></span></span><span class="line"><span class="cl"><span class="s2">    
</span></span></span><span class="line"><span class="cl"><span class="s2">    å‚æ•°:
</span></span></span><span class="line"><span class="cl"><span class="s2">        model_path: æ¨¡å‹è·¯å¾„
</span></span></span><span class="line"><span class="cl"><span class="s2">        text: è¾“å…¥æ–‡æœ¬
</span></span></span><span class="line"><span class="cl"><span class="s2">        device: è®¾å¤‡ç±»å‹
</span></span></span><span class="line"><span class="cl"><span class="s2">        
</span></span></span><span class="line"><span class="cl"><span class="s2">    è¿”å›:
</span></span></span><span class="line"><span class="cl"><span class="s2">        é¢„æµ‹ç»“æœ
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">device</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">device</span> <span class="o">=</span> <span class="s1">&#39;cuda&#39;</span> <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">()</span> <span class="k">else</span> <span class="s1">&#39;cpu&#39;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># åŠ è½½æ£€æŸ¥ç‚¹</span>
</span></span><span class="line"><span class="cl">    <span class="n">checkpoint</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">model_path</span><span class="p">,</span> <span class="n">map_location</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># é‡æ–°åˆ›å»ºæ¨¡å‹</span>
</span></span><span class="line"><span class="cl">    <span class="n">model</span> <span class="o">=</span> <span class="n">AutoModelForSequenceClassification</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;bert-base-uncased&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">num_labels</span><span class="o">=</span><span class="n">checkpoint</span><span class="p">[</span><span class="s1">&#39;num_labels&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># åŠ è½½æƒé‡</span>
</span></span><span class="line"><span class="cl">    <span class="n">model</span><span class="o">.</span><span class="n">load_state_dict</span><span class="p">(</span><span class="n">checkpoint</span><span class="p">[</span><span class="s1">&#39;model_state_dict&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="n">model</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># é‡æ–°åˆ›å»ºåˆ†è¯å™¨</span>
</span></span><span class="line"><span class="cl">    <span class="n">tokenizer</span> <span class="o">=</span> <span class="n">AutoTokenizer</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="s2">&#34;bert-base-uncased&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># ç¼–ç æ–‡æœ¬</span>
</span></span><span class="line"><span class="cl">    <span class="n">inputs</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">text</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">truncation</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;max_length&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">max_length</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">return_tensors</span><span class="o">=</span><span class="s1">&#39;pt&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># é¢„æµ‹</span>
</span></span><span class="line"><span class="cl">    <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">        <span class="n">outputs</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="o">**</span><span class="n">inputs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">probabilities</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">softmax</span><span class="p">(</span><span class="n">outputs</span><span class="o">.</span><span class="n">logits</span><span class="p">,</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">prediction</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">outputs</span><span class="o">.</span><span class="n">logits</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;prediction&#39;</span><span class="p">:</span> <span class="n">prediction</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;probabilities&#39;</span><span class="p">:</span> <span class="n">probabilities</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;confidence&#39;</span><span class="p">:</span> <span class="n">probabilities</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># è¿è¡Œå®Œæ•´æ¼”ç¤º</span>
</span></span><span class="line"><span class="cl">    <span class="n">main</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># ç¤ºä¾‹ï¼šä½¿ç”¨ç‹¬ç«‹çš„åŠ è½½å’Œé¢„æµ‹å‡½æ•°</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\n\n</span><span class="s2">ç‹¬ç«‹å‡½æ•°è°ƒç”¨ç¤ºä¾‹:&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">result</span> <span class="o">=</span> <span class="n">load_and_predict</span><span class="p">(</span><span class="s2">&#34;text_classifier_model.pt&#34;</span><span class="p">,</span> <span class="s2">&#34;This product is excellent!&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;é¢„æµ‹ç»“æœ: </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span></span></span></code></pre></td></tr></table>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-headline-24" class="outline-4">
<h4 id="headline-24">
ts5.pyè¿è¡Œæ•ˆæœ
</h4>
<div id="outline-text-headline-24" class="outline-text-4">
<div class="src src-bash">
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ python ts5.py
</span></span><span class="line"><span class="cl">Some weights of BertForSequenceClassification were not initialized from the model checkpoint at bert-base-uncased and are newly initialized: <span class="o">[</span><span class="s1">&#39;classifier.bias&#39;</span>, <span class="s1">&#39;classifier.weight&#39;</span><span class="o">]</span>
</span></span><span class="line"><span class="cl">You should probably TRAIN this model on a down-stream task to be able to use it <span class="k">for</span> predictions and inference.
</span></span><span class="line"><span class="cl">D:<span class="se">\t</span>emp<span class="se">\t</span>emp<span class="se">\t</span>s8.py:260: FutureWarning: You are using <span class="sb">`</span>torch.load<span class="sb">`</span> with <span class="sb">`</span><span class="nv">weights_only</span><span class="o">=</span>False<span class="sb">`</span> <span class="o">(</span>the current default value<span class="o">)</span>, which uses the default pickle module implicitly. It is possible to construct malicious pickle data which will execute arbitrary code during unpickling <span class="o">(</span>See https://github.com/pytorch/pytorch/blob/main/SECURITY.md#untrusted-models <span class="k">for</span> more details<span class="o">)</span>. In a future release, the default value <span class="k">for</span> <span class="sb">`</span>weights_only<span class="sb">`</span> will be flipped to <span class="sb">`</span>True<span class="sb">`</span>. This limits the functions that could be executed during unpickling. Arbitrary objects will no longer be allowed to be loaded via this mode unless they are explicitly allowlisted by the user via <span class="sb">`</span>torch.serialization.add_safe_globals<span class="sb">`</span>. We recommend you start setting <span class="sb">`</span><span class="nv">weights_only</span><span class="o">=</span>True<span class="sb">`</span> <span class="k">for</span> any use <span class="k">case</span> where you don<span class="s1">&#39;t have full control of the loaded file. Please open an issue on GitHub for any issues related to this experimental feature.
</span></span></span><span class="line"><span class="cl"><span class="s1">  checkpoint = torch.load(path, map_location=self.device)
</span></span></span><span class="line"><span class="cl"><span class="s1">D:\temp\temp\ts8.py:365: FutureWarning: You are using `torch.load` with `weights_only=False` (the current default value), which uses the default pickle module implicitly. It is possible to construct malicious pickle data which will execute arbitrary code during unpickling (See https://github.com/pytorch/pytorch/blob/main/SECURITY.md#untrusted-models for more details). In a future release, the default value for `weights_only` will be flipped to `True`. This limits the functions that could be executed during unpickling. Arbitrary objects will no longer be allowed to be loaded via this mode unless they are explicitly allowlisted by the user via `torch.serialization.add_safe_globals`. We recommend you start setting `weights_only=True` for any use case where you don&#39;</span>t have full control of the loaded file. Please open an issue on GitHub <span class="k">for</span> any issues related to this experimental feature.
</span></span><span class="line"><span class="cl">  <span class="nv">checkpoint</span> <span class="o">=</span> torch.load<span class="o">(</span>model_path, <span class="nv">map_location</span><span class="o">=</span>device<span class="o">)</span>
</span></span><span class="line"><span class="cl">Some weights of BertForSequenceClassification were not initialized from the model checkpoint at bert-base-uncased and are newly initialized: <span class="o">[</span><span class="s1">&#39;classifier.bias&#39;</span>, <span class="s1">&#39;classifier.weight&#39;</span><span class="o">]</span>
</span></span><span class="line"><span class="cl">You should probably TRAIN this model on a down-stream task to be able to use it <span class="k">for</span> predictions and inference.
</span></span><span class="line"><span class="cl"><span class="o">============================================================</span>
</span></span><span class="line"><span class="cl"><span class="nv">æ–‡æœ¬åˆ†ç±»å®Œæ•´æµç¨‹æ¼”ç¤º</span>
</span></span><span class="line"><span class="cl"><span class="o">============================================================</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">1. å‡†å¤‡æ•°æ®...
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">2. åˆå§‹åŒ–è®­ç»ƒå™¨...
</span></span><span class="line"><span class="cl">ä½¿ç”¨è®¾å¤‡: cpu
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">3. åˆ›å»ºæ•°æ®åŠ è½½å™¨...
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">4. å¼€å§‹è®­ç»ƒæ¨¡å‹...
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">==================================================</span>
</span></span><span class="line"><span class="cl">Epoch 1/3
</span></span><span class="line"><span class="cl"><span class="o">==================================================</span>
</span></span><span class="line"><span class="cl">è®­ç»ƒç»“æœ - Loss: 0.6826, Accuracy: 0.6250
</span></span><span class="line"><span class="cl">éªŒè¯ç»“æœ - Loss: 0.7525, Accuracy: 0.5000
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">==================================================</span>
</span></span><span class="line"><span class="cl">Epoch 2/3
</span></span><span class="line"><span class="cl"><span class="o">==================================================</span>
</span></span><span class="line"><span class="cl">è®­ç»ƒç»“æœ - Loss: 0.6311, Accuracy: 0.6250
</span></span><span class="line"><span class="cl">éªŒè¯ç»“æœ - Loss: 0.6439, Accuracy: 0.5000
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">==================================================</span>
</span></span><span class="line"><span class="cl">Epoch 3/3
</span></span><span class="line"><span class="cl"><span class="o">==================================================</span>
</span></span><span class="line"><span class="cl">è®­ç»ƒç»“æœ - Loss: 0.4965, Accuracy: 0.7500
</span></span><span class="line"><span class="cl">éªŒè¯ç»“æœ - Loss: 0.5111, Accuracy: 1.0000
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">æ¨¡å‹å·²ä¿å­˜åˆ°: text_classifier_model.pt
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">5. åŠ è½½æ¨¡å‹å¹¶è¿›è¡Œæ¨ç†...
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">6. æµ‹è¯•æ¨ç†...
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">æ–‡æœ¬: This is the best product I<span class="s1">&#39;ve ever bought!
</span></span></span><span class="line"><span class="cl"><span class="s1">æƒ…æ„Ÿ: æ­£é¢
</span></span></span><span class="line"><span class="cl"><span class="s1">ç½®ä¿¡åº¦: 71.61%
</span></span></span><span class="line"><span class="cl"><span class="s1">æ¦‚ç‡åˆ†å¸ƒ: [è´Ÿé¢: 0.2839, æ­£é¢: 0.7161]
</span></span></span><span class="line"><span class="cl"><span class="s1">
</span></span></span><span class="line"><span class="cl"><span class="s1">æ–‡æœ¬: I&#39;</span>m very disappointed with the quality.
</span></span><span class="line"><span class="cl">æƒ…æ„Ÿ: æ­£é¢
</span></span><span class="line"><span class="cl">ç½®ä¿¡åº¦: 63.62%
</span></span><span class="line"><span class="cl">æ¦‚ç‡åˆ†å¸ƒ: <span class="o">[</span>è´Ÿé¢: 0.3638, æ­£é¢: 0.6362<span class="o">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">æ–‡æœ¬: It<span class="s1">&#39;s okay, nothing special.
</span></span></span><span class="line"><span class="cl"><span class="s1">æƒ…æ„Ÿ: æ­£é¢
</span></span></span><span class="line"><span class="cl"><span class="s1">ç½®ä¿¡åº¦: 59.90%
</span></span></span><span class="line"><span class="cl"><span class="s1">æ¦‚ç‡åˆ†å¸ƒ: [è´Ÿé¢: 0.4010, æ­£é¢: 0.5990]
</span></span></span><span class="line"><span class="cl"><span class="s1">
</span></span></span><span class="line"><span class="cl"><span class="s1">æ–‡æœ¬: The service was absolutely fantastic!
</span></span></span><span class="line"><span class="cl"><span class="s1">æƒ…æ„Ÿ: æ­£é¢
</span></span></span><span class="line"><span class="cl"><span class="s1">ç½®ä¿¡åº¦: 69.58%
</span></span></span><span class="line"><span class="cl"><span class="s1">æ¦‚ç‡åˆ†å¸ƒ: [è´Ÿé¢: 0.3042, æ­£é¢: 0.6958]
</span></span></span><span class="line"><span class="cl"><span class="s1">
</span></span></span><span class="line"><span class="cl"><span class="s1">============================================================
</span></span></span><span class="line"><span class="cl"><span class="s1">æµç¨‹å®Œæˆï¼
</span></span></span><span class="line"><span class="cl"><span class="s1">============================================================
</span></span></span><span class="line"><span class="cl"><span class="s1">
</span></span></span><span class="line"><span class="cl"><span class="s1">
</span></span></span><span class="line"><span class="cl"><span class="s1">ç‹¬ç«‹å‡½æ•°è°ƒç”¨ç¤ºä¾‹:
</span></span></span><span class="line"><span class="cl"><span class="s1">é¢„æµ‹ç»“æœ: {&#39;</span>prediction<span class="s1">&#39;: 1, &#39;</span>probabilities<span class="s1">&#39;: array([0.28677344, 0.7132265 ], dtype=float32), &#39;</span>confidence<span class="err">&#39;</span>: 0.7132264971733093<span class="o">}</span></span></span></code></pre></td></tr></table>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-headline-25" class="outline-3">
<h3 id="headline-25">
å‚è€ƒé“¾æ¥
</h3>
<div id="outline-text-headline-25" class="outline-text-3">
<p><a href="https://ynhugo.github.io/p/ubuntu-22.04-serverå®‰è£…nvidiaé©±åŠ¨/">ubuntu 22.04 serverå®‰è£…Nvidiaé©±åŠ¨</a></p>
<p>
<a href="https://developer.aliyun.com/article/1675559">å¤§æ¨¡å‹å¼€å‘ä»å…¥é—¨åˆ°éƒ¨ç½²</a></p>
<p>
<a href="https://chat.deepseek.com/share/2j04y8dnz4t1ds9dg9">PyTorch GPUçŸ©é˜µä¹˜æ³•æ•°æ®ç±»å‹é—®é¢˜ä¿®å¤</a></p>
<p>
<a href="https://chat.deepseek.com/share/5tv9sb2eo77trk4m6o">æ–‡æœ¬åˆ†ç±»å®Œæ•´æµç¨‹å®ç°ä¸ä¼˜åŒ–</a></p>
<p>
<a href="https://chat.deepseek.com/share/xjtay4rchp2y8bl6hm">æ–‡æœ¬åˆ†ç±»æ¨¡å‹è®­ç»ƒä¸é¢„æµ‹ç»“æœåˆ†æ</a></p>
</div>
</div>
</div>
</div>

</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/nvidia/">Nvidia</a>
        
            <a href="/tags/gpu/">Gpu</a>
        
            <a href="/tags/pytorch/">Pytorch</a>
        
    </section>


    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY-NC-SA 4.0</span>
    </section>
    </footer>


    
</article>

    

    

     
    
        
    <div class="disqus-container">
    <div id="disqus_thread"></div>
<script>
    window.disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "hugo-theme-stack" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>

<style>
    .disqus-container {
        background-color: var(--card-background);
        border-radius: var(--card-border-radius);
        box-shadow: var(--shadow-l1);
        padding: var(--card-padding);
    }
</style>

<script>
    window.addEventListener('onColorSchemeChange', (e) => {
        if (typeof DISQUS == 'object') {
            DISQUS.reset({
                reload: true
            });
        }
    })
</script>

    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2020 - 
        
        2026 Example Person
    </section>
    
    <section class="powerby">
        ä½¿ç”¨ <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> æ„å»º <br />
        ä¸»é¢˜ <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.30.0">Stack</a></b> ç”± <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a> è®¾è®¡
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
