<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content=" socketåŸºäºtcpçš„æœåŠ¡ç«¯ä¸å®¢æˆ·ç«¯å®ä¾‹ å…ˆè¿è¡ŒæœåŠ¡ç«¯å†è¿è¡Œå®¢æˆ·ç«¯ï¼ŒæœåŠ¡ç«¯æ”¶åˆ°å®¢æˆ·ç«¯ä¸‹å±çš„å¼€å§‹æŒ‡ä»¤åï¼Œä¸¤è¾¹åŒæ—¶åˆ›å»ºçº¿ç¨‹ï¼ŒæœåŠ¡ç«¯æ”¶åˆ°å®¢æˆ·ç«¯ä¸‹å±çš„åœæ­¢æŒ‡ä»¤åï¼Œä¸¤è¾¹åŒæ—¶åœæ­¢çº¿ç¨‹\nserver.c 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 #include &lt;stdlib.h&gt; #include &lt;stdio.h&gt; #include &lt;stdbool.h&gt; #include &lt;assert.h&gt; #include &lt;fcntl.h&gt; // Flags for open() #include &lt;sys/stat.h&gt; // Open() system call #include &lt;sys/types.h&gt; // Types for open() #include &lt;unistd.h&gt; // Close() system call #include &lt;string.h&gt; // Memory setting and copying #include &lt;getopt.h&gt; // Option parsing #include &lt;errno.h&gt; // Error codes #include&lt;sys/socket.h&gt; #include&lt;netinet/in.h&gt; #include &lt;pthread.h&gt; #define DEFAULT_PORT 4000 #define MAXLINE 4096 #define socket_send_size 4096 int socket_fd, connect_fd; int flag1; // å…¨å±€å˜é‡ pthread_t worker_thread = 0; // å·¥ä½œçº¿ç¨‹ ID volatile int thread_running = 0; // çº¿ç¨‹è¿è¡ŒçŠ¶æ€ pthread_mutex_t mutex = PTHREAD_MUTEX_INITIALIZER; // äº’æ–¥é” int flag1; int socket_fd, connect_fd; void cleanup_handler() {\t} void *receive_file(void *arg) { printf(&#34;enter therad\\n&#34;);\tpthread_cleanup_push(cleanup_handler, NULL); int i = 0, rc = 0; unsigned char send_buffer[socket_send_size] = {0}; memset(send_buffer, 0, socket_send_size); while (flag1 == 1) { #if 1 for (i = 0; i &lt; 4; i++) { if (flag1 != 1) break; } send(connect_fd, &amp;send_buffer[0], socket_send_size, 0); #endif } pthread_cleanup_pop(0); pthread_exit(NULL); } void create_thread() { pthread_mutex_lock(&amp;mutex); if (!thread_running) { int ret = pthread_create(&amp;worker_thread, NULL, &amp;receive_file, NULL); if (ret != 0) { perror(&#34;pthread_create&#34;);\texit(EXIT_FAILURE); } thread_running = 1; printf(&#34;Main: Created thread\\n&#34;); } else { printf(&#34;Main: Thread is already running\\n&#34;); } pthread_mutex_unlock(&amp;mutex); } // é”€æ¯çº¿ç¨‹ void destroy_thread() { pthread_mutex_lock(&amp;mutex); if (thread_running) { printf(&#34;Main: Stopping thread...\\n&#34;); int ret = pthread_cancel(worker_thread); if (ret != 0) { perror(&#34;pthread_cancel&#34;); exit(EXIT_FAILURE); } // ç­‰å¾…çº¿ç¨‹é€€å‡ºå¹¶å›æ”¶èµ„æº ret = pthread_join(worker_thread, NULL); if (ret != 0) { perror(&#34;pthread_join&#34;); exit(EXIT_FAILURE); } thread_running = 0; printf(&#34;Main: Thread has exited.\\n&#34;); } else { printf(&#34;Main: No thread is running\\n&#34;); } pthread_mutex_unlock(&amp;mutex); } // ä¸»å‡½æ•° /*---------------------------------------------------------------------------- * Main *----------------------------------------------------------------------------*/ int main(void) {\t// Socketç›¸å…³å˜é‡ struct sockaddr_in servaddr; unsigned char buff[MAXLINE]; int n; //åˆå§‹åŒ–Socket if( (socket_fd = socket(AF_INET, SOCK_STREAM, 0)) == -1 ) { printf(&#34;create socket error: %s(errno: %d)\\n&#34;,strerror(errno),errno); exit(0); } // è§£å†³ Address already in use é—®é¢˜ int opt = 1; setsockopt(socket_fd, SOL_SOCKET, SO_REUSEADDR, &amp;opt, sizeof(opt)); //åˆå§‹åŒ– memset(&amp;servaddr, 0, sizeof(servaddr)); servaddr.sin_family = AF_INET; servaddr.sin_addr.s_addr = htonl(INADDR_ANY);//IPåœ°å€è®¾ç½®æˆINADDR_ANY,è®©ç³»ç»Ÿè‡ªåŠ¨è·å–æœ¬æœºçš„IPåœ°å€ã€‚ servaddr.sin_port = htons(DEFAULT_PORT);//è®¾ç½®çš„ç«¯å£ä¸ºDEFAULT_PORT //å°†æœ¬åœ°åœ°å€ç»‘å®šåˆ°æ‰€åˆ›å»ºçš„å¥—æ¥å­—ä¸Š if( bind(socket_fd, (struct sockaddr*)&amp;servaddr, sizeof(servaddr)) == -1) { printf(&#34;bind socket error: %s(errno: %d)\\n&#34;,strerror(errno),errno); exit(0); } //å¼€å§‹ç›‘å¬æ˜¯å¦æœ‰å®¢æˆ·ç«¯è¿æ¥ if( listen(socket_fd, 2) == -1) { printf(&#34;listen socket error: %s(errno: %d)\\n&#34;,strerror(errno),errno); exit(0); } printf(&#34;======waiting for client&#39;s request======\\n&#34;); flag1 = 0; printf(&#34;start:\\nFA 00 00 08 00 00 00 01\\n&#34;); printf(&#34;stop:\\nFA 00 00 08 00 00 00 02\\n&#34;); while (1) { if( (connect_fd = accept(socket_fd, (struct sockaddr*)NULL, NULL)) == -1) { printf(&#34;accept socket error: %s(errno: %d)&#34;,strerror(errno),errno); usleep(10); continue; } printf(&#34;mark-1\\n&#34;); while (1) { //æ¥å—å®¢æˆ·ç«¯ä¼ è¿‡æ¥çš„æ•°æ® n = recv(connect_fd, buff, MAXLINE, 0); usleep(100); printf(&#34;mark-2\\n&#34;); if(n &gt; 0) { // åˆ¤æ–­æ˜¯å¼€å§‹è¿˜æ˜¯åœæ­¢ if (buff[0] == 0xFA &amp;&amp; buff[7] == 0x01) { // å¼€å§‹ printf(&#34;start\\n&#34;); //sleep(1200); //æµ‹è¯•é•¿æ—¶é—´ä¸æ‰§è¡Œæ“ä½œï¼Œç½‘å£æ˜¯å¦ä»æ­£å¸¸å·¥ä½œ flag1 = 1; // å¤ä½\tcreate_thread(); system(&#34;date&#34;); } else if (buff[0] == 0xFA &amp;&amp; buff[7] == 0x02) { flag1 = 2; // åœæ­¢\tdestroy_thread(); system(&#34;date&#34;); } } else if (n &lt; 0) { usleep(100); continue; } else { close(connect_fd); printf(&#34;mark-3\\n&#34;); usleep(100); break; } } usleep(10); } close(connect_fd); close(socket_fd); return 0; } client.c 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 #include &lt;stdio.h&gt; #include &lt;stdlib.h&gt; #include &lt;string.h&gt; #include &lt;errno.h&gt; #include &lt;sys/types.h&gt; #include &lt;sys/socket.h&gt; #include &lt;netinet/in.h&gt; #include &lt;arpa/inet.h&gt; #include &lt;unistd.h&gt; #include &lt;pthread.h&gt; #define DEFAULT_PORT 4000 #define MAXLINE 4096 // å…¨å±€å˜é‡ pthread_t worker_thread = 0; // å·¥ä½œçº¿ç¨‹ ID volatile int thread_running = 0; // çº¿ç¨‹è¿è¡ŒçŠ¶æ€ volatile int thread_should_exit = 0; // çº¿ç¨‹é€€å‡ºæ ‡å¿— pthread_mutex_t mutex = PTHREAD_MUTEX_INITIALIZER; // äº’æ–¥é” // çº¿ç¨‹æ¸…ç†å‡½æ•° void cleanup_handler(void *arg) { printf(&#34;Thread: Cleaning up resources...\\n&#34;); } // å·¥ä½œçº¿ç¨‹å‡½æ•° void *receive_file(void *arg) { printf(&#34;Thread: Entered thread\\n&#34;); // æ³¨å†Œæ¸…ç†å‡½æ•° pthread_cleanup_push(cleanup_handler, NULL); while (!thread_should_exit) { // æ¨¡æ‹Ÿå·¥ä½œ printf(&#34;Thread: Working...\\n&#34;); sleep(1); } // æ¸…ç† pthread_cleanup_pop(1); printf(&#34;Thread: Exiting...\\n&#34;); return NULL; } // åˆ›å»ºçº¿ç¨‹ void create_thread() { pthread_mutex_lock(&amp;mutex); if (!thread_running) { thread_should_exit = 0; // é‡ç½®é€€å‡ºæ ‡å¿— int ret = pthread_create(&amp;worker_thread, NULL, receive_file, NULL); if (ret != 0) { perror(&#34;pthread_create&#34;); exit(EXIT_FAILURE); } thread_running = 1; printf(&#34;Main: Created thread\\n&#34;); } else { printf(&#34;Main: Thread is already running\\n&#34;); } pthread_mutex_unlock(&amp;mutex); } // é”€æ¯çº¿ç¨‹ void destroy_thread() { pthread_mutex_lock(&amp;mutex); if (thread_running) { printf(&#34;Main: Stopping thread...\\n&#34;); thread_should_exit = 1; // è®¾ç½®é€€å‡ºæ ‡å¿— // ç­‰å¾…çº¿ç¨‹é€€å‡ºå¹¶å›æ”¶èµ„æº int ret = pthread_join(worker_thread, NULL); if (ret != 0) { perror(&#34;pthread_join&#34;); exit(EXIT_FAILURE); } thread_running = 0; printf(&#34;Main: Thread has exited.\\n&#34;); } else { printf(&#34;Main: No thread is running\\n&#34;); } pthread_mutex_unlock(&amp;mutex); } // è§£æ 16 è¿›åˆ¶è¾“å…¥ int parse_hex_input(const char *input, unsigned char *output, size_t output_size) { char *endptr; for (size_t i = 0; i &lt; output_size; i++) { output[i] = (unsigned char)strtol(input + 2 * i, &amp;endptr, 16); if (endptr != input + 2 * (i + 1)) { return -1; // éæ³•è¾“å…¥ } } return 0; } int main(int argc, char *argv[]) { int i = 0; int input = 0; int sockfd; struct sockaddr_in servaddr; // æ£€æŸ¥å‘½ä»¤è¡Œå‚æ•° if (argc != 2) { printf(&#34;Usage: %s &lt;ipaddress&gt;\\n&#34;, argv[0]); exit(EXIT_FAILURE); } // åˆ›å»º Socket if ((sockfd = socket(AF_INET, SOCK_STREAM, 0)) &lt; 0) { printf(&#34;Create socket error: %s (errno: %d)\\n&#34;, strerror(errno), errno); exit(EXIT_FAILURE); } // è®¾ç½®æœåŠ¡å™¨åœ°å€ memset(&amp;servaddr, 0, sizeof(servaddr)); servaddr.sin_family = AF_INET; servaddr.sin_port = htons(DEFAULT_PORT); if (inet_pton(AF_INET, argv[1], &amp;servaddr.sin_addr) &lt;= 0) { printf(&#34;inet_pton error for %s\\n&#34;, argv[1]); close(sockfd); exit(EXIT_FAILURE); } // è¿æ¥åˆ°æœåŠ¡å™¨ if (connect(sockfd, (struct sockaddr *)&amp;servaddr, sizeof(servaddr)) &lt; 0) { printf(&#34;Connect error: %s (errno: %d)\\n&#34;, strerror(errno), errno); close(sockfd); exit(EXIT_FAILURE); } printf(&#34;Connected to server at %s:%d\\n&#34;, argv[1], DEFAULT_PORT); printf(&#34;start:\\nFA 00 00 08 00 00 00 01\\n&#34;); printf(&#34;stop:\\nFA 00 00 08 00 00 00 02\\n&#34;); // ä¸»å¾ªç¯ while (1) { unsigned char input_buf[8] = {0}; char input_str[17]; // 8 ä¸ª 16 è¿›åˆ¶æ•°ï¼Œæ¯ä¸ªå  2 å­—ç¬¦ï¼ŒåŠ ä¸Šç»“æŸç¬¦ for (i = 0; i &lt; 8; i++) { scanf(&#34;%x&#34;, &amp;input); input_buf[i] = input; } // æ‰“å°è¾“å…¥ printf(&#34;Input: &#34;); for (int i = 0; i &lt; 8; i++) { printf(&#34;%02X &#34;, input_buf[i]); } printf(&#34;\\n&#34;); // æ ¹æ®è¾“å…¥å¯åŠ¨æˆ–åœæ­¢çº¿ç¨‹ if (input_buf[0] == 0xFA &amp;&amp; input_buf[7] == 0x01) { create_thread(); send(sockfd, &amp;input_buf[0], sizeof(input_buf), 0); } else if (input_buf[0] == 0xFA &amp;&amp; input_buf[7] == 0x02) { destroy_thread(); send(sockfd, &amp;input_buf[0], sizeof(input_buf), 0); } } // æ¸…ç†èµ„æº destroy_thread(); // ç¡®ä¿çº¿ç¨‹é€€å‡º pthread_mutex_destroy(&amp;mutex); close(sockfd); return 0; } è¿è¡Œæ–¹å¼ serverç«¯ 1 ./server æ˜¾ç¤ºç»“æœå¹¶ç­‰å¾…å®¢æˆ·ç«¯è¿æ¥\n">
<title>socketåŸºäºtcpçš„æœåŠ¡ç«¯ä¸å®¢æˆ·ç«¯å®ä¾‹</title>

<link rel='canonical' href='https://ynhugo.github.io/p/socket%E5%9F%BA%E4%BA%8Etcp%E7%9A%84%E6%9C%8D%E5%8A%A1%E7%AB%AF%E4%B8%8E%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%AE%9E%E4%BE%8B/'>

<link rel="stylesheet" href="/scss/style.min.6a692fd055deae459f2a9767f57f3855ba80cafd5041317f24f7360f6ca47cdf.css"><meta property='og:title' content="socketåŸºäºtcpçš„æœåŠ¡ç«¯ä¸å®¢æˆ·ç«¯å®ä¾‹">
<meta property='og:description' content=" socketåŸºäºtcpçš„æœåŠ¡ç«¯ä¸å®¢æˆ·ç«¯å®ä¾‹ å…ˆè¿è¡ŒæœåŠ¡ç«¯å†è¿è¡Œå®¢æˆ·ç«¯ï¼ŒæœåŠ¡ç«¯æ”¶åˆ°å®¢æˆ·ç«¯ä¸‹å±çš„å¼€å§‹æŒ‡ä»¤åï¼Œä¸¤è¾¹åŒæ—¶åˆ›å»ºçº¿ç¨‹ï¼ŒæœåŠ¡ç«¯æ”¶åˆ°å®¢æˆ·ç«¯ä¸‹å±çš„åœæ­¢æŒ‡ä»¤åï¼Œä¸¤è¾¹åŒæ—¶åœæ­¢çº¿ç¨‹\nserver.c 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 #include &lt;stdlib.h&gt; #include &lt;stdio.h&gt; #include &lt;stdbool.h&gt; #include &lt;assert.h&gt; #include &lt;fcntl.h&gt; // Flags for open() #include &lt;sys/stat.h&gt; // Open() system call #include &lt;sys/types.h&gt; // Types for open() #include &lt;unistd.h&gt; // Close() system call #include &lt;string.h&gt; // Memory setting and copying #include &lt;getopt.h&gt; // Option parsing #include &lt;errno.h&gt; // Error codes #include&lt;sys/socket.h&gt; #include&lt;netinet/in.h&gt; #include &lt;pthread.h&gt; #define DEFAULT_PORT 4000 #define MAXLINE 4096 #define socket_send_size 4096 int socket_fd, connect_fd; int flag1; // å…¨å±€å˜é‡ pthread_t worker_thread = 0; // å·¥ä½œçº¿ç¨‹ ID volatile int thread_running = 0; // çº¿ç¨‹è¿è¡ŒçŠ¶æ€ pthread_mutex_t mutex = PTHREAD_MUTEX_INITIALIZER; // äº’æ–¥é” int flag1; int socket_fd, connect_fd; void cleanup_handler() {\t} void *receive_file(void *arg) { printf(&#34;enter therad\\n&#34;);\tpthread_cleanup_push(cleanup_handler, NULL); int i = 0, rc = 0; unsigned char send_buffer[socket_send_size] = {0}; memset(send_buffer, 0, socket_send_size); while (flag1 == 1) { #if 1 for (i = 0; i &lt; 4; i++) { if (flag1 != 1) break; } send(connect_fd, &amp;send_buffer[0], socket_send_size, 0); #endif } pthread_cleanup_pop(0); pthread_exit(NULL); } void create_thread() { pthread_mutex_lock(&amp;mutex); if (!thread_running) { int ret = pthread_create(&amp;worker_thread, NULL, &amp;receive_file, NULL); if (ret != 0) { perror(&#34;pthread_create&#34;);\texit(EXIT_FAILURE); } thread_running = 1; printf(&#34;Main: Created thread\\n&#34;); } else { printf(&#34;Main: Thread is already running\\n&#34;); } pthread_mutex_unlock(&amp;mutex); } // é”€æ¯çº¿ç¨‹ void destroy_thread() { pthread_mutex_lock(&amp;mutex); if (thread_running) { printf(&#34;Main: Stopping thread...\\n&#34;); int ret = pthread_cancel(worker_thread); if (ret != 0) { perror(&#34;pthread_cancel&#34;); exit(EXIT_FAILURE); } // ç­‰å¾…çº¿ç¨‹é€€å‡ºå¹¶å›æ”¶èµ„æº ret = pthread_join(worker_thread, NULL); if (ret != 0) { perror(&#34;pthread_join&#34;); exit(EXIT_FAILURE); } thread_running = 0; printf(&#34;Main: Thread has exited.\\n&#34;); } else { printf(&#34;Main: No thread is running\\n&#34;); } pthread_mutex_unlock(&amp;mutex); } // ä¸»å‡½æ•° /*---------------------------------------------------------------------------- * Main *----------------------------------------------------------------------------*/ int main(void) {\t// Socketç›¸å…³å˜é‡ struct sockaddr_in servaddr; unsigned char buff[MAXLINE]; int n; //åˆå§‹åŒ–Socket if( (socket_fd = socket(AF_INET, SOCK_STREAM, 0)) == -1 ) { printf(&#34;create socket error: %s(errno: %d)\\n&#34;,strerror(errno),errno); exit(0); } // è§£å†³ Address already in use é—®é¢˜ int opt = 1; setsockopt(socket_fd, SOL_SOCKET, SO_REUSEADDR, &amp;opt, sizeof(opt)); //åˆå§‹åŒ– memset(&amp;servaddr, 0, sizeof(servaddr)); servaddr.sin_family = AF_INET; servaddr.sin_addr.s_addr = htonl(INADDR_ANY);//IPåœ°å€è®¾ç½®æˆINADDR_ANY,è®©ç³»ç»Ÿè‡ªåŠ¨è·å–æœ¬æœºçš„IPåœ°å€ã€‚ servaddr.sin_port = htons(DEFAULT_PORT);//è®¾ç½®çš„ç«¯å£ä¸ºDEFAULT_PORT //å°†æœ¬åœ°åœ°å€ç»‘å®šåˆ°æ‰€åˆ›å»ºçš„å¥—æ¥å­—ä¸Š if( bind(socket_fd, (struct sockaddr*)&amp;servaddr, sizeof(servaddr)) == -1) { printf(&#34;bind socket error: %s(errno: %d)\\n&#34;,strerror(errno),errno); exit(0); } //å¼€å§‹ç›‘å¬æ˜¯å¦æœ‰å®¢æˆ·ç«¯è¿æ¥ if( listen(socket_fd, 2) == -1) { printf(&#34;listen socket error: %s(errno: %d)\\n&#34;,strerror(errno),errno); exit(0); } printf(&#34;======waiting for client&#39;s request======\\n&#34;); flag1 = 0; printf(&#34;start:\\nFA 00 00 08 00 00 00 01\\n&#34;); printf(&#34;stop:\\nFA 00 00 08 00 00 00 02\\n&#34;); while (1) { if( (connect_fd = accept(socket_fd, (struct sockaddr*)NULL, NULL)) == -1) { printf(&#34;accept socket error: %s(errno: %d)&#34;,strerror(errno),errno); usleep(10); continue; } printf(&#34;mark-1\\n&#34;); while (1) { //æ¥å—å®¢æˆ·ç«¯ä¼ è¿‡æ¥çš„æ•°æ® n = recv(connect_fd, buff, MAXLINE, 0); usleep(100); printf(&#34;mark-2\\n&#34;); if(n &gt; 0) { // åˆ¤æ–­æ˜¯å¼€å§‹è¿˜æ˜¯åœæ­¢ if (buff[0] == 0xFA &amp;&amp; buff[7] == 0x01) { // å¼€å§‹ printf(&#34;start\\n&#34;); //sleep(1200); //æµ‹è¯•é•¿æ—¶é—´ä¸æ‰§è¡Œæ“ä½œï¼Œç½‘å£æ˜¯å¦ä»æ­£å¸¸å·¥ä½œ flag1 = 1; // å¤ä½\tcreate_thread(); system(&#34;date&#34;); } else if (buff[0] == 0xFA &amp;&amp; buff[7] == 0x02) { flag1 = 2; // åœæ­¢\tdestroy_thread(); system(&#34;date&#34;); } } else if (n &lt; 0) { usleep(100); continue; } else { close(connect_fd); printf(&#34;mark-3\\n&#34;); usleep(100); break; } } usleep(10); } close(connect_fd); close(socket_fd); return 0; } client.c 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 #include &lt;stdio.h&gt; #include &lt;stdlib.h&gt; #include &lt;string.h&gt; #include &lt;errno.h&gt; #include &lt;sys/types.h&gt; #include &lt;sys/socket.h&gt; #include &lt;netinet/in.h&gt; #include &lt;arpa/inet.h&gt; #include &lt;unistd.h&gt; #include &lt;pthread.h&gt; #define DEFAULT_PORT 4000 #define MAXLINE 4096 // å…¨å±€å˜é‡ pthread_t worker_thread = 0; // å·¥ä½œçº¿ç¨‹ ID volatile int thread_running = 0; // çº¿ç¨‹è¿è¡ŒçŠ¶æ€ volatile int thread_should_exit = 0; // çº¿ç¨‹é€€å‡ºæ ‡å¿— pthread_mutex_t mutex = PTHREAD_MUTEX_INITIALIZER; // äº’æ–¥é” // çº¿ç¨‹æ¸…ç†å‡½æ•° void cleanup_handler(void *arg) { printf(&#34;Thread: Cleaning up resources...\\n&#34;); } // å·¥ä½œçº¿ç¨‹å‡½æ•° void *receive_file(void *arg) { printf(&#34;Thread: Entered thread\\n&#34;); // æ³¨å†Œæ¸…ç†å‡½æ•° pthread_cleanup_push(cleanup_handler, NULL); while (!thread_should_exit) { // æ¨¡æ‹Ÿå·¥ä½œ printf(&#34;Thread: Working...\\n&#34;); sleep(1); } // æ¸…ç† pthread_cleanup_pop(1); printf(&#34;Thread: Exiting...\\n&#34;); return NULL; } // åˆ›å»ºçº¿ç¨‹ void create_thread() { pthread_mutex_lock(&amp;mutex); if (!thread_running) { thread_should_exit = 0; // é‡ç½®é€€å‡ºæ ‡å¿— int ret = pthread_create(&amp;worker_thread, NULL, receive_file, NULL); if (ret != 0) { perror(&#34;pthread_create&#34;); exit(EXIT_FAILURE); } thread_running = 1; printf(&#34;Main: Created thread\\n&#34;); } else { printf(&#34;Main: Thread is already running\\n&#34;); } pthread_mutex_unlock(&amp;mutex); } // é”€æ¯çº¿ç¨‹ void destroy_thread() { pthread_mutex_lock(&amp;mutex); if (thread_running) { printf(&#34;Main: Stopping thread...\\n&#34;); thread_should_exit = 1; // è®¾ç½®é€€å‡ºæ ‡å¿— // ç­‰å¾…çº¿ç¨‹é€€å‡ºå¹¶å›æ”¶èµ„æº int ret = pthread_join(worker_thread, NULL); if (ret != 0) { perror(&#34;pthread_join&#34;); exit(EXIT_FAILURE); } thread_running = 0; printf(&#34;Main: Thread has exited.\\n&#34;); } else { printf(&#34;Main: No thread is running\\n&#34;); } pthread_mutex_unlock(&amp;mutex); } // è§£æ 16 è¿›åˆ¶è¾“å…¥ int parse_hex_input(const char *input, unsigned char *output, size_t output_size) { char *endptr; for (size_t i = 0; i &lt; output_size; i++) { output[i] = (unsigned char)strtol(input + 2 * i, &amp;endptr, 16); if (endptr != input + 2 * (i + 1)) { return -1; // éæ³•è¾“å…¥ } } return 0; } int main(int argc, char *argv[]) { int i = 0; int input = 0; int sockfd; struct sockaddr_in servaddr; // æ£€æŸ¥å‘½ä»¤è¡Œå‚æ•° if (argc != 2) { printf(&#34;Usage: %s &lt;ipaddress&gt;\\n&#34;, argv[0]); exit(EXIT_FAILURE); } // åˆ›å»º Socket if ((sockfd = socket(AF_INET, SOCK_STREAM, 0)) &lt; 0) { printf(&#34;Create socket error: %s (errno: %d)\\n&#34;, strerror(errno), errno); exit(EXIT_FAILURE); } // è®¾ç½®æœåŠ¡å™¨åœ°å€ memset(&amp;servaddr, 0, sizeof(servaddr)); servaddr.sin_family = AF_INET; servaddr.sin_port = htons(DEFAULT_PORT); if (inet_pton(AF_INET, argv[1], &amp;servaddr.sin_addr) &lt;= 0) { printf(&#34;inet_pton error for %s\\n&#34;, argv[1]); close(sockfd); exit(EXIT_FAILURE); } // è¿æ¥åˆ°æœåŠ¡å™¨ if (connect(sockfd, (struct sockaddr *)&amp;servaddr, sizeof(servaddr)) &lt; 0) { printf(&#34;Connect error: %s (errno: %d)\\n&#34;, strerror(errno), errno); close(sockfd); exit(EXIT_FAILURE); } printf(&#34;Connected to server at %s:%d\\n&#34;, argv[1], DEFAULT_PORT); printf(&#34;start:\\nFA 00 00 08 00 00 00 01\\n&#34;); printf(&#34;stop:\\nFA 00 00 08 00 00 00 02\\n&#34;); // ä¸»å¾ªç¯ while (1) { unsigned char input_buf[8] = {0}; char input_str[17]; // 8 ä¸ª 16 è¿›åˆ¶æ•°ï¼Œæ¯ä¸ªå  2 å­—ç¬¦ï¼ŒåŠ ä¸Šç»“æŸç¬¦ for (i = 0; i &lt; 8; i++) { scanf(&#34;%x&#34;, &amp;input); input_buf[i] = input; } // æ‰“å°è¾“å…¥ printf(&#34;Input: &#34;); for (int i = 0; i &lt; 8; i++) { printf(&#34;%02X &#34;, input_buf[i]); } printf(&#34;\\n&#34;); // æ ¹æ®è¾“å…¥å¯åŠ¨æˆ–åœæ­¢çº¿ç¨‹ if (input_buf[0] == 0xFA &amp;&amp; input_buf[7] == 0x01) { create_thread(); send(sockfd, &amp;input_buf[0], sizeof(input_buf), 0); } else if (input_buf[0] == 0xFA &amp;&amp; input_buf[7] == 0x02) { destroy_thread(); send(sockfd, &amp;input_buf[0], sizeof(input_buf), 0); } } // æ¸…ç†èµ„æº destroy_thread(); // ç¡®ä¿çº¿ç¨‹é€€å‡º pthread_mutex_destroy(&amp;mutex); close(sockfd); return 0; } è¿è¡Œæ–¹å¼ serverç«¯ 1 ./server æ˜¾ç¤ºç»“æœå¹¶ç­‰å¾…å®¢æˆ·ç«¯è¿æ¥\n">
<meta property='og:url' content='https://ynhugo.github.io/p/socket%E5%9F%BA%E4%BA%8Etcp%E7%9A%84%E6%9C%8D%E5%8A%A1%E7%AB%AF%E4%B8%8E%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%AE%9E%E4%BE%8B/'>
<meta property='og:site_name' content='ynhugo'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='socket' /><meta property='article:tag' content='tcp' /><meta property='article:tag' content='ç¨‹åºå‘˜' /><meta property='article:published_time' content='2025-03-20T17:38:32&#43;08:00'/><meta property='article:modified_time' content='2025-03-20T17:38:32&#43;08:00'/>
<meta name="twitter:title" content="socketåŸºäºtcpçš„æœåŠ¡ç«¯ä¸å®¢æˆ·ç«¯å®ä¾‹">
<meta name="twitter:description" content=" socketåŸºäºtcpçš„æœåŠ¡ç«¯ä¸å®¢æˆ·ç«¯å®ä¾‹ å…ˆè¿è¡ŒæœåŠ¡ç«¯å†è¿è¡Œå®¢æˆ·ç«¯ï¼ŒæœåŠ¡ç«¯æ”¶åˆ°å®¢æˆ·ç«¯ä¸‹å±çš„å¼€å§‹æŒ‡ä»¤åï¼Œä¸¤è¾¹åŒæ—¶åˆ›å»ºçº¿ç¨‹ï¼ŒæœåŠ¡ç«¯æ”¶åˆ°å®¢æˆ·ç«¯ä¸‹å±çš„åœæ­¢æŒ‡ä»¤åï¼Œä¸¤è¾¹åŒæ—¶åœæ­¢çº¿ç¨‹\nserver.c 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 #include &lt;stdlib.h&gt; #include &lt;stdio.h&gt; #include &lt;stdbool.h&gt; #include &lt;assert.h&gt; #include &lt;fcntl.h&gt; // Flags for open() #include &lt;sys/stat.h&gt; // Open() system call #include &lt;sys/types.h&gt; // Types for open() #include &lt;unistd.h&gt; // Close() system call #include &lt;string.h&gt; // Memory setting and copying #include &lt;getopt.h&gt; // Option parsing #include &lt;errno.h&gt; // Error codes #include&lt;sys/socket.h&gt; #include&lt;netinet/in.h&gt; #include &lt;pthread.h&gt; #define DEFAULT_PORT 4000 #define MAXLINE 4096 #define socket_send_size 4096 int socket_fd, connect_fd; int flag1; // å…¨å±€å˜é‡ pthread_t worker_thread = 0; // å·¥ä½œçº¿ç¨‹ ID volatile int thread_running = 0; // çº¿ç¨‹è¿è¡ŒçŠ¶æ€ pthread_mutex_t mutex = PTHREAD_MUTEX_INITIALIZER; // äº’æ–¥é” int flag1; int socket_fd, connect_fd; void cleanup_handler() {\t} void *receive_file(void *arg) { printf(&#34;enter therad\\n&#34;);\tpthread_cleanup_push(cleanup_handler, NULL); int i = 0, rc = 0; unsigned char send_buffer[socket_send_size] = {0}; memset(send_buffer, 0, socket_send_size); while (flag1 == 1) { #if 1 for (i = 0; i &lt; 4; i++) { if (flag1 != 1) break; } send(connect_fd, &amp;send_buffer[0], socket_send_size, 0); #endif } pthread_cleanup_pop(0); pthread_exit(NULL); } void create_thread() { pthread_mutex_lock(&amp;mutex); if (!thread_running) { int ret = pthread_create(&amp;worker_thread, NULL, &amp;receive_file, NULL); if (ret != 0) { perror(&#34;pthread_create&#34;);\texit(EXIT_FAILURE); } thread_running = 1; printf(&#34;Main: Created thread\\n&#34;); } else { printf(&#34;Main: Thread is already running\\n&#34;); } pthread_mutex_unlock(&amp;mutex); } // é”€æ¯çº¿ç¨‹ void destroy_thread() { pthread_mutex_lock(&amp;mutex); if (thread_running) { printf(&#34;Main: Stopping thread...\\n&#34;); int ret = pthread_cancel(worker_thread); if (ret != 0) { perror(&#34;pthread_cancel&#34;); exit(EXIT_FAILURE); } // ç­‰å¾…çº¿ç¨‹é€€å‡ºå¹¶å›æ”¶èµ„æº ret = pthread_join(worker_thread, NULL); if (ret != 0) { perror(&#34;pthread_join&#34;); exit(EXIT_FAILURE); } thread_running = 0; printf(&#34;Main: Thread has exited.\\n&#34;); } else { printf(&#34;Main: No thread is running\\n&#34;); } pthread_mutex_unlock(&amp;mutex); } // ä¸»å‡½æ•° /*---------------------------------------------------------------------------- * Main *----------------------------------------------------------------------------*/ int main(void) {\t// Socketç›¸å…³å˜é‡ struct sockaddr_in servaddr; unsigned char buff[MAXLINE]; int n; //åˆå§‹åŒ–Socket if( (socket_fd = socket(AF_INET, SOCK_STREAM, 0)) == -1 ) { printf(&#34;create socket error: %s(errno: %d)\\n&#34;,strerror(errno),errno); exit(0); } // è§£å†³ Address already in use é—®é¢˜ int opt = 1; setsockopt(socket_fd, SOL_SOCKET, SO_REUSEADDR, &amp;opt, sizeof(opt)); //åˆå§‹åŒ– memset(&amp;servaddr, 0, sizeof(servaddr)); servaddr.sin_family = AF_INET; servaddr.sin_addr.s_addr = htonl(INADDR_ANY);//IPåœ°å€è®¾ç½®æˆINADDR_ANY,è®©ç³»ç»Ÿè‡ªåŠ¨è·å–æœ¬æœºçš„IPåœ°å€ã€‚ servaddr.sin_port = htons(DEFAULT_PORT);//è®¾ç½®çš„ç«¯å£ä¸ºDEFAULT_PORT //å°†æœ¬åœ°åœ°å€ç»‘å®šåˆ°æ‰€åˆ›å»ºçš„å¥—æ¥å­—ä¸Š if( bind(socket_fd, (struct sockaddr*)&amp;servaddr, sizeof(servaddr)) == -1) { printf(&#34;bind socket error: %s(errno: %d)\\n&#34;,strerror(errno),errno); exit(0); } //å¼€å§‹ç›‘å¬æ˜¯å¦æœ‰å®¢æˆ·ç«¯è¿æ¥ if( listen(socket_fd, 2) == -1) { printf(&#34;listen socket error: %s(errno: %d)\\n&#34;,strerror(errno),errno); exit(0); } printf(&#34;======waiting for client&#39;s request======\\n&#34;); flag1 = 0; printf(&#34;start:\\nFA 00 00 08 00 00 00 01\\n&#34;); printf(&#34;stop:\\nFA 00 00 08 00 00 00 02\\n&#34;); while (1) { if( (connect_fd = accept(socket_fd, (struct sockaddr*)NULL, NULL)) == -1) { printf(&#34;accept socket error: %s(errno: %d)&#34;,strerror(errno),errno); usleep(10); continue; } printf(&#34;mark-1\\n&#34;); while (1) { //æ¥å—å®¢æˆ·ç«¯ä¼ è¿‡æ¥çš„æ•°æ® n = recv(connect_fd, buff, MAXLINE, 0); usleep(100); printf(&#34;mark-2\\n&#34;); if(n &gt; 0) { // åˆ¤æ–­æ˜¯å¼€å§‹è¿˜æ˜¯åœæ­¢ if (buff[0] == 0xFA &amp;&amp; buff[7] == 0x01) { // å¼€å§‹ printf(&#34;start\\n&#34;); //sleep(1200); //æµ‹è¯•é•¿æ—¶é—´ä¸æ‰§è¡Œæ“ä½œï¼Œç½‘å£æ˜¯å¦ä»æ­£å¸¸å·¥ä½œ flag1 = 1; // å¤ä½\tcreate_thread(); system(&#34;date&#34;); } else if (buff[0] == 0xFA &amp;&amp; buff[7] == 0x02) { flag1 = 2; // åœæ­¢\tdestroy_thread(); system(&#34;date&#34;); } } else if (n &lt; 0) { usleep(100); continue; } else { close(connect_fd); printf(&#34;mark-3\\n&#34;); usleep(100); break; } } usleep(10); } close(connect_fd); close(socket_fd); return 0; } client.c 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 #include &lt;stdio.h&gt; #include &lt;stdlib.h&gt; #include &lt;string.h&gt; #include &lt;errno.h&gt; #include &lt;sys/types.h&gt; #include &lt;sys/socket.h&gt; #include &lt;netinet/in.h&gt; #include &lt;arpa/inet.h&gt; #include &lt;unistd.h&gt; #include &lt;pthread.h&gt; #define DEFAULT_PORT 4000 #define MAXLINE 4096 // å…¨å±€å˜é‡ pthread_t worker_thread = 0; // å·¥ä½œçº¿ç¨‹ ID volatile int thread_running = 0; // çº¿ç¨‹è¿è¡ŒçŠ¶æ€ volatile int thread_should_exit = 0; // çº¿ç¨‹é€€å‡ºæ ‡å¿— pthread_mutex_t mutex = PTHREAD_MUTEX_INITIALIZER; // äº’æ–¥é” // çº¿ç¨‹æ¸…ç†å‡½æ•° void cleanup_handler(void *arg) { printf(&#34;Thread: Cleaning up resources...\\n&#34;); } // å·¥ä½œçº¿ç¨‹å‡½æ•° void *receive_file(void *arg) { printf(&#34;Thread: Entered thread\\n&#34;); // æ³¨å†Œæ¸…ç†å‡½æ•° pthread_cleanup_push(cleanup_handler, NULL); while (!thread_should_exit) { // æ¨¡æ‹Ÿå·¥ä½œ printf(&#34;Thread: Working...\\n&#34;); sleep(1); } // æ¸…ç† pthread_cleanup_pop(1); printf(&#34;Thread: Exiting...\\n&#34;); return NULL; } // åˆ›å»ºçº¿ç¨‹ void create_thread() { pthread_mutex_lock(&amp;mutex); if (!thread_running) { thread_should_exit = 0; // é‡ç½®é€€å‡ºæ ‡å¿— int ret = pthread_create(&amp;worker_thread, NULL, receive_file, NULL); if (ret != 0) { perror(&#34;pthread_create&#34;); exit(EXIT_FAILURE); } thread_running = 1; printf(&#34;Main: Created thread\\n&#34;); } else { printf(&#34;Main: Thread is already running\\n&#34;); } pthread_mutex_unlock(&amp;mutex); } // é”€æ¯çº¿ç¨‹ void destroy_thread() { pthread_mutex_lock(&amp;mutex); if (thread_running) { printf(&#34;Main: Stopping thread...\\n&#34;); thread_should_exit = 1; // è®¾ç½®é€€å‡ºæ ‡å¿— // ç­‰å¾…çº¿ç¨‹é€€å‡ºå¹¶å›æ”¶èµ„æº int ret = pthread_join(worker_thread, NULL); if (ret != 0) { perror(&#34;pthread_join&#34;); exit(EXIT_FAILURE); } thread_running = 0; printf(&#34;Main: Thread has exited.\\n&#34;); } else { printf(&#34;Main: No thread is running\\n&#34;); } pthread_mutex_unlock(&amp;mutex); } // è§£æ 16 è¿›åˆ¶è¾“å…¥ int parse_hex_input(const char *input, unsigned char *output, size_t output_size) { char *endptr; for (size_t i = 0; i &lt; output_size; i++) { output[i] = (unsigned char)strtol(input + 2 * i, &amp;endptr, 16); if (endptr != input + 2 * (i + 1)) { return -1; // éæ³•è¾“å…¥ } } return 0; } int main(int argc, char *argv[]) { int i = 0; int input = 0; int sockfd; struct sockaddr_in servaddr; // æ£€æŸ¥å‘½ä»¤è¡Œå‚æ•° if (argc != 2) { printf(&#34;Usage: %s &lt;ipaddress&gt;\\n&#34;, argv[0]); exit(EXIT_FAILURE); } // åˆ›å»º Socket if ((sockfd = socket(AF_INET, SOCK_STREAM, 0)) &lt; 0) { printf(&#34;Create socket error: %s (errno: %d)\\n&#34;, strerror(errno), errno); exit(EXIT_FAILURE); } // è®¾ç½®æœåŠ¡å™¨åœ°å€ memset(&amp;servaddr, 0, sizeof(servaddr)); servaddr.sin_family = AF_INET; servaddr.sin_port = htons(DEFAULT_PORT); if (inet_pton(AF_INET, argv[1], &amp;servaddr.sin_addr) &lt;= 0) { printf(&#34;inet_pton error for %s\\n&#34;, argv[1]); close(sockfd); exit(EXIT_FAILURE); } // è¿æ¥åˆ°æœåŠ¡å™¨ if (connect(sockfd, (struct sockaddr *)&amp;servaddr, sizeof(servaddr)) &lt; 0) { printf(&#34;Connect error: %s (errno: %d)\\n&#34;, strerror(errno), errno); close(sockfd); exit(EXIT_FAILURE); } printf(&#34;Connected to server at %s:%d\\n&#34;, argv[1], DEFAULT_PORT); printf(&#34;start:\\nFA 00 00 08 00 00 00 01\\n&#34;); printf(&#34;stop:\\nFA 00 00 08 00 00 00 02\\n&#34;); // ä¸»å¾ªç¯ while (1) { unsigned char input_buf[8] = {0}; char input_str[17]; // 8 ä¸ª 16 è¿›åˆ¶æ•°ï¼Œæ¯ä¸ªå  2 å­—ç¬¦ï¼ŒåŠ ä¸Šç»“æŸç¬¦ for (i = 0; i &lt; 8; i++) { scanf(&#34;%x&#34;, &amp;input); input_buf[i] = input; } // æ‰“å°è¾“å…¥ printf(&#34;Input: &#34;); for (int i = 0; i &lt; 8; i++) { printf(&#34;%02X &#34;, input_buf[i]); } printf(&#34;\\n&#34;); // æ ¹æ®è¾“å…¥å¯åŠ¨æˆ–åœæ­¢çº¿ç¨‹ if (input_buf[0] == 0xFA &amp;&amp; input_buf[7] == 0x01) { create_thread(); send(sockfd, &amp;input_buf[0], sizeof(input_buf), 0); } else if (input_buf[0] == 0xFA &amp;&amp; input_buf[7] == 0x02) { destroy_thread(); send(sockfd, &amp;input_buf[0], sizeof(input_buf), 0); } } // æ¸…ç†èµ„æº destroy_thread(); // ç¡®ä¿çº¿ç¨‹é€€å‡º pthread_mutex_destroy(&amp;mutex); close(sockfd); return 0; } è¿è¡Œæ–¹å¼ serverç«¯ 1 ./server æ˜¾ç¤ºç»“æœå¹¶ç­‰å¾…å®¢æˆ·ç«¯è¿æ¥\n">
    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="åˆ‡æ¢èœå•">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/avatar_hu_b5976aa1afdc1d2e.png" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">ğŸ¥</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">ynhugo</a></h1>
            <h2 class="site-description">ynhugo.github.io</h2>
        </div>
    </header><ol class="menu-social">
            
                <li>
                    <a 
                        href='https://github.com/CaiJimmy/hugo-theme-stack'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://x.com'
                        target="_blank"
                        title="x"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M22 4.01c-1 .49 -1.98 .689 -3 .99c-1.121 -1.265 -2.783 -1.335 -4.38 -.737s-2.643 2.06 -2.62 3.737v1c-3.245 .083 -6.135 -1.395 -8 -4c0 0 -4.182 7.433 4 11c-1.872 1.247 -3.739 2.088 -6 2c3.308 1.803 6.913 2.423 10.034 1.517c3.58 -1.04 6.522 -3.723 7.651 -7.742a13.84 13.84 0 0 0 .497 -3.753c-.002 -.249 1.51 -2.772 1.818 -4.013z" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>ä¸»é¡µ</span>
            </a>
        </li>
        
        
        <li >
            <a href='/book/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 512 512" fill="none" stroke="#808080" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <path d="m443.6,11h-321c-35.4,0-64.6,26.1-64.6,59.4v371.1c0,33.4 26.1,59.4 59.4,59.4h326.2c6.3,0 10.4-4.2 10.4-11.5v-468c0-6.2-4.2-10.4-10.4-10.4zm-321,20.9h310.5v350.3h-315.7c-14.9,0-28.3,5.2-38.6,13.9v-325.7c-1.42109e-14-21.9 19.8-38.5 43.8-38.5zm310.6,449.3h-315.8c-21.9,0-38.6-16.7-38.6-38.6 0-21.9 17.7-38.6 38.6-38.6l315.8,.1v77.1z"/>
</svg>
                
                <span>Book</span>
            </a>
        </li>
        
        
        <li >
            <a href='/%E5%85%B3%E4%BA%8E/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>å…³äº</span>
            </a>
        </li>
        
        
        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>Archives</span>
            </a>
        </li>
        
        
        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>Search</span>
            </a>
        </li>
        
        
        <li >
            <a href='/links/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                
                <span>Links</span>
            </a>
        </li>
        
        <li class="menu-bottom-section">
            <ol class="menu">
                    
                        <li id="i18n-switch">  
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M4 5h7" />
  <path d="M9 3v2c0 4.418 -2.239 8 -5 8" />
  <path d="M5 9c-.003 2.144 2.952 3.908 6.7 4" />
  <path d="M12 20l4 -9l4 9" />
  <path d="M19.1 18h-6.2" />
</svg>



                            <select name="language" title="language" onchange="window.location.href = this.selectedOptions[0].value">
                                
                                    <option value="https://ynhugo.github.io/en/" >English</option>
                                
                                    <option value="https://ynhugo.github.io/" selected>ä¸­æ–‡</option>
                                
                                    <option value="https://ynhugo.github.io/ar/" >Ø¹Ø±Ø¨ÙŠ</option>
                                
                            </select>
                        </li>
                    
                

                
                    <li id="dark-mode-toggle">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <span>æš—è‰²æ¨¡å¼</span>
                    </li>
                
            </ol>
        </li>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">ç›®å½•</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
<ul>
<li><a href="#headline-1">socketåŸºäºtcpçš„æœåŠ¡ç«¯ä¸å®¢æˆ·ç«¯å®ä¾‹</a>
<ul>
<li><a href="#headline-2">server.c</a>
</li>
<li><a href="#headline-3">client.c</a>
</li>
<li><a href="#headline-4">è¿è¡Œæ–¹å¼</a>
<ul>
<li><a href="#headline-5">serverç«¯</a>
</li>
<li><a href="#headline-6">clientç«¯</a>
</li>
</ul>
</li>
<li><a href="#headline-7">å‚è€ƒé“¾æ¥</a>
</li>
</ul>
</li>
</ul>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="main-article">
    <header class="article-header">

    <div class="article-details">
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/p/socket%E5%9F%BA%E4%BA%8Etcp%E7%9A%84%E6%9C%8D%E5%8A%A1%E7%AB%AF%E4%B8%8E%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%AE%9E%E4%BE%8B/">socketåŸºäºtcpçš„æœåŠ¡ç«¯ä¸å®¢æˆ·ç«¯å®ä¾‹</a>
        </h2>
    
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">Mar 20, 2025</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    é˜…è¯»æ—¶é•¿: 8 åˆ†é’Ÿ
                </time>
            </div>
        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    
<div id="outline-container-headline-1" class="outline-2">
<h2 id="headline-1">
socketåŸºäºtcpçš„æœåŠ¡ç«¯ä¸å®¢æˆ·ç«¯å®ä¾‹
</h2>
<div id="outline-text-headline-1" class="outline-text-2">
<p>
å…ˆè¿è¡ŒæœåŠ¡ç«¯å†è¿è¡Œå®¢æˆ·ç«¯ï¼ŒæœåŠ¡ç«¯æ”¶åˆ°å®¢æˆ·ç«¯ä¸‹å±çš„å¼€å§‹æŒ‡ä»¤åï¼Œä¸¤è¾¹åŒæ—¶åˆ›å»ºçº¿ç¨‹ï¼ŒæœåŠ¡ç«¯æ”¶åˆ°å®¢æˆ·ç«¯ä¸‹å±çš„åœæ­¢æŒ‡ä»¤åï¼Œä¸¤è¾¹åŒæ—¶åœæ­¢çº¿ç¨‹</p>
<div id="outline-container-headline-2" class="outline-3">
<h3 id="headline-2">
server.c
</h3>
<div id="outline-text-headline-2" class="outline-text-3">
<div class="src src-text">
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">#include &lt;stdlib.h&gt;
</span></span><span class="line"><span class="cl">#include &lt;stdio.h&gt;
</span></span><span class="line"><span class="cl">#include &lt;stdbool.h&gt;
</span></span><span class="line"><span class="cl">#include &lt;assert.h&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">#include &lt;fcntl.h&gt;              // Flags for open()
</span></span><span class="line"><span class="cl">#include &lt;sys/stat.h&gt;           // Open() system call
</span></span><span class="line"><span class="cl">#include &lt;sys/types.h&gt;          // Types for open()
</span></span><span class="line"><span class="cl">#include &lt;unistd.h&gt;             // Close() system call
</span></span><span class="line"><span class="cl">#include &lt;string.h&gt;             // Memory setting and copying
</span></span><span class="line"><span class="cl">#include &lt;getopt.h&gt;             // Option parsing
</span></span><span class="line"><span class="cl">#include &lt;errno.h&gt;              // Error codes
</span></span><span class="line"><span class="cl">#include&lt;sys/socket.h&gt;
</span></span><span class="line"><span class="cl">#include&lt;netinet/in.h&gt;
</span></span><span class="line"><span class="cl">#include &lt;pthread.h&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">#define DEFAULT_PORT 4000
</span></span><span class="line"><span class="cl">#define MAXLINE 4096
</span></span><span class="line"><span class="cl">#define socket_send_size 4096
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">int    socket_fd, connect_fd;
</span></span><span class="line"><span class="cl">int    flag1;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">// å…¨å±€å˜é‡
</span></span><span class="line"><span class="cl">pthread_t worker_thread = 0; // å·¥ä½œçº¿ç¨‹ ID
</span></span><span class="line"><span class="cl">volatile int thread_running = 0; // çº¿ç¨‹è¿è¡ŒçŠ¶æ€
</span></span><span class="line"><span class="cl">pthread_mutex_t mutex = PTHREAD_MUTEX_INITIALIZER; // äº’æ–¥é”
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">int flag1;
</span></span><span class="line"><span class="cl">int socket_fd, connect_fd;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">void cleanup_handler() {	
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">void *receive_file(void *arg) {
</span></span><span class="line"><span class="cl">	printf(&#34;enter therad\n&#34;);	
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	pthread_cleanup_push(cleanup_handler, NULL);
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    int i = 0, rc = 0;
</span></span><span class="line"><span class="cl">    unsigned char send_buffer[socket_send_size] = {0};
</span></span><span class="line"><span class="cl">    memset(send_buffer, 0, socket_send_size);
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">	while (flag1 == 1) {
</span></span><span class="line"><span class="cl">#if 1
</span></span><span class="line"><span class="cl">		for (i = 0; i &lt; 4; i++) {
</span></span><span class="line"><span class="cl">			if (flag1 != 1) break;
</span></span><span class="line"><span class="cl">		}
</span></span><span class="line"><span class="cl">		send(connect_fd, &amp;send_buffer[0], socket_send_size, 0);
</span></span><span class="line"><span class="cl">#endif
</span></span><span class="line"><span class="cl">	}
</span></span><span class="line"><span class="cl">	pthread_cleanup_pop(0);
</span></span><span class="line"><span class="cl">	pthread_exit(NULL);
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">void create_thread() {
</span></span><span class="line"><span class="cl">    pthread_mutex_lock(&amp;mutex);
</span></span><span class="line"><span class="cl">    if (!thread_running) {        
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		int ret = pthread_create(&amp;worker_thread, NULL, &amp;receive_file, NULL);
</span></span><span class="line"><span class="cl">		if (ret != 0) {
</span></span><span class="line"><span class="cl">			perror(&#34;pthread_create&#34;);			
</span></span><span class="line"><span class="cl">			exit(EXIT_FAILURE);
</span></span><span class="line"><span class="cl">		}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        thread_running = 1;
</span></span><span class="line"><span class="cl">        printf(&#34;Main: Created thread\n&#34;);
</span></span><span class="line"><span class="cl">    } else {
</span></span><span class="line"><span class="cl">        printf(&#34;Main: Thread is already running\n&#34;);
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">    pthread_mutex_unlock(&amp;mutex);
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">// é”€æ¯çº¿ç¨‹
</span></span><span class="line"><span class="cl">void destroy_thread() {
</span></span><span class="line"><span class="cl">    pthread_mutex_lock(&amp;mutex);
</span></span><span class="line"><span class="cl">    if (thread_running) {
</span></span><span class="line"><span class="cl">        printf(&#34;Main: Stopping thread...\n&#34;);
</span></span><span class="line"><span class="cl">        int ret = pthread_cancel(worker_thread);
</span></span><span class="line"><span class="cl">        if (ret != 0) {
</span></span><span class="line"><span class="cl">            perror(&#34;pthread_cancel&#34;);
</span></span><span class="line"><span class="cl">            exit(EXIT_FAILURE);
</span></span><span class="line"><span class="cl">        }
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        // ç­‰å¾…çº¿ç¨‹é€€å‡ºå¹¶å›æ”¶èµ„æº
</span></span><span class="line"><span class="cl">        ret = pthread_join(worker_thread, NULL);
</span></span><span class="line"><span class="cl">        if (ret != 0) {
</span></span><span class="line"><span class="cl">            perror(&#34;pthread_join&#34;);
</span></span><span class="line"><span class="cl">            exit(EXIT_FAILURE);
</span></span><span class="line"><span class="cl">        }
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        thread_running = 0;
</span></span><span class="line"><span class="cl">        printf(&#34;Main: Thread has exited.\n&#34;);
</span></span><span class="line"><span class="cl">    } else {
</span></span><span class="line"><span class="cl">        printf(&#34;Main: No thread is running\n&#34;);
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">    pthread_mutex_unlock(&amp;mutex);
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">// ä¸»å‡½æ•°
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">/*----------------------------------------------------------------------------
</span></span><span class="line"><span class="cl"> * Main
</span></span><span class="line"><span class="cl"> *----------------------------------------------------------------------------*/
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">int main(void) {		
</span></span><span class="line"><span class="cl">	// Socketç›¸å…³å˜é‡
</span></span><span class="line"><span class="cl">    struct sockaddr_in     servaddr;
</span></span><span class="line"><span class="cl">	unsigned char    buff[MAXLINE];
</span></span><span class="line"><span class="cl">	int     n;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    //åˆå§‹åŒ–Socket
</span></span><span class="line"><span class="cl">	if( (socket_fd = socket(AF_INET, SOCK_STREAM, 0)) == -1 ) {
</span></span><span class="line"><span class="cl">		printf(&#34;create socket error: %s(errno: %d)\n&#34;,strerror(errno),errno);
</span></span><span class="line"><span class="cl">		exit(0);
</span></span><span class="line"><span class="cl">	}
</span></span><span class="line"><span class="cl">	// è§£å†³ Address already in use é—®é¢˜
</span></span><span class="line"><span class="cl">    int opt = 1;
</span></span><span class="line"><span class="cl">    setsockopt(socket_fd, SOL_SOCKET, SO_REUSEADDR, &amp;opt, sizeof(opt));
</span></span><span class="line"><span class="cl">	//åˆå§‹åŒ–
</span></span><span class="line"><span class="cl">	memset(&amp;servaddr, 0, sizeof(servaddr));
</span></span><span class="line"><span class="cl">	servaddr.sin_family = AF_INET;
</span></span><span class="line"><span class="cl">	servaddr.sin_addr.s_addr = htonl(INADDR_ANY);//IPåœ°å€è®¾ç½®æˆINADDR_ANY,è®©ç³»ç»Ÿè‡ªåŠ¨è·å–æœ¬æœºçš„IPåœ°å€ã€‚
</span></span><span class="line"><span class="cl">	servaddr.sin_port = htons(DEFAULT_PORT);//è®¾ç½®çš„ç«¯å£ä¸ºDEFAULT_PORT
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	//å°†æœ¬åœ°åœ°å€ç»‘å®šåˆ°æ‰€åˆ›å»ºçš„å¥—æ¥å­—ä¸Š
</span></span><span class="line"><span class="cl">	if( bind(socket_fd, (struct sockaddr*)&amp;servaddr, sizeof(servaddr)) == -1) {
</span></span><span class="line"><span class="cl">		printf(&#34;bind socket error: %s(errno: %d)\n&#34;,strerror(errno),errno);
</span></span><span class="line"><span class="cl">		exit(0);
</span></span><span class="line"><span class="cl">	}
</span></span><span class="line"><span class="cl">	//å¼€å§‹ç›‘å¬æ˜¯å¦æœ‰å®¢æˆ·ç«¯è¿æ¥
</span></span><span class="line"><span class="cl">	if( listen(socket_fd, 2) == -1) {
</span></span><span class="line"><span class="cl">		printf(&#34;listen socket error: %s(errno: %d)\n&#34;,strerror(errno),errno);
</span></span><span class="line"><span class="cl">		exit(0);
</span></span><span class="line"><span class="cl">	}
</span></span><span class="line"><span class="cl">	printf(&#34;======waiting for client&#39;s request======\n&#34;);
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	flag1 = 0;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	printf(&#34;start:\nFA 00 00 08 00 00 00 01\n&#34;);
</span></span><span class="line"><span class="cl">	printf(&#34;stop:\nFA 00 00 08 00 00 00 02\n&#34;);
</span></span><span class="line"><span class="cl">	while (1) {
</span></span><span class="line"><span class="cl">		if( (connect_fd = accept(socket_fd, (struct sockaddr*)NULL, NULL)) == -1) {
</span></span><span class="line"><span class="cl">			printf(&#34;accept socket error: %s(errno: %d)&#34;,strerror(errno),errno);
</span></span><span class="line"><span class="cl">			usleep(10);
</span></span><span class="line"><span class="cl">			continue;
</span></span><span class="line"><span class="cl">		}
</span></span><span class="line"><span class="cl">		printf(&#34;mark-1\n&#34;);
</span></span><span class="line"><span class="cl">		while (1) {
</span></span><span class="line"><span class="cl">			//æ¥å—å®¢æˆ·ç«¯ä¼ è¿‡æ¥çš„æ•°æ®
</span></span><span class="line"><span class="cl">			n = recv(connect_fd, buff, MAXLINE, 0);
</span></span><span class="line"><span class="cl">			usleep(100);
</span></span><span class="line"><span class="cl">			printf(&#34;mark-2\n&#34;);
</span></span><span class="line"><span class="cl">			if(n &gt; 0) {
</span></span><span class="line"><span class="cl">				// åˆ¤æ–­æ˜¯å¼€å§‹è¿˜æ˜¯åœæ­¢
</span></span><span class="line"><span class="cl">				if (buff[0] == 0xFA &amp;&amp; buff[7] == 0x01) {
</span></span><span class="line"><span class="cl">					// å¼€å§‹
</span></span><span class="line"><span class="cl">					printf(&#34;start\n&#34;);
</span></span><span class="line"><span class="cl">					//sleep(1200); //æµ‹è¯•é•¿æ—¶é—´ä¸æ‰§è¡Œæ“ä½œï¼Œç½‘å£æ˜¯å¦ä»æ­£å¸¸å·¥ä½œ
</span></span><span class="line"><span class="cl">					flag1 = 1;
</span></span><span class="line"><span class="cl">					// å¤ä½					
</span></span><span class="line"><span class="cl">					create_thread();
</span></span><span class="line"><span class="cl">					system(&#34;date&#34;);
</span></span><span class="line"><span class="cl">				}
</span></span><span class="line"><span class="cl">				else if (buff[0] == 0xFA &amp;&amp; buff[7] == 0x02) {
</span></span><span class="line"><span class="cl">					flag1 = 2;
</span></span><span class="line"><span class="cl">					// åœæ­¢					
</span></span><span class="line"><span class="cl">					destroy_thread();
</span></span><span class="line"><span class="cl">					system(&#34;date&#34;);
</span></span><span class="line"><span class="cl">				} 
</span></span><span class="line"><span class="cl">			} else if (n &lt; 0) {
</span></span><span class="line"><span class="cl">				usleep(100);
</span></span><span class="line"><span class="cl">				continue;
</span></span><span class="line"><span class="cl">			} else {
</span></span><span class="line"><span class="cl">				close(connect_fd);
</span></span><span class="line"><span class="cl">				printf(&#34;mark-3\n&#34;);
</span></span><span class="line"><span class="cl">				usleep(100);
</span></span><span class="line"><span class="cl">				break;
</span></span><span class="line"><span class="cl">			}
</span></span><span class="line"><span class="cl">		}
</span></span><span class="line"><span class="cl">		usleep(10);
</span></span><span class="line"><span class="cl">	}
</span></span><span class="line"><span class="cl">    close(connect_fd);
</span></span><span class="line"><span class="cl">    close(socket_fd);
</span></span><span class="line"><span class="cl">    return 0;
</span></span><span class="line"><span class="cl">}</span></span></code></pre></td></tr></table>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-headline-3" class="outline-3">
<h3 id="headline-3">
client.c
</h3>
<div id="outline-text-headline-3" class="outline-text-3">
<div class="src src-text">
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">#include &lt;stdio.h&gt;
</span></span><span class="line"><span class="cl">#include &lt;stdlib.h&gt;
</span></span><span class="line"><span class="cl">#include &lt;string.h&gt;
</span></span><span class="line"><span class="cl">#include &lt;errno.h&gt;
</span></span><span class="line"><span class="cl">#include &lt;sys/types.h&gt;
</span></span><span class="line"><span class="cl">#include &lt;sys/socket.h&gt;
</span></span><span class="line"><span class="cl">#include &lt;netinet/in.h&gt;
</span></span><span class="line"><span class="cl">#include &lt;arpa/inet.h&gt;
</span></span><span class="line"><span class="cl">#include &lt;unistd.h&gt;
</span></span><span class="line"><span class="cl">#include &lt;pthread.h&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">#define DEFAULT_PORT 4000
</span></span><span class="line"><span class="cl">#define MAXLINE 4096
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">// å…¨å±€å˜é‡
</span></span><span class="line"><span class="cl">pthread_t worker_thread = 0;          // å·¥ä½œçº¿ç¨‹ ID
</span></span><span class="line"><span class="cl">volatile int thread_running = 0;      // çº¿ç¨‹è¿è¡ŒçŠ¶æ€
</span></span><span class="line"><span class="cl">volatile int thread_should_exit = 0;  // çº¿ç¨‹é€€å‡ºæ ‡å¿—
</span></span><span class="line"><span class="cl">pthread_mutex_t mutex = PTHREAD_MUTEX_INITIALIZER;  // äº’æ–¥é”
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">// çº¿ç¨‹æ¸…ç†å‡½æ•°
</span></span><span class="line"><span class="cl">void cleanup_handler(void *arg) {
</span></span><span class="line"><span class="cl">    printf(&#34;Thread: Cleaning up resources...\n&#34;);
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">// å·¥ä½œçº¿ç¨‹å‡½æ•°
</span></span><span class="line"><span class="cl">void *receive_file(void *arg) {
</span></span><span class="line"><span class="cl">    printf(&#34;Thread: Entered thread\n&#34;);
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    // æ³¨å†Œæ¸…ç†å‡½æ•°
</span></span><span class="line"><span class="cl">    pthread_cleanup_push(cleanup_handler, NULL);
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    while (!thread_should_exit) {
</span></span><span class="line"><span class="cl">        // æ¨¡æ‹Ÿå·¥ä½œ
</span></span><span class="line"><span class="cl">        printf(&#34;Thread: Working...\n&#34;);
</span></span><span class="line"><span class="cl">        sleep(1);
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    // æ¸…ç†
</span></span><span class="line"><span class="cl">    pthread_cleanup_pop(1);
</span></span><span class="line"><span class="cl">    printf(&#34;Thread: Exiting...\n&#34;);
</span></span><span class="line"><span class="cl">    return NULL;
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">// åˆ›å»ºçº¿ç¨‹
</span></span><span class="line"><span class="cl">void create_thread() {
</span></span><span class="line"><span class="cl">    pthread_mutex_lock(&amp;mutex);
</span></span><span class="line"><span class="cl">    if (!thread_running) {
</span></span><span class="line"><span class="cl">        thread_should_exit = 0;  // é‡ç½®é€€å‡ºæ ‡å¿—
</span></span><span class="line"><span class="cl">        int ret = pthread_create(&amp;worker_thread, NULL, receive_file, NULL);
</span></span><span class="line"><span class="cl">        if (ret != 0) {
</span></span><span class="line"><span class="cl">            perror(&#34;pthread_create&#34;);
</span></span><span class="line"><span class="cl">            exit(EXIT_FAILURE);
</span></span><span class="line"><span class="cl">        }
</span></span><span class="line"><span class="cl">        thread_running = 1;
</span></span><span class="line"><span class="cl">        printf(&#34;Main: Created thread\n&#34;);
</span></span><span class="line"><span class="cl">    } else {
</span></span><span class="line"><span class="cl">        printf(&#34;Main: Thread is already running\n&#34;);
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">    pthread_mutex_unlock(&amp;mutex);
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">// é”€æ¯çº¿ç¨‹
</span></span><span class="line"><span class="cl">void destroy_thread() {
</span></span><span class="line"><span class="cl">    pthread_mutex_lock(&amp;mutex);
</span></span><span class="line"><span class="cl">    if (thread_running) {
</span></span><span class="line"><span class="cl">        printf(&#34;Main: Stopping thread...\n&#34;);
</span></span><span class="line"><span class="cl">        thread_should_exit = 1;  // è®¾ç½®é€€å‡ºæ ‡å¿—
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        // ç­‰å¾…çº¿ç¨‹é€€å‡ºå¹¶å›æ”¶èµ„æº
</span></span><span class="line"><span class="cl">        int ret = pthread_join(worker_thread, NULL);
</span></span><span class="line"><span class="cl">        if (ret != 0) {
</span></span><span class="line"><span class="cl">            perror(&#34;pthread_join&#34;);
</span></span><span class="line"><span class="cl">            exit(EXIT_FAILURE);
</span></span><span class="line"><span class="cl">        }
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        thread_running = 0;
</span></span><span class="line"><span class="cl">        printf(&#34;Main: Thread has exited.\n&#34;);
</span></span><span class="line"><span class="cl">    } else {
</span></span><span class="line"><span class="cl">        printf(&#34;Main: No thread is running\n&#34;);
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">    pthread_mutex_unlock(&amp;mutex);
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">// è§£æ 16 è¿›åˆ¶è¾“å…¥
</span></span><span class="line"><span class="cl">int parse_hex_input(const char *input, unsigned char *output, size_t output_size) {
</span></span><span class="line"><span class="cl">    char *endptr;
</span></span><span class="line"><span class="cl">    for (size_t i = 0; i &lt; output_size; i++) {
</span></span><span class="line"><span class="cl">        output[i] = (unsigned char)strtol(input + 2 * i, &amp;endptr, 16);
</span></span><span class="line"><span class="cl">        if (endptr != input + 2 * (i + 1)) {
</span></span><span class="line"><span class="cl">            return -1;  // éæ³•è¾“å…¥
</span></span><span class="line"><span class="cl">        }
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">    return 0;
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">int main(int argc, char *argv[]) {
</span></span><span class="line"><span class="cl">	int i = 0;
</span></span><span class="line"><span class="cl">	int input = 0;
</span></span><span class="line"><span class="cl">    int sockfd;
</span></span><span class="line"><span class="cl">    struct sockaddr_in servaddr;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    // æ£€æŸ¥å‘½ä»¤è¡Œå‚æ•°
</span></span><span class="line"><span class="cl">    if (argc != 2) {
</span></span><span class="line"><span class="cl">        printf(&#34;Usage: %s &lt;ipaddress&gt;\n&#34;, argv[0]);
</span></span><span class="line"><span class="cl">        exit(EXIT_FAILURE);
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    // åˆ›å»º Socket
</span></span><span class="line"><span class="cl">    if ((sockfd = socket(AF_INET, SOCK_STREAM, 0)) &lt; 0) {
</span></span><span class="line"><span class="cl">        printf(&#34;Create socket error: %s (errno: %d)\n&#34;, strerror(errno), errno);
</span></span><span class="line"><span class="cl">        exit(EXIT_FAILURE);
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    // è®¾ç½®æœåŠ¡å™¨åœ°å€
</span></span><span class="line"><span class="cl">    memset(&amp;servaddr, 0, sizeof(servaddr));
</span></span><span class="line"><span class="cl">    servaddr.sin_family = AF_INET;
</span></span><span class="line"><span class="cl">    servaddr.sin_port = htons(DEFAULT_PORT);
</span></span><span class="line"><span class="cl">    if (inet_pton(AF_INET, argv[1], &amp;servaddr.sin_addr) &lt;= 0) {
</span></span><span class="line"><span class="cl">        printf(&#34;inet_pton error for %s\n&#34;, argv[1]);
</span></span><span class="line"><span class="cl">        close(sockfd);
</span></span><span class="line"><span class="cl">        exit(EXIT_FAILURE);
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    // è¿æ¥åˆ°æœåŠ¡å™¨
</span></span><span class="line"><span class="cl">    if (connect(sockfd, (struct sockaddr *)&amp;servaddr, sizeof(servaddr)) &lt; 0) {
</span></span><span class="line"><span class="cl">        printf(&#34;Connect error: %s (errno: %d)\n&#34;, strerror(errno), errno);
</span></span><span class="line"><span class="cl">        close(sockfd);
</span></span><span class="line"><span class="cl">        exit(EXIT_FAILURE);
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    printf(&#34;Connected to server at %s:%d\n&#34;, argv[1], DEFAULT_PORT);
</span></span><span class="line"><span class="cl">	printf(&#34;start:\nFA 00 00 08 00 00 00 01\n&#34;);
</span></span><span class="line"><span class="cl">	printf(&#34;stop:\nFA 00 00 08 00 00 00 02\n&#34;);
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    // ä¸»å¾ªç¯
</span></span><span class="line"><span class="cl">    while (1) {
</span></span><span class="line"><span class="cl">        unsigned char input_buf[8] = {0};
</span></span><span class="line"><span class="cl">        char input_str[17];  // 8 ä¸ª 16 è¿›åˆ¶æ•°ï¼Œæ¯ä¸ªå  2 å­—ç¬¦ï¼ŒåŠ ä¸Šç»“æŸç¬¦
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        for (i = 0; i &lt; 8; i++) {
</span></span><span class="line"><span class="cl">			scanf(&#34;%x&#34;, &amp;input);
</span></span><span class="line"><span class="cl">			input_buf[i] = input;
</span></span><span class="line"><span class="cl">		}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        // æ‰“å°è¾“å…¥
</span></span><span class="line"><span class="cl">        printf(&#34;Input: &#34;);
</span></span><span class="line"><span class="cl">        for (int i = 0; i &lt; 8; i++) {
</span></span><span class="line"><span class="cl">            printf(&#34;%02X &#34;, input_buf[i]);
</span></span><span class="line"><span class="cl">        }
</span></span><span class="line"><span class="cl">        printf(&#34;\n&#34;);
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        // æ ¹æ®è¾“å…¥å¯åŠ¨æˆ–åœæ­¢çº¿ç¨‹
</span></span><span class="line"><span class="cl">        if (input_buf[0] == 0xFA &amp;&amp; input_buf[7] == 0x01) {
</span></span><span class="line"><span class="cl">            create_thread();
</span></span><span class="line"><span class="cl">			send(sockfd, &amp;input_buf[0], sizeof(input_buf), 0);
</span></span><span class="line"><span class="cl">        } else if (input_buf[0] == 0xFA &amp;&amp; input_buf[7] == 0x02) {
</span></span><span class="line"><span class="cl">            destroy_thread();
</span></span><span class="line"><span class="cl">			send(sockfd, &amp;input_buf[0], sizeof(input_buf), 0);
</span></span><span class="line"><span class="cl">        }
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    // æ¸…ç†èµ„æº
</span></span><span class="line"><span class="cl">    destroy_thread();  // ç¡®ä¿çº¿ç¨‹é€€å‡º
</span></span><span class="line"><span class="cl">    pthread_mutex_destroy(&amp;mutex);
</span></span><span class="line"><span class="cl">    close(sockfd);
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    return 0;
</span></span><span class="line"><span class="cl">}</span></span></code></pre></td></tr></table>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-headline-4" class="outline-3">
<h3 id="headline-4">
è¿è¡Œæ–¹å¼
</h3>
<div id="outline-text-headline-4" class="outline-text-3">
<div id="outline-container-headline-5" class="outline-4">
<h4 id="headline-5">
serverç«¯
</h4>
<div id="outline-text-headline-5" class="outline-text-4">
<div class="src src-text">
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">./server</span></span></code></pre></td></tr></table>
</div>
</div>
</div>
<p>
æ˜¾ç¤ºç»“æœå¹¶ç­‰å¾…å®¢æˆ·ç«¯è¿æ¥</p>
<div class="src src-text">
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">======waiting for client&#39;s request======
</span></span><span class="line"><span class="cl">start:
</span></span><span class="line"><span class="cl">FA 00 00 08 00 00 00 01
</span></span><span class="line"><span class="cl">stop:
</span></span><span class="line"><span class="cl">FA 00 00 08 00 00 00 02</span></span></code></pre></td></tr></table>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-headline-6" class="outline-4">
<h4 id="headline-6">
clientç«¯
</h4>
<div id="outline-text-headline-6" class="outline-text-4">
<p>
è¿è¡Œå®¢æˆ·ç«¯åä¸‹å‘æŒ‡ä»¤</p>
<p>
start: FA 00 00 08 00 00 00 01
stop:  FA 00 00 08 00 00 00 02</p>
<div class="src src-text">
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">$ ./client 127.0.0.1
</span></span><span class="line"><span class="cl">Connected to server at 127.0.0.1:4000
</span></span><span class="line"><span class="cl">start:
</span></span><span class="line"><span class="cl">FA 00 00 08 00 00 00 01
</span></span><span class="line"><span class="cl">stop:
</span></span><span class="line"><span class="cl">FA 00 00 08 00 00 00 02
</span></span><span class="line"><span class="cl">FA 00 00 08 00 00 00 01
</span></span><span class="line"><span class="cl">Input: FA 00 00 08 00 00 00 01
</span></span><span class="line"><span class="cl">Main: Created thread
</span></span><span class="line"><span class="cl">Thread: Entered thread
</span></span><span class="line"><span class="cl">Thread: Working...
</span></span><span class="line"><span class="cl">Thread: Working...
</span></span><span class="line"><span class="cl">Thread: Working...
</span></span><span class="line"><span class="cl">Thread: Working...
</span></span><span class="line"><span class="cl">FA 00 00 08 00 00 00 02Thread: Working...
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Input: FA 00 00 08 00 00 00 02
</span></span><span class="line"><span class="cl">Main: Stopping thread...
</span></span><span class="line"><span class="cl">Thread: Cleaning up resources...
</span></span><span class="line"><span class="cl">Thread: Exiting...
</span></span><span class="line"><span class="cl">Main: Thread has exited.
</span></span><span class="line"><span class="cl">FA 00 00 08 00 00 00 01
</span></span><span class="line"><span class="cl">Input: FA 00 00 08 00 00 00 01
</span></span><span class="line"><span class="cl">Main: Created thread
</span></span><span class="line"><span class="cl">Thread: Entered thread
</span></span><span class="line"><span class="cl">Thread: Working...
</span></span><span class="line"><span class="cl">Thread: Working...
</span></span><span class="line"><span class="cl">Thread: Working...
</span></span><span class="line"><span class="cl">Thread: Working...
</span></span><span class="line"><span class="cl">FA 00 00 08 00 00 00 02Thread: Working...
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Input: FA 00 00 08 00 00 00 02
</span></span><span class="line"><span class="cl">Main: Stopping thread...
</span></span><span class="line"><span class="cl">Thread: Cleaning up resources...
</span></span><span class="line"><span class="cl">Thread: Exiting...
</span></span><span class="line"><span class="cl">Main: Thread has exited.</span></span></code></pre></td></tr></table>
</div>
</div>
</div>
<p>
æ­¤æ—¶æœåŠ¡ç«¯æ”¶åˆ°å®¢æˆ·ç«¯ä¸‹å‘çš„æŒ‡ä»¤</p>
<div class="src src-text">
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">$ ./server
</span></span><span class="line"><span class="cl">======waiting for client&#39;s request======
</span></span><span class="line"><span class="cl">start:
</span></span><span class="line"><span class="cl">FA 00 00 08 00 00 00 01
</span></span><span class="line"><span class="cl">stop:
</span></span><span class="line"><span class="cl">FA 00 00 08 00 00 00 02
</span></span><span class="line"><span class="cl">mark-1
</span></span><span class="line"><span class="cl">mark-2
</span></span><span class="line"><span class="cl">start
</span></span><span class="line"><span class="cl">Main: Created thread
</span></span><span class="line"><span class="cl">enter therad
</span></span><span class="line"><span class="cl">2025å¹´03æœˆ20æ—¥ 17:44:57
</span></span><span class="line"><span class="cl">mark-2
</span></span><span class="line"><span class="cl">Main: Stopping thread...
</span></span><span class="line"><span class="cl">Main: Thread has exited.
</span></span><span class="line"><span class="cl">2025å¹´03æœˆ20æ—¥ 17:45:02
</span></span><span class="line"><span class="cl">mark-2
</span></span><span class="line"><span class="cl">start
</span></span><span class="line"><span class="cl">Main: Created thread
</span></span><span class="line"><span class="cl">enter therad
</span></span><span class="line"><span class="cl">2025å¹´03æœˆ20æ—¥ 17:45:10
</span></span><span class="line"><span class="cl">mark-2
</span></span><span class="line"><span class="cl">Main: Stopping thread...
</span></span><span class="line"><span class="cl">Main: Thread has exited.
</span></span><span class="line"><span class="cl">2025å¹´03æœˆ20æ—¥ 17:45:16</span></span></code></pre></td></tr></table>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-headline-7" class="outline-3">
<h3 id="headline-7">
å‚è€ƒé“¾æ¥
</h3>
<div id="outline-text-headline-7" class="outline-text-3">
<p>
<a href="https://ynhugo.github.io/p/socketåŸºäºtcpé€šä¿¡å®ä¾‹/">socketåŸºäºtcpé€šä¿¡å®ä¾‹</a></p>
<p>
<a href="https://ynhugo.github.io/p/socketåŸºäºtcpæœåŠ¡ç«¯å®ä¾‹/">socketåŸºäºtcpæœåŠ¡ç«¯å®ä¾‹</a></p>
<p>
<a href="https://ynhugo.github.io/p/socketåŸºäºtcpå®¢æˆ·ç«¯å®ä¾‹/">socketåŸºäºtcpå®¢æˆ·ç«¯å®ä¾‹</a></p>
</div>
</div>
</div>
</div>

</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/socket/">Socket</a>
        
            <a href="/tags/tcp/">Tcp</a>
        
            <a href="/tags/%E7%A8%8B%E5%BA%8F%E5%91%98/">ç¨‹åºå‘˜</a>
        
    </section>


    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY-NC-SA 4.0</span>
    </section>
    </footer>


    
</article>

    

    

<aside class="related-content--wrapper">
    <h2 class="section-title">ç›¸å…³æ–‡ç« </h2>
    <div class="related-content">
        <div class="flex article-list--tile">
            
                
<article class="">
    <a href="/p/socket%E5%9F%BA%E4%BA%8Etcp%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%AE%9E%E4%BE%8B/">
        
        

        <div class="article-details">
            <h2 class="article-title">socketåŸºäºtcpå®¢æˆ·ç«¯å®ä¾‹</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/socket%E5%9F%BA%E4%BA%8Etcp%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%AE%9E%E4%BE%8B/">
        
        

        <div class="article-details">
            <h2 class="article-title">socketåŸºäºtcpæœåŠ¡ç«¯å®ä¾‹</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/socket-%E6%9C%8D%E5%8A%A1%E7%AB%AF%E4%B8%8E%E7%BA%BF%E7%A8%8B%E7%AE%A1%E7%90%86%E7%9A%84%E7%BB%93%E5%90%88-deepseek/">
        
        

        <div class="article-details">
            <h2 class="article-title">Socket æœåŠ¡ç«¯ä¸çº¿ç¨‹ç®¡ç†çš„ç»“åˆ-Deepseek</h2>
        </div>
    </a>
</article>

            
        </div>
    </div>
</aside>

     
    
        
    <div class="disqus-container">
    <div id="disqus_thread"></div>
<script>
    window.disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "hugo-theme-stack" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>

<style>
    .disqus-container {
        background-color: var(--card-background);
        border-radius: var(--card-border-radius);
        box-shadow: var(--shadow-l1);
        padding: var(--card-padding);
    }
</style>

<script>
    window.addEventListener('onColorSchemeChange', (e) => {
        if (typeof DISQUS == 'object') {
            DISQUS.reset({
                reload: true
            });
        }
    })
</script>

    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2020 - 
        
        2026 Example Person
    </section>
    
    <section class="powerby">
        ä½¿ç”¨ <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> æ„å»º <br />
        ä¸»é¢˜ <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.30.0">Stack</a></b> ç”± <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a> è®¾è®¡
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
