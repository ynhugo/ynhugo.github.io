<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content=" 使用qemu搭建arm嵌入式linux开发环境 使用说明 该脚本只有在第一次运行的时候需要构建环境，花费时间长一些，构建完成以后自动启动环境，以后再运行该脚本的时候就不需要再次构建环境了，加载后进入开发环境，敲回车确认。\n退出时先按快捷键&#34;Ctrl+x&#34;，再按&#34;x&#34;即可退出环境。\n搭建脚本 调试启动脚本 推荐使用这个脚本，从头到尾自动化完成\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 239 240 241 242 243 244 245 246 247 248 249 250 251 252 253 254 255 256 257 258 259 260 261 262 263 264 265 266 267 268 269 270 271 272 273 274 275 276 277 278 279 280 281 282 283 284 285 286 287 288 289 290 291 292 293 294 295 296 297 298 299 300 301 302 303 304 305 306 307 308 309 310 311 312 313 314 315 316 317 318 319 320 321 322 323 324 325 326 327 328 329 330 331 332 333 334 335 336 337 338 339 340 341 342 343 344 345 346 347 348 349 350 351 352 353 354 355 356 357 358 359 360 361 362 363 364 365 366 367 368 369 370 371 372 373 374 375 376 377 378 379 380 381 382 383 384 385 386 387 388 389 390 391 392 393 394 395 396 397 398 399 400 401 402 403 404 405 406 407 408 409 410 411 412 413 cmdself=$0 linux=&#34;linux-4.4.232&#34;; # linux=&#34;linux-4.4.76&#34;; busybox=&#34;busybox-1.32.0&#34;; uboot=&#34;u-boot-2017.05&#34; # uboot=&#34;u-boot-2020.07&#34; file_linux=&#34;${linux}.tar.xz&#34;; file_busybox=&#34;${busybox}.tar.bz2&#34;; file_uboot=&#34;${uboot}.tar.bz2&#34; work_dir_name=&#34;yenao_qemu_test&#34;; work_dir=&#34;${HOME}/${work_dir_name}&#34;; Operate_Net_File=&#34;/etc/network/interfaces&#34; uboot_config_file=&#34;${work_dir}/${uboot}/include/configs/vexpress_common.h&#34; mkdir -p ${work_dir}; cd ${work_dir}; cpu_cores=$(nproc) jobs=$((cpu_cores * 2)) package_array=(gcc-arm-linux-gnueabi python-dev qemu qemu-kvm libvirt-bin bridge-utils virt-manager uml-utilities bridge-utils u-boot-tools ed tftp-hpa tftpd-hpa xinetd nfs-kernel-server device-tree-compiler) # gcc-arm-linux-gnueabi 交叉编译工具链与 gcc-multilib 不能共存，因此如果电脑之前有安装并且需要 gcc-multilib 的话，可以再运行完脚本后重新安装 gcc-multilib package_array_size=${#package_array[@]} for ((i = 0; i &lt; package_array_size; i++)) do # 软件安装 if [ ! &#34;$(apt list --installed | grep -wo &#34;${package_array[${i}]}&#34; | head -n 1)&#34; = &#34;${package_array[${i}]}&#34; ]; then echo -e &#34;\\e[34m&#34; sudo apt-get install ${package_array[${i}]} -y echo -e &#34;\\e[0m&#34; if [ ! &#34;$(apt list --installed | grep -wo &#34;${package_array[${i}]}&#34; | head -n 1)&#34; = &#34;${package_array[${i}]}&#34; ]; then echo -e &#34;\\e[31m${package_array[${i}]} 未安装\\e[0m&#34; else echo -e &#34;\\e[32m${package_array[${i}]} 已安装\\e[0m&#34; fi\telse echo -e &#34;\\e[32m${package_array[${i}]} 已安装\\e[0m&#34; fi done\t# 配置/etc/default/tftpd-hpa sudo chmod 777 /etc/default/tftpd-hpa; cat /etc/default/tftpd-hpa &gt; /etc/default/tftpd-hpa sudo chown ${USER}:${USER} -R /etc/default/tftpd-hpa echo &#39;TFTP_USERNAME=&#34;tftp&#34;&#39; &gt;&gt; /etc/default/tftpd-hpa echo &#34;TFTP_DIRECTORY=\\&#34;/tftpboot\\&#34;&#34; &gt;&gt; /etc/default/tftpd-hpa # echo &#34;TFTP_DIRECTORY=\\&#34;/tftpboot /tftpboot/${work_dir_name}\\&#34;&#34; &gt;&gt; /etc/default/tftpd-hpa echo &#39;TFTP_ADDRESS=&#34;0.0.0.0:69&#34;&#39; &gt;&gt; /etc/default/tftpd-hpa echo &#39;TFTP_OPTIONS=&#34;-l -c -s&#34;&#39; &gt;&gt; /etc/default/tftpd-hpa # 如果要设置多个目录就不能添加&#34;-s&#34;选项 # echo &#39;TFTP_OPTIONS=&#34;-l -c&#34;&#39; &gt;&gt; /etc/default/tftpd-hpa sudo chown root:root -R /etc/default/tftpd-hpa # 判断/tftpboot是否存在 if [ -d &#34;/tftpboot/&#34; ]; then echo &#34;tftpboot exists.&#34;; tftpboot_access=$(stat /tftpboot/ | grep -w &#34;Uid&#34; | tr &#39;(&#39; &#39; &#39; | tr &#39;/&#39; &#39; &#39; | awk &#39;{print $2}&#39;) if [ &#34;$tftpboot_access&#34; != &#34;0777&#34; ]; then sudo chmod 777 /tftpboot; echo &#34;/tftpboot的权限已设置为0777&#34; fi else sudo mkdir /tftpboot; sudo chmod 777 /tftpboot; echo &#34;/tftpboot的权限已设置为0777&#34; fi # 判断/tftpboot/${work_dir_name}是否存在，想要配置多个文件夹的话可以取消注释 # if [ -d &#34;/tftpboot/${work_dir_name}&#34; ]; then # echo &#34;tftpboot/${work_dir_name} exists.&#34;; # work_dir_name_access=$(stat /tftpboot/ | grep -w &#34;Uid&#34; | tr &#39;(&#39; &#39; &#39; | tr &#39;/&#39; &#39; &#39; | awk &#39;{print $2}&#39;) # if [ &#34;$work_dir_name_access&#34; != &#34;0777&#34; ]; then # sudo chmod 777 /tftpboot/${work_dir_name}; # echo &#34;/tftpboot/${work_dir_name}的权限已设置为0777&#34; # fi # else # sudo mkdir /tftpboot/${work_dir_name}; # sudo chmod 777 /tftpboot/${work_dir_name}; # echo &#34;/tftpboot/${work_dir_name}的权限已设置为0777&#34; # fi # 允许开发板通过NFS访问Ubuntu的/home/${USER}目录，当然你可以加其他目录 result=$(grep -w &#34;${work_dir} \\*(rw,nohide,insecure,no_subtree_check,async,no_root_squash)&#34; /etc/exports | grep -v &#34;#&#34;) if [ $? -eq 0 ]; then # 查找并注释匹配行 # sudo sed -i &#34;s/${work_dir} \\*(rw,nohide,insecure,no_subtree_check,async,no_root_squash)/#\\/home\\/${USER} \\*(rw,nohide,insecure,no_subtree_check,async,no_root_squash)/g&#34; /etc/exports # echo &#34;已注释匹配行：$result&#34; sudo /etc/init.d/nfs-kernel-server restart echo &#34;匹配行已存在，并且重启了nfs服务&#34; else power=$(ls -l /etc/exports | awk &#39;{print $4}&#39;) if [ &#34;$power&#34; == &#34;root&#34; ]; then sudo chown ${USER}:${USER} -R /etc/exports echo &#34;${work_dir} *(rw,nohide,insecure,no_subtree_check,async,no_root_squash)&#34; &gt;&gt; /etc/exports sudo chown root:root -R /etc/exports else echo &#34;${work_dir} *(rw,nohide,insecure,no_subtree_check,async,no_root_squash)&#34; &gt;&gt; /etc/exports sudo chown root:root -R /etc/exports fi sudo /etc/init.d/nfs-kernel-server restart echo &#34;匹配行已添加，并且重启了nfs服务&#34; fi # 判断linux内核是否准备好 while true; do result=$(curl ipinfo.io | grep &#34;country&#34; | tr &#39;&#34;&#39; &#39; &#39; | awk &#39;{print $3}&#39;) if [ -z &#34;${result}&#34; ]; then continue else echo -e &#34;\\e[32mcountry: ${result}\\e[0m&#34; break fi done while true; do if [ ! -f &#34;${work_dir}/$file_linux&#34; ]; then\techo -e &#34;\\e[32m&#34; if [ ${result} != &#34;CN&#34; ]; then\t# wget https://cdn.kernel.org/pub/linux/kernel/v4.x/linux-4.4.232.tar.xz wget https://cdn.kernel.org/pub/linux/kernel/v4.x/${file_linux} else # wget https://mirrors.ustc.edu.cn/kernel.org/linux/kernel/v4.x/linux-4.4.232.tar.xz wget https://mirrors.ustc.edu.cn/kernel.org/linux/kernel/v4.x/${file_linux} fi else if [ &#34;$(sha256sum ${file_linux})&#34; != &#34;4eae8865deaf03f0d13bf5056e258d451a468cabc5158757b247b0e43518fd34 ${file_linux}&#34; ]; then rm -rf ${file_linux} continue else echo -e &#34;\\e[32m${file_linux} 已下载\\e[0m&#34; break; fi fi echo -e &#34;\\e[0m&#34; done # 判断busybox文件是否准备好 while true; do if [ ! -f &#34;${work_dir}/$file_busybox&#34; ]; then echo -e &#34;\\e[33m&#34; # wget --no-check-certificate https://busybox.net/downloads/busybox-1.32.0.tar.bz2 wget --no-check-certificate https://busybox.net/downloads/${file_busybox} echo -e &#34;\\e[0m&#34; else if [ &#34;$(sha256sum ${file_busybox})&#34; != &#34;c35d87f1d04b2b153d33c275c2632e40d388a88f19a9e71727e0bbbff51fe689 ${file_busybox}&#34; ]; then rm -rf ${file_busybo} continue else echo -e &#34;\\e[32m$file_busybox 已下载\\e[0m&#34; break; fi fi\tdone # 判断u-boot文件是否准备好 while true; do if [ ! -f &#34;${work_dir}/$file_uboot&#34; ]; then echo -e &#34;\\e[34m&#34; # wget --no-check-certificate https://ftp.denx.de/pub/u-boot/u-boot-2017.05.tar.bz2 # wget --no-check-certificate https://ftp.denx.de/pub/u-boot/u-boot-2020.07.tar.bz2 wget --no-check-certificate https://ftp.denx.de/pub/u-boot/${file_uboot} echo -e &#34;\\e[0m&#34; else if [ &#34;$(sha256sum ${file_uboot})&#34; != &#34;c8373949d7f0de1059e507b83a655d4cea539f75dc66ccdbb27adbd38d83095e u-boot-2017.05.tar.bz2&#34; ]; then rm -rf ${file_uboot} continue else echo -e &#34;\\e[32m$file_uboot 已下载\\e[0m&#34; break fi fi done # 临时配置交叉编译环境 export ARCH=arm &amp;&amp; export CROSS_COMPILE=arm-linux-gnueabi-; # 判断linux内核是否解压 echo -e &#34;\\e[32m&#34; # kernel if [ -d &#34;${work_dir}/$linux&#34; ]; then echo &#34;$linux exists.&#34; else tar xvf ${work_dir}/$file_linux -C ${work_dir}; fi echo -e &#34;\\e[0m&#34; # 判断busybox文件是否解压 echo -e &#34;\\e[33m&#34; if [ -d &#34;${work_dir}/$busybox&#34; ]; then echo &#34;$busybox exists.&#34; else tar xvf ${work_dir}/$file_busybox -C ${work_dir}; fi echo -e &#34;\\e[0m&#34; # 判断u-boot文件是否解压 echo -e &#34;\\e[34m&#34; if [ -d &#34;${work_dir}/${uboot}&#34; ]; then echo &#34;$uboot exists.&#34; else tar xvf ${work_dir}/$file_uboot -C ${work_dir}; if [ -f &#34;${work_dir}/${uboot}/include/configs/vexpress_common.h&#34; ]; then cp ${uboot_config_file} ${uboot_config_file}.old fi fi echo -e &#34;\\e[0m&#34; # 编译linux内核 echo -e &#34;\\e[32m&#34; cd ${work_dir}/${linux}; make distclean -j${jobs}; make vexpress_defconfig -j${jobs}; make zImage -j${jobs}; make modules -j${jobs}; make LOADADDR=0x60003000 uImage -j${jobs}; make dtbs -j${jobs}; # mkimage -n &#39;mini2440&#39; -A arm -O linux -T kernel -C none -a 0x30008000 -e 0x30008040 -d ${work_dir}/$linux/arch/arm/boot/zImage ${work_dir}/$linux/arch/arm/boot/uImage echo -e &#34;\\e[0m&#34; # 编译busybox，编译之后把&#34;${busybox}/_install/*&#34;拷贝到rootfs目录下 echo -e &#34;\\e[33m&#34; cd ${work_dir}/${busybox}; make distclean -j${jobs}; make defconfig -j${jobs}; make -j${jobs}; make install -j${jobs}; echo -e &#34;\\e[0m&#34; # 搭建网络开发环境 echo -e &#34;\\e[95m&#34; if [ ! -f &#34;$Operate_Net_File&#34; ]; then sudo touch ${Operate_Net_File} else echo &#34;${uboot_config_file} is exists.&#34; if [ ! -f &#34;$Operate_Net_File.old&#34; ]; then sudo cp ${Operate_Net_File} {$Operate_Net_File}.old else echo &#34;${Operate_Net_File}.old is exists.&#34; fi fi sudo chown ${USER}:${USER} ${Operate_Net_File} if [ ! &#34;$(cat /etc/network/interfaces | grep -o &#34;br0&#34; | head -n 1)&#34; = &#34;br0&#34; ]; then echo &#34;debug_1&#34; cat ${Operate_Net_File} &gt; ${Operate_Net_File} if [ &#34;$(ip addr | grep -o &#34;ens33&#34; | head -n 1)&#34; = &#34;ens33&#34; ]; then echo &#34;auto lo&#34; &gt;&gt; ${Operate_Net_File} echo &#34;iface lo inet loopback&#34; &gt;&gt; ${Operate_Net_File} echo &#34;&#34; &gt;&gt; ${Operate_Net_File} echo &#34;auto ens33&#34; &gt;&gt; ${Operate_Net_File} echo &#34;&#34; &gt;&gt; ${Operate_Net_File} echo &#34;auto br0&#34; &gt;&gt; ${Operate_Net_File} echo &#34;iface br0 inet dhcp&#34; &gt;&gt; ${Operate_Net_File} echo &#34;\tbridge_ports ens33&#34; &gt;&gt; ${Operate_Net_File} sudo chown ${root}:${root} ${Operate_Net_File} sudo /etc/init.d/networking restart else if [ &#34;$(ip addr | grep -o &#34;eth0&#34;)&#34; = &#34;eth0&#34; ]; then echo &#34;auto lo&#34; &gt;&gt; ${Operate_Net_File} echo &#34;iface lo inet loopback&#34; &gt;&gt; ${Operate_Net_File} echo &#34;&#34; &gt;&gt; ${Operate_Net_File} echo &#34;auto eth0&#34; &gt;&gt; ${Operate_Net_File} echo &#34;&#34; &gt;&gt; ${Operate_Net_File} echo &#34;auto br0&#34; &gt;&gt; ${Operate_Net_File} echo &#34;iface br0 inet dhcp&#34; &gt;&gt; ${Operate_Net_File} echo &#34;\tbridge_ports eth0&#34; &gt;&gt; ${Operate_Net_File}\tsudo /etc/init.d/networking restart fi fi else echo &#34;br0 exists.&#34; fi if [ &#34;$(ifconfig | grep -wo &#34;br0&#34;)&#34; = &#34;br0&#34; ]; then of_ip_var1=$(ifconfig | grep -w -A 1 &#34;br0&#34; | grep -v &#34;br0&#34; | awk &#39;$1==&#34;inet&#34; {print $2}&#39; | grep -oE &#34;\\b([0-9]{1,3}\\.){3}[0-9]{1,3}\\b&#34; | awk -F &#39;.&#39; &#39;{print $1}&#39;); echo ${of_ip_var1} of_ip_var2=$(ifconfig | grep -w -A 1 &#34;br0&#34; | grep -v &#34;br0&#34; | awk &#39;$1==&#34;inet&#34; {print $2}&#39; | grep -oE &#34;\\b([0-9]{1,3}\\.){3}[0-9]{1,3}\\b&#34; | awk -F &#39;.&#39; &#39;{print $2}&#39;); echo ${of_ip_var2} of_ip_var3=$(ifconfig | grep -w -A 1 &#34;br0&#34; | grep -v &#34;br0&#34; | awk &#39;$1==&#34;inet&#34; {print $2}&#39; | grep -oE &#34;\\b([0-9]{1,3}\\.){3}[0-9]{1,3}\\b&#34; | awk -F &#39;.&#39; &#39;{print $3}&#39;); echo ${of_ip_var3} of_ip_var4=$(ifconfig | grep -w -A 1 &#34;br0&#34; | grep -v &#34;br0&#34; | awk &#39;$1==&#34;inet&#34; {print $2}&#39; | grep -oE &#34;\\b([0-9]{1,3}\\.){3}[0-9]{1,3}\\b&#34; | awk -F &#39;.&#39; &#39;{print $4}&#39;); echo ${of_ip_var4} else echo &#34;The br0 not exists.&#34; fi sudo chown ${USER}:${USER} ${Operate_Net_File} if [ ! -f &#34;${uboot_config_file}.old&#34; ]; then cp ${uboot_config_file} ${uboot_config_file}.old else cat ${uboot_config_file}.old &gt; ${uboot_config_file} fi uboot_config_file_var1=$(grep -n &#34;\\/\\* Basic environment settings \\*\\/&#34; ${uboot_config_file}.old | tr &#39;:&#39; &#39; &#39; | awk &#39;{print $1}&#39;) uboot_config_file_var2=$((uboot_config_file_var1 + 1)) cat ${uboot_config_file}.old &gt; ${uboot_config_file} sed -i &#39;/CONFIG_BOOTCOMMAND\\b/d&#39; ${uboot_config_file} sed -i &#39;/run distro_bootcmd\\b/d&#39; ${uboot_config_file} sed -i &#39;/run bootflash\\b/d&#39; ${uboot_config_file} sed -i &#34;${uboot_config_file_var2}i\\#define CONFIG_SERVERIP ${of_ip_var1}.${of_ip_var2}.${of_ip_var3}.${of_ip_var4}&#34; ${uboot_config_file} sed -i &#34;${uboot_config_file_var2}i\\#define CONFIG_NETMASK 255.255.255.0&#34; ${uboot_config_file} sed -i &#34;${uboot_config_file_var2}i\\#define CONFIG_IPADDR ${of_ip_var1}.${of_ip_var2}.${of_ip_var3}.223&#34; ${uboot_config_file} sed -i &#34;${uboot_config_file_var2}i\\/* netmask */&#34; ${uboot_config_file} sed -i &#34;${uboot_config_file_var2}i\\#define CONFIG_BOOTCOMMAND \\&#34;tftp 0x60003000 uImage;tftp 0x60500000 vexpress-v2p-ca9.dtb;setenv bootargs &#39;root=/dev/mmcblk0 console=ttyAMA0&#39;;bootm 0x60003000 - 0x60500000;\\&#34; \\\\&#34; ${uboot_config_file} echo -e &#34;\\e[0m&#34; # 编译u-boot，编译之后会在${uboot}目录下出现u-boot，传真u-boot示例：sudo qemu-system-arm -M vexpress-a9 -m 256 -kernel ./u-boot -nographic echo -e &#34;\\e[34m&#34; cd ${work_dir}/${uboot}; make distclean -j${jobs}; make vexpress_ca9x4_defconfig -j${jobs}; make -j${jobs}; echo -e &#34;\\e[0m&#34; # 准备根文件系统 echo -e &#34;\\e[33m&#34; cd ${work_dir}; mkdir -p ${work_dir}/rootfs/{dev,etc/init.d,lib,mnt}; sudo cp -vrf ${work_dir}/${busybox}/_install/* ${work_dir}/rootfs/; sudo cp -vrf /usr/arm-linux-gnueabi/lib/* ${work_dir}/rootfs/lib/; cd ${work_dir}/rootfs/dev; # 创建字符设备类型的设备节点，这些设备节点的主设备号为4,次设备号为1..11 sudo mknod -m 666 console c 4 1; sudo mknod -m 666 null c 4 2; sudo mknod -m 666 tty1 c 4 3; sudo mknod -m 666 tty2 c 4 4; sudo mknod -m 666 tty3 c 4 5; sudo mknod -m 666 tty4 c 4 6; sudo mknod -m 666 tty5 c 4 7; sudo mknod -m 666 tty6 c 4 8; sudo mknod -m 666 tty7 c 4 9; sudo mknod -m 666 tty8 c 4 10; sudo mknod -m 666 tty9 c 4 11; # 在rootfs目录下准备挂载NFS脚本 sudo touch ${work_dir}/rootfs/mountNFS.sh sudo chown ${USER}:${USER} ${work_dir}/rootfs/mountNFS.sh cat ${work_dir}/rootfs/mountNFS.sh &gt; ${work_dir}/rootfs/mountNFS.sh echo &#34;ifconfig eth0 ${of_ip_var1}.${of_ip_var2}.${of_ip_var3}.223&#34; &gt;&gt; ${work_dir}/rootfs/mountNFS.sh echo &#34;mount -t nfs -o nolock ${of_ip_var1}.${of_ip_var2}.${of_ip_var3}.${of_ip_var4}:${work_dir} /mnt&#34; &gt;&gt; ${work_dir}/rootfs/mountNFS.sh sudo chown ${root}:${root} ${work_dir}/rootfs/mountNFS.sh # 进入qemu运行的虚拟机后通过以下命令运行脚本进行挂载nfs：&#34;sh mountNFS.sh&#34; cd ${work_dir}; # 制作rootfs.ext3，格式化rootfs.ext3为ext3文件系统类型，将rootfs.ext3挂载到/mnt，再将根文件系统拷贝到/mnt，然后解除/mnt挂载的rootfs.ext3，此时rootfs.ext3中已经有根文件系统了 sudo dd if=/dev/zero of=rootfs.ext3 bs=1M count=32 sudo mkfs.ext3 rootfs.ext3 sudo mount -t ext3 rootfs.ext3 /mnt -o loop sudo cp -vrf ${work_dir}/rootfs/* /mnt sudo umount /mnt echo -e &#34;\\e[0m&#34; # tftpboot echo -e &#34;\\e[96m&#34; # sudo chmod 775 $work_dir/$uboot/uImage; sudo rm -rf /tftpboot/* sudo cp -f ${work_dir}/${linux}/arch/arm/boot/zImage /tftpboot; sudo cp -f ${work_dir}/${linux}/arch/arm/boot/uImage /tftpboot; sudo cp -f ${work_dir}/${linux}/arch/arm/boot/dts/vexpress-v2p-ca9.dtb /tftpboot; sudo cp -f ${work_dir}/${uboot}/u-boot /tftpboot; sudo cp -f ${work_dir}/rootfs.ext3 /tftpboot; echo -e &#34;\\e[0m&#34; # QEMU运行虚拟机，通过sd卡加载linux内核 echo -e &#34;\\e[92m&#34; # qemu-system-arm -M vexpress-a9 -m 256M -kernel ${work_dir}/$linux/arch/arm/boot/zImage -dtb ${work_dir}/$linux/arch/arm/boot/dts/vexpress-v2p-ca9.dtb -nographic -append &#34;root=/dev/mmcblk0 rw console=ttyAMA0&#34; -sd ${work_dir}/rootfs.ext3; # 在脚本外部执行，进入yenao_qemu_test目录执行下面的语句 # qemu-system-arm -M vexpress-a9 -m 512M -kernel linux-4.4.232/arch/arm/boot/zImage -dtb linux-4.4.232/arch/arm/boot/dts/vexpress-v2p-ca9.dtb -nographic -append &#34;root=/dev/mmcblk0 rw console=ttyAMA0&#34; -sd rootfs.ext3 # QEMU运行虚拟机，只加载u-boot # qemu-system-arm -M vexpress-a9 -m 256M -kernel ${work_dir}/${uboot}/u-boot -nographic # 通过 u-boot 加载内核 # cd /tftpboot # sudo qemu-system-arm -M vexpress-a9 -kernel u-boot -nographic -m 128M -net nic,vlan=0 -net tap,vlan=0,ifname=tap0 -sd rootfs.ext3 if [ &#34;$1&#34; = &#34;sd&#34; ]; then # QEMU运行虚拟机，通过sd卡加载linux内核\tsudo qemu-system-arm -M vexpress-a9 -m 256M -kernel ${work_dir}/$linux/arch/arm/boot/zImage -dtb ${work_dir}/$linux/arch/arm/boot/dts/vexpress-v2p-ca9.dtb -nographic -append &#34;root=/dev/mmcblk0 rw console=ttyAMA0&#34; -sd ${work_dir}/rootfs.ext3;\telif [ &#34;$1&#34; = &#34;u-boot&#34; ]; then cd /tftpboot sudo qemu-system-arm -M vexpress-a9 -kernel u-boot -nographic -m 128M -net nic,vlan=0 -net tap,vlan=0,ifname=tap0 -sd rootfs.ext3 elif [ &#34;$1&#34; = &#34;help&#34; ]; then echo &#34;sd start: ${cmdself} sd&#34; echo &#34;u-boot start: ${cmdself} u-boot&#34; echo &#34;out sd start var: ${cmdself} out sd&#34; echo &#34;out u-boot start var: ${cmdself} out u-boot&#34; elif [ &#34;$1&#34; = &#34;out&#34; ] &amp;&amp; [ &#34;$2&#34; = &#34;sd&#34; ]; then echo &#34; qemu-system-arm -M vexpress-a9 -m 256M -kernel ${work_dir}/$linux/arch/arm/boot/zImage -dtb ${work_dir}/$linux/arch/arm/boot/dts/vexpress-v2p-ca9.dtb -nographic -append \\&#34;root=/dev/mmcblk0 rw console=ttyAMA0\\&#34; -sd ${work_dir}/rootfs.ext3;&#34; elif [ &#34;$1&#34; = &#34;out&#34; ] &amp;&amp; [ &#34;$2&#34; = &#34;u-boot&#34; ]; then echo &#34;sudo qemu-system-arm -M vexpress-a9 -kernel u-boot -nographic -m 128M -net nic,vlan=0 -net tap,vlan=0,ifname=tap0 -sd rootfs.ext3&#34; else # 默认通过u-boot加载linux内核 cd /tftpboot sudo qemu-system-arm -M vexpress-a9 -kernel u-boot -nographic -m 128M -net nic,vlan=0 -net tap,vlan=0,ifname=tap0 -sd rootfs.ext3 fi echo -e &#34;\\e[0m&#34; # 部分参数说明 # |----------------------------------------------------------------+--------------------------------------------------------------------------------------| # | 参数 | 含义 | # |----------------------------------------------------------------+--------------------------------------------------------------------------------------| # | M vexpress-a9` | 指定虚拟机的机型为 `vexpress-a9`，即使用 ARMv7 架构的 Versatile Express 开发板模型。 | # |----------------------------------------------------------------+--------------------------------------------------------------------------------------| # | m 512M` | 设置虚拟机的内存大小为 512MB。 | # |----------------------------------------------------------------+--------------------------------------------------------------------------------------| # | kernel ${work_dir}/$linux/arch/arm/boot/zImage` | 指定 Linux 内核镜像的路径和文件名。 | # |----------------------------------------------------------------+--------------------------------------------------------------------------------------| # | dtb ${work_dir}/$linux/arch/arm/boot/dts/vexpress-v2p-ca9.dtb` | 指定设备树二进制文件（Device Tree Blob）的路径和文件名。 | # |----------------------------------------------------------------+--------------------------------------------------------------------------------------| # | nographic` | 以无图形界面的方式运行虚拟机。 | # |----------------------------------------------------------------+--------------------------------------------------------------------------------------| # | append &#34;root=/dev/mmcblk0 rw console=ttyAMA0&#34;` | 指定 Linux 内核启动参数，包括根文件系统的设备路径、读写权限和控制台终端。 | # |----------------------------------------------------------------+--------------------------------------------------------------------------------------| # | sd ${work_dir}/rootfs.ext3` | 指定虚拟机的根文件系统镜像路径和文件名。 | # |----------------------------------------------------------------+--------------------------------------------------------------------------------------| 挂载NFS文件系统流程，待实现 1 2 3 4 5 6 7 8 9 10 11 12 13 export ARCH=arm CROSS_COMPILE=arm-linux-gnueabi-; make vexpress_ca9x4_defconfig; make -j12 setenv ipaddr 192.168.1.223; setenv serverip 192.168.1.100; tftp 0x60003000 uImage; tftp 0x60500000 vexpress-v2p-ca9.dtb; setenv bootargs &#39;root=/dev/nfs rw nfsroot=192.168.1.100:/home/ubt init=/linuxrc ip=192.168.1.223 console=ttyAMA0&#39;; bootm 0x60003000 - 0x60500000; 所需资源下载 linux-4.4.232.tar.xz\n">
<title>使用qemu搭建arm嵌入式linux开发环境</title>

<link rel='canonical' href='https://ynhugo.github.io/p/%E4%BD%BF%E7%94%A8qemu%E6%90%AD%E5%BB%BAarm%E5%B5%8C%E5%85%A5%E5%BC%8Flinux%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/'>

<link rel="stylesheet" href="/scss/style.min.946cca6c6259ef94ac55abfae7c7bf3291ea3ed5eea17ef77500b257217c6710.css"><meta property='og:title' content="使用qemu搭建arm嵌入式linux开发环境">
<meta property='og:description' content=" 使用qemu搭建arm嵌入式linux开发环境 使用说明 该脚本只有在第一次运行的时候需要构建环境，花费时间长一些，构建完成以后自动启动环境，以后再运行该脚本的时候就不需要再次构建环境了，加载后进入开发环境，敲回车确认。\n退出时先按快捷键&#34;Ctrl+x&#34;，再按&#34;x&#34;即可退出环境。\n搭建脚本 调试启动脚本 推荐使用这个脚本，从头到尾自动化完成\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 239 240 241 242 243 244 245 246 247 248 249 250 251 252 253 254 255 256 257 258 259 260 261 262 263 264 265 266 267 268 269 270 271 272 273 274 275 276 277 278 279 280 281 282 283 284 285 286 287 288 289 290 291 292 293 294 295 296 297 298 299 300 301 302 303 304 305 306 307 308 309 310 311 312 313 314 315 316 317 318 319 320 321 322 323 324 325 326 327 328 329 330 331 332 333 334 335 336 337 338 339 340 341 342 343 344 345 346 347 348 349 350 351 352 353 354 355 356 357 358 359 360 361 362 363 364 365 366 367 368 369 370 371 372 373 374 375 376 377 378 379 380 381 382 383 384 385 386 387 388 389 390 391 392 393 394 395 396 397 398 399 400 401 402 403 404 405 406 407 408 409 410 411 412 413 cmdself=$0 linux=&#34;linux-4.4.232&#34;; # linux=&#34;linux-4.4.76&#34;; busybox=&#34;busybox-1.32.0&#34;; uboot=&#34;u-boot-2017.05&#34; # uboot=&#34;u-boot-2020.07&#34; file_linux=&#34;${linux}.tar.xz&#34;; file_busybox=&#34;${busybox}.tar.bz2&#34;; file_uboot=&#34;${uboot}.tar.bz2&#34; work_dir_name=&#34;yenao_qemu_test&#34;; work_dir=&#34;${HOME}/${work_dir_name}&#34;; Operate_Net_File=&#34;/etc/network/interfaces&#34; uboot_config_file=&#34;${work_dir}/${uboot}/include/configs/vexpress_common.h&#34; mkdir -p ${work_dir}; cd ${work_dir}; cpu_cores=$(nproc) jobs=$((cpu_cores * 2)) package_array=(gcc-arm-linux-gnueabi python-dev qemu qemu-kvm libvirt-bin bridge-utils virt-manager uml-utilities bridge-utils u-boot-tools ed tftp-hpa tftpd-hpa xinetd nfs-kernel-server device-tree-compiler) # gcc-arm-linux-gnueabi 交叉编译工具链与 gcc-multilib 不能共存，因此如果电脑之前有安装并且需要 gcc-multilib 的话，可以再运行完脚本后重新安装 gcc-multilib package_array_size=${#package_array[@]} for ((i = 0; i &lt; package_array_size; i++)) do # 软件安装 if [ ! &#34;$(apt list --installed | grep -wo &#34;${package_array[${i}]}&#34; | head -n 1)&#34; = &#34;${package_array[${i}]}&#34; ]; then echo -e &#34;\\e[34m&#34; sudo apt-get install ${package_array[${i}]} -y echo -e &#34;\\e[0m&#34; if [ ! &#34;$(apt list --installed | grep -wo &#34;${package_array[${i}]}&#34; | head -n 1)&#34; = &#34;${package_array[${i}]}&#34; ]; then echo -e &#34;\\e[31m${package_array[${i}]} 未安装\\e[0m&#34; else echo -e &#34;\\e[32m${package_array[${i}]} 已安装\\e[0m&#34; fi\telse echo -e &#34;\\e[32m${package_array[${i}]} 已安装\\e[0m&#34; fi done\t# 配置/etc/default/tftpd-hpa sudo chmod 777 /etc/default/tftpd-hpa; cat /etc/default/tftpd-hpa &gt; /etc/default/tftpd-hpa sudo chown ${USER}:${USER} -R /etc/default/tftpd-hpa echo &#39;TFTP_USERNAME=&#34;tftp&#34;&#39; &gt;&gt; /etc/default/tftpd-hpa echo &#34;TFTP_DIRECTORY=\\&#34;/tftpboot\\&#34;&#34; &gt;&gt; /etc/default/tftpd-hpa # echo &#34;TFTP_DIRECTORY=\\&#34;/tftpboot /tftpboot/${work_dir_name}\\&#34;&#34; &gt;&gt; /etc/default/tftpd-hpa echo &#39;TFTP_ADDRESS=&#34;0.0.0.0:69&#34;&#39; &gt;&gt; /etc/default/tftpd-hpa echo &#39;TFTP_OPTIONS=&#34;-l -c -s&#34;&#39; &gt;&gt; /etc/default/tftpd-hpa # 如果要设置多个目录就不能添加&#34;-s&#34;选项 # echo &#39;TFTP_OPTIONS=&#34;-l -c&#34;&#39; &gt;&gt; /etc/default/tftpd-hpa sudo chown root:root -R /etc/default/tftpd-hpa # 判断/tftpboot是否存在 if [ -d &#34;/tftpboot/&#34; ]; then echo &#34;tftpboot exists.&#34;; tftpboot_access=$(stat /tftpboot/ | grep -w &#34;Uid&#34; | tr &#39;(&#39; &#39; &#39; | tr &#39;/&#39; &#39; &#39; | awk &#39;{print $2}&#39;) if [ &#34;$tftpboot_access&#34; != &#34;0777&#34; ]; then sudo chmod 777 /tftpboot; echo &#34;/tftpboot的权限已设置为0777&#34; fi else sudo mkdir /tftpboot; sudo chmod 777 /tftpboot; echo &#34;/tftpboot的权限已设置为0777&#34; fi # 判断/tftpboot/${work_dir_name}是否存在，想要配置多个文件夹的话可以取消注释 # if [ -d &#34;/tftpboot/${work_dir_name}&#34; ]; then # echo &#34;tftpboot/${work_dir_name} exists.&#34;; # work_dir_name_access=$(stat /tftpboot/ | grep -w &#34;Uid&#34; | tr &#39;(&#39; &#39; &#39; | tr &#39;/&#39; &#39; &#39; | awk &#39;{print $2}&#39;) # if [ &#34;$work_dir_name_access&#34; != &#34;0777&#34; ]; then # sudo chmod 777 /tftpboot/${work_dir_name}; # echo &#34;/tftpboot/${work_dir_name}的权限已设置为0777&#34; # fi # else # sudo mkdir /tftpboot/${work_dir_name}; # sudo chmod 777 /tftpboot/${work_dir_name}; # echo &#34;/tftpboot/${work_dir_name}的权限已设置为0777&#34; # fi # 允许开发板通过NFS访问Ubuntu的/home/${USER}目录，当然你可以加其他目录 result=$(grep -w &#34;${work_dir} \\*(rw,nohide,insecure,no_subtree_check,async,no_root_squash)&#34; /etc/exports | grep -v &#34;#&#34;) if [ $? -eq 0 ]; then # 查找并注释匹配行 # sudo sed -i &#34;s/${work_dir} \\*(rw,nohide,insecure,no_subtree_check,async,no_root_squash)/#\\/home\\/${USER} \\*(rw,nohide,insecure,no_subtree_check,async,no_root_squash)/g&#34; /etc/exports # echo &#34;已注释匹配行：$result&#34; sudo /etc/init.d/nfs-kernel-server restart echo &#34;匹配行已存在，并且重启了nfs服务&#34; else power=$(ls -l /etc/exports | awk &#39;{print $4}&#39;) if [ &#34;$power&#34; == &#34;root&#34; ]; then sudo chown ${USER}:${USER} -R /etc/exports echo &#34;${work_dir} *(rw,nohide,insecure,no_subtree_check,async,no_root_squash)&#34; &gt;&gt; /etc/exports sudo chown root:root -R /etc/exports else echo &#34;${work_dir} *(rw,nohide,insecure,no_subtree_check,async,no_root_squash)&#34; &gt;&gt; /etc/exports sudo chown root:root -R /etc/exports fi sudo /etc/init.d/nfs-kernel-server restart echo &#34;匹配行已添加，并且重启了nfs服务&#34; fi # 判断linux内核是否准备好 while true; do result=$(curl ipinfo.io | grep &#34;country&#34; | tr &#39;&#34;&#39; &#39; &#39; | awk &#39;{print $3}&#39;) if [ -z &#34;${result}&#34; ]; then continue else echo -e &#34;\\e[32mcountry: ${result}\\e[0m&#34; break fi done while true; do if [ ! -f &#34;${work_dir}/$file_linux&#34; ]; then\techo -e &#34;\\e[32m&#34; if [ ${result} != &#34;CN&#34; ]; then\t# wget https://cdn.kernel.org/pub/linux/kernel/v4.x/linux-4.4.232.tar.xz wget https://cdn.kernel.org/pub/linux/kernel/v4.x/${file_linux} else # wget https://mirrors.ustc.edu.cn/kernel.org/linux/kernel/v4.x/linux-4.4.232.tar.xz wget https://mirrors.ustc.edu.cn/kernel.org/linux/kernel/v4.x/${file_linux} fi else if [ &#34;$(sha256sum ${file_linux})&#34; != &#34;4eae8865deaf03f0d13bf5056e258d451a468cabc5158757b247b0e43518fd34 ${file_linux}&#34; ]; then rm -rf ${file_linux} continue else echo -e &#34;\\e[32m${file_linux} 已下载\\e[0m&#34; break; fi fi echo -e &#34;\\e[0m&#34; done # 判断busybox文件是否准备好 while true; do if [ ! -f &#34;${work_dir}/$file_busybox&#34; ]; then echo -e &#34;\\e[33m&#34; # wget --no-check-certificate https://busybox.net/downloads/busybox-1.32.0.tar.bz2 wget --no-check-certificate https://busybox.net/downloads/${file_busybox} echo -e &#34;\\e[0m&#34; else if [ &#34;$(sha256sum ${file_busybox})&#34; != &#34;c35d87f1d04b2b153d33c275c2632e40d388a88f19a9e71727e0bbbff51fe689 ${file_busybox}&#34; ]; then rm -rf ${file_busybo} continue else echo -e &#34;\\e[32m$file_busybox 已下载\\e[0m&#34; break; fi fi\tdone # 判断u-boot文件是否准备好 while true; do if [ ! -f &#34;${work_dir}/$file_uboot&#34; ]; then echo -e &#34;\\e[34m&#34; # wget --no-check-certificate https://ftp.denx.de/pub/u-boot/u-boot-2017.05.tar.bz2 # wget --no-check-certificate https://ftp.denx.de/pub/u-boot/u-boot-2020.07.tar.bz2 wget --no-check-certificate https://ftp.denx.de/pub/u-boot/${file_uboot} echo -e &#34;\\e[0m&#34; else if [ &#34;$(sha256sum ${file_uboot})&#34; != &#34;c8373949d7f0de1059e507b83a655d4cea539f75dc66ccdbb27adbd38d83095e u-boot-2017.05.tar.bz2&#34; ]; then rm -rf ${file_uboot} continue else echo -e &#34;\\e[32m$file_uboot 已下载\\e[0m&#34; break fi fi done # 临时配置交叉编译环境 export ARCH=arm &amp;&amp; export CROSS_COMPILE=arm-linux-gnueabi-; # 判断linux内核是否解压 echo -e &#34;\\e[32m&#34; # kernel if [ -d &#34;${work_dir}/$linux&#34; ]; then echo &#34;$linux exists.&#34; else tar xvf ${work_dir}/$file_linux -C ${work_dir}; fi echo -e &#34;\\e[0m&#34; # 判断busybox文件是否解压 echo -e &#34;\\e[33m&#34; if [ -d &#34;${work_dir}/$busybox&#34; ]; then echo &#34;$busybox exists.&#34; else tar xvf ${work_dir}/$file_busybox -C ${work_dir}; fi echo -e &#34;\\e[0m&#34; # 判断u-boot文件是否解压 echo -e &#34;\\e[34m&#34; if [ -d &#34;${work_dir}/${uboot}&#34; ]; then echo &#34;$uboot exists.&#34; else tar xvf ${work_dir}/$file_uboot -C ${work_dir}; if [ -f &#34;${work_dir}/${uboot}/include/configs/vexpress_common.h&#34; ]; then cp ${uboot_config_file} ${uboot_config_file}.old fi fi echo -e &#34;\\e[0m&#34; # 编译linux内核 echo -e &#34;\\e[32m&#34; cd ${work_dir}/${linux}; make distclean -j${jobs}; make vexpress_defconfig -j${jobs}; make zImage -j${jobs}; make modules -j${jobs}; make LOADADDR=0x60003000 uImage -j${jobs}; make dtbs -j${jobs}; # mkimage -n &#39;mini2440&#39; -A arm -O linux -T kernel -C none -a 0x30008000 -e 0x30008040 -d ${work_dir}/$linux/arch/arm/boot/zImage ${work_dir}/$linux/arch/arm/boot/uImage echo -e &#34;\\e[0m&#34; # 编译busybox，编译之后把&#34;${busybox}/_install/*&#34;拷贝到rootfs目录下 echo -e &#34;\\e[33m&#34; cd ${work_dir}/${busybox}; make distclean -j${jobs}; make defconfig -j${jobs}; make -j${jobs}; make install -j${jobs}; echo -e &#34;\\e[0m&#34; # 搭建网络开发环境 echo -e &#34;\\e[95m&#34; if [ ! -f &#34;$Operate_Net_File&#34; ]; then sudo touch ${Operate_Net_File} else echo &#34;${uboot_config_file} is exists.&#34; if [ ! -f &#34;$Operate_Net_File.old&#34; ]; then sudo cp ${Operate_Net_File} {$Operate_Net_File}.old else echo &#34;${Operate_Net_File}.old is exists.&#34; fi fi sudo chown ${USER}:${USER} ${Operate_Net_File} if [ ! &#34;$(cat /etc/network/interfaces | grep -o &#34;br0&#34; | head -n 1)&#34; = &#34;br0&#34; ]; then echo &#34;debug_1&#34; cat ${Operate_Net_File} &gt; ${Operate_Net_File} if [ &#34;$(ip addr | grep -o &#34;ens33&#34; | head -n 1)&#34; = &#34;ens33&#34; ]; then echo &#34;auto lo&#34; &gt;&gt; ${Operate_Net_File} echo &#34;iface lo inet loopback&#34; &gt;&gt; ${Operate_Net_File} echo &#34;&#34; &gt;&gt; ${Operate_Net_File} echo &#34;auto ens33&#34; &gt;&gt; ${Operate_Net_File} echo &#34;&#34; &gt;&gt; ${Operate_Net_File} echo &#34;auto br0&#34; &gt;&gt; ${Operate_Net_File} echo &#34;iface br0 inet dhcp&#34; &gt;&gt; ${Operate_Net_File} echo &#34;\tbridge_ports ens33&#34; &gt;&gt; ${Operate_Net_File} sudo chown ${root}:${root} ${Operate_Net_File} sudo /etc/init.d/networking restart else if [ &#34;$(ip addr | grep -o &#34;eth0&#34;)&#34; = &#34;eth0&#34; ]; then echo &#34;auto lo&#34; &gt;&gt; ${Operate_Net_File} echo &#34;iface lo inet loopback&#34; &gt;&gt; ${Operate_Net_File} echo &#34;&#34; &gt;&gt; ${Operate_Net_File} echo &#34;auto eth0&#34; &gt;&gt; ${Operate_Net_File} echo &#34;&#34; &gt;&gt; ${Operate_Net_File} echo &#34;auto br0&#34; &gt;&gt; ${Operate_Net_File} echo &#34;iface br0 inet dhcp&#34; &gt;&gt; ${Operate_Net_File} echo &#34;\tbridge_ports eth0&#34; &gt;&gt; ${Operate_Net_File}\tsudo /etc/init.d/networking restart fi fi else echo &#34;br0 exists.&#34; fi if [ &#34;$(ifconfig | grep -wo &#34;br0&#34;)&#34; = &#34;br0&#34; ]; then of_ip_var1=$(ifconfig | grep -w -A 1 &#34;br0&#34; | grep -v &#34;br0&#34; | awk &#39;$1==&#34;inet&#34; {print $2}&#39; | grep -oE &#34;\\b([0-9]{1,3}\\.){3}[0-9]{1,3}\\b&#34; | awk -F &#39;.&#39; &#39;{print $1}&#39;); echo ${of_ip_var1} of_ip_var2=$(ifconfig | grep -w -A 1 &#34;br0&#34; | grep -v &#34;br0&#34; | awk &#39;$1==&#34;inet&#34; {print $2}&#39; | grep -oE &#34;\\b([0-9]{1,3}\\.){3}[0-9]{1,3}\\b&#34; | awk -F &#39;.&#39; &#39;{print $2}&#39;); echo ${of_ip_var2} of_ip_var3=$(ifconfig | grep -w -A 1 &#34;br0&#34; | grep -v &#34;br0&#34; | awk &#39;$1==&#34;inet&#34; {print $2}&#39; | grep -oE &#34;\\b([0-9]{1,3}\\.){3}[0-9]{1,3}\\b&#34; | awk -F &#39;.&#39; &#39;{print $3}&#39;); echo ${of_ip_var3} of_ip_var4=$(ifconfig | grep -w -A 1 &#34;br0&#34; | grep -v &#34;br0&#34; | awk &#39;$1==&#34;inet&#34; {print $2}&#39; | grep -oE &#34;\\b([0-9]{1,3}\\.){3}[0-9]{1,3}\\b&#34; | awk -F &#39;.&#39; &#39;{print $4}&#39;); echo ${of_ip_var4} else echo &#34;The br0 not exists.&#34; fi sudo chown ${USER}:${USER} ${Operate_Net_File} if [ ! -f &#34;${uboot_config_file}.old&#34; ]; then cp ${uboot_config_file} ${uboot_config_file}.old else cat ${uboot_config_file}.old &gt; ${uboot_config_file} fi uboot_config_file_var1=$(grep -n &#34;\\/\\* Basic environment settings \\*\\/&#34; ${uboot_config_file}.old | tr &#39;:&#39; &#39; &#39; | awk &#39;{print $1}&#39;) uboot_config_file_var2=$((uboot_config_file_var1 + 1)) cat ${uboot_config_file}.old &gt; ${uboot_config_file} sed -i &#39;/CONFIG_BOOTCOMMAND\\b/d&#39; ${uboot_config_file} sed -i &#39;/run distro_bootcmd\\b/d&#39; ${uboot_config_file} sed -i &#39;/run bootflash\\b/d&#39; ${uboot_config_file} sed -i &#34;${uboot_config_file_var2}i\\#define CONFIG_SERVERIP ${of_ip_var1}.${of_ip_var2}.${of_ip_var3}.${of_ip_var4}&#34; ${uboot_config_file} sed -i &#34;${uboot_config_file_var2}i\\#define CONFIG_NETMASK 255.255.255.0&#34; ${uboot_config_file} sed -i &#34;${uboot_config_file_var2}i\\#define CONFIG_IPADDR ${of_ip_var1}.${of_ip_var2}.${of_ip_var3}.223&#34; ${uboot_config_file} sed -i &#34;${uboot_config_file_var2}i\\/* netmask */&#34; ${uboot_config_file} sed -i &#34;${uboot_config_file_var2}i\\#define CONFIG_BOOTCOMMAND \\&#34;tftp 0x60003000 uImage;tftp 0x60500000 vexpress-v2p-ca9.dtb;setenv bootargs &#39;root=/dev/mmcblk0 console=ttyAMA0&#39;;bootm 0x60003000 - 0x60500000;\\&#34; \\\\&#34; ${uboot_config_file} echo -e &#34;\\e[0m&#34; # 编译u-boot，编译之后会在${uboot}目录下出现u-boot，传真u-boot示例：sudo qemu-system-arm -M vexpress-a9 -m 256 -kernel ./u-boot -nographic echo -e &#34;\\e[34m&#34; cd ${work_dir}/${uboot}; make distclean -j${jobs}; make vexpress_ca9x4_defconfig -j${jobs}; make -j${jobs}; echo -e &#34;\\e[0m&#34; # 准备根文件系统 echo -e &#34;\\e[33m&#34; cd ${work_dir}; mkdir -p ${work_dir}/rootfs/{dev,etc/init.d,lib,mnt}; sudo cp -vrf ${work_dir}/${busybox}/_install/* ${work_dir}/rootfs/; sudo cp -vrf /usr/arm-linux-gnueabi/lib/* ${work_dir}/rootfs/lib/; cd ${work_dir}/rootfs/dev; # 创建字符设备类型的设备节点，这些设备节点的主设备号为4,次设备号为1..11 sudo mknod -m 666 console c 4 1; sudo mknod -m 666 null c 4 2; sudo mknod -m 666 tty1 c 4 3; sudo mknod -m 666 tty2 c 4 4; sudo mknod -m 666 tty3 c 4 5; sudo mknod -m 666 tty4 c 4 6; sudo mknod -m 666 tty5 c 4 7; sudo mknod -m 666 tty6 c 4 8; sudo mknod -m 666 tty7 c 4 9; sudo mknod -m 666 tty8 c 4 10; sudo mknod -m 666 tty9 c 4 11; # 在rootfs目录下准备挂载NFS脚本 sudo touch ${work_dir}/rootfs/mountNFS.sh sudo chown ${USER}:${USER} ${work_dir}/rootfs/mountNFS.sh cat ${work_dir}/rootfs/mountNFS.sh &gt; ${work_dir}/rootfs/mountNFS.sh echo &#34;ifconfig eth0 ${of_ip_var1}.${of_ip_var2}.${of_ip_var3}.223&#34; &gt;&gt; ${work_dir}/rootfs/mountNFS.sh echo &#34;mount -t nfs -o nolock ${of_ip_var1}.${of_ip_var2}.${of_ip_var3}.${of_ip_var4}:${work_dir} /mnt&#34; &gt;&gt; ${work_dir}/rootfs/mountNFS.sh sudo chown ${root}:${root} ${work_dir}/rootfs/mountNFS.sh # 进入qemu运行的虚拟机后通过以下命令运行脚本进行挂载nfs：&#34;sh mountNFS.sh&#34; cd ${work_dir}; # 制作rootfs.ext3，格式化rootfs.ext3为ext3文件系统类型，将rootfs.ext3挂载到/mnt，再将根文件系统拷贝到/mnt，然后解除/mnt挂载的rootfs.ext3，此时rootfs.ext3中已经有根文件系统了 sudo dd if=/dev/zero of=rootfs.ext3 bs=1M count=32 sudo mkfs.ext3 rootfs.ext3 sudo mount -t ext3 rootfs.ext3 /mnt -o loop sudo cp -vrf ${work_dir}/rootfs/* /mnt sudo umount /mnt echo -e &#34;\\e[0m&#34; # tftpboot echo -e &#34;\\e[96m&#34; # sudo chmod 775 $work_dir/$uboot/uImage; sudo rm -rf /tftpboot/* sudo cp -f ${work_dir}/${linux}/arch/arm/boot/zImage /tftpboot; sudo cp -f ${work_dir}/${linux}/arch/arm/boot/uImage /tftpboot; sudo cp -f ${work_dir}/${linux}/arch/arm/boot/dts/vexpress-v2p-ca9.dtb /tftpboot; sudo cp -f ${work_dir}/${uboot}/u-boot /tftpboot; sudo cp -f ${work_dir}/rootfs.ext3 /tftpboot; echo -e &#34;\\e[0m&#34; # QEMU运行虚拟机，通过sd卡加载linux内核 echo -e &#34;\\e[92m&#34; # qemu-system-arm -M vexpress-a9 -m 256M -kernel ${work_dir}/$linux/arch/arm/boot/zImage -dtb ${work_dir}/$linux/arch/arm/boot/dts/vexpress-v2p-ca9.dtb -nographic -append &#34;root=/dev/mmcblk0 rw console=ttyAMA0&#34; -sd ${work_dir}/rootfs.ext3; # 在脚本外部执行，进入yenao_qemu_test目录执行下面的语句 # qemu-system-arm -M vexpress-a9 -m 512M -kernel linux-4.4.232/arch/arm/boot/zImage -dtb linux-4.4.232/arch/arm/boot/dts/vexpress-v2p-ca9.dtb -nographic -append &#34;root=/dev/mmcblk0 rw console=ttyAMA0&#34; -sd rootfs.ext3 # QEMU运行虚拟机，只加载u-boot # qemu-system-arm -M vexpress-a9 -m 256M -kernel ${work_dir}/${uboot}/u-boot -nographic # 通过 u-boot 加载内核 # cd /tftpboot # sudo qemu-system-arm -M vexpress-a9 -kernel u-boot -nographic -m 128M -net nic,vlan=0 -net tap,vlan=0,ifname=tap0 -sd rootfs.ext3 if [ &#34;$1&#34; = &#34;sd&#34; ]; then # QEMU运行虚拟机，通过sd卡加载linux内核\tsudo qemu-system-arm -M vexpress-a9 -m 256M -kernel ${work_dir}/$linux/arch/arm/boot/zImage -dtb ${work_dir}/$linux/arch/arm/boot/dts/vexpress-v2p-ca9.dtb -nographic -append &#34;root=/dev/mmcblk0 rw console=ttyAMA0&#34; -sd ${work_dir}/rootfs.ext3;\telif [ &#34;$1&#34; = &#34;u-boot&#34; ]; then cd /tftpboot sudo qemu-system-arm -M vexpress-a9 -kernel u-boot -nographic -m 128M -net nic,vlan=0 -net tap,vlan=0,ifname=tap0 -sd rootfs.ext3 elif [ &#34;$1&#34; = &#34;help&#34; ]; then echo &#34;sd start: ${cmdself} sd&#34; echo &#34;u-boot start: ${cmdself} u-boot&#34; echo &#34;out sd start var: ${cmdself} out sd&#34; echo &#34;out u-boot start var: ${cmdself} out u-boot&#34; elif [ &#34;$1&#34; = &#34;out&#34; ] &amp;&amp; [ &#34;$2&#34; = &#34;sd&#34; ]; then echo &#34; qemu-system-arm -M vexpress-a9 -m 256M -kernel ${work_dir}/$linux/arch/arm/boot/zImage -dtb ${work_dir}/$linux/arch/arm/boot/dts/vexpress-v2p-ca9.dtb -nographic -append \\&#34;root=/dev/mmcblk0 rw console=ttyAMA0\\&#34; -sd ${work_dir}/rootfs.ext3;&#34; elif [ &#34;$1&#34; = &#34;out&#34; ] &amp;&amp; [ &#34;$2&#34; = &#34;u-boot&#34; ]; then echo &#34;sudo qemu-system-arm -M vexpress-a9 -kernel u-boot -nographic -m 128M -net nic,vlan=0 -net tap,vlan=0,ifname=tap0 -sd rootfs.ext3&#34; else # 默认通过u-boot加载linux内核 cd /tftpboot sudo qemu-system-arm -M vexpress-a9 -kernel u-boot -nographic -m 128M -net nic,vlan=0 -net tap,vlan=0,ifname=tap0 -sd rootfs.ext3 fi echo -e &#34;\\e[0m&#34; # 部分参数说明 # |----------------------------------------------------------------+--------------------------------------------------------------------------------------| # | 参数 | 含义 | # |----------------------------------------------------------------+--------------------------------------------------------------------------------------| # | M vexpress-a9` | 指定虚拟机的机型为 `vexpress-a9`，即使用 ARMv7 架构的 Versatile Express 开发板模型。 | # |----------------------------------------------------------------+--------------------------------------------------------------------------------------| # | m 512M` | 设置虚拟机的内存大小为 512MB。 | # |----------------------------------------------------------------+--------------------------------------------------------------------------------------| # | kernel ${work_dir}/$linux/arch/arm/boot/zImage` | 指定 Linux 内核镜像的路径和文件名。 | # |----------------------------------------------------------------+--------------------------------------------------------------------------------------| # | dtb ${work_dir}/$linux/arch/arm/boot/dts/vexpress-v2p-ca9.dtb` | 指定设备树二进制文件（Device Tree Blob）的路径和文件名。 | # |----------------------------------------------------------------+--------------------------------------------------------------------------------------| # | nographic` | 以无图形界面的方式运行虚拟机。 | # |----------------------------------------------------------------+--------------------------------------------------------------------------------------| # | append &#34;root=/dev/mmcblk0 rw console=ttyAMA0&#34;` | 指定 Linux 内核启动参数，包括根文件系统的设备路径、读写权限和控制台终端。 | # |----------------------------------------------------------------+--------------------------------------------------------------------------------------| # | sd ${work_dir}/rootfs.ext3` | 指定虚拟机的根文件系统镜像路径和文件名。 | # |----------------------------------------------------------------+--------------------------------------------------------------------------------------| 挂载NFS文件系统流程，待实现 1 2 3 4 5 6 7 8 9 10 11 12 13 export ARCH=arm CROSS_COMPILE=arm-linux-gnueabi-; make vexpress_ca9x4_defconfig; make -j12 setenv ipaddr 192.168.1.223; setenv serverip 192.168.1.100; tftp 0x60003000 uImage; tftp 0x60500000 vexpress-v2p-ca9.dtb; setenv bootargs &#39;root=/dev/nfs rw nfsroot=192.168.1.100:/home/ubt init=/linuxrc ip=192.168.1.223 console=ttyAMA0&#39;; bootm 0x60003000 - 0x60500000; 所需资源下载 linux-4.4.232.tar.xz\n">
<meta property='og:url' content='https://ynhugo.github.io/p/%E4%BD%BF%E7%94%A8qemu%E6%90%AD%E5%BB%BAarm%E5%B5%8C%E5%85%A5%E5%BC%8Flinux%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/'>
<meta property='og:site_name' content='ynhugo'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:published_time' content='2023-09-14T07:37:20&#43;08:00'/><meta property='article:modified_time' content='2023-09-14T07:37:20&#43;08:00'/>
<meta name="twitter:title" content="使用qemu搭建arm嵌入式linux开发环境">
<meta name="twitter:description" content=" 使用qemu搭建arm嵌入式linux开发环境 使用说明 该脚本只有在第一次运行的时候需要构建环境，花费时间长一些，构建完成以后自动启动环境，以后再运行该脚本的时候就不需要再次构建环境了，加载后进入开发环境，敲回车确认。\n退出时先按快捷键&#34;Ctrl+x&#34;，再按&#34;x&#34;即可退出环境。\n搭建脚本 调试启动脚本 推荐使用这个脚本，从头到尾自动化完成\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 239 240 241 242 243 244 245 246 247 248 249 250 251 252 253 254 255 256 257 258 259 260 261 262 263 264 265 266 267 268 269 270 271 272 273 274 275 276 277 278 279 280 281 282 283 284 285 286 287 288 289 290 291 292 293 294 295 296 297 298 299 300 301 302 303 304 305 306 307 308 309 310 311 312 313 314 315 316 317 318 319 320 321 322 323 324 325 326 327 328 329 330 331 332 333 334 335 336 337 338 339 340 341 342 343 344 345 346 347 348 349 350 351 352 353 354 355 356 357 358 359 360 361 362 363 364 365 366 367 368 369 370 371 372 373 374 375 376 377 378 379 380 381 382 383 384 385 386 387 388 389 390 391 392 393 394 395 396 397 398 399 400 401 402 403 404 405 406 407 408 409 410 411 412 413 cmdself=$0 linux=&#34;linux-4.4.232&#34;; # linux=&#34;linux-4.4.76&#34;; busybox=&#34;busybox-1.32.0&#34;; uboot=&#34;u-boot-2017.05&#34; # uboot=&#34;u-boot-2020.07&#34; file_linux=&#34;${linux}.tar.xz&#34;; file_busybox=&#34;${busybox}.tar.bz2&#34;; file_uboot=&#34;${uboot}.tar.bz2&#34; work_dir_name=&#34;yenao_qemu_test&#34;; work_dir=&#34;${HOME}/${work_dir_name}&#34;; Operate_Net_File=&#34;/etc/network/interfaces&#34; uboot_config_file=&#34;${work_dir}/${uboot}/include/configs/vexpress_common.h&#34; mkdir -p ${work_dir}; cd ${work_dir}; cpu_cores=$(nproc) jobs=$((cpu_cores * 2)) package_array=(gcc-arm-linux-gnueabi python-dev qemu qemu-kvm libvirt-bin bridge-utils virt-manager uml-utilities bridge-utils u-boot-tools ed tftp-hpa tftpd-hpa xinetd nfs-kernel-server device-tree-compiler) # gcc-arm-linux-gnueabi 交叉编译工具链与 gcc-multilib 不能共存，因此如果电脑之前有安装并且需要 gcc-multilib 的话，可以再运行完脚本后重新安装 gcc-multilib package_array_size=${#package_array[@]} for ((i = 0; i &lt; package_array_size; i++)) do # 软件安装 if [ ! &#34;$(apt list --installed | grep -wo &#34;${package_array[${i}]}&#34; | head -n 1)&#34; = &#34;${package_array[${i}]}&#34; ]; then echo -e &#34;\\e[34m&#34; sudo apt-get install ${package_array[${i}]} -y echo -e &#34;\\e[0m&#34; if [ ! &#34;$(apt list --installed | grep -wo &#34;${package_array[${i}]}&#34; | head -n 1)&#34; = &#34;${package_array[${i}]}&#34; ]; then echo -e &#34;\\e[31m${package_array[${i}]} 未安装\\e[0m&#34; else echo -e &#34;\\e[32m${package_array[${i}]} 已安装\\e[0m&#34; fi\telse echo -e &#34;\\e[32m${package_array[${i}]} 已安装\\e[0m&#34; fi done\t# 配置/etc/default/tftpd-hpa sudo chmod 777 /etc/default/tftpd-hpa; cat /etc/default/tftpd-hpa &gt; /etc/default/tftpd-hpa sudo chown ${USER}:${USER} -R /etc/default/tftpd-hpa echo &#39;TFTP_USERNAME=&#34;tftp&#34;&#39; &gt;&gt; /etc/default/tftpd-hpa echo &#34;TFTP_DIRECTORY=\\&#34;/tftpboot\\&#34;&#34; &gt;&gt; /etc/default/tftpd-hpa # echo &#34;TFTP_DIRECTORY=\\&#34;/tftpboot /tftpboot/${work_dir_name}\\&#34;&#34; &gt;&gt; /etc/default/tftpd-hpa echo &#39;TFTP_ADDRESS=&#34;0.0.0.0:69&#34;&#39; &gt;&gt; /etc/default/tftpd-hpa echo &#39;TFTP_OPTIONS=&#34;-l -c -s&#34;&#39; &gt;&gt; /etc/default/tftpd-hpa # 如果要设置多个目录就不能添加&#34;-s&#34;选项 # echo &#39;TFTP_OPTIONS=&#34;-l -c&#34;&#39; &gt;&gt; /etc/default/tftpd-hpa sudo chown root:root -R /etc/default/tftpd-hpa # 判断/tftpboot是否存在 if [ -d &#34;/tftpboot/&#34; ]; then echo &#34;tftpboot exists.&#34;; tftpboot_access=$(stat /tftpboot/ | grep -w &#34;Uid&#34; | tr &#39;(&#39; &#39; &#39; | tr &#39;/&#39; &#39; &#39; | awk &#39;{print $2}&#39;) if [ &#34;$tftpboot_access&#34; != &#34;0777&#34; ]; then sudo chmod 777 /tftpboot; echo &#34;/tftpboot的权限已设置为0777&#34; fi else sudo mkdir /tftpboot; sudo chmod 777 /tftpboot; echo &#34;/tftpboot的权限已设置为0777&#34; fi # 判断/tftpboot/${work_dir_name}是否存在，想要配置多个文件夹的话可以取消注释 # if [ -d &#34;/tftpboot/${work_dir_name}&#34; ]; then # echo &#34;tftpboot/${work_dir_name} exists.&#34;; # work_dir_name_access=$(stat /tftpboot/ | grep -w &#34;Uid&#34; | tr &#39;(&#39; &#39; &#39; | tr &#39;/&#39; &#39; &#39; | awk &#39;{print $2}&#39;) # if [ &#34;$work_dir_name_access&#34; != &#34;0777&#34; ]; then # sudo chmod 777 /tftpboot/${work_dir_name}; # echo &#34;/tftpboot/${work_dir_name}的权限已设置为0777&#34; # fi # else # sudo mkdir /tftpboot/${work_dir_name}; # sudo chmod 777 /tftpboot/${work_dir_name}; # echo &#34;/tftpboot/${work_dir_name}的权限已设置为0777&#34; # fi # 允许开发板通过NFS访问Ubuntu的/home/${USER}目录，当然你可以加其他目录 result=$(grep -w &#34;${work_dir} \\*(rw,nohide,insecure,no_subtree_check,async,no_root_squash)&#34; /etc/exports | grep -v &#34;#&#34;) if [ $? -eq 0 ]; then # 查找并注释匹配行 # sudo sed -i &#34;s/${work_dir} \\*(rw,nohide,insecure,no_subtree_check,async,no_root_squash)/#\\/home\\/${USER} \\*(rw,nohide,insecure,no_subtree_check,async,no_root_squash)/g&#34; /etc/exports # echo &#34;已注释匹配行：$result&#34; sudo /etc/init.d/nfs-kernel-server restart echo &#34;匹配行已存在，并且重启了nfs服务&#34; else power=$(ls -l /etc/exports | awk &#39;{print $4}&#39;) if [ &#34;$power&#34; == &#34;root&#34; ]; then sudo chown ${USER}:${USER} -R /etc/exports echo &#34;${work_dir} *(rw,nohide,insecure,no_subtree_check,async,no_root_squash)&#34; &gt;&gt; /etc/exports sudo chown root:root -R /etc/exports else echo &#34;${work_dir} *(rw,nohide,insecure,no_subtree_check,async,no_root_squash)&#34; &gt;&gt; /etc/exports sudo chown root:root -R /etc/exports fi sudo /etc/init.d/nfs-kernel-server restart echo &#34;匹配行已添加，并且重启了nfs服务&#34; fi # 判断linux内核是否准备好 while true; do result=$(curl ipinfo.io | grep &#34;country&#34; | tr &#39;&#34;&#39; &#39; &#39; | awk &#39;{print $3}&#39;) if [ -z &#34;${result}&#34; ]; then continue else echo -e &#34;\\e[32mcountry: ${result}\\e[0m&#34; break fi done while true; do if [ ! -f &#34;${work_dir}/$file_linux&#34; ]; then\techo -e &#34;\\e[32m&#34; if [ ${result} != &#34;CN&#34; ]; then\t# wget https://cdn.kernel.org/pub/linux/kernel/v4.x/linux-4.4.232.tar.xz wget https://cdn.kernel.org/pub/linux/kernel/v4.x/${file_linux} else # wget https://mirrors.ustc.edu.cn/kernel.org/linux/kernel/v4.x/linux-4.4.232.tar.xz wget https://mirrors.ustc.edu.cn/kernel.org/linux/kernel/v4.x/${file_linux} fi else if [ &#34;$(sha256sum ${file_linux})&#34; != &#34;4eae8865deaf03f0d13bf5056e258d451a468cabc5158757b247b0e43518fd34 ${file_linux}&#34; ]; then rm -rf ${file_linux} continue else echo -e &#34;\\e[32m${file_linux} 已下载\\e[0m&#34; break; fi fi echo -e &#34;\\e[0m&#34; done # 判断busybox文件是否准备好 while true; do if [ ! -f &#34;${work_dir}/$file_busybox&#34; ]; then echo -e &#34;\\e[33m&#34; # wget --no-check-certificate https://busybox.net/downloads/busybox-1.32.0.tar.bz2 wget --no-check-certificate https://busybox.net/downloads/${file_busybox} echo -e &#34;\\e[0m&#34; else if [ &#34;$(sha256sum ${file_busybox})&#34; != &#34;c35d87f1d04b2b153d33c275c2632e40d388a88f19a9e71727e0bbbff51fe689 ${file_busybox}&#34; ]; then rm -rf ${file_busybo} continue else echo -e &#34;\\e[32m$file_busybox 已下载\\e[0m&#34; break; fi fi\tdone # 判断u-boot文件是否准备好 while true; do if [ ! -f &#34;${work_dir}/$file_uboot&#34; ]; then echo -e &#34;\\e[34m&#34; # wget --no-check-certificate https://ftp.denx.de/pub/u-boot/u-boot-2017.05.tar.bz2 # wget --no-check-certificate https://ftp.denx.de/pub/u-boot/u-boot-2020.07.tar.bz2 wget --no-check-certificate https://ftp.denx.de/pub/u-boot/${file_uboot} echo -e &#34;\\e[0m&#34; else if [ &#34;$(sha256sum ${file_uboot})&#34; != &#34;c8373949d7f0de1059e507b83a655d4cea539f75dc66ccdbb27adbd38d83095e u-boot-2017.05.tar.bz2&#34; ]; then rm -rf ${file_uboot} continue else echo -e &#34;\\e[32m$file_uboot 已下载\\e[0m&#34; break fi fi done # 临时配置交叉编译环境 export ARCH=arm &amp;&amp; export CROSS_COMPILE=arm-linux-gnueabi-; # 判断linux内核是否解压 echo -e &#34;\\e[32m&#34; # kernel if [ -d &#34;${work_dir}/$linux&#34; ]; then echo &#34;$linux exists.&#34; else tar xvf ${work_dir}/$file_linux -C ${work_dir}; fi echo -e &#34;\\e[0m&#34; # 判断busybox文件是否解压 echo -e &#34;\\e[33m&#34; if [ -d &#34;${work_dir}/$busybox&#34; ]; then echo &#34;$busybox exists.&#34; else tar xvf ${work_dir}/$file_busybox -C ${work_dir}; fi echo -e &#34;\\e[0m&#34; # 判断u-boot文件是否解压 echo -e &#34;\\e[34m&#34; if [ -d &#34;${work_dir}/${uboot}&#34; ]; then echo &#34;$uboot exists.&#34; else tar xvf ${work_dir}/$file_uboot -C ${work_dir}; if [ -f &#34;${work_dir}/${uboot}/include/configs/vexpress_common.h&#34; ]; then cp ${uboot_config_file} ${uboot_config_file}.old fi fi echo -e &#34;\\e[0m&#34; # 编译linux内核 echo -e &#34;\\e[32m&#34; cd ${work_dir}/${linux}; make distclean -j${jobs}; make vexpress_defconfig -j${jobs}; make zImage -j${jobs}; make modules -j${jobs}; make LOADADDR=0x60003000 uImage -j${jobs}; make dtbs -j${jobs}; # mkimage -n &#39;mini2440&#39; -A arm -O linux -T kernel -C none -a 0x30008000 -e 0x30008040 -d ${work_dir}/$linux/arch/arm/boot/zImage ${work_dir}/$linux/arch/arm/boot/uImage echo -e &#34;\\e[0m&#34; # 编译busybox，编译之后把&#34;${busybox}/_install/*&#34;拷贝到rootfs目录下 echo -e &#34;\\e[33m&#34; cd ${work_dir}/${busybox}; make distclean -j${jobs}; make defconfig -j${jobs}; make -j${jobs}; make install -j${jobs}; echo -e &#34;\\e[0m&#34; # 搭建网络开发环境 echo -e &#34;\\e[95m&#34; if [ ! -f &#34;$Operate_Net_File&#34; ]; then sudo touch ${Operate_Net_File} else echo &#34;${uboot_config_file} is exists.&#34; if [ ! -f &#34;$Operate_Net_File.old&#34; ]; then sudo cp ${Operate_Net_File} {$Operate_Net_File}.old else echo &#34;${Operate_Net_File}.old is exists.&#34; fi fi sudo chown ${USER}:${USER} ${Operate_Net_File} if [ ! &#34;$(cat /etc/network/interfaces | grep -o &#34;br0&#34; | head -n 1)&#34; = &#34;br0&#34; ]; then echo &#34;debug_1&#34; cat ${Operate_Net_File} &gt; ${Operate_Net_File} if [ &#34;$(ip addr | grep -o &#34;ens33&#34; | head -n 1)&#34; = &#34;ens33&#34; ]; then echo &#34;auto lo&#34; &gt;&gt; ${Operate_Net_File} echo &#34;iface lo inet loopback&#34; &gt;&gt; ${Operate_Net_File} echo &#34;&#34; &gt;&gt; ${Operate_Net_File} echo &#34;auto ens33&#34; &gt;&gt; ${Operate_Net_File} echo &#34;&#34; &gt;&gt; ${Operate_Net_File} echo &#34;auto br0&#34; &gt;&gt; ${Operate_Net_File} echo &#34;iface br0 inet dhcp&#34; &gt;&gt; ${Operate_Net_File} echo &#34;\tbridge_ports ens33&#34; &gt;&gt; ${Operate_Net_File} sudo chown ${root}:${root} ${Operate_Net_File} sudo /etc/init.d/networking restart else if [ &#34;$(ip addr | grep -o &#34;eth0&#34;)&#34; = &#34;eth0&#34; ]; then echo &#34;auto lo&#34; &gt;&gt; ${Operate_Net_File} echo &#34;iface lo inet loopback&#34; &gt;&gt; ${Operate_Net_File} echo &#34;&#34; &gt;&gt; ${Operate_Net_File} echo &#34;auto eth0&#34; &gt;&gt; ${Operate_Net_File} echo &#34;&#34; &gt;&gt; ${Operate_Net_File} echo &#34;auto br0&#34; &gt;&gt; ${Operate_Net_File} echo &#34;iface br0 inet dhcp&#34; &gt;&gt; ${Operate_Net_File} echo &#34;\tbridge_ports eth0&#34; &gt;&gt; ${Operate_Net_File}\tsudo /etc/init.d/networking restart fi fi else echo &#34;br0 exists.&#34; fi if [ &#34;$(ifconfig | grep -wo &#34;br0&#34;)&#34; = &#34;br0&#34; ]; then of_ip_var1=$(ifconfig | grep -w -A 1 &#34;br0&#34; | grep -v &#34;br0&#34; | awk &#39;$1==&#34;inet&#34; {print $2}&#39; | grep -oE &#34;\\b([0-9]{1,3}\\.){3}[0-9]{1,3}\\b&#34; | awk -F &#39;.&#39; &#39;{print $1}&#39;); echo ${of_ip_var1} of_ip_var2=$(ifconfig | grep -w -A 1 &#34;br0&#34; | grep -v &#34;br0&#34; | awk &#39;$1==&#34;inet&#34; {print $2}&#39; | grep -oE &#34;\\b([0-9]{1,3}\\.){3}[0-9]{1,3}\\b&#34; | awk -F &#39;.&#39; &#39;{print $2}&#39;); echo ${of_ip_var2} of_ip_var3=$(ifconfig | grep -w -A 1 &#34;br0&#34; | grep -v &#34;br0&#34; | awk &#39;$1==&#34;inet&#34; {print $2}&#39; | grep -oE &#34;\\b([0-9]{1,3}\\.){3}[0-9]{1,3}\\b&#34; | awk -F &#39;.&#39; &#39;{print $3}&#39;); echo ${of_ip_var3} of_ip_var4=$(ifconfig | grep -w -A 1 &#34;br0&#34; | grep -v &#34;br0&#34; | awk &#39;$1==&#34;inet&#34; {print $2}&#39; | grep -oE &#34;\\b([0-9]{1,3}\\.){3}[0-9]{1,3}\\b&#34; | awk -F &#39;.&#39; &#39;{print $4}&#39;); echo ${of_ip_var4} else echo &#34;The br0 not exists.&#34; fi sudo chown ${USER}:${USER} ${Operate_Net_File} if [ ! -f &#34;${uboot_config_file}.old&#34; ]; then cp ${uboot_config_file} ${uboot_config_file}.old else cat ${uboot_config_file}.old &gt; ${uboot_config_file} fi uboot_config_file_var1=$(grep -n &#34;\\/\\* Basic environment settings \\*\\/&#34; ${uboot_config_file}.old | tr &#39;:&#39; &#39; &#39; | awk &#39;{print $1}&#39;) uboot_config_file_var2=$((uboot_config_file_var1 + 1)) cat ${uboot_config_file}.old &gt; ${uboot_config_file} sed -i &#39;/CONFIG_BOOTCOMMAND\\b/d&#39; ${uboot_config_file} sed -i &#39;/run distro_bootcmd\\b/d&#39; ${uboot_config_file} sed -i &#39;/run bootflash\\b/d&#39; ${uboot_config_file} sed -i &#34;${uboot_config_file_var2}i\\#define CONFIG_SERVERIP ${of_ip_var1}.${of_ip_var2}.${of_ip_var3}.${of_ip_var4}&#34; ${uboot_config_file} sed -i &#34;${uboot_config_file_var2}i\\#define CONFIG_NETMASK 255.255.255.0&#34; ${uboot_config_file} sed -i &#34;${uboot_config_file_var2}i\\#define CONFIG_IPADDR ${of_ip_var1}.${of_ip_var2}.${of_ip_var3}.223&#34; ${uboot_config_file} sed -i &#34;${uboot_config_file_var2}i\\/* netmask */&#34; ${uboot_config_file} sed -i &#34;${uboot_config_file_var2}i\\#define CONFIG_BOOTCOMMAND \\&#34;tftp 0x60003000 uImage;tftp 0x60500000 vexpress-v2p-ca9.dtb;setenv bootargs &#39;root=/dev/mmcblk0 console=ttyAMA0&#39;;bootm 0x60003000 - 0x60500000;\\&#34; \\\\&#34; ${uboot_config_file} echo -e &#34;\\e[0m&#34; # 编译u-boot，编译之后会在${uboot}目录下出现u-boot，传真u-boot示例：sudo qemu-system-arm -M vexpress-a9 -m 256 -kernel ./u-boot -nographic echo -e &#34;\\e[34m&#34; cd ${work_dir}/${uboot}; make distclean -j${jobs}; make vexpress_ca9x4_defconfig -j${jobs}; make -j${jobs}; echo -e &#34;\\e[0m&#34; # 准备根文件系统 echo -e &#34;\\e[33m&#34; cd ${work_dir}; mkdir -p ${work_dir}/rootfs/{dev,etc/init.d,lib,mnt}; sudo cp -vrf ${work_dir}/${busybox}/_install/* ${work_dir}/rootfs/; sudo cp -vrf /usr/arm-linux-gnueabi/lib/* ${work_dir}/rootfs/lib/; cd ${work_dir}/rootfs/dev; # 创建字符设备类型的设备节点，这些设备节点的主设备号为4,次设备号为1..11 sudo mknod -m 666 console c 4 1; sudo mknod -m 666 null c 4 2; sudo mknod -m 666 tty1 c 4 3; sudo mknod -m 666 tty2 c 4 4; sudo mknod -m 666 tty3 c 4 5; sudo mknod -m 666 tty4 c 4 6; sudo mknod -m 666 tty5 c 4 7; sudo mknod -m 666 tty6 c 4 8; sudo mknod -m 666 tty7 c 4 9; sudo mknod -m 666 tty8 c 4 10; sudo mknod -m 666 tty9 c 4 11; # 在rootfs目录下准备挂载NFS脚本 sudo touch ${work_dir}/rootfs/mountNFS.sh sudo chown ${USER}:${USER} ${work_dir}/rootfs/mountNFS.sh cat ${work_dir}/rootfs/mountNFS.sh &gt; ${work_dir}/rootfs/mountNFS.sh echo &#34;ifconfig eth0 ${of_ip_var1}.${of_ip_var2}.${of_ip_var3}.223&#34; &gt;&gt; ${work_dir}/rootfs/mountNFS.sh echo &#34;mount -t nfs -o nolock ${of_ip_var1}.${of_ip_var2}.${of_ip_var3}.${of_ip_var4}:${work_dir} /mnt&#34; &gt;&gt; ${work_dir}/rootfs/mountNFS.sh sudo chown ${root}:${root} ${work_dir}/rootfs/mountNFS.sh # 进入qemu运行的虚拟机后通过以下命令运行脚本进行挂载nfs：&#34;sh mountNFS.sh&#34; cd ${work_dir}; # 制作rootfs.ext3，格式化rootfs.ext3为ext3文件系统类型，将rootfs.ext3挂载到/mnt，再将根文件系统拷贝到/mnt，然后解除/mnt挂载的rootfs.ext3，此时rootfs.ext3中已经有根文件系统了 sudo dd if=/dev/zero of=rootfs.ext3 bs=1M count=32 sudo mkfs.ext3 rootfs.ext3 sudo mount -t ext3 rootfs.ext3 /mnt -o loop sudo cp -vrf ${work_dir}/rootfs/* /mnt sudo umount /mnt echo -e &#34;\\e[0m&#34; # tftpboot echo -e &#34;\\e[96m&#34; # sudo chmod 775 $work_dir/$uboot/uImage; sudo rm -rf /tftpboot/* sudo cp -f ${work_dir}/${linux}/arch/arm/boot/zImage /tftpboot; sudo cp -f ${work_dir}/${linux}/arch/arm/boot/uImage /tftpboot; sudo cp -f ${work_dir}/${linux}/arch/arm/boot/dts/vexpress-v2p-ca9.dtb /tftpboot; sudo cp -f ${work_dir}/${uboot}/u-boot /tftpboot; sudo cp -f ${work_dir}/rootfs.ext3 /tftpboot; echo -e &#34;\\e[0m&#34; # QEMU运行虚拟机，通过sd卡加载linux内核 echo -e &#34;\\e[92m&#34; # qemu-system-arm -M vexpress-a9 -m 256M -kernel ${work_dir}/$linux/arch/arm/boot/zImage -dtb ${work_dir}/$linux/arch/arm/boot/dts/vexpress-v2p-ca9.dtb -nographic -append &#34;root=/dev/mmcblk0 rw console=ttyAMA0&#34; -sd ${work_dir}/rootfs.ext3; # 在脚本外部执行，进入yenao_qemu_test目录执行下面的语句 # qemu-system-arm -M vexpress-a9 -m 512M -kernel linux-4.4.232/arch/arm/boot/zImage -dtb linux-4.4.232/arch/arm/boot/dts/vexpress-v2p-ca9.dtb -nographic -append &#34;root=/dev/mmcblk0 rw console=ttyAMA0&#34; -sd rootfs.ext3 # QEMU运行虚拟机，只加载u-boot # qemu-system-arm -M vexpress-a9 -m 256M -kernel ${work_dir}/${uboot}/u-boot -nographic # 通过 u-boot 加载内核 # cd /tftpboot # sudo qemu-system-arm -M vexpress-a9 -kernel u-boot -nographic -m 128M -net nic,vlan=0 -net tap,vlan=0,ifname=tap0 -sd rootfs.ext3 if [ &#34;$1&#34; = &#34;sd&#34; ]; then # QEMU运行虚拟机，通过sd卡加载linux内核\tsudo qemu-system-arm -M vexpress-a9 -m 256M -kernel ${work_dir}/$linux/arch/arm/boot/zImage -dtb ${work_dir}/$linux/arch/arm/boot/dts/vexpress-v2p-ca9.dtb -nographic -append &#34;root=/dev/mmcblk0 rw console=ttyAMA0&#34; -sd ${work_dir}/rootfs.ext3;\telif [ &#34;$1&#34; = &#34;u-boot&#34; ]; then cd /tftpboot sudo qemu-system-arm -M vexpress-a9 -kernel u-boot -nographic -m 128M -net nic,vlan=0 -net tap,vlan=0,ifname=tap0 -sd rootfs.ext3 elif [ &#34;$1&#34; = &#34;help&#34; ]; then echo &#34;sd start: ${cmdself} sd&#34; echo &#34;u-boot start: ${cmdself} u-boot&#34; echo &#34;out sd start var: ${cmdself} out sd&#34; echo &#34;out u-boot start var: ${cmdself} out u-boot&#34; elif [ &#34;$1&#34; = &#34;out&#34; ] &amp;&amp; [ &#34;$2&#34; = &#34;sd&#34; ]; then echo &#34; qemu-system-arm -M vexpress-a9 -m 256M -kernel ${work_dir}/$linux/arch/arm/boot/zImage -dtb ${work_dir}/$linux/arch/arm/boot/dts/vexpress-v2p-ca9.dtb -nographic -append \\&#34;root=/dev/mmcblk0 rw console=ttyAMA0\\&#34; -sd ${work_dir}/rootfs.ext3;&#34; elif [ &#34;$1&#34; = &#34;out&#34; ] &amp;&amp; [ &#34;$2&#34; = &#34;u-boot&#34; ]; then echo &#34;sudo qemu-system-arm -M vexpress-a9 -kernel u-boot -nographic -m 128M -net nic,vlan=0 -net tap,vlan=0,ifname=tap0 -sd rootfs.ext3&#34; else # 默认通过u-boot加载linux内核 cd /tftpboot sudo qemu-system-arm -M vexpress-a9 -kernel u-boot -nographic -m 128M -net nic,vlan=0 -net tap,vlan=0,ifname=tap0 -sd rootfs.ext3 fi echo -e &#34;\\e[0m&#34; # 部分参数说明 # |----------------------------------------------------------------+--------------------------------------------------------------------------------------| # | 参数 | 含义 | # |----------------------------------------------------------------+--------------------------------------------------------------------------------------| # | M vexpress-a9` | 指定虚拟机的机型为 `vexpress-a9`，即使用 ARMv7 架构的 Versatile Express 开发板模型。 | # |----------------------------------------------------------------+--------------------------------------------------------------------------------------| # | m 512M` | 设置虚拟机的内存大小为 512MB。 | # |----------------------------------------------------------------+--------------------------------------------------------------------------------------| # | kernel ${work_dir}/$linux/arch/arm/boot/zImage` | 指定 Linux 内核镜像的路径和文件名。 | # |----------------------------------------------------------------+--------------------------------------------------------------------------------------| # | dtb ${work_dir}/$linux/arch/arm/boot/dts/vexpress-v2p-ca9.dtb` | 指定设备树二进制文件（Device Tree Blob）的路径和文件名。 | # |----------------------------------------------------------------+--------------------------------------------------------------------------------------| # | nographic` | 以无图形界面的方式运行虚拟机。 | # |----------------------------------------------------------------+--------------------------------------------------------------------------------------| # | append &#34;root=/dev/mmcblk0 rw console=ttyAMA0&#34;` | 指定 Linux 内核启动参数，包括根文件系统的设备路径、读写权限和控制台终端。 | # |----------------------------------------------------------------+--------------------------------------------------------------------------------------| # | sd ${work_dir}/rootfs.ext3` | 指定虚拟机的根文件系统镜像路径和文件名。 | # |----------------------------------------------------------------+--------------------------------------------------------------------------------------| 挂载NFS文件系统流程，待实现 1 2 3 4 5 6 7 8 9 10 11 12 13 export ARCH=arm CROSS_COMPILE=arm-linux-gnueabi-; make vexpress_ca9x4_defconfig; make -j12 setenv ipaddr 192.168.1.223; setenv serverip 192.168.1.100; tftp 0x60003000 uImage; tftp 0x60500000 vexpress-v2p-ca9.dtb; setenv bootargs &#39;root=/dev/nfs rw nfsroot=192.168.1.100:/home/ubt init=/linuxrc ip=192.168.1.223 console=ttyAMA0&#39;; bootm 0x60003000 - 0x60500000; 所需资源下载 linux-4.4.232.tar.xz\n">
    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="切换菜单">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/avatar_hu_f509edb42ecc0ebd.png" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">🍥</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">ynhugo</a></h1>
            <h2 class="site-description">ynhugo.github.io</h2>
        </div>
    </header><ol class="menu-social">
            
                <li>
                    <a 
                        href='https://github.com/CaiJimmy/hugo-theme-stack'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://x.com'
                        target="_blank"
                        title="x"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M22 4.01c-1 .49 -1.98 .689 -3 .99c-1.121 -1.265 -2.783 -1.335 -4.38 -.737s-2.643 2.06 -2.62 3.737v1c-3.245 .083 -6.135 -1.395 -8 -4c0 0 -4.182 7.433 4 11c-1.872 1.247 -3.739 2.088 -6 2c3.308 1.803 6.913 2.423 10.034 1.517c3.58 -1.04 6.522 -3.723 7.651 -7.742a13.84 13.84 0 0 0 .497 -3.753c-.002 -.249 1.51 -2.772 1.818 -4.013z" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>主页</span>
            </a>
        </li>
        
        
        <li >
            <a href='/book/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 512 512" fill="none" stroke="#808080" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <path d="m443.6,11h-321c-35.4,0-64.6,26.1-64.6,59.4v371.1c0,33.4 26.1,59.4 59.4,59.4h326.2c6.3,0 10.4-4.2 10.4-11.5v-468c0-6.2-4.2-10.4-10.4-10.4zm-321,20.9h310.5v350.3h-315.7c-14.9,0-28.3,5.2-38.6,13.9v-325.7c-1.42109e-14-21.9 19.8-38.5 43.8-38.5zm310.6,449.3h-315.8c-21.9,0-38.6-16.7-38.6-38.6 0-21.9 17.7-38.6 38.6-38.6l315.8,.1v77.1z"/>
</svg>
                
                <span>Book</span>
            </a>
        </li>
        
        
        <li >
            <a href='/%E5%85%B3%E4%BA%8E/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>关于</span>
            </a>
        </li>
        
        
        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>Archives</span>
            </a>
        </li>
        
        
        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>Search</span>
            </a>
        </li>
        
        
        <li >
            <a href='/links/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                
                <span>Links</span>
            </a>
        </li>
        
        <li class="menu-bottom-section">
            <ol class="menu">
                    
                        <li id="i18n-switch">  
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M4 5h7" />
  <path d="M9 3v2c0 4.418 -2.239 8 -5 8" />
  <path d="M5 9c-.003 2.144 2.952 3.908 6.7 4" />
  <path d="M12 20l4 -9l4 9" />
  <path d="M19.1 18h-6.2" />
</svg>



                            <select name="language" title="language" onchange="window.location.href = this.selectedOptions[0].value">
                                
                                    <option value="https://ynhugo.github.io/en/" >English</option>
                                
                                    <option value="https://ynhugo.github.io/" selected>中文</option>
                                
                                    <option value="https://ynhugo.github.io/ar/" >عربي</option>
                                
                            </select>
                        </li>
                    
                

                
                    <li id="dark-mode-toggle">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <span>暗色模式</span>
                    </li>
                
            </ol>
        </li>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">目录</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
<ul>
<li><a href="#headline-1">使用qemu搭建arm嵌入式linux开发环境</a>
<ul>
<li><a href="#headline-2">使用说明</a>
</li>
<li><a href="#headline-3">搭建脚本</a>
<ul>
<li><a href="#headline-4">调试启动脚本</a>
<ul>
<li><a href="#headline-5">挂载NFS文件系统流程，待实现</a>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#headline-6">所需资源下载</a>
</li>
<li><a href="#headline-7">综合调试 org 脚本</a>
<ul>
<li><a href="#headline-8">综合调试启动</a>
</li>
<li><a href="#headline-9">内核编译</a>
</li>
<li><a href="#headline-10">busybox 编译</a>
<ul>
<li><a href="#headline-11">rootfs</a>
</li>
</ul>
</li>
<li><a href="#headline-12">u-boot 编译</a>
<ul>
<li><a href="#headline-13">搭建网络开发环境</a>
</li>
</ul>
</li>
<li><a href="#headline-14">启动</a>
</li>
<li><a href="#headline-15">开发环境</a>
</li>
<li><a href="#headline-16">qemu_ts</a>
</li>
</ul>
</li>
<li><a href="#headline-17">参考链接</a>
</li>
</ul>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="main-article">
    <header class="article-header">

    <div class="article-details">
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/p/%E4%BD%BF%E7%94%A8qemu%E6%90%AD%E5%BB%BAarm%E5%B5%8C%E5%85%A5%E5%BC%8Flinux%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/">使用qemu搭建arm嵌入式linux开发环境</a>
        </h2>
    
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">Sep 14, 2023</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    阅读时长: 31 分钟
                </time>
            </div>
        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    
<div id="outline-container-headline-1" class="outline-2">
<h2 id="headline-1">
使用qemu搭建arm嵌入式linux开发环境
</h2>
<div id="outline-text-headline-1" class="outline-text-2">
<div id="outline-container-headline-2" class="outline-3">
<h3 id="headline-2">
使用说明
</h3>
<div id="outline-text-headline-2" class="outline-text-3">
<p>
该脚本只有在第一次运行的时候需要构建环境，花费时间长一些，构建完成以后自动启动环境，以后再运行该脚本的时候就不需要再次构建环境了，加载后进入开发环境，敲回车确认。</p>
<p>
退出时先按快捷键&#34;Ctrl+x&#34;，再按&#34;x&#34;即可退出环境。</p>
</div>
</div>
<div id="outline-container-headline-3" class="outline-3">
<h3 id="headline-3">
搭建脚本
</h3>
<div id="outline-text-headline-3" class="outline-text-3">
<div id="outline-container-headline-4" class="outline-4">
<h4 id="headline-4">
调试启动脚本
</h4>
<div id="outline-text-headline-4" class="outline-text-4">
<p>
推荐使用这个脚本，从头到尾自动化完成</p>
<div class="src src-bash">
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span><span class="lnt">202
</span><span class="lnt">203
</span><span class="lnt">204
</span><span class="lnt">205
</span><span class="lnt">206
</span><span class="lnt">207
</span><span class="lnt">208
</span><span class="lnt">209
</span><span class="lnt">210
</span><span class="lnt">211
</span><span class="lnt">212
</span><span class="lnt">213
</span><span class="lnt">214
</span><span class="lnt">215
</span><span class="lnt">216
</span><span class="lnt">217
</span><span class="lnt">218
</span><span class="lnt">219
</span><span class="lnt">220
</span><span class="lnt">221
</span><span class="lnt">222
</span><span class="lnt">223
</span><span class="lnt">224
</span><span class="lnt">225
</span><span class="lnt">226
</span><span class="lnt">227
</span><span class="lnt">228
</span><span class="lnt">229
</span><span class="lnt">230
</span><span class="lnt">231
</span><span class="lnt">232
</span><span class="lnt">233
</span><span class="lnt">234
</span><span class="lnt">235
</span><span class="lnt">236
</span><span class="lnt">237
</span><span class="lnt">238
</span><span class="lnt">239
</span><span class="lnt">240
</span><span class="lnt">241
</span><span class="lnt">242
</span><span class="lnt">243
</span><span class="lnt">244
</span><span class="lnt">245
</span><span class="lnt">246
</span><span class="lnt">247
</span><span class="lnt">248
</span><span class="lnt">249
</span><span class="lnt">250
</span><span class="lnt">251
</span><span class="lnt">252
</span><span class="lnt">253
</span><span class="lnt">254
</span><span class="lnt">255
</span><span class="lnt">256
</span><span class="lnt">257
</span><span class="lnt">258
</span><span class="lnt">259
</span><span class="lnt">260
</span><span class="lnt">261
</span><span class="lnt">262
</span><span class="lnt">263
</span><span class="lnt">264
</span><span class="lnt">265
</span><span class="lnt">266
</span><span class="lnt">267
</span><span class="lnt">268
</span><span class="lnt">269
</span><span class="lnt">270
</span><span class="lnt">271
</span><span class="lnt">272
</span><span class="lnt">273
</span><span class="lnt">274
</span><span class="lnt">275
</span><span class="lnt">276
</span><span class="lnt">277
</span><span class="lnt">278
</span><span class="lnt">279
</span><span class="lnt">280
</span><span class="lnt">281
</span><span class="lnt">282
</span><span class="lnt">283
</span><span class="lnt">284
</span><span class="lnt">285
</span><span class="lnt">286
</span><span class="lnt">287
</span><span class="lnt">288
</span><span class="lnt">289
</span><span class="lnt">290
</span><span class="lnt">291
</span><span class="lnt">292
</span><span class="lnt">293
</span><span class="lnt">294
</span><span class="lnt">295
</span><span class="lnt">296
</span><span class="lnt">297
</span><span class="lnt">298
</span><span class="lnt">299
</span><span class="lnt">300
</span><span class="lnt">301
</span><span class="lnt">302
</span><span class="lnt">303
</span><span class="lnt">304
</span><span class="lnt">305
</span><span class="lnt">306
</span><span class="lnt">307
</span><span class="lnt">308
</span><span class="lnt">309
</span><span class="lnt">310
</span><span class="lnt">311
</span><span class="lnt">312
</span><span class="lnt">313
</span><span class="lnt">314
</span><span class="lnt">315
</span><span class="lnt">316
</span><span class="lnt">317
</span><span class="lnt">318
</span><span class="lnt">319
</span><span class="lnt">320
</span><span class="lnt">321
</span><span class="lnt">322
</span><span class="lnt">323
</span><span class="lnt">324
</span><span class="lnt">325
</span><span class="lnt">326
</span><span class="lnt">327
</span><span class="lnt">328
</span><span class="lnt">329
</span><span class="lnt">330
</span><span class="lnt">331
</span><span class="lnt">332
</span><span class="lnt">333
</span><span class="lnt">334
</span><span class="lnt">335
</span><span class="lnt">336
</span><span class="lnt">337
</span><span class="lnt">338
</span><span class="lnt">339
</span><span class="lnt">340
</span><span class="lnt">341
</span><span class="lnt">342
</span><span class="lnt">343
</span><span class="lnt">344
</span><span class="lnt">345
</span><span class="lnt">346
</span><span class="lnt">347
</span><span class="lnt">348
</span><span class="lnt">349
</span><span class="lnt">350
</span><span class="lnt">351
</span><span class="lnt">352
</span><span class="lnt">353
</span><span class="lnt">354
</span><span class="lnt">355
</span><span class="lnt">356
</span><span class="lnt">357
</span><span class="lnt">358
</span><span class="lnt">359
</span><span class="lnt">360
</span><span class="lnt">361
</span><span class="lnt">362
</span><span class="lnt">363
</span><span class="lnt">364
</span><span class="lnt">365
</span><span class="lnt">366
</span><span class="lnt">367
</span><span class="lnt">368
</span><span class="lnt">369
</span><span class="lnt">370
</span><span class="lnt">371
</span><span class="lnt">372
</span><span class="lnt">373
</span><span class="lnt">374
</span><span class="lnt">375
</span><span class="lnt">376
</span><span class="lnt">377
</span><span class="lnt">378
</span><span class="lnt">379
</span><span class="lnt">380
</span><span class="lnt">381
</span><span class="lnt">382
</span><span class="lnt">383
</span><span class="lnt">384
</span><span class="lnt">385
</span><span class="lnt">386
</span><span class="lnt">387
</span><span class="lnt">388
</span><span class="lnt">389
</span><span class="lnt">390
</span><span class="lnt">391
</span><span class="lnt">392
</span><span class="lnt">393
</span><span class="lnt">394
</span><span class="lnt">395
</span><span class="lnt">396
</span><span class="lnt">397
</span><span class="lnt">398
</span><span class="lnt">399
</span><span class="lnt">400
</span><span class="lnt">401
</span><span class="lnt">402
</span><span class="lnt">403
</span><span class="lnt">404
</span><span class="lnt">405
</span><span class="lnt">406
</span><span class="lnt">407
</span><span class="lnt">408
</span><span class="lnt">409
</span><span class="lnt">410
</span><span class="lnt">411
</span><span class="lnt">412
</span><span class="lnt">413
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">  <span class="nv">cmdself</span><span class="o">=</span><span class="nv">$0</span>
</span></span><span class="line"><span class="cl">  <span class="nv">linux</span><span class="o">=</span><span class="s2">&#34;linux-4.4.232&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># linux=&#34;linux-4.4.76&#34;;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">busybox</span><span class="o">=</span><span class="s2">&#34;busybox-1.32.0&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">uboot</span><span class="o">=</span><span class="s2">&#34;u-boot-2017.05&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># uboot=&#34;u-boot-2020.07&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">file_linux</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">linux</span><span class="si">}</span><span class="s2">.tar.xz&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">file_busybox</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">busybox</span><span class="si">}</span><span class="s2">.tar.bz2&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">file_uboot</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">uboot</span><span class="si">}</span><span class="s2">.tar.bz2&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">work_dir_name</span><span class="o">=</span><span class="s2">&#34;yenao_qemu_test&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">work_dir</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span><span class="s2">/</span><span class="si">${</span><span class="nv">work_dir_name</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">Operate_Net_File</span><span class="o">=</span><span class="s2">&#34;/etc/network/interfaces&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">uboot_config_file</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span><span class="s2">/</span><span class="si">${</span><span class="nv">uboot</span><span class="si">}</span><span class="s2">/include/configs/vexpress_common.h&#34;</span>
</span></span><span class="line"><span class="cl">  mkdir -p <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nb">cd</span> <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">cpu_cores</span><span class="o">=</span><span class="k">$(</span>nproc<span class="k">)</span>
</span></span><span class="line"><span class="cl">  <span class="nv">jobs</span><span class="o">=</span><span class="k">$((</span>cpu_cores <span class="o">*</span> <span class="m">2</span><span class="k">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nv">package_array</span><span class="o">=(</span>gcc-arm-linux-gnueabi  python-dev  qemu  qemu-kvm  libvirt-bin  bridge-utils  virt-manager  uml-utilities  bridge-utils  u-boot-tools  ed  tftp-hpa  tftpd-hpa  xinetd  nfs-kernel-server  device-tree-compiler<span class="o">)</span> <span class="c1"># gcc-arm-linux-gnueabi 交叉编译工具链与 gcc-multilib 不能共存，因此如果电脑之前有安装并且需要 gcc-multilib 的话，可以再运行完脚本后重新安装 gcc-multilib</span>
</span></span><span class="line"><span class="cl">  <span class="nv">package_array_size</span><span class="o">=</span><span class="si">${#</span><span class="nv">package_array</span><span class="p">[@]</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="o">((</span><span class="nv">i</span> <span class="o">=</span> 0<span class="p">;</span> i &lt; package_array_size<span class="p">;</span> i++<span class="o">))</span>
</span></span><span class="line"><span class="cl">  <span class="k">do</span>
</span></span><span class="line"><span class="cl">	  <span class="c1"># 软件安装</span>
</span></span><span class="line"><span class="cl">	  <span class="k">if</span> <span class="o">[</span> ! <span class="s2">&#34;</span><span class="k">$(</span>apt list --installed <span class="p">|</span> grep -wo <span class="s2">&#34;</span><span class="si">${</span><span class="nv">package_array</span><span class="p">[</span><span class="si">${</span><span class="nv">i</span><span class="si">}</span><span class="p">]</span><span class="si">}</span><span class="s2">&#34;</span> <span class="p">|</span> head -n 1<span class="k">)</span><span class="s2">&#34;</span> <span class="o">=</span> <span class="s2">&#34;</span><span class="si">${</span><span class="nv">package_array</span><span class="p">[</span><span class="si">${</span><span class="nv">i</span><span class="si">}</span><span class="p">]</span><span class="si">}</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">		  <span class="nb">echo</span> -e <span class="s2">&#34;\e[34m&#34;</span>
</span></span><span class="line"><span class="cl">		  sudo apt-get install <span class="si">${</span><span class="nv">package_array</span><span class="p">[</span><span class="si">${</span><span class="nv">i</span><span class="si">}</span><span class="p">]</span><span class="si">}</span> -y
</span></span><span class="line"><span class="cl">		  <span class="nb">echo</span> -e <span class="s2">&#34;\e[0m&#34;</span>
</span></span><span class="line"><span class="cl">		  <span class="k">if</span> <span class="o">[</span> ! <span class="s2">&#34;</span><span class="k">$(</span>apt list --installed <span class="p">|</span> grep -wo <span class="s2">&#34;</span><span class="si">${</span><span class="nv">package_array</span><span class="p">[</span><span class="si">${</span><span class="nv">i</span><span class="si">}</span><span class="p">]</span><span class="si">}</span><span class="s2">&#34;</span> <span class="p">|</span> head -n 1<span class="k">)</span><span class="s2">&#34;</span> <span class="o">=</span> <span class="s2">&#34;</span><span class="si">${</span><span class="nv">package_array</span><span class="p">[</span><span class="si">${</span><span class="nv">i</span><span class="si">}</span><span class="p">]</span><span class="si">}</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">			  <span class="nb">echo</span> -e <span class="s2">&#34;\e[31m</span><span class="si">${</span><span class="nv">package_array</span><span class="p">[</span><span class="si">${</span><span class="nv">i</span><span class="si">}</span><span class="p">]</span><span class="si">}</span><span class="s2"> 未安装\e[0m&#34;</span>
</span></span><span class="line"><span class="cl">		  <span class="k">else</span>
</span></span><span class="line"><span class="cl">			  <span class="nb">echo</span> -e <span class="s2">&#34;\e[32m</span><span class="si">${</span><span class="nv">package_array</span><span class="p">[</span><span class="si">${</span><span class="nv">i</span><span class="si">}</span><span class="p">]</span><span class="si">}</span><span class="s2"> 已安装\e[0m&#34;</span>
</span></span><span class="line"><span class="cl">		  <span class="k">fi</span>		  
</span></span><span class="line"><span class="cl">	  <span class="k">else</span>
</span></span><span class="line"><span class="cl">		  <span class="nb">echo</span> -e <span class="s2">&#34;\e[32m</span><span class="si">${</span><span class="nv">package_array</span><span class="p">[</span><span class="si">${</span><span class="nv">i</span><span class="si">}</span><span class="p">]</span><span class="si">}</span><span class="s2"> 已安装\e[0m&#34;</span>
</span></span><span class="line"><span class="cl">	  <span class="k">fi</span>
</span></span><span class="line"><span class="cl">  <span class="k">done</span>	
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1"># 配置/etc/default/tftpd-hpa</span>
</span></span><span class="line"><span class="cl">  sudo chmod <span class="m">777</span> /etc/default/tftpd-hpa<span class="p">;</span>
</span></span><span class="line"><span class="cl">  cat /etc/default/tftpd-hpa &gt; /etc/default/tftpd-hpa
</span></span><span class="line"><span class="cl">  sudo chown <span class="si">${</span><span class="nv">USER</span><span class="si">}</span>:<span class="si">${</span><span class="nv">USER</span><span class="si">}</span> -R /etc/default/tftpd-hpa
</span></span><span class="line"><span class="cl">  <span class="nb">echo</span> <span class="s1">&#39;TFTP_USERNAME=&#34;tftp&#34;&#39;</span> &gt;&gt; /etc/default/tftpd-hpa
</span></span><span class="line"><span class="cl">  <span class="nb">echo</span> <span class="s2">&#34;TFTP_DIRECTORY=\&#34;/tftpboot\&#34;&#34;</span> &gt;&gt; /etc/default/tftpd-hpa
</span></span><span class="line"><span class="cl">  <span class="c1"># echo &#34;TFTP_DIRECTORY=\&#34;/tftpboot /tftpboot/${work_dir_name}\&#34;&#34; &gt;&gt; /etc/default/tftpd-hpa</span>
</span></span><span class="line"><span class="cl">  <span class="nb">echo</span> <span class="s1">&#39;TFTP_ADDRESS=&#34;0.0.0.0:69&#34;&#39;</span> &gt;&gt; /etc/default/tftpd-hpa
</span></span><span class="line"><span class="cl">  <span class="nb">echo</span> <span class="s1">&#39;TFTP_OPTIONS=&#34;-l -c -s&#34;&#39;</span> &gt;&gt; /etc/default/tftpd-hpa <span class="c1"># 如果要设置多个目录就不能添加&#34;-s&#34;选项</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># echo &#39;TFTP_OPTIONS=&#34;-l -c&#34;&#39; &gt;&gt; /etc/default/tftpd-hpa</span>
</span></span><span class="line"><span class="cl">  sudo chown root:root -R /etc/default/tftpd-hpa
</span></span><span class="line"><span class="cl">  <span class="c1"># 判断/tftpboot是否存在</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="o">[</span> -d <span class="s2">&#34;/tftpboot/&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">	  <span class="nb">echo</span> <span class="s2">&#34;tftpboot exists.&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	  <span class="nv">tftpboot_access</span><span class="o">=</span><span class="k">$(</span>stat /tftpboot/ <span class="p">|</span> grep -w <span class="s2">&#34;Uid&#34;</span> <span class="p">|</span> tr <span class="s1">&#39;(&#39;</span> <span class="s1">&#39; &#39;</span> <span class="p">|</span> tr <span class="s1">&#39;/&#39;</span> <span class="s1">&#39; &#39;</span> <span class="p">|</span> awk <span class="s1">&#39;{print $2}&#39;</span><span class="k">)</span>
</span></span><span class="line"><span class="cl">	  <span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$tftpboot_access</span><span class="s2">&#34;</span> !<span class="o">=</span> <span class="s2">&#34;0777&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">		  sudo chmod <span class="m">777</span> /tftpboot<span class="p">;</span>
</span></span><span class="line"><span class="cl">		  <span class="nb">echo</span> <span class="s2">&#34;/tftpboot的权限已设置为0777&#34;</span>
</span></span><span class="line"><span class="cl">	  <span class="k">fi</span>
</span></span><span class="line"><span class="cl">  <span class="k">else</span>
</span></span><span class="line"><span class="cl">	  sudo mkdir /tftpboot<span class="p">;</span>
</span></span><span class="line"><span class="cl">	  sudo chmod <span class="m">777</span> /tftpboot<span class="p">;</span>
</span></span><span class="line"><span class="cl">	  <span class="nb">echo</span> <span class="s2">&#34;/tftpboot的权限已设置为0777&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="k">fi</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># 判断/tftpboot/${work_dir_name}是否存在，想要配置多个文件夹的话可以取消注释</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># if [ -d &#34;/tftpboot/${work_dir_name}&#34; ]; then</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># 	echo &#34;tftpboot/${work_dir_name} exists.&#34;;</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># 	work_dir_name_access=$(stat /tftpboot/ | grep -w &#34;Uid&#34; | tr &#39;(&#39; &#39; &#39; | tr &#39;/&#39; &#39; &#39; | awk &#39;{print $2}&#39;)</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># 	if [ &#34;$work_dir_name_access&#34; != &#34;0777&#34; ]; then</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># 		sudo chmod 777 /tftpboot/${work_dir_name};</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># 		echo &#34;/tftpboot/${work_dir_name}的权限已设置为0777&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># 	fi</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># else</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># 	sudo mkdir /tftpboot/${work_dir_name};</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># 	sudo chmod 777 /tftpboot/${work_dir_name};</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># 	echo &#34;/tftpboot/${work_dir_name}的权限已设置为0777&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># fi</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1"># 允许开发板通过NFS访问Ubuntu的/home/${USER}目录，当然你可以加其他目录</span>
</span></span><span class="line"><span class="cl">  <span class="nv">result</span><span class="o">=</span><span class="k">$(</span>grep -w <span class="s2">&#34;</span><span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span><span class="s2"> \*(rw,nohide,insecure,no_subtree_check,async,no_root_squash)&#34;</span> /etc/exports <span class="p">|</span> grep -v <span class="s2">&#34;#&#34;</span><span class="k">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="o">[</span> <span class="nv">$?</span> -eq <span class="m">0</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">	  <span class="c1"># 查找并注释匹配行</span>
</span></span><span class="line"><span class="cl">	  <span class="c1"># sudo sed -i &#34;s/${work_dir} \*(rw,nohide,insecure,no_subtree_check,async,no_root_squash)/#\/home\/${USER} \*(rw,nohide,insecure,no_subtree_check,async,no_root_squash)/g&#34; /etc/exports</span>
</span></span><span class="line"><span class="cl">	  <span class="c1"># echo &#34;已注释匹配行：$result&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	  sudo /etc/init.d/nfs-kernel-server restart
</span></span><span class="line"><span class="cl">	  <span class="nb">echo</span> <span class="s2">&#34;匹配行已存在，并且重启了nfs服务&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="k">else</span>
</span></span><span class="line"><span class="cl">	  <span class="nv">power</span><span class="o">=</span><span class="k">$(</span>ls -l /etc/exports <span class="p">|</span> awk <span class="s1">&#39;{print $4}&#39;</span><span class="k">)</span>
</span></span><span class="line"><span class="cl">	  <span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$power</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s2">&#34;root&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">		  sudo chown <span class="si">${</span><span class="nv">USER</span><span class="si">}</span>:<span class="si">${</span><span class="nv">USER</span><span class="si">}</span> -R /etc/exports
</span></span><span class="line"><span class="cl">		  <span class="nb">echo</span> <span class="s2">&#34;</span><span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span><span class="s2"> *(rw,nohide,insecure,no_subtree_check,async,no_root_squash)&#34;</span> &gt;&gt; /etc/exports
</span></span><span class="line"><span class="cl">		  sudo chown root:root -R /etc/exports
</span></span><span class="line"><span class="cl">	  <span class="k">else</span>
</span></span><span class="line"><span class="cl">		  <span class="nb">echo</span> <span class="s2">&#34;</span><span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span><span class="s2"> *(rw,nohide,insecure,no_subtree_check,async,no_root_squash)&#34;</span> &gt;&gt; /etc/exports
</span></span><span class="line"><span class="cl">		  sudo chown root:root -R /etc/exports
</span></span><span class="line"><span class="cl">	  <span class="k">fi</span>
</span></span><span class="line"><span class="cl">	  sudo /etc/init.d/nfs-kernel-server restart
</span></span><span class="line"><span class="cl">	  <span class="nb">echo</span> <span class="s2">&#34;匹配行已添加，并且重启了nfs服务&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="k">fi</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1"># 判断linux内核是否准备好</span>
</span></span><span class="line"><span class="cl">  <span class="k">while</span> true<span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">do</span>
</span></span><span class="line"><span class="cl">	  <span class="nv">result</span><span class="o">=</span><span class="k">$(</span>curl ipinfo.io <span class="p">|</span> grep <span class="s2">&#34;country&#34;</span> <span class="p">|</span> tr <span class="s1">&#39;&#34;&#39;</span> <span class="s1">&#39; &#39;</span> <span class="p">|</span> awk <span class="s1">&#39;{print $3}&#39;</span><span class="k">)</span>
</span></span><span class="line"><span class="cl">	  <span class="k">if</span> <span class="o">[</span> -z <span class="s2">&#34;</span><span class="si">${</span><span class="nv">result</span><span class="si">}</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">		  <span class="k">continue</span>
</span></span><span class="line"><span class="cl">	  <span class="k">else</span>
</span></span><span class="line"><span class="cl">		  <span class="nb">echo</span> -e <span class="s2">&#34;\e[32mcountry: </span><span class="si">${</span><span class="nv">result</span><span class="si">}</span><span class="s2">\e[0m&#34;</span>
</span></span><span class="line"><span class="cl">		  <span class="nb">break</span>
</span></span><span class="line"><span class="cl">	  <span class="k">fi</span>
</span></span><span class="line"><span class="cl">  <span class="k">done</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">while</span> true<span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">do</span>
</span></span><span class="line"><span class="cl">	  <span class="k">if</span> <span class="o">[</span> ! -f <span class="s2">&#34;</span><span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span><span class="s2">/</span><span class="nv">$file_linux</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>		  
</span></span><span class="line"><span class="cl">		  <span class="nb">echo</span> -e <span class="s2">&#34;\e[32m&#34;</span>
</span></span><span class="line"><span class="cl">		  <span class="k">if</span> <span class="o">[</span> <span class="si">${</span><span class="nv">result</span><span class="si">}</span> !<span class="o">=</span> <span class="s2">&#34;CN&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>				  
</span></span><span class="line"><span class="cl">			  <span class="c1"># wget https://cdn.kernel.org/pub/linux/kernel/v4.x/linux-4.4.232.tar.xz</span>
</span></span><span class="line"><span class="cl">			  wget https://cdn.kernel.org/pub/linux/kernel/v4.x/<span class="si">${</span><span class="nv">file_linux</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">		  <span class="k">else</span>
</span></span><span class="line"><span class="cl">			  <span class="c1"># wget https://mirrors.ustc.edu.cn/kernel.org/linux/kernel/v4.x/linux-4.4.232.tar.xz</span>
</span></span><span class="line"><span class="cl">			  wget https://mirrors.ustc.edu.cn/kernel.org/linux/kernel/v4.x/<span class="si">${</span><span class="nv">file_linux</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">		  <span class="k">fi</span>
</span></span><span class="line"><span class="cl">	  <span class="k">else</span>
</span></span><span class="line"><span class="cl">		  <span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="k">$(</span>sha256sum <span class="si">${</span><span class="nv">file_linux</span><span class="si">}</span><span class="k">)</span><span class="s2">&#34;</span> !<span class="o">=</span> <span class="s2">&#34;4eae8865deaf03f0d13bf5056e258d451a468cabc5158757b247b0e43518fd34  </span><span class="si">${</span><span class="nv">file_linux</span><span class="si">}</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">			  rm -rf <span class="si">${</span><span class="nv">file_linux</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">			  <span class="k">continue</span>
</span></span><span class="line"><span class="cl">		  <span class="k">else</span>
</span></span><span class="line"><span class="cl">			  <span class="nb">echo</span> -e <span class="s2">&#34;\e[32m</span><span class="si">${</span><span class="nv">file_linux</span><span class="si">}</span><span class="s2"> 已下载\e[0m&#34;</span>
</span></span><span class="line"><span class="cl">			  break<span class="p">;</span>
</span></span><span class="line"><span class="cl">		  <span class="k">fi</span>
</span></span><span class="line"><span class="cl">	  <span class="k">fi</span>
</span></span><span class="line"><span class="cl">	  <span class="nb">echo</span> -e  <span class="s2">&#34;\e[0m&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="k">done</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1"># 判断busybox文件是否准备好</span>
</span></span><span class="line"><span class="cl">  <span class="k">while</span> true<span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">do</span>
</span></span><span class="line"><span class="cl">	  <span class="k">if</span> <span class="o">[</span> ! -f <span class="s2">&#34;</span><span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span><span class="s2">/</span><span class="nv">$file_busybox</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">		  <span class="nb">echo</span> -e  <span class="s2">&#34;\e[33m&#34;</span>
</span></span><span class="line"><span class="cl">		  <span class="c1"># wget --no-check-certificate https://busybox.net/downloads/busybox-1.32.0.tar.bz2</span>
</span></span><span class="line"><span class="cl">		  wget --no-check-certificate https://busybox.net/downloads/<span class="si">${</span><span class="nv">file_busybox</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">		  <span class="nb">echo</span> -e  <span class="s2">&#34;\e[0m&#34;</span>
</span></span><span class="line"><span class="cl">	  <span class="k">else</span>
</span></span><span class="line"><span class="cl">		  <span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="k">$(</span>sha256sum <span class="si">${</span><span class="nv">file_busybox</span><span class="si">}</span><span class="k">)</span><span class="s2">&#34;</span> !<span class="o">=</span> <span class="s2">&#34;c35d87f1d04b2b153d33c275c2632e40d388a88f19a9e71727e0bbbff51fe689  </span><span class="si">${</span><span class="nv">file_busybox</span><span class="si">}</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">			  rm -rf <span class="si">${</span><span class="nv">file_busybo</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">			  <span class="k">continue</span>
</span></span><span class="line"><span class="cl">		  <span class="k">else</span>
</span></span><span class="line"><span class="cl">			  <span class="nb">echo</span> -e <span class="s2">&#34;\e[32m</span><span class="nv">$file_busybox</span><span class="s2"> 已下载\e[0m&#34;</span>
</span></span><span class="line"><span class="cl">			  break<span class="p">;</span>
</span></span><span class="line"><span class="cl">		  <span class="k">fi</span>
</span></span><span class="line"><span class="cl">	  <span class="k">fi</span>	  	  
</span></span><span class="line"><span class="cl">  <span class="k">done</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1"># 判断u-boot文件是否准备好</span>
</span></span><span class="line"><span class="cl">  <span class="k">while</span> true<span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">do</span>
</span></span><span class="line"><span class="cl">	  <span class="k">if</span> <span class="o">[</span> ! -f <span class="s2">&#34;</span><span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span><span class="s2">/</span><span class="nv">$file_uboot</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">		  <span class="nb">echo</span> -e  <span class="s2">&#34;\e[34m&#34;</span>
</span></span><span class="line"><span class="cl">		  <span class="c1"># wget --no-check-certificate https://ftp.denx.de/pub/u-boot/u-boot-2017.05.tar.bz2</span>
</span></span><span class="line"><span class="cl">		  <span class="c1"># wget --no-check-certificate https://ftp.denx.de/pub/u-boot/u-boot-2020.07.tar.bz2</span>
</span></span><span class="line"><span class="cl">		  wget --no-check-certificate https://ftp.denx.de/pub/u-boot/<span class="si">${</span><span class="nv">file_uboot</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">		  <span class="nb">echo</span> -e  <span class="s2">&#34;\e[0m&#34;</span>
</span></span><span class="line"><span class="cl">	  <span class="k">else</span>
</span></span><span class="line"><span class="cl">		  <span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="k">$(</span>sha256sum <span class="si">${</span><span class="nv">file_uboot</span><span class="si">}</span><span class="k">)</span><span class="s2">&#34;</span> !<span class="o">=</span> <span class="s2">&#34;c8373949d7f0de1059e507b83a655d4cea539f75dc66ccdbb27adbd38d83095e  u-boot-2017.05.tar.bz2&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">			  rm -rf <span class="si">${</span><span class="nv">file_uboot</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">			  <span class="k">continue</span>
</span></span><span class="line"><span class="cl">		  <span class="k">else</span>
</span></span><span class="line"><span class="cl">			  <span class="nb">echo</span> -e <span class="s2">&#34;\e[32m</span><span class="nv">$file_uboot</span><span class="s2"> 已下载\e[0m&#34;</span>
</span></span><span class="line"><span class="cl">			  <span class="nb">break</span>
</span></span><span class="line"><span class="cl">		  <span class="k">fi</span>
</span></span><span class="line"><span class="cl">	  <span class="k">fi</span>
</span></span><span class="line"><span class="cl">  <span class="k">done</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1"># 临时配置交叉编译环境</span>
</span></span><span class="line"><span class="cl">  <span class="nb">export</span> <span class="nv">ARCH</span><span class="o">=</span>arm <span class="o">&amp;&amp;</span> <span class="nb">export</span> <span class="nv">CROSS_COMPILE</span><span class="o">=</span>arm-linux-gnueabi-<span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1"># 判断linux内核是否解压</span>
</span></span><span class="line"><span class="cl">  <span class="nb">echo</span> -e  <span class="s2">&#34;\e[32m&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># kernel</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="o">[</span> -d <span class="s2">&#34;</span><span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span><span class="s2">/</span><span class="nv">$linux</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">	  <span class="nb">echo</span> <span class="s2">&#34;</span><span class="nv">$linux</span><span class="s2"> exists.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="k">else</span>
</span></span><span class="line"><span class="cl">	  tar xvf <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span>/<span class="nv">$file_linux</span> -C <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">fi</span>
</span></span><span class="line"><span class="cl">  <span class="nb">echo</span> -e  <span class="s2">&#34;\e[0m&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1"># 判断busybox文件是否解压</span>
</span></span><span class="line"><span class="cl">  <span class="nb">echo</span> -e  <span class="s2">&#34;\e[33m&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="o">[</span> -d <span class="s2">&#34;</span><span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span><span class="s2">/</span><span class="nv">$busybox</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">	  <span class="nb">echo</span> <span class="s2">&#34;</span><span class="nv">$busybox</span><span class="s2"> exists.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="k">else</span>
</span></span><span class="line"><span class="cl">	  tar xvf <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span>/<span class="nv">$file_busybox</span> -C <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">fi</span>
</span></span><span class="line"><span class="cl">  <span class="nb">echo</span> -e  <span class="s2">&#34;\e[0m&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1"># 判断u-boot文件是否解压</span>
</span></span><span class="line"><span class="cl">  <span class="nb">echo</span> -e  <span class="s2">&#34;\e[34m&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="o">[</span> -d <span class="s2">&#34;</span><span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span><span class="s2">/</span><span class="si">${</span><span class="nv">uboot</span><span class="si">}</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">	  <span class="nb">echo</span> <span class="s2">&#34;</span><span class="nv">$uboot</span><span class="s2"> exists.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="k">else</span>
</span></span><span class="line"><span class="cl">	  tar xvf <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span>/<span class="nv">$file_uboot</span> -C <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	  <span class="k">if</span> <span class="o">[</span> -f <span class="s2">&#34;</span><span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span><span class="s2">/</span><span class="si">${</span><span class="nv">uboot</span><span class="si">}</span><span class="s2">/include/configs/vexpress_common.h&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">		  cp <span class="si">${</span><span class="nv">uboot_config_file</span><span class="si">}</span> <span class="si">${</span><span class="nv">uboot_config_file</span><span class="si">}</span>.old
</span></span><span class="line"><span class="cl">	  <span class="k">fi</span>
</span></span><span class="line"><span class="cl">  <span class="k">fi</span>
</span></span><span class="line"><span class="cl">  <span class="nb">echo</span> -e  <span class="s2">&#34;\e[0m&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1"># 编译linux内核</span>
</span></span><span class="line"><span class="cl">  <span class="nb">echo</span> -e  <span class="s2">&#34;\e[32m&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nb">cd</span>  <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span>/<span class="si">${</span><span class="nv">linux</span><span class="si">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  make distclean -j<span class="si">${</span><span class="nv">jobs</span><span class="si">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  make vexpress_defconfig -j<span class="si">${</span><span class="nv">jobs</span><span class="si">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  make zImage -j<span class="si">${</span><span class="nv">jobs</span><span class="si">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  make modules -j<span class="si">${</span><span class="nv">jobs</span><span class="si">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  make <span class="nv">LOADADDR</span><span class="o">=</span>0x60003000 uImage -j<span class="si">${</span><span class="nv">jobs</span><span class="si">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  make dtbs -j<span class="si">${</span><span class="nv">jobs</span><span class="si">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># mkimage -n &#39;mini2440&#39; -A arm -O linux -T kernel -C none -a 0x30008000 -e 0x30008040 -d  ${work_dir}/$linux/arch/arm/boot/zImage  ${work_dir}/$linux/arch/arm/boot/uImage</span>
</span></span><span class="line"><span class="cl">  <span class="nb">echo</span> -e  <span class="s2">&#34;\e[0m&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1"># 编译busybox，编译之后把&#34;${busybox}/_install/*&#34;拷贝到rootfs目录下</span>
</span></span><span class="line"><span class="cl">  <span class="nb">echo</span> -e  <span class="s2">&#34;\e[33m&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nb">cd</span>  <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span>/<span class="si">${</span><span class="nv">busybox</span><span class="si">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  make distclean -j<span class="si">${</span><span class="nv">jobs</span><span class="si">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  make defconfig -j<span class="si">${</span><span class="nv">jobs</span><span class="si">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  make -j<span class="si">${</span><span class="nv">jobs</span><span class="si">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  make install -j<span class="si">${</span><span class="nv">jobs</span><span class="si">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nb">echo</span> -e  <span class="s2">&#34;\e[0m&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1"># 搭建网络开发环境</span>
</span></span><span class="line"><span class="cl">  <span class="nb">echo</span> -e  <span class="s2">&#34;\e[95m&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="o">[</span> ! -f <span class="s2">&#34;</span><span class="nv">$Operate_Net_File</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">	  sudo touch <span class="si">${</span><span class="nv">Operate_Net_File</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">else</span>
</span></span><span class="line"><span class="cl">	  <span class="nb">echo</span> <span class="s2">&#34;</span><span class="si">${</span><span class="nv">uboot_config_file</span><span class="si">}</span><span class="s2"> is exists.&#34;</span>
</span></span><span class="line"><span class="cl">	  <span class="k">if</span> <span class="o">[</span> ! -f <span class="s2">&#34;</span><span class="nv">$Operate_Net_File</span><span class="s2">.old&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">		  sudo cp <span class="si">${</span><span class="nv">Operate_Net_File</span><span class="si">}</span> <span class="o">{</span><span class="nv">$Operate_Net_File</span><span class="o">}</span>.old
</span></span><span class="line"><span class="cl">	  <span class="k">else</span>
</span></span><span class="line"><span class="cl">		  <span class="nb">echo</span> <span class="s2">&#34;</span><span class="si">${</span><span class="nv">Operate_Net_File</span><span class="si">}</span><span class="s2">.old is exists.&#34;</span>
</span></span><span class="line"><span class="cl">	  <span class="k">fi</span>
</span></span><span class="line"><span class="cl">  <span class="k">fi</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  sudo chown <span class="si">${</span><span class="nv">USER</span><span class="si">}</span>:<span class="si">${</span><span class="nv">USER</span><span class="si">}</span> <span class="si">${</span><span class="nv">Operate_Net_File</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="o">[</span> ! <span class="s2">&#34;</span><span class="k">$(</span>cat /etc/network/interfaces <span class="p">|</span> grep -o <span class="s2">&#34;br0&#34;</span> <span class="p">|</span> head -n 1<span class="k">)</span><span class="s2">&#34;</span> <span class="o">=</span> <span class="s2">&#34;br0&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">	  <span class="nb">echo</span> <span class="s2">&#34;debug_1&#34;</span>
</span></span><span class="line"><span class="cl">	  cat <span class="si">${</span><span class="nv">Operate_Net_File</span><span class="si">}</span> &gt; <span class="si">${</span><span class="nv">Operate_Net_File</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">	  <span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="k">$(</span>ip addr <span class="p">|</span> grep -o <span class="s2">&#34;ens33&#34;</span> <span class="p">|</span> head -n 1<span class="k">)</span><span class="s2">&#34;</span> <span class="o">=</span> <span class="s2">&#34;ens33&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">		  <span class="nb">echo</span> <span class="s2">&#34;auto lo&#34;</span> &gt;&gt; <span class="si">${</span><span class="nv">Operate_Net_File</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">		  <span class="nb">echo</span> <span class="s2">&#34;iface lo inet loopback&#34;</span> &gt;&gt; <span class="si">${</span><span class="nv">Operate_Net_File</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">		  <span class="nb">echo</span> <span class="s2">&#34;&#34;</span> &gt;&gt; <span class="si">${</span><span class="nv">Operate_Net_File</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">		  <span class="nb">echo</span> <span class="s2">&#34;auto ens33&#34;</span> &gt;&gt; <span class="si">${</span><span class="nv">Operate_Net_File</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">		  <span class="nb">echo</span> <span class="s2">&#34;&#34;</span> &gt;&gt; <span class="si">${</span><span class="nv">Operate_Net_File</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">		  <span class="nb">echo</span> <span class="s2">&#34;auto br0&#34;</span> &gt;&gt; <span class="si">${</span><span class="nv">Operate_Net_File</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">		  <span class="nb">echo</span> <span class="s2">&#34;iface br0 inet dhcp&#34;</span> &gt;&gt; <span class="si">${</span><span class="nv">Operate_Net_File</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">		  <span class="nb">echo</span> <span class="s2">&#34;	bridge_ports ens33&#34;</span> &gt;&gt; <span class="si">${</span><span class="nv">Operate_Net_File</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">		  sudo chown <span class="si">${</span><span class="nv">root</span><span class="si">}</span>:<span class="si">${</span><span class="nv">root</span><span class="si">}</span> <span class="si">${</span><span class="nv">Operate_Net_File</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">		  sudo /etc/init.d/networking restart
</span></span><span class="line"><span class="cl">	  <span class="k">else</span>
</span></span><span class="line"><span class="cl">		  <span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="k">$(</span>ip addr <span class="p">|</span> grep -o <span class="s2">&#34;eth0&#34;</span><span class="k">)</span><span class="s2">&#34;</span> <span class="o">=</span> <span class="s2">&#34;eth0&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">			  <span class="nb">echo</span> <span class="s2">&#34;auto lo&#34;</span> &gt;&gt; <span class="si">${</span><span class="nv">Operate_Net_File</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">			  <span class="nb">echo</span> <span class="s2">&#34;iface lo inet loopback&#34;</span> &gt;&gt; <span class="si">${</span><span class="nv">Operate_Net_File</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">			  <span class="nb">echo</span> <span class="s2">&#34;&#34;</span> &gt;&gt; <span class="si">${</span><span class="nv">Operate_Net_File</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">			  <span class="nb">echo</span> <span class="s2">&#34;auto eth0&#34;</span> &gt;&gt; <span class="si">${</span><span class="nv">Operate_Net_File</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">			  <span class="nb">echo</span> <span class="s2">&#34;&#34;</span> &gt;&gt; <span class="si">${</span><span class="nv">Operate_Net_File</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">			  <span class="nb">echo</span> <span class="s2">&#34;auto br0&#34;</span> &gt;&gt; <span class="si">${</span><span class="nv">Operate_Net_File</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">			  <span class="nb">echo</span> <span class="s2">&#34;iface br0 inet dhcp&#34;</span> &gt;&gt; <span class="si">${</span><span class="nv">Operate_Net_File</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">			  <span class="nb">echo</span> <span class="s2">&#34;	bridge_ports eth0&#34;</span> &gt;&gt; <span class="si">${</span><span class="nv">Operate_Net_File</span><span class="si">}</span>			  
</span></span><span class="line"><span class="cl">			  sudo /etc/init.d/networking restart
</span></span><span class="line"><span class="cl">		  <span class="k">fi</span>
</span></span><span class="line"><span class="cl">	  <span class="k">fi</span>
</span></span><span class="line"><span class="cl">  <span class="k">else</span>
</span></span><span class="line"><span class="cl">	  <span class="nb">echo</span> <span class="s2">&#34;br0 exists.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="k">fi</span>  
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="k">$(</span>ifconfig <span class="p">|</span> grep -wo <span class="s2">&#34;br0&#34;</span><span class="k">)</span><span class="s2">&#34;</span> <span class="o">=</span> <span class="s2">&#34;br0&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">	  <span class="nv">of_ip_var1</span><span class="o">=</span><span class="k">$(</span>ifconfig <span class="p">|</span> grep -w -A <span class="m">1</span> <span class="s2">&#34;br0&#34;</span> <span class="p">|</span> grep -v <span class="s2">&#34;br0&#34;</span> <span class="p">|</span> awk <span class="s1">&#39;$1==&#34;inet&#34; {print $2}&#39;</span> <span class="p">|</span> grep -oE <span class="s2">&#34;\b([0-9]{1,3}\.){3}[0-9]{1,3}\b&#34;</span> <span class="p">|</span> awk -F <span class="s1">&#39;.&#39;</span> <span class="s1">&#39;{print $1}&#39;</span><span class="k">)</span><span class="p">;</span> <span class="nb">echo</span> <span class="si">${</span><span class="nv">of_ip_var1</span><span class="si">}</span> 
</span></span><span class="line"><span class="cl">	  <span class="nv">of_ip_var2</span><span class="o">=</span><span class="k">$(</span>ifconfig <span class="p">|</span> grep -w -A <span class="m">1</span> <span class="s2">&#34;br0&#34;</span> <span class="p">|</span> grep -v <span class="s2">&#34;br0&#34;</span> <span class="p">|</span> awk <span class="s1">&#39;$1==&#34;inet&#34; {print $2}&#39;</span> <span class="p">|</span> grep -oE <span class="s2">&#34;\b([0-9]{1,3}\.){3}[0-9]{1,3}\b&#34;</span> <span class="p">|</span> awk -F <span class="s1">&#39;.&#39;</span> <span class="s1">&#39;{print $2}&#39;</span><span class="k">)</span><span class="p">;</span> <span class="nb">echo</span> <span class="si">${</span><span class="nv">of_ip_var2</span><span class="si">}</span> 
</span></span><span class="line"><span class="cl">	  <span class="nv">of_ip_var3</span><span class="o">=</span><span class="k">$(</span>ifconfig <span class="p">|</span> grep -w -A <span class="m">1</span> <span class="s2">&#34;br0&#34;</span> <span class="p">|</span> grep -v <span class="s2">&#34;br0&#34;</span> <span class="p">|</span> awk <span class="s1">&#39;$1==&#34;inet&#34; {print $2}&#39;</span> <span class="p">|</span> grep -oE <span class="s2">&#34;\b([0-9]{1,3}\.){3}[0-9]{1,3}\b&#34;</span> <span class="p">|</span> awk -F <span class="s1">&#39;.&#39;</span> <span class="s1">&#39;{print $3}&#39;</span><span class="k">)</span><span class="p">;</span> <span class="nb">echo</span> <span class="si">${</span><span class="nv">of_ip_var3</span><span class="si">}</span> 
</span></span><span class="line"><span class="cl">	  <span class="nv">of_ip_var4</span><span class="o">=</span><span class="k">$(</span>ifconfig <span class="p">|</span> grep -w -A <span class="m">1</span> <span class="s2">&#34;br0&#34;</span> <span class="p">|</span> grep -v <span class="s2">&#34;br0&#34;</span> <span class="p">|</span> awk <span class="s1">&#39;$1==&#34;inet&#34; {print $2}&#39;</span> <span class="p">|</span> grep -oE <span class="s2">&#34;\b([0-9]{1,3}\.){3}[0-9]{1,3}\b&#34;</span> <span class="p">|</span> awk -F <span class="s1">&#39;.&#39;</span> <span class="s1">&#39;{print $4}&#39;</span><span class="k">)</span><span class="p">;</span> <span class="nb">echo</span> <span class="si">${</span><span class="nv">of_ip_var4</span><span class="si">}</span> 
</span></span><span class="line"><span class="cl">  <span class="k">else</span>
</span></span><span class="line"><span class="cl">	  <span class="nb">echo</span> <span class="s2">&#34;The br0 not exists.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="k">fi</span>
</span></span><span class="line"><span class="cl">  sudo chown <span class="si">${</span><span class="nv">USER</span><span class="si">}</span>:<span class="si">${</span><span class="nv">USER</span><span class="si">}</span> <span class="si">${</span><span class="nv">Operate_Net_File</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="o">[</span> ! -f <span class="s2">&#34;</span><span class="si">${</span><span class="nv">uboot_config_file</span><span class="si">}</span><span class="s2">.old&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">	  cp <span class="si">${</span><span class="nv">uboot_config_file</span><span class="si">}</span> <span class="si">${</span><span class="nv">uboot_config_file</span><span class="si">}</span>.old
</span></span><span class="line"><span class="cl">  <span class="k">else</span>
</span></span><span class="line"><span class="cl">	  cat <span class="si">${</span><span class="nv">uboot_config_file</span><span class="si">}</span>.old &gt;  <span class="si">${</span><span class="nv">uboot_config_file</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">fi</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nv">uboot_config_file_var1</span><span class="o">=</span><span class="k">$(</span>grep -n <span class="s2">&#34;\/\* Basic environment settings \*\/&#34;</span> <span class="si">${</span><span class="nv">uboot_config_file</span><span class="si">}</span>.old <span class="p">|</span> tr <span class="s1">&#39;:&#39;</span> <span class="s1">&#39; &#39;</span> <span class="p">|</span> awk <span class="s1">&#39;{print $1}&#39;</span><span class="k">)</span>
</span></span><span class="line"><span class="cl">  <span class="nv">uboot_config_file_var2</span><span class="o">=</span><span class="k">$((</span>uboot_config_file_var1 <span class="o">+</span> <span class="m">1</span><span class="k">))</span>
</span></span><span class="line"><span class="cl">  cat <span class="si">${</span><span class="nv">uboot_config_file</span><span class="si">}</span>.old &gt; <span class="si">${</span><span class="nv">uboot_config_file</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">  sed -i <span class="s1">&#39;/CONFIG_BOOTCOMMAND\b/d&#39;</span> <span class="si">${</span><span class="nv">uboot_config_file</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">  sed -i <span class="s1">&#39;/run distro_bootcmd\b/d&#39;</span> <span class="si">${</span><span class="nv">uboot_config_file</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">  sed -i <span class="s1">&#39;/run bootflash\b/d&#39;</span> <span class="si">${</span><span class="nv">uboot_config_file</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">  sed -i  <span class="s2">&#34;</span><span class="si">${</span><span class="nv">uboot_config_file_var2</span><span class="si">}</span><span class="s2">i\#define CONFIG_SERVERIP </span><span class="si">${</span><span class="nv">of_ip_var1</span><span class="si">}</span><span class="s2">.</span><span class="si">${</span><span class="nv">of_ip_var2</span><span class="si">}</span><span class="s2">.</span><span class="si">${</span><span class="nv">of_ip_var3</span><span class="si">}</span><span class="s2">.</span><span class="si">${</span><span class="nv">of_ip_var4</span><span class="si">}</span><span class="s2">&#34;</span> <span class="si">${</span><span class="nv">uboot_config_file</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">  sed -i  <span class="s2">&#34;</span><span class="si">${</span><span class="nv">uboot_config_file_var2</span><span class="si">}</span><span class="s2">i\#define CONFIG_NETMASK 255.255.255.0&#34;</span> <span class="si">${</span><span class="nv">uboot_config_file</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">  sed -i  <span class="s2">&#34;</span><span class="si">${</span><span class="nv">uboot_config_file_var2</span><span class="si">}</span><span class="s2">i\#define CONFIG_IPADDR </span><span class="si">${</span><span class="nv">of_ip_var1</span><span class="si">}</span><span class="s2">.</span><span class="si">${</span><span class="nv">of_ip_var2</span><span class="si">}</span><span class="s2">.</span><span class="si">${</span><span class="nv">of_ip_var3</span><span class="si">}</span><span class="s2">.223&#34;</span> <span class="si">${</span><span class="nv">uboot_config_file</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">  sed -i  <span class="s2">&#34;</span><span class="si">${</span><span class="nv">uboot_config_file_var2</span><span class="si">}</span><span class="s2">i\/* netmask */&#34;</span> <span class="si">${</span><span class="nv">uboot_config_file</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">  sed -i  <span class="s2">&#34;</span><span class="si">${</span><span class="nv">uboot_config_file_var2</span><span class="si">}</span><span class="s2">i\#define CONFIG_BOOTCOMMAND \&#34;tftp 0x60003000 uImage;tftp 0x60500000 vexpress-v2p-ca9.dtb;setenv bootargs &#39;root=/dev/mmcblk0 console=ttyAMA0&#39;;bootm 0x60003000 - 0x60500000;\&#34; \\&#34;</span> <span class="si">${</span><span class="nv">uboot_config_file</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">  <span class="nb">echo</span> -e  <span class="s2">&#34;\e[0m&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1"># 编译u-boot，编译之后会在${uboot}目录下出现u-boot，传真u-boot示例：sudo qemu-system-arm -M vexpress-a9 -m 256 -kernel ./u-boot -nographic</span>
</span></span><span class="line"><span class="cl">  <span class="nb">echo</span> -e  <span class="s2">&#34;\e[34m&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nb">cd</span>  <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span>/<span class="si">${</span><span class="nv">uboot</span><span class="si">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  make distclean -j<span class="si">${</span><span class="nv">jobs</span><span class="si">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  make vexpress_ca9x4_defconfig -j<span class="si">${</span><span class="nv">jobs</span><span class="si">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  make -j<span class="si">${</span><span class="nv">jobs</span><span class="si">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nb">echo</span> -e  <span class="s2">&#34;\e[0m&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1"># 准备根文件系统</span>
</span></span><span class="line"><span class="cl">  <span class="nb">echo</span> -e  <span class="s2">&#34;\e[33m&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nb">cd</span> <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  mkdir -p <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span>/rootfs/<span class="o">{</span>dev,etc/init.d,lib,mnt<span class="o">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  sudo cp -vrf <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span>/<span class="si">${</span><span class="nv">busybox</span><span class="si">}</span>/_install/* <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span>/rootfs/<span class="p">;</span>
</span></span><span class="line"><span class="cl">  sudo cp -vrf /usr/arm-linux-gnueabi/lib/* <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span>/rootfs/lib/<span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nb">cd</span> <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span>/rootfs/dev<span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># 创建字符设备类型的设备节点，这些设备节点的主设备号为4,次设备号为1..11</span>
</span></span><span class="line"><span class="cl">  sudo mknod -m <span class="m">666</span> console c <span class="m">4</span> 1<span class="p">;</span>
</span></span><span class="line"><span class="cl">  sudo mknod -m <span class="m">666</span> null c <span class="m">4</span> 2<span class="p">;</span>
</span></span><span class="line"><span class="cl">  sudo mknod -m <span class="m">666</span> tty1 c <span class="m">4</span> 3<span class="p">;</span>
</span></span><span class="line"><span class="cl">  sudo mknod -m <span class="m">666</span> tty2 c <span class="m">4</span> 4<span class="p">;</span>
</span></span><span class="line"><span class="cl">  sudo mknod -m <span class="m">666</span> tty3 c <span class="m">4</span> 5<span class="p">;</span>
</span></span><span class="line"><span class="cl">  sudo mknod -m <span class="m">666</span> tty4 c <span class="m">4</span> 6<span class="p">;</span>
</span></span><span class="line"><span class="cl">  sudo mknod -m <span class="m">666</span> tty5 c <span class="m">4</span> 7<span class="p">;</span>
</span></span><span class="line"><span class="cl">  sudo mknod -m <span class="m">666</span> tty6 c <span class="m">4</span> 8<span class="p">;</span>
</span></span><span class="line"><span class="cl">  sudo mknod -m <span class="m">666</span> tty7 c <span class="m">4</span> 9<span class="p">;</span>
</span></span><span class="line"><span class="cl">  sudo mknod -m <span class="m">666</span> tty8 c <span class="m">4</span> 10<span class="p">;</span>
</span></span><span class="line"><span class="cl">  sudo mknod -m <span class="m">666</span> tty9 c <span class="m">4</span> 11<span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1"># 在rootfs目录下准备挂载NFS脚本</span>
</span></span><span class="line"><span class="cl">  sudo touch <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span>/rootfs/mountNFS.sh
</span></span><span class="line"><span class="cl">  sudo chown <span class="si">${</span><span class="nv">USER</span><span class="si">}</span>:<span class="si">${</span><span class="nv">USER</span><span class="si">}</span> <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span>/rootfs/mountNFS.sh
</span></span><span class="line"><span class="cl">  cat <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span>/rootfs/mountNFS.sh &gt; <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span>/rootfs/mountNFS.sh
</span></span><span class="line"><span class="cl">  <span class="nb">echo</span> <span class="s2">&#34;ifconfig eth0 </span><span class="si">${</span><span class="nv">of_ip_var1</span><span class="si">}</span><span class="s2">.</span><span class="si">${</span><span class="nv">of_ip_var2</span><span class="si">}</span><span class="s2">.</span><span class="si">${</span><span class="nv">of_ip_var3</span><span class="si">}</span><span class="s2">.223&#34;</span> &gt;&gt; <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span>/rootfs/mountNFS.sh 
</span></span><span class="line"><span class="cl">  <span class="nb">echo</span> <span class="s2">&#34;mount -t nfs -o nolock </span><span class="si">${</span><span class="nv">of_ip_var1</span><span class="si">}</span><span class="s2">.</span><span class="si">${</span><span class="nv">of_ip_var2</span><span class="si">}</span><span class="s2">.</span><span class="si">${</span><span class="nv">of_ip_var3</span><span class="si">}</span><span class="s2">.</span><span class="si">${</span><span class="nv">of_ip_var4</span><span class="si">}</span><span class="s2">:</span><span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span><span class="s2"> /mnt&#34;</span> &gt;&gt; <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span>/rootfs/mountNFS.sh
</span></span><span class="line"><span class="cl">  sudo chown <span class="si">${</span><span class="nv">root</span><span class="si">}</span>:<span class="si">${</span><span class="nv">root</span><span class="si">}</span> <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span>/rootfs/mountNFS.sh
</span></span><span class="line"><span class="cl">  <span class="c1"># 进入qemu运行的虚拟机后通过以下命令运行脚本进行挂载nfs：&#34;sh mountNFS.sh&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nb">cd</span> <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># 制作rootfs.ext3，格式化rootfs.ext3为ext3文件系统类型，将rootfs.ext3挂载到/mnt，再将根文件系统拷贝到/mnt，然后解除/mnt挂载的rootfs.ext3，此时rootfs.ext3中已经有根文件系统了</span>
</span></span><span class="line"><span class="cl">  sudo dd <span class="k">if</span><span class="o">=</span>/dev/zero <span class="nv">of</span><span class="o">=</span>rootfs.ext3 <span class="nv">bs</span><span class="o">=</span>1M <span class="nv">count</span><span class="o">=</span><span class="m">32</span>
</span></span><span class="line"><span class="cl">  sudo mkfs.ext3 rootfs.ext3
</span></span><span class="line"><span class="cl">  sudo mount -t ext3 rootfs.ext3 /mnt -o loop
</span></span><span class="line"><span class="cl">  sudo cp -vrf <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span>/rootfs/* /mnt
</span></span><span class="line"><span class="cl">  sudo umount /mnt
</span></span><span class="line"><span class="cl">  <span class="nb">echo</span> -e  <span class="s2">&#34;\e[0m&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1"># tftpboot</span>
</span></span><span class="line"><span class="cl">  <span class="nb">echo</span> -e  <span class="s2">&#34;\e[96m&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># sudo chmod 775 $work_dir/$uboot/uImage;</span>
</span></span><span class="line"><span class="cl">  sudo rm -rf /tftpboot/*  
</span></span><span class="line"><span class="cl">  sudo cp -f <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span>/<span class="si">${</span><span class="nv">linux</span><span class="si">}</span>/arch/arm/boot/zImage /tftpboot<span class="p">;</span>
</span></span><span class="line"><span class="cl">  sudo cp -f <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span>/<span class="si">${</span><span class="nv">linux</span><span class="si">}</span>/arch/arm/boot/uImage /tftpboot<span class="p">;</span>
</span></span><span class="line"><span class="cl">  sudo cp -f <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span>/<span class="si">${</span><span class="nv">linux</span><span class="si">}</span>/arch/arm/boot/dts/vexpress-v2p-ca9.dtb /tftpboot<span class="p">;</span>
</span></span><span class="line"><span class="cl">  sudo cp -f <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span>/<span class="si">${</span><span class="nv">uboot</span><span class="si">}</span>/u-boot /tftpboot<span class="p">;</span>
</span></span><span class="line"><span class="cl">  sudo cp -f <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span>/rootfs.ext3 /tftpboot<span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nb">echo</span> -e  <span class="s2">&#34;\e[0m&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1"># QEMU运行虚拟机，通过sd卡加载linux内核</span>
</span></span><span class="line"><span class="cl">  <span class="nb">echo</span> -e  <span class="s2">&#34;\e[92m&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># qemu-system-arm -M vexpress-a9 -m 256M -kernel ${work_dir}/$linux/arch/arm/boot/zImage -dtb ${work_dir}/$linux/arch/arm/boot/dts/vexpress-v2p-ca9.dtb -nographic -append &#34;root=/dev/mmcblk0 rw console=ttyAMA0&#34; -sd ${work_dir}/rootfs.ext3;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1"># 在脚本外部执行，进入yenao_qemu_test目录执行下面的语句 </span>
</span></span><span class="line"><span class="cl">  <span class="c1"># qemu-system-arm -M vexpress-a9 -m 512M -kernel linux-4.4.232/arch/arm/boot/zImage -dtb linux-4.4.232/arch/arm/boot/dts/vexpress-v2p-ca9.dtb -nographic -append &#34;root=/dev/mmcblk0 rw console=ttyAMA0&#34; -sd rootfs.ext3</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1"># QEMU运行虚拟机，只加载u-boot</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># qemu-system-arm -M vexpress-a9 -m 256M -kernel ${work_dir}/${uboot}/u-boot  -nographic</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1"># 通过 u-boot 加载内核</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># cd /tftpboot</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># sudo qemu-system-arm -M vexpress-a9 -kernel u-boot -nographic -m 128M -net nic,vlan=0 -net tap,vlan=0,ifname=tap0 -sd rootfs.ext3</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$1</span><span class="s2">&#34;</span> <span class="o">=</span> <span class="s2">&#34;sd&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">	  <span class="c1"># QEMU运行虚拟机，通过sd卡加载linux内核	  </span>
</span></span><span class="line"><span class="cl">	  sudo qemu-system-arm -M vexpress-a9 -m 256M -kernel <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span>/<span class="nv">$linux</span>/arch/arm/boot/zImage -dtb <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span>/<span class="nv">$linux</span>/arch/arm/boot/dts/vexpress-v2p-ca9.dtb -nographic -append <span class="s2">&#34;root=/dev/mmcblk0 rw console=ttyAMA0&#34;</span> -sd <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span>/rootfs.ext3<span class="p">;</span>	  
</span></span><span class="line"><span class="cl">  <span class="k">elif</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$1</span><span class="s2">&#34;</span> <span class="o">=</span> <span class="s2">&#34;u-boot&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">	  <span class="nb">cd</span> /tftpboot
</span></span><span class="line"><span class="cl">	  sudo qemu-system-arm -M vexpress-a9 -kernel u-boot -nographic -m 128M -net nic,vlan<span class="o">=</span><span class="m">0</span> -net tap,vlan<span class="o">=</span>0,ifname<span class="o">=</span>tap0 -sd rootfs.ext3
</span></span><span class="line"><span class="cl">  <span class="k">elif</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$1</span><span class="s2">&#34;</span> <span class="o">=</span> <span class="s2">&#34;help&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">	  <span class="nb">echo</span> <span class="s2">&#34;sd start: </span><span class="si">${</span><span class="nv">cmdself</span><span class="si">}</span><span class="s2"> sd&#34;</span>
</span></span><span class="line"><span class="cl">	  <span class="nb">echo</span> <span class="s2">&#34;u-boot start: </span><span class="si">${</span><span class="nv">cmdself</span><span class="si">}</span><span class="s2"> u-boot&#34;</span>
</span></span><span class="line"><span class="cl">	  <span class="nb">echo</span> <span class="s2">&#34;out sd start var: </span><span class="si">${</span><span class="nv">cmdself</span><span class="si">}</span><span class="s2"> out sd&#34;</span>
</span></span><span class="line"><span class="cl">	  <span class="nb">echo</span> <span class="s2">&#34;out u-boot start var: </span><span class="si">${</span><span class="nv">cmdself</span><span class="si">}</span><span class="s2"> out u-boot&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="k">elif</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$1</span><span class="s2">&#34;</span> <span class="o">=</span> <span class="s2">&#34;out&#34;</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$2</span><span class="s2">&#34;</span> <span class="o">=</span> <span class="s2">&#34;sd&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">	  <span class="nb">echo</span> <span class="s2">&#34; qemu-system-arm -M vexpress-a9 -m 256M -kernel </span><span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span><span class="s2">/</span><span class="nv">$linux</span><span class="s2">/arch/arm/boot/zImage -dtb </span><span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span><span class="s2">/</span><span class="nv">$linux</span><span class="s2">/arch/arm/boot/dts/vexpress-v2p-ca9.dtb -nographic -append \&#34;root=/dev/mmcblk0 rw console=ttyAMA0\&#34; -sd </span><span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span><span class="s2">/rootfs.ext3;&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="k">elif</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$1</span><span class="s2">&#34;</span> <span class="o">=</span> <span class="s2">&#34;out&#34;</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$2</span><span class="s2">&#34;</span> <span class="o">=</span> <span class="s2">&#34;u-boot&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">	  <span class="nb">echo</span> <span class="s2">&#34;sudo qemu-system-arm -M vexpress-a9 -kernel u-boot -nographic -m 128M -net nic,vlan=0 -net tap,vlan=0,ifname=tap0 -sd rootfs.ext3&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="k">else</span>
</span></span><span class="line"><span class="cl">	  <span class="c1"># 默认通过u-boot加载linux内核</span>
</span></span><span class="line"><span class="cl">	  <span class="nb">cd</span> /tftpboot
</span></span><span class="line"><span class="cl">	  sudo qemu-system-arm -M vexpress-a9 -kernel u-boot -nographic -m 128M -net nic,vlan<span class="o">=</span><span class="m">0</span> -net tap,vlan<span class="o">=</span>0,ifname<span class="o">=</span>tap0 -sd rootfs.ext3
</span></span><span class="line"><span class="cl">  <span class="k">fi</span>
</span></span><span class="line"><span class="cl">  <span class="nb">echo</span> -e  <span class="s2">&#34;\e[0m&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># 部分参数说明</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># |----------------------------------------------------------------+--------------------------------------------------------------------------------------|</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># | 参数                                                           | 含义                                                                                 |</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># |----------------------------------------------------------------+--------------------------------------------------------------------------------------|</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># | M vexpress-a9`                                                 | 指定虚拟机的机型为 `vexpress-a9`，即使用 ARMv7 架构的 Versatile Express 开发板模型。 |</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># |----------------------------------------------------------------+--------------------------------------------------------------------------------------|</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># | m 512M`                                                        | 设置虚拟机的内存大小为 512MB。                                                       |</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># |----------------------------------------------------------------+--------------------------------------------------------------------------------------|</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># | kernel ${work_dir}/$linux/arch/arm/boot/zImage`                | 指定 Linux 内核镜像的路径和文件名。                                                  |</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># |----------------------------------------------------------------+--------------------------------------------------------------------------------------|</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># | dtb ${work_dir}/$linux/arch/arm/boot/dts/vexpress-v2p-ca9.dtb` | 指定设备树二进制文件（Device Tree Blob）的路径和文件名。                             |</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># |----------------------------------------------------------------+--------------------------------------------------------------------------------------|</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># | nographic`                                                     | 以无图形界面的方式运行虚拟机。                                                       |</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># |----------------------------------------------------------------+--------------------------------------------------------------------------------------|</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># | append &#34;root=/dev/mmcblk0 rw console=ttyAMA0&#34;`                 | 指定 Linux 内核启动参数，包括根文件系统的设备路径、读写权限和控制台终端。            |</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># |----------------------------------------------------------------+--------------------------------------------------------------------------------------|</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># | sd ${work_dir}/rootfs.ext3`                                    | 指定虚拟机的根文件系统镜像路径和文件名。                                             |</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># |----------------------------------------------------------------+--------------------------------------------------------------------------------------|</span></span></span></code></pre></td></tr></table>
</div>
</div>
</div>
<div id="outline-container-headline-5" class="outline-5">
<h5 id="headline-5">
挂载NFS文件系统流程，待实现
</h5>
<div id="outline-text-headline-5" class="outline-text-5">
<div class="src src-bash">
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">  <span class="nb">export</span> <span class="nv">ARCH</span><span class="o">=</span>arm  <span class="nv">CROSS_COMPILE</span><span class="o">=</span>arm-linux-gnueabi-<span class="p">;</span> make vexpress_ca9x4_defconfig<span class="p">;</span> make -j12
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  setenv ipaddr 192.168.1.223<span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  setenv serverip 192.168.1.100<span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  tftp 0x60003000 uImage<span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  tftp 0x60500000 vexpress-v2p-ca9.dtb<span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  setenv bootargs <span class="s1">&#39;root=/dev/nfs rw nfsroot=192.168.1.100:/home/ubt init=/linuxrc ip=192.168.1.223 console=ttyAMA0&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  bootm 0x60003000 - 0x60500000<span class="p">;</span></span></span></code></pre></td></tr></table>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-headline-6" class="outline-2">
<h2 id="headline-6">
所需资源下载
</h2>
<div id="outline-text-headline-6" class="outline-text-2">
<p>
<a href="\images\使用qemu搭建arm嵌入式linux开发环境/linux-4.4.232.tar.xz">linux-4.4.232.tar.xz</a></p>
<p>
<a href="/images/使用qemu搭建arm嵌入式linux开发环境/busybox-1.32.0.tar.bz2">busybox-1.32.0.tar.bz2</a></p>
<p>
<a href="/images/使用qemu搭建arm嵌入式linux开发环境/u-boot-2020.07.tar.bz2">u-boot-2020.07.tar.bz2</a></p>
<p>
<a href="/images/使用qemu搭建arm嵌入式linux开发环境/qemu_debug.zip">点击下载: qemu_deubg.zip</a></p>
</div>
</div>
<div id="outline-container-headline-7" class="outline-2">
<h2 id="headline-7">
综合调试 org 脚本
</h2>
<div id="outline-text-headline-7" class="outline-text-2">
<div id="outline-container-headline-8" class="outline-3">
<h3 id="headline-8">
综合调试启动
</h3>
<div id="outline-text-headline-8" class="outline-text-3">
<div class="src src-bash">
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span><span class="lnt">202
</span><span class="lnt">203
</span><span class="lnt">204
</span><span class="lnt">205
</span><span class="lnt">206
</span><span class="lnt">207
</span><span class="lnt">208
</span><span class="lnt">209
</span><span class="lnt">210
</span><span class="lnt">211
</span><span class="lnt">212
</span><span class="lnt">213
</span><span class="lnt">214
</span><span class="lnt">215
</span><span class="lnt">216
</span><span class="lnt">217
</span><span class="lnt">218
</span><span class="lnt">219
</span><span class="lnt">220
</span><span class="lnt">221
</span><span class="lnt">222
</span><span class="lnt">223
</span><span class="lnt">224
</span><span class="lnt">225
</span><span class="lnt">226
</span><span class="lnt">227
</span><span class="lnt">228
</span><span class="lnt">229
</span><span class="lnt">230
</span><span class="lnt">231
</span><span class="lnt">232
</span><span class="lnt">233
</span><span class="lnt">234
</span><span class="lnt">235
</span><span class="lnt">236
</span><span class="lnt">237
</span><span class="lnt">238
</span><span class="lnt">239
</span><span class="lnt">240
</span><span class="lnt">241
</span><span class="lnt">242
</span><span class="lnt">243
</span><span class="lnt">244
</span><span class="lnt">245
</span><span class="lnt">246
</span><span class="lnt">247
</span><span class="lnt">248
</span><span class="lnt">249
</span><span class="lnt">250
</span><span class="lnt">251
</span><span class="lnt">252
</span><span class="lnt">253
</span><span class="lnt">254
</span><span class="lnt">255
</span><span class="lnt">256
</span><span class="lnt">257
</span><span class="lnt">258
</span><span class="lnt">259
</span><span class="lnt">260
</span><span class="lnt">261
</span><span class="lnt">262
</span><span class="lnt">263
</span><span class="lnt">264
</span><span class="lnt">265
</span><span class="lnt">266
</span><span class="lnt">267
</span><span class="lnt">268
</span><span class="lnt">269
</span><span class="lnt">270
</span><span class="lnt">271
</span><span class="lnt">272
</span><span class="lnt">273
</span><span class="lnt">274
</span><span class="lnt">275
</span><span class="lnt">276
</span><span class="lnt">277
</span><span class="lnt">278
</span><span class="lnt">279
</span><span class="lnt">280
</span><span class="lnt">281
</span><span class="lnt">282
</span><span class="lnt">283
</span><span class="lnt">284
</span><span class="lnt">285
</span><span class="lnt">286
</span><span class="lnt">287
</span><span class="lnt">288
</span><span class="lnt">289
</span><span class="lnt">290
</span><span class="lnt">291
</span><span class="lnt">292
</span><span class="lnt">293
</span><span class="lnt">294
</span><span class="lnt">295
</span><span class="lnt">296
</span><span class="lnt">297
</span><span class="lnt">298
</span><span class="lnt">299
</span><span class="lnt">300
</span><span class="lnt">301
</span><span class="lnt">302
</span><span class="lnt">303
</span><span class="lnt">304
</span><span class="lnt">305
</span><span class="lnt">306
</span><span class="lnt">307
</span><span class="lnt">308
</span><span class="lnt">309
</span><span class="lnt">310
</span><span class="lnt">311
</span><span class="lnt">312
</span><span class="lnt">313
</span><span class="lnt">314
</span><span class="lnt">315
</span><span class="lnt">316
</span><span class="lnt">317
</span><span class="lnt">318
</span><span class="lnt">319
</span><span class="lnt">320
</span><span class="lnt">321
</span><span class="lnt">322
</span><span class="lnt">323
</span><span class="lnt">324
</span><span class="lnt">325
</span><span class="lnt">326
</span><span class="lnt">327
</span><span class="lnt">328
</span><span class="lnt">329
</span><span class="lnt">330
</span><span class="lnt">331
</span><span class="lnt">332
</span><span class="lnt">333
</span><span class="lnt">334
</span><span class="lnt">335
</span><span class="lnt">336
</span><span class="lnt">337
</span><span class="lnt">338
</span><span class="lnt">339
</span><span class="lnt">340
</span><span class="lnt">341
</span><span class="lnt">342
</span><span class="lnt">343
</span><span class="lnt">344
</span><span class="lnt">345
</span><span class="lnt">346
</span><span class="lnt">347
</span><span class="lnt">348
</span><span class="lnt">349
</span><span class="lnt">350
</span><span class="lnt">351
</span><span class="lnt">352
</span><span class="lnt">353
</span><span class="lnt">354
</span><span class="lnt">355
</span><span class="lnt">356
</span><span class="lnt">357
</span><span class="lnt">358
</span><span class="lnt">359
</span><span class="lnt">360
</span><span class="lnt">361
</span><span class="lnt">362
</span><span class="lnt">363
</span><span class="lnt">364
</span><span class="lnt">365
</span><span class="lnt">366
</span><span class="lnt">367
</span><span class="lnt">368
</span><span class="lnt">369
</span><span class="lnt">370
</span><span class="lnt">371
</span><span class="lnt">372
</span><span class="lnt">373
</span><span class="lnt">374
</span><span class="lnt">375
</span><span class="lnt">376
</span><span class="lnt">377
</span><span class="lnt">378
</span><span class="lnt">379
</span><span class="lnt">380
</span><span class="lnt">381
</span><span class="lnt">382
</span><span class="lnt">383
</span><span class="lnt">384
</span><span class="lnt">385
</span><span class="lnt">386
</span><span class="lnt">387
</span><span class="lnt">388
</span><span class="lnt">389
</span><span class="lnt">390
</span><span class="lnt">391
</span><span class="lnt">392
</span><span class="lnt">393
</span><span class="lnt">394
</span><span class="lnt">395
</span><span class="lnt">396
</span><span class="lnt">397
</span><span class="lnt">398
</span><span class="lnt">399
</span><span class="lnt">400
</span><span class="lnt">401
</span><span class="lnt">402
</span><span class="lnt">403
</span><span class="lnt">404
</span><span class="lnt">405
</span><span class="lnt">406
</span><span class="lnt">407
</span><span class="lnt">408
</span><span class="lnt">409
</span><span class="lnt">410
</span><span class="lnt">411
</span><span class="lnt">412
</span><span class="lnt">413
</span><span class="lnt">414
</span><span class="lnt">415
</span><span class="lnt">416
</span><span class="lnt">417
</span><span class="lnt">418
</span><span class="lnt">419
</span><span class="lnt">420
</span><span class="lnt">421
</span><span class="lnt">422
</span><span class="lnt">423
</span><span class="lnt">424
</span><span class="lnt">425
</span><span class="lnt">426
</span><span class="lnt">427
</span><span class="lnt">428
</span><span class="lnt">429
</span><span class="lnt">430
</span><span class="lnt">431
</span><span class="lnt">432
</span><span class="lnt">433
</span><span class="lnt">434
</span><span class="lnt">435
</span><span class="lnt">436
</span><span class="lnt">437
</span><span class="lnt">438
</span><span class="lnt">439
</span><span class="lnt">440
</span><span class="lnt">441
</span><span class="lnt">442
</span><span class="lnt">443
</span><span class="lnt">444
</span><span class="lnt">445
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">  <span class="nv">linux</span><span class="o">=</span><span class="s2">&#34;linux-4.4.232&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># linux=&#34;linux-4.4.76&#34;;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">busybox</span><span class="o">=</span><span class="s2">&#34;busybox-1.32.0&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">uboot</span><span class="o">=</span><span class="s2">&#34;u-boot-2017.05&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># uboot=&#34;u-boot-2020.07&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">vuboot</span><span class="o">=</span><span class="s2">&#34;v2017.05&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">git_uboot</span><span class="o">=</span><span class="s2">&#34;v&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">file_linux</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">linux</span><span class="si">}</span><span class="s2">.tar.xz&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">file_busybox</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">busybox</span><span class="si">}</span><span class="s2">.tar.bz2&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">file_uboot</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">uboot</span><span class="si">}</span><span class="s2">.tar.bz2&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">file_vuboot</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">vuboot</span><span class="si">}</span><span class="s2">.tar.gz&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">bz2_uboot</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">file_uboot</span><span class="si">}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">gz_uboot</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">file_vuboot</span><span class="si">}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">work_dir_name</span><span class="o">=</span><span class="s2">&#34;yenao_qemu_test&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">work_dir</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span><span class="s2">/</span><span class="si">${</span><span class="nv">work_dir_name</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">Operate_Net_File</span><span class="o">=</span><span class="s2">&#34;/etc/network/interfaces&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">uboot_config_file</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span><span class="s2">/</span><span class="si">${</span><span class="nv">uboot</span><span class="si">}</span><span class="s2">/include/configs/vexpress_common.h&#34;</span>
</span></span><span class="line"><span class="cl">  mkdir -p <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nb">cd</span> <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">cpu_cores</span><span class="o">=</span><span class="k">$(</span>nproc<span class="k">)</span>
</span></span><span class="line"><span class="cl">  <span class="nv">jobs</span><span class="o">=</span><span class="k">$((</span>cpu_cores <span class="o">*</span> <span class="m">2</span><span class="k">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nv">package_array</span><span class="o">=(</span>gcc-arm-linux-gnueabi  python-dev  qemu  qemu-kvm  libvirt-bin  bridge-utils  virt-manager  uml-utilities  bridge-utils  u-boot-tools  ed  tftp-hpa  tftpd-hpa  xinetd  nfs-kernel-server  device-tree-compiler<span class="o">)</span> <span class="c1"># gcc-arm-linux-gnueabi 交叉编译工具链与 gcc-multilib 不能共存，因此如果电脑之前有安装并且需要 gcc-multilib 的话，可以再运行完脚本后重新安装 gcc-multilib</span>
</span></span><span class="line"><span class="cl">  <span class="nv">package_array_size</span><span class="o">=</span><span class="si">${#</span><span class="nv">package_array</span><span class="p">[@]</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="o">((</span><span class="nv">i</span> <span class="o">=</span> 0<span class="p">;</span> i &lt; package_array_size<span class="p">;</span> i++<span class="o">))</span>
</span></span><span class="line"><span class="cl">  <span class="k">do</span>
</span></span><span class="line"><span class="cl">	  <span class="c1"># 软件安装</span>
</span></span><span class="line"><span class="cl">	  <span class="k">if</span> <span class="o">[</span> ! <span class="s2">&#34;</span><span class="k">$(</span>apt list --installed <span class="p">|</span> grep -wo <span class="s2">&#34;</span><span class="si">${</span><span class="nv">package_array</span><span class="p">[</span><span class="si">${</span><span class="nv">i</span><span class="si">}</span><span class="p">]</span><span class="si">}</span><span class="s2">&#34;</span> <span class="p">|</span> head -n 1<span class="k">)</span><span class="s2">&#34;</span> <span class="o">=</span> <span class="s2">&#34;</span><span class="si">${</span><span class="nv">package_array</span><span class="p">[</span><span class="si">${</span><span class="nv">i</span><span class="si">}</span><span class="p">]</span><span class="si">}</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">		  <span class="nb">echo</span> -e <span class="s2">&#34;\e[34m&#34;</span>
</span></span><span class="line"><span class="cl">		  sudo apt-get install <span class="si">${</span><span class="nv">package_array</span><span class="p">[</span><span class="si">${</span><span class="nv">i</span><span class="si">}</span><span class="p">]</span><span class="si">}</span> -y
</span></span><span class="line"><span class="cl">		  <span class="nb">echo</span> -e <span class="s2">&#34;\e[0m&#34;</span>
</span></span><span class="line"><span class="cl">		  <span class="k">if</span> <span class="o">[</span> ! <span class="s2">&#34;</span><span class="k">$(</span>apt list --installed <span class="p">|</span> grep -wo <span class="s2">&#34;</span><span class="si">${</span><span class="nv">package_array</span><span class="p">[</span><span class="si">${</span><span class="nv">i</span><span class="si">}</span><span class="p">]</span><span class="si">}</span><span class="s2">&#34;</span> <span class="p">|</span> head -n 1<span class="k">)</span><span class="s2">&#34;</span> <span class="o">=</span> <span class="s2">&#34;</span><span class="si">${</span><span class="nv">package_array</span><span class="p">[</span><span class="si">${</span><span class="nv">i</span><span class="si">}</span><span class="p">]</span><span class="si">}</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">			  <span class="nb">echo</span> -e <span class="s2">&#34;\e[31m</span><span class="si">${</span><span class="nv">package_array</span><span class="p">[</span><span class="si">${</span><span class="nv">i</span><span class="si">}</span><span class="p">]</span><span class="si">}</span><span class="s2"> 未安装\e[0m&#34;</span>
</span></span><span class="line"><span class="cl">		  <span class="k">else</span>
</span></span><span class="line"><span class="cl">			  <span class="nb">echo</span> -e <span class="s2">&#34;\e[32m</span><span class="si">${</span><span class="nv">package_array</span><span class="p">[</span><span class="si">${</span><span class="nv">i</span><span class="si">}</span><span class="p">]</span><span class="si">}</span><span class="s2"> 已安装\e[0m&#34;</span>
</span></span><span class="line"><span class="cl">		  <span class="k">fi</span>		  
</span></span><span class="line"><span class="cl">	  <span class="k">else</span>
</span></span><span class="line"><span class="cl">		  <span class="nb">echo</span> -e <span class="s2">&#34;\e[32m</span><span class="si">${</span><span class="nv">package_array</span><span class="p">[</span><span class="si">${</span><span class="nv">i</span><span class="si">}</span><span class="p">]</span><span class="si">}</span><span class="s2"> 已安装\e[0m&#34;</span>
</span></span><span class="line"><span class="cl">	  <span class="k">fi</span>
</span></span><span class="line"><span class="cl">  <span class="k">done</span>	
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1"># 配置/etc/default/tftpd-hpa</span>
</span></span><span class="line"><span class="cl">  sudo chmod <span class="m">777</span> /etc/default/tftpd-hpa<span class="p">;</span>
</span></span><span class="line"><span class="cl">  cat /etc/default/tftpd-hpa &gt; /etc/default/tftpd-hpa
</span></span><span class="line"><span class="cl">  sudo chown <span class="si">${</span><span class="nv">USER</span><span class="si">}</span>:<span class="si">${</span><span class="nv">USER</span><span class="si">}</span> -R /etc/default/tftpd-hpa
</span></span><span class="line"><span class="cl">  <span class="nb">echo</span> <span class="s1">&#39;TFTP_USERNAME=&#34;tftp&#34;&#39;</span> &gt;&gt; /etc/default/tftpd-hpa
</span></span><span class="line"><span class="cl">  <span class="nb">echo</span> <span class="s2">&#34;TFTP_DIRECTORY=\&#34;/tftpboot\&#34;&#34;</span> &gt;&gt; /etc/default/tftpd-hpa
</span></span><span class="line"><span class="cl">  <span class="c1"># echo &#34;TFTP_DIRECTORY=\&#34;/tftpboot /tftpboot/${work_dir_name}\&#34;&#34; &gt;&gt; /etc/default/tftpd-hpa</span>
</span></span><span class="line"><span class="cl">  <span class="nb">echo</span> <span class="s1">&#39;TFTP_ADDRESS=&#34;0.0.0.0:69&#34;&#39;</span> &gt;&gt; /etc/default/tftpd-hpa
</span></span><span class="line"><span class="cl">  <span class="nb">echo</span> <span class="s1">&#39;TFTP_OPTIONS=&#34;-l -c -s&#34;&#39;</span> &gt;&gt; /etc/default/tftpd-hpa <span class="c1"># 如果要设置多个目录就不能添加&#34;-s&#34;选项</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># echo &#39;TFTP_OPTIONS=&#34;-l -c&#34;&#39; &gt;&gt; /etc/default/tftpd-hpa</span>
</span></span><span class="line"><span class="cl">  sudo chown root:root -R /etc/default/tftpd-hpa
</span></span><span class="line"><span class="cl">  <span class="c1"># 判断/tftpboot是否存在</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="o">[</span> -d <span class="s2">&#34;/tftpboot/&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">	  <span class="nb">echo</span> <span class="s2">&#34;tftpboot exists.&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	  <span class="nv">tftpboot_access</span><span class="o">=</span><span class="k">$(</span>stat /tftpboot/ <span class="p">|</span> grep -w <span class="s2">&#34;Uid&#34;</span> <span class="p">|</span> tr <span class="s1">&#39;(&#39;</span> <span class="s1">&#39; &#39;</span> <span class="p">|</span> tr <span class="s1">&#39;/&#39;</span> <span class="s1">&#39; &#39;</span> <span class="p">|</span> awk <span class="s1">&#39;{print $2}&#39;</span><span class="k">)</span>
</span></span><span class="line"><span class="cl">	  <span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$tftpboot_access</span><span class="s2">&#34;</span> !<span class="o">=</span> <span class="s2">&#34;0777&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">		  sudo chmod <span class="m">777</span> /tftpboot<span class="p">;</span>
</span></span><span class="line"><span class="cl">		  <span class="nb">echo</span> <span class="s2">&#34;/tftpboot的权限已设置为0777&#34;</span>
</span></span><span class="line"><span class="cl">	  <span class="k">fi</span>
</span></span><span class="line"><span class="cl">  <span class="k">else</span>
</span></span><span class="line"><span class="cl">	  sudo mkdir /tftpboot<span class="p">;</span>
</span></span><span class="line"><span class="cl">	  sudo chmod <span class="m">777</span> /tftpboot<span class="p">;</span>
</span></span><span class="line"><span class="cl">	  <span class="nb">echo</span> <span class="s2">&#34;/tftpboot的权限已设置为0777&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="k">fi</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># 判断/tftpboot/${work_dir_name}是否存在，想要配置多个文件夹的话可以取消注释</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># if [ -d &#34;/tftpboot/${work_dir_name}&#34; ]; then</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># 	echo &#34;tftpboot/${work_dir_name} exists.&#34;;</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># 	work_dir_name_access=$(stat /tftpboot/ | grep -w &#34;Uid&#34; | tr &#39;(&#39; &#39; &#39; | tr &#39;/&#39; &#39; &#39; | awk &#39;{print $2}&#39;)</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># 	if [ &#34;$work_dir_name_access&#34; != &#34;0777&#34; ]; then</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># 		sudo chmod 777 /tftpboot/${work_dir_name};</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># 		echo &#34;/tftpboot/${work_dir_name}的权限已设置为0777&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># 	fi</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># else</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># 	sudo mkdir /tftpboot/${work_dir_name};</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># 	sudo chmod 777 /tftpboot/${work_dir_name};</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># 	echo &#34;/tftpboot/${work_dir_name}的权限已设置为0777&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># fi</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1"># 允许开发板通过NFS访问Ubuntu的/home/${USER}目录，当然你可以加其他目录</span>
</span></span><span class="line"><span class="cl">  <span class="nv">result</span><span class="o">=</span><span class="k">$(</span>grep -w <span class="s2">&#34;</span><span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span><span class="s2"> \*(rw,nohide,insecure,no_subtree_check,async,no_root_squash)&#34;</span> /etc/exports <span class="p">|</span> grep -v <span class="s2">&#34;#&#34;</span><span class="k">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="o">[</span> <span class="nv">$?</span> -eq <span class="m">0</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">	  <span class="c1"># 查找并注释匹配行</span>
</span></span><span class="line"><span class="cl">	  <span class="c1"># sudo sed -i &#34;s/${work_dir} \*(rw,nohide,insecure,no_subtree_check,async,no_root_squash)/#\/home\/${USER} \*(rw,nohide,insecure,no_subtree_check,async,no_root_squash)/g&#34; /etc/exports</span>
</span></span><span class="line"><span class="cl">	  <span class="c1"># echo &#34;已注释匹配行：$result&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	  sudo /etc/init.d/nfs-kernel-server restart
</span></span><span class="line"><span class="cl">	  <span class="nb">echo</span> <span class="s2">&#34;匹配行已存在，并且重启了nfs服务&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="k">else</span>
</span></span><span class="line"><span class="cl">	  <span class="nv">power</span><span class="o">=</span><span class="k">$(</span>ls -l /etc/exports <span class="p">|</span> awk <span class="s1">&#39;{print $4}&#39;</span><span class="k">)</span>
</span></span><span class="line"><span class="cl">	  <span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$power</span><span class="s2">&#34;</span> <span class="o">==</span> <span class="s2">&#34;root&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">		  sudo chown <span class="si">${</span><span class="nv">USER</span><span class="si">}</span>:<span class="si">${</span><span class="nv">USER</span><span class="si">}</span> -R /etc/exports
</span></span><span class="line"><span class="cl">		  <span class="nb">echo</span> <span class="s2">&#34;</span><span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span><span class="s2"> *(rw,nohide,insecure,no_subtree_check,async,no_root_squash)&#34;</span> &gt;&gt; /etc/exports
</span></span><span class="line"><span class="cl">		  sudo chown root:root -R /etc/exports
</span></span><span class="line"><span class="cl">	  <span class="k">else</span>
</span></span><span class="line"><span class="cl">		  <span class="nb">echo</span> <span class="s2">&#34;</span><span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span><span class="s2"> *(rw,nohide,insecure,no_subtree_check,async,no_root_squash)&#34;</span> &gt;&gt; /etc/exports
</span></span><span class="line"><span class="cl">		  sudo chown root:root -R /etc/exports
</span></span><span class="line"><span class="cl">	  <span class="k">fi</span>
</span></span><span class="line"><span class="cl">	  sudo /etc/init.d/nfs-kernel-server restart
</span></span><span class="line"><span class="cl">	  <span class="nb">echo</span> <span class="s2">&#34;匹配行已添加，并且重启了nfs服务&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="k">fi</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1"># 判断linux内核是否准备好</span>
</span></span><span class="line"><span class="cl">  <span class="k">while</span> true<span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">do</span>
</span></span><span class="line"><span class="cl">	  <span class="nv">result</span><span class="o">=</span><span class="k">$(</span>curl ipinfo.io <span class="p">|</span> grep <span class="s2">&#34;country&#34;</span> <span class="p">|</span> tr <span class="s1">&#39;&#34;&#39;</span> <span class="s1">&#39; &#39;</span> <span class="p">|</span> awk <span class="s1">&#39;{print $3}&#39;</span><span class="k">)</span>
</span></span><span class="line"><span class="cl">	  <span class="k">if</span> <span class="o">[</span> -z <span class="s2">&#34;</span><span class="si">${</span><span class="nv">result</span><span class="si">}</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">		  <span class="k">continue</span>
</span></span><span class="line"><span class="cl">	  <span class="k">else</span>
</span></span><span class="line"><span class="cl">		  <span class="nb">echo</span> -e <span class="s2">&#34;\e[32mcountry: </span><span class="si">${</span><span class="nv">result</span><span class="si">}</span><span class="s2">\e[0m&#34;</span>
</span></span><span class="line"><span class="cl">		  <span class="nb">break</span>
</span></span><span class="line"><span class="cl">	  <span class="k">fi</span>
</span></span><span class="line"><span class="cl">  <span class="k">done</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">while</span> true<span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">do</span>
</span></span><span class="line"><span class="cl">	  <span class="k">if</span> <span class="o">[</span> ! -f <span class="s2">&#34;</span><span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span><span class="s2">/</span><span class="nv">$file_linux</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>		  
</span></span><span class="line"><span class="cl">		  <span class="nb">echo</span> -e <span class="s2">&#34;\e[32m&#34;</span>
</span></span><span class="line"><span class="cl">		  <span class="k">if</span> <span class="o">[</span> <span class="si">${</span><span class="nv">result</span><span class="si">}</span> !<span class="o">=</span> <span class="s2">&#34;CN&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>				  
</span></span><span class="line"><span class="cl">			  <span class="c1"># wget https://cdn.kernel.org/pub/linux/kernel/v4.x/linux-4.4.232.tar.xz</span>
</span></span><span class="line"><span class="cl">			  wget https://cdn.kernel.org/pub/linux/kernel/v4.x/<span class="si">${</span><span class="nv">file_linux</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">		  <span class="k">else</span>
</span></span><span class="line"><span class="cl">			  <span class="c1"># wget https://mirrors.ustc.edu.cn/kernel.org/linux/kernel/v4.x/linux-4.4.232.tar.xz</span>
</span></span><span class="line"><span class="cl">			  wget https://mirrors.ustc.edu.cn/kernel.org/linux/kernel/v4.x/<span class="si">${</span><span class="nv">file_linux</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">		  <span class="k">fi</span>
</span></span><span class="line"><span class="cl">	  <span class="k">else</span>
</span></span><span class="line"><span class="cl">		  <span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="k">$(</span>sha256sum <span class="si">${</span><span class="nv">file_linux</span><span class="si">}</span><span class="k">)</span><span class="s2">&#34;</span> !<span class="o">=</span> <span class="s2">&#34;4eae8865deaf03f0d13bf5056e258d451a468cabc5158757b247b0e43518fd34  </span><span class="si">${</span><span class="nv">file_linux</span><span class="si">}</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">			  rm -rf <span class="si">${</span><span class="nv">file_linux</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">			  <span class="k">continue</span>
</span></span><span class="line"><span class="cl">		  <span class="k">else</span>
</span></span><span class="line"><span class="cl">			  <span class="nb">echo</span> -e <span class="s2">&#34;\e[32m</span><span class="si">${</span><span class="nv">file_linux</span><span class="si">}</span><span class="s2"> 已下载\e[0m&#34;</span>
</span></span><span class="line"><span class="cl">			  break<span class="p">;</span>
</span></span><span class="line"><span class="cl">		  <span class="k">fi</span>
</span></span><span class="line"><span class="cl">	  <span class="k">fi</span>
</span></span><span class="line"><span class="cl">	  <span class="nb">echo</span> -e  <span class="s2">&#34;\e[0m&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="k">done</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1"># 判断busybox文件是否准备好</span>
</span></span><span class="line"><span class="cl">  <span class="k">while</span> true<span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">do</span>
</span></span><span class="line"><span class="cl">	  <span class="k">if</span> <span class="o">[</span> ! -f <span class="s2">&#34;</span><span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span><span class="s2">/</span><span class="nv">$file_busybox</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">		  <span class="nb">echo</span> -e  <span class="s2">&#34;\e[33m&#34;</span>
</span></span><span class="line"><span class="cl">		  <span class="c1"># wget --no-check-certificate https://busybox.net/downloads/busybox-1.32.0.tar.bz2</span>
</span></span><span class="line"><span class="cl">		  wget --no-check-certificate https://busybox.net/downloads/<span class="si">${</span><span class="nv">file_busybox</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">		  <span class="nb">echo</span> -e  <span class="s2">&#34;\e[0m&#34;</span>
</span></span><span class="line"><span class="cl">	  <span class="k">else</span>
</span></span><span class="line"><span class="cl">		  <span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="k">$(</span>sha256sum <span class="si">${</span><span class="nv">file_busybox</span><span class="si">}</span><span class="k">)</span><span class="s2">&#34;</span> !<span class="o">=</span> <span class="s2">&#34;c35d87f1d04b2b153d33c275c2632e40d388a88f19a9e71727e0bbbff51fe689  </span><span class="si">${</span><span class="nv">file_busybox</span><span class="si">}</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">			  rm -rf <span class="si">${</span><span class="nv">file_busybo</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">			  <span class="k">continue</span>
</span></span><span class="line"><span class="cl">		  <span class="k">else</span>
</span></span><span class="line"><span class="cl">			  <span class="nb">echo</span> -e <span class="s2">&#34;\e[32m</span><span class="nv">$file_busybox</span><span class="s2"> 已下载\e[0m&#34;</span>
</span></span><span class="line"><span class="cl">			  break<span class="p">;</span>
</span></span><span class="line"><span class="cl">		  <span class="k">fi</span>
</span></span><span class="line"><span class="cl">	  <span class="k">fi</span>	  	  
</span></span><span class="line"><span class="cl">  <span class="k">done</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1"># 判断u-boot文件是否准备好</span>
</span></span><span class="line"><span class="cl">  <span class="k">while</span> true<span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">do</span>
</span></span><span class="line"><span class="cl">	  <span class="nv">result</span><span class="o">=</span><span class="k">$(</span>curl ipinfo.io <span class="p">|</span> grep <span class="s2">&#34;country&#34;</span> <span class="p">|</span> tr <span class="s1">&#39;&#34;&#39;</span> <span class="s1">&#39; &#39;</span> <span class="p">|</span> awk <span class="s1">&#39;{print $3}&#39;</span><span class="k">)</span>
</span></span><span class="line"><span class="cl">	  <span class="k">if</span> <span class="o">[</span> -z <span class="s2">&#34;</span><span class="si">${</span><span class="nv">result</span><span class="si">}</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">		  <span class="k">continue</span>
</span></span><span class="line"><span class="cl">	  <span class="k">else</span>
</span></span><span class="line"><span class="cl">		  <span class="nb">echo</span> -e <span class="s2">&#34;\e[32mcountry: </span><span class="si">${</span><span class="nv">result</span><span class="si">}</span><span class="s2">\e[0m&#34;</span>
</span></span><span class="line"><span class="cl">		  <span class="nb">break</span>
</span></span><span class="line"><span class="cl">	  <span class="k">fi</span>
</span></span><span class="line"><span class="cl">  <span class="k">done</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nv">file_uboot</span><span class="o">=</span><span class="si">${</span><span class="nv">file_vuboot</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># echo &#34;https://codeload.github.com/u-boot/u-boot/tar.gz/refs/tags/v2017.05&#34; | awk -F &#39;/&#39; &#39;{print $5&#34;-&#34;$9&#34;.&#34;$6}&#39; | tr -d &#39;v&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">while</span> true<span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">do</span>
</span></span><span class="line"><span class="cl">	  <span class="k">if</span> <span class="o">[</span> ! -f <span class="s2">&#34;</span><span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span><span class="s2">/</span><span class="nv">$file_uboot</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">		  <span class="nb">echo</span> -e  <span class="s2">&#34;\e[34m&#34;</span>
</span></span><span class="line"><span class="cl">		  <span class="k">if</span> <span class="o">[</span> <span class="si">${</span><span class="nv">result</span><span class="si">}</span> !<span class="o">=</span> <span class="s2">&#34;CN&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">			  <span class="c1"># wget --no-check-certificate https://ftp.denx.de/pub/u-boot/u-boot-2017.05.tar.bz2 </span>
</span></span><span class="line"><span class="cl">			  <span class="c1"># wget --no-check-certificate https://ftp.denx.de/pub/u-boot/u-boot-2020.07.tar.bz2</span>
</span></span><span class="line"><span class="cl">			  <span class="c1"># wget --no-check-certificate https://ftp.denx.de/pub/u-boot/${file_uboot}</span>
</span></span><span class="line"><span class="cl">			  <span class="c1"># wget https://github.com/u-boot/u-boot/archive/refs/tags/v2017.05.tar.gz</span>
</span></span><span class="line"><span class="cl">			  wget  https://github.com/u-boot/u-boot/archive/refs/tags/<span class="si">${</span><span class="nv">file_uboot</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">		  <span class="k">else</span>
</span></span><span class="line"><span class="cl">			  wget https://hub.nuaa.cf/u-boot/u-boot/archive/refs/tags/<span class="si">${</span><span class="nv">file_uboot</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">		  <span class="k">fi</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	  <span class="k">else</span>
</span></span><span class="line"><span class="cl">		  <span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="k">$(</span>sha256sum <span class="si">${</span><span class="nv">file_uboot</span><span class="si">}</span><span class="k">)</span><span class="s2">&#34;</span> !<span class="o">=</span> <span class="s2">&#34;0f94a62c460fc136aeca9bcd9fde3bb1d3f25b953e1bee96be4497a06a39ae81  </span><span class="si">${</span><span class="nv">file_uboot</span><span class="si">}</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">			  rm -rf <span class="si">${</span><span class="nv">file_uboot</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">			  <span class="k">continue</span>
</span></span><span class="line"><span class="cl">		  <span class="k">else</span>
</span></span><span class="line"><span class="cl">			  <span class="nb">echo</span> -e <span class="s2">&#34;\e[32m</span><span class="nv">$file_uboot</span><span class="s2"> 已下载\e[0m&#34;</span>
</span></span><span class="line"><span class="cl">			  <span class="nb">break</span>
</span></span><span class="line"><span class="cl">		  <span class="k">fi</span>
</span></span><span class="line"><span class="cl">	  <span class="k">fi</span>
</span></span><span class="line"><span class="cl">	  <span class="nb">echo</span> -e  <span class="s2">&#34;\e[0m&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="k">done</span>  
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1"># 临时配置交叉编译环境</span>
</span></span><span class="line"><span class="cl">  <span class="nb">export</span> <span class="nv">ARCH</span><span class="o">=</span>arm <span class="o">&amp;&amp;</span> <span class="nb">export</span> <span class="nv">CROSS_COMPILE</span><span class="o">=</span>arm-linux-gnueabi-<span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1"># 判断linux内核是否解压</span>
</span></span><span class="line"><span class="cl">  <span class="nb">echo</span> -e  <span class="s2">&#34;\e[32m&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># kernel</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="o">[</span> -d <span class="s2">&#34;</span><span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span><span class="s2">/</span><span class="nv">$linux</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">	  <span class="nb">echo</span> <span class="s2">&#34;</span><span class="nv">$linux</span><span class="s2"> exists.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="k">else</span>
</span></span><span class="line"><span class="cl">	  tar xvf <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span>/<span class="nv">$file_linux</span> -C <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">fi</span>
</span></span><span class="line"><span class="cl">  <span class="nb">echo</span> -e  <span class="s2">&#34;\e[0m&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1"># 判断busybox文件是否解压</span>
</span></span><span class="line"><span class="cl">  <span class="nb">echo</span> -e  <span class="s2">&#34;\e[33m&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="o">[</span> -d <span class="s2">&#34;</span><span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span><span class="s2">/</span><span class="nv">$busybox</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">	  <span class="nb">echo</span> <span class="s2">&#34;</span><span class="nv">$busybox</span><span class="s2"> exists.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="k">else</span>
</span></span><span class="line"><span class="cl">	  tar xvf <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span>/<span class="nv">$file_busybox</span> -C <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">fi</span>
</span></span><span class="line"><span class="cl">  <span class="nb">echo</span> -e  <span class="s2">&#34;\e[0m&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1"># 判断u-boot文件是否解压</span>
</span></span><span class="line"><span class="cl">  <span class="nb">echo</span> -e <span class="s2">&#34;\e[34m&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="o">[</span> -d <span class="s2">&#34;</span><span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span><span class="s2">/</span><span class="si">${</span><span class="nv">uboot</span><span class="si">}</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">	  <span class="nb">echo</span> <span class="s2">&#34;</span><span class="nv">$uboot</span><span class="s2"> exists.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="k">else</span>
</span></span><span class="line"><span class="cl">	  <span class="k">if</span> <span class="o">[</span> -f <span class="s2">&#34;</span><span class="si">${</span><span class="nv">bz2_uboot</span><span class="si">}</span><span class="s2">&#34;</span>  <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">		  tar xvf <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span>/<span class="nv">$file_uboot</span> -C <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		  <span class="k">if</span> <span class="o">[</span> -f <span class="s2">&#34;</span><span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span><span class="s2">/</span><span class="si">${</span><span class="nv">uboot</span><span class="si">}</span><span class="s2">/include/configs/vexpress_common.h&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">			  cp <span class="si">${</span><span class="nv">uboot_config_file</span><span class="si">}</span> <span class="si">${</span><span class="nv">uboot_config_file</span><span class="si">}</span>.old
</span></span><span class="line"><span class="cl">		  <span class="k">fi</span>
</span></span><span class="line"><span class="cl">	  <span class="k">elif</span> <span class="o">[</span> -f <span class="s2">&#34;</span><span class="si">${</span><span class="nv">gz_uboot</span><span class="si">}</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">		  tar zxvf <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span>/<span class="nv">$file_uboot</span> -C <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		  <span class="k">if</span> <span class="o">[</span> -f <span class="s2">&#34;</span><span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span><span class="s2">/</span><span class="si">${</span><span class="nv">uboot</span><span class="si">}</span><span class="s2">/include/configs/vexpress_common.h&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">			  cp <span class="si">${</span><span class="nv">uboot_config_file</span><span class="si">}</span> <span class="si">${</span><span class="nv">uboot_config_file</span><span class="si">}</span>.old
</span></span><span class="line"><span class="cl">		  <span class="k">fi</span>
</span></span><span class="line"><span class="cl">	  <span class="k">fi</span>
</span></span><span class="line"><span class="cl">	  <span class="nb">echo</span> -e <span class="s2">&#34;\e[0m&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="k">fi</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1"># 编译linux内核</span>
</span></span><span class="line"><span class="cl">  <span class="nb">echo</span> -e  <span class="s2">&#34;\e[32m&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nb">cd</span>  <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span>/<span class="si">${</span><span class="nv">linux</span><span class="si">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  make distclean -j<span class="si">${</span><span class="nv">jobs</span><span class="si">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  make vexpress_defconfig -j<span class="si">${</span><span class="nv">jobs</span><span class="si">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  make zImage -j<span class="si">${</span><span class="nv">jobs</span><span class="si">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  make modules -j<span class="si">${</span><span class="nv">jobs</span><span class="si">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  make <span class="nv">LOADADDR</span><span class="o">=</span>0x60003000 uImage -j<span class="si">${</span><span class="nv">jobs</span><span class="si">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  make dtbs -j<span class="si">${</span><span class="nv">jobs</span><span class="si">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># mkimage -n &#39;mini2440&#39; -A arm -O linux -T kernel -C none -a 0x30008000 -e 0x30008040 -d  ${work_dir}/$linux/arch/arm/boot/zImage  ${work_dir}/$linux/arch/arm/boot/uImage</span>
</span></span><span class="line"><span class="cl">  <span class="nb">echo</span> -e  <span class="s2">&#34;\e[0m&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1"># 编译busybox，编译之后把&#34;${busybox}/_install/*&#34;拷贝到rootfs目录下</span>
</span></span><span class="line"><span class="cl">  <span class="nb">echo</span> -e  <span class="s2">&#34;\e[33m&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nb">cd</span>  <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span>/<span class="si">${</span><span class="nv">busybox</span><span class="si">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  make distclean -j<span class="si">${</span><span class="nv">jobs</span><span class="si">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  make defconfig -j<span class="si">${</span><span class="nv">jobs</span><span class="si">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  make -j<span class="si">${</span><span class="nv">jobs</span><span class="si">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  make install -j<span class="si">${</span><span class="nv">jobs</span><span class="si">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nb">echo</span> -e  <span class="s2">&#34;\e[0m&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1"># 搭建网络开发环境</span>
</span></span><span class="line"><span class="cl">  <span class="nb">echo</span> -e  <span class="s2">&#34;\e[95m&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="o">[</span> ! -f <span class="s2">&#34;</span><span class="nv">$Operate_Net_File</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">	  sudo touch <span class="si">${</span><span class="nv">Operate_Net_File</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">else</span>
</span></span><span class="line"><span class="cl">	  <span class="nb">echo</span> <span class="s2">&#34;</span><span class="si">${</span><span class="nv">uboot_config_file</span><span class="si">}</span><span class="s2"> is exists.&#34;</span>
</span></span><span class="line"><span class="cl">	  <span class="k">if</span> <span class="o">[</span> ! -f <span class="s2">&#34;</span><span class="nv">$Operate_Net_File</span><span class="s2">.old&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">		  sudo cp <span class="si">${</span><span class="nv">Operate_Net_File</span><span class="si">}</span> <span class="o">{</span><span class="nv">$Operate_Net_File</span><span class="o">}</span>.old
</span></span><span class="line"><span class="cl">	  <span class="k">else</span>
</span></span><span class="line"><span class="cl">		  <span class="nb">echo</span> <span class="s2">&#34;</span><span class="si">${</span><span class="nv">Operate_Net_File</span><span class="si">}</span><span class="s2">.old is exists.&#34;</span>
</span></span><span class="line"><span class="cl">	  <span class="k">fi</span>
</span></span><span class="line"><span class="cl">  <span class="k">fi</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  sudo chown <span class="si">${</span><span class="nv">USER</span><span class="si">}</span>:<span class="si">${</span><span class="nv">USER</span><span class="si">}</span> <span class="si">${</span><span class="nv">Operate_Net_File</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="o">[</span> ! <span class="s2">&#34;</span><span class="k">$(</span>cat /etc/network/interfaces <span class="p">|</span> grep -o <span class="s2">&#34;br0&#34;</span> <span class="p">|</span> head -n 1<span class="k">)</span><span class="s2">&#34;</span> <span class="o">=</span> <span class="s2">&#34;br0&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">	  <span class="nb">echo</span> <span class="s2">&#34;debug_1&#34;</span>
</span></span><span class="line"><span class="cl">	  cat <span class="si">${</span><span class="nv">Operate_Net_File</span><span class="si">}</span> &gt; <span class="si">${</span><span class="nv">Operate_Net_File</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">	  <span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="k">$(</span>ip addr <span class="p">|</span> grep -o <span class="s2">&#34;ens33&#34;</span> <span class="p">|</span> head -n 1<span class="k">)</span><span class="s2">&#34;</span> <span class="o">=</span> <span class="s2">&#34;ens33&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">		  <span class="nb">echo</span> <span class="s2">&#34;auto lo&#34;</span> &gt;&gt; <span class="si">${</span><span class="nv">Operate_Net_File</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">		  <span class="nb">echo</span> <span class="s2">&#34;iface lo inet loopback&#34;</span> &gt;&gt; <span class="si">${</span><span class="nv">Operate_Net_File</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">		  <span class="nb">echo</span> <span class="s2">&#34;&#34;</span> &gt;&gt; <span class="si">${</span><span class="nv">Operate_Net_File</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">		  <span class="nb">echo</span> <span class="s2">&#34;auto ens33&#34;</span> &gt;&gt; <span class="si">${</span><span class="nv">Operate_Net_File</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">		  <span class="nb">echo</span> <span class="s2">&#34;&#34;</span> &gt;&gt; <span class="si">${</span><span class="nv">Operate_Net_File</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">		  <span class="nb">echo</span> <span class="s2">&#34;auto br0&#34;</span> &gt;&gt; <span class="si">${</span><span class="nv">Operate_Net_File</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">		  <span class="nb">echo</span> <span class="s2">&#34;iface br0 inet dhcp&#34;</span> &gt;&gt; <span class="si">${</span><span class="nv">Operate_Net_File</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">		  <span class="nb">echo</span> <span class="s2">&#34;	bridge_ports ens33&#34;</span> &gt;&gt; <span class="si">${</span><span class="nv">Operate_Net_File</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">		  sudo chown <span class="si">${</span><span class="nv">root</span><span class="si">}</span>:<span class="si">${</span><span class="nv">root</span><span class="si">}</span> <span class="si">${</span><span class="nv">Operate_Net_File</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">		  sudo /etc/init.d/networking restart
</span></span><span class="line"><span class="cl">	  <span class="k">else</span>
</span></span><span class="line"><span class="cl">		  <span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="k">$(</span>ip addr <span class="p">|</span> grep -o <span class="s2">&#34;eth0&#34;</span><span class="k">)</span><span class="s2">&#34;</span> <span class="o">=</span> <span class="s2">&#34;eth0&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">			  <span class="nb">echo</span> <span class="s2">&#34;auto lo&#34;</span> &gt;&gt; <span class="si">${</span><span class="nv">Operate_Net_File</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">			  <span class="nb">echo</span> <span class="s2">&#34;iface lo inet loopback&#34;</span> &gt;&gt; <span class="si">${</span><span class="nv">Operate_Net_File</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">			  <span class="nb">echo</span> <span class="s2">&#34;&#34;</span> &gt;&gt; <span class="si">${</span><span class="nv">Operate_Net_File</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">			  <span class="nb">echo</span> <span class="s2">&#34;auto eth0&#34;</span> &gt;&gt; <span class="si">${</span><span class="nv">Operate_Net_File</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">			  <span class="nb">echo</span> <span class="s2">&#34;&#34;</span> &gt;&gt; <span class="si">${</span><span class="nv">Operate_Net_File</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">			  <span class="nb">echo</span> <span class="s2">&#34;auto br0&#34;</span> &gt;&gt; <span class="si">${</span><span class="nv">Operate_Net_File</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">			  <span class="nb">echo</span> <span class="s2">&#34;iface br0 inet dhcp&#34;</span> &gt;&gt; <span class="si">${</span><span class="nv">Operate_Net_File</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">			  <span class="nb">echo</span> <span class="s2">&#34;	bridge_ports eth0&#34;</span> &gt;&gt; <span class="si">${</span><span class="nv">Operate_Net_File</span><span class="si">}</span>			  
</span></span><span class="line"><span class="cl">			  sudo /etc/init.d/networking restart
</span></span><span class="line"><span class="cl">		  <span class="k">fi</span>
</span></span><span class="line"><span class="cl">	  <span class="k">fi</span>
</span></span><span class="line"><span class="cl">  <span class="k">else</span>
</span></span><span class="line"><span class="cl">	  <span class="nb">echo</span> <span class="s2">&#34;br0 exists.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="k">fi</span>  
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="k">$(</span>ifconfig <span class="p">|</span> grep -wo <span class="s2">&#34;br0&#34;</span><span class="k">)</span><span class="s2">&#34;</span> <span class="o">=</span> <span class="s2">&#34;br0&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">	  <span class="nv">of_ip_var1</span><span class="o">=</span><span class="k">$(</span>ifconfig <span class="p">|</span> grep -w -A <span class="m">1</span> <span class="s2">&#34;br0&#34;</span> <span class="p">|</span> grep -v <span class="s2">&#34;br0&#34;</span> <span class="p">|</span> awk <span class="s1">&#39;$1==&#34;inet&#34; {print $2}&#39;</span> <span class="p">|</span> grep -oE <span class="s2">&#34;\b([0-9]{1,3}\.){3}[0-9]{1,3}\b&#34;</span> <span class="p">|</span> awk -F <span class="s1">&#39;.&#39;</span> <span class="s1">&#39;{print $1}&#39;</span><span class="k">)</span><span class="p">;</span> <span class="nb">echo</span> <span class="si">${</span><span class="nv">of_ip_var1</span><span class="si">}</span> 
</span></span><span class="line"><span class="cl">	  <span class="nv">of_ip_var2</span><span class="o">=</span><span class="k">$(</span>ifconfig <span class="p">|</span> grep -w -A <span class="m">1</span> <span class="s2">&#34;br0&#34;</span> <span class="p">|</span> grep -v <span class="s2">&#34;br0&#34;</span> <span class="p">|</span> awk <span class="s1">&#39;$1==&#34;inet&#34; {print $2}&#39;</span> <span class="p">|</span> grep -oE <span class="s2">&#34;\b([0-9]{1,3}\.){3}[0-9]{1,3}\b&#34;</span> <span class="p">|</span> awk -F <span class="s1">&#39;.&#39;</span> <span class="s1">&#39;{print $2}&#39;</span><span class="k">)</span><span class="p">;</span> <span class="nb">echo</span> <span class="si">${</span><span class="nv">of_ip_var2</span><span class="si">}</span> 
</span></span><span class="line"><span class="cl">	  <span class="nv">of_ip_var3</span><span class="o">=</span><span class="k">$(</span>ifconfig <span class="p">|</span> grep -w -A <span class="m">1</span> <span class="s2">&#34;br0&#34;</span> <span class="p">|</span> grep -v <span class="s2">&#34;br0&#34;</span> <span class="p">|</span> awk <span class="s1">&#39;$1==&#34;inet&#34; {print $2}&#39;</span> <span class="p">|</span> grep -oE <span class="s2">&#34;\b([0-9]{1,3}\.){3}[0-9]{1,3}\b&#34;</span> <span class="p">|</span> awk -F <span class="s1">&#39;.&#39;</span> <span class="s1">&#39;{print $3}&#39;</span><span class="k">)</span><span class="p">;</span> <span class="nb">echo</span> <span class="si">${</span><span class="nv">of_ip_var3</span><span class="si">}</span> 
</span></span><span class="line"><span class="cl">	  <span class="nv">of_ip_var4</span><span class="o">=</span><span class="k">$(</span>ifconfig <span class="p">|</span> grep -w -A <span class="m">1</span> <span class="s2">&#34;br0&#34;</span> <span class="p">|</span> grep -v <span class="s2">&#34;br0&#34;</span> <span class="p">|</span> awk <span class="s1">&#39;$1==&#34;inet&#34; {print $2}&#39;</span> <span class="p">|</span> grep -oE <span class="s2">&#34;\b([0-9]{1,3}\.){3}[0-9]{1,3}\b&#34;</span> <span class="p">|</span> awk -F <span class="s1">&#39;.&#39;</span> <span class="s1">&#39;{print $4}&#39;</span><span class="k">)</span><span class="p">;</span> <span class="nb">echo</span> <span class="si">${</span><span class="nv">of_ip_var4</span><span class="si">}</span> 
</span></span><span class="line"><span class="cl">  <span class="k">else</span>
</span></span><span class="line"><span class="cl">	  <span class="nb">echo</span> <span class="s2">&#34;The br0 not exists.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="k">fi</span>
</span></span><span class="line"><span class="cl">  sudo chown <span class="si">${</span><span class="nv">USER</span><span class="si">}</span>:<span class="si">${</span><span class="nv">USER</span><span class="si">}</span> <span class="si">${</span><span class="nv">Operate_Net_File</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="o">[</span> ! -f <span class="s2">&#34;</span><span class="si">${</span><span class="nv">uboot_config_file</span><span class="si">}</span><span class="s2">.old&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">	  cp <span class="si">${</span><span class="nv">uboot_config_file</span><span class="si">}</span> <span class="si">${</span><span class="nv">uboot_config_file</span><span class="si">}</span>.old
</span></span><span class="line"><span class="cl">  <span class="k">else</span>
</span></span><span class="line"><span class="cl">	  cat <span class="si">${</span><span class="nv">uboot_config_file</span><span class="si">}</span>.old &gt;  <span class="si">${</span><span class="nv">uboot_config_file</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">fi</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nv">uboot_config_file_var1</span><span class="o">=</span><span class="k">$(</span>grep -n <span class="s2">&#34;\/\* Basic environment settings \*\/&#34;</span> <span class="si">${</span><span class="nv">uboot_config_file</span><span class="si">}</span>.old <span class="p">|</span> tr <span class="s1">&#39;:&#39;</span> <span class="s1">&#39; &#39;</span> <span class="p">|</span> awk <span class="s1">&#39;{print $1}&#39;</span><span class="k">)</span>
</span></span><span class="line"><span class="cl">  <span class="nv">uboot_config_file_var2</span><span class="o">=</span><span class="k">$((</span>uboot_config_file_var1 <span class="o">+</span> <span class="m">1</span><span class="k">))</span>
</span></span><span class="line"><span class="cl">  cat <span class="si">${</span><span class="nv">uboot_config_file</span><span class="si">}</span>.old &gt; <span class="si">${</span><span class="nv">uboot_config_file</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">  sed -i <span class="s1">&#39;/CONFIG_BOOTCOMMAND\b/d&#39;</span> <span class="si">${</span><span class="nv">uboot_config_file</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">  sed -i <span class="s1">&#39;/run distro_bootcmd\b/d&#39;</span> <span class="si">${</span><span class="nv">uboot_config_file</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">  sed -i <span class="s1">&#39;/run bootflash\b/d&#39;</span> <span class="si">${</span><span class="nv">uboot_config_file</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">  sed -i  <span class="s2">&#34;</span><span class="si">${</span><span class="nv">uboot_config_file_var2</span><span class="si">}</span><span class="s2">i\#define CONFIG_SERVERIP </span><span class="si">${</span><span class="nv">of_ip_var1</span><span class="si">}</span><span class="s2">.</span><span class="si">${</span><span class="nv">of_ip_var2</span><span class="si">}</span><span class="s2">.</span><span class="si">${</span><span class="nv">of_ip_var3</span><span class="si">}</span><span class="s2">.</span><span class="si">${</span><span class="nv">of_ip_var4</span><span class="si">}</span><span class="s2">&#34;</span> <span class="si">${</span><span class="nv">uboot_config_file</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">  sed -i  <span class="s2">&#34;</span><span class="si">${</span><span class="nv">uboot_config_file_var2</span><span class="si">}</span><span class="s2">i\#define CONFIG_NETMASK 255.255.255.0&#34;</span> <span class="si">${</span><span class="nv">uboot_config_file</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">  sed -i  <span class="s2">&#34;</span><span class="si">${</span><span class="nv">uboot_config_file_var2</span><span class="si">}</span><span class="s2">i\#define CONFIG_IPADDR </span><span class="si">${</span><span class="nv">of_ip_var1</span><span class="si">}</span><span class="s2">.</span><span class="si">${</span><span class="nv">of_ip_var2</span><span class="si">}</span><span class="s2">.</span><span class="si">${</span><span class="nv">of_ip_var3</span><span class="si">}</span><span class="s2">.223&#34;</span> <span class="si">${</span><span class="nv">uboot_config_file</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">  sed -i  <span class="s2">&#34;</span><span class="si">${</span><span class="nv">uboot_config_file_var2</span><span class="si">}</span><span class="s2">i\/* netmask */&#34;</span> <span class="si">${</span><span class="nv">uboot_config_file</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">  sed -i  <span class="s2">&#34;</span><span class="si">${</span><span class="nv">uboot_config_file_var2</span><span class="si">}</span><span class="s2">i\#define CONFIG_BOOTCOMMAND \&#34;tftp 0x60003000 uImage;tftp 0x60500000 vexpress-v2p-ca9.dtb;setenv bootargs &#39;root=/dev/mmcblk0 console=ttyAMA0&#39;;bootm 0x60003000 - 0x60500000;\&#34; \\&#34;</span> <span class="si">${</span><span class="nv">uboot_config_file</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">  <span class="nb">echo</span> -e  <span class="s2">&#34;\e[0m&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1"># 编译u-boot，编译之后会在${uboot}目录下出现u-boot，传真u-boot示例：sudo qemu-system-arm -M vexpress-a9 -m 256 -kernel ./u-boot -nographic</span>
</span></span><span class="line"><span class="cl">  <span class="nb">echo</span> -e  <span class="s2">&#34;\e[34m&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nb">cd</span>  <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span>/<span class="si">${</span><span class="nv">uboot</span><span class="si">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  make distclean -j<span class="si">${</span><span class="nv">jobs</span><span class="si">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  make vexpress_ca9x4_defconfig -j<span class="si">${</span><span class="nv">jobs</span><span class="si">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  make -j<span class="si">${</span><span class="nv">jobs</span><span class="si">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nb">echo</span> -e  <span class="s2">&#34;\e[0m&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1"># 准备根文件系统</span>
</span></span><span class="line"><span class="cl">  <span class="nb">echo</span> -e  <span class="s2">&#34;\e[33m&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nb">cd</span> <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  mkdir -p <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span>/rootfs/<span class="o">{</span>dev,etc/init.d,lib,mnt<span class="o">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  sudo cp -vrf <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span>/<span class="si">${</span><span class="nv">busybox</span><span class="si">}</span>/_install/* <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span>/rootfs/<span class="p">;</span>
</span></span><span class="line"><span class="cl">  sudo cp -vrf /usr/arm-linux-gnueabi/lib/* <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span>/rootfs/lib/<span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nb">cd</span> <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span>/rootfs/dev<span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># 创建字符设备类型的设备节点，这些设备节点的主设备号为4,次设备号为1..11</span>
</span></span><span class="line"><span class="cl">  sudo mknod -m <span class="m">666</span> console c <span class="m">4</span> 1<span class="p">;</span>
</span></span><span class="line"><span class="cl">  sudo mknod -m <span class="m">666</span> null c <span class="m">4</span> 2<span class="p">;</span>
</span></span><span class="line"><span class="cl">  sudo mknod -m <span class="m">666</span> tty1 c <span class="m">4</span> 3<span class="p">;</span>
</span></span><span class="line"><span class="cl">  sudo mknod -m <span class="m">666</span> tty2 c <span class="m">4</span> 4<span class="p">;</span>
</span></span><span class="line"><span class="cl">  sudo mknod -m <span class="m">666</span> tty3 c <span class="m">4</span> 5<span class="p">;</span>
</span></span><span class="line"><span class="cl">  sudo mknod -m <span class="m">666</span> tty4 c <span class="m">4</span> 6<span class="p">;</span>
</span></span><span class="line"><span class="cl">  sudo mknod -m <span class="m">666</span> tty5 c <span class="m">4</span> 7<span class="p">;</span>
</span></span><span class="line"><span class="cl">  sudo mknod -m <span class="m">666</span> tty6 c <span class="m">4</span> 8<span class="p">;</span>
</span></span><span class="line"><span class="cl">  sudo mknod -m <span class="m">666</span> tty7 c <span class="m">4</span> 9<span class="p">;</span>
</span></span><span class="line"><span class="cl">  sudo mknod -m <span class="m">666</span> tty8 c <span class="m">4</span> 10<span class="p">;</span>
</span></span><span class="line"><span class="cl">  sudo mknod -m <span class="m">666</span> tty9 c <span class="m">4</span> 11<span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1"># 在rootfs目录下准备挂载NFS脚本</span>
</span></span><span class="line"><span class="cl">  sudo touch <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span>/rootfs/mountNFS.sh
</span></span><span class="line"><span class="cl">  sudo chown <span class="si">${</span><span class="nv">USER</span><span class="si">}</span>:<span class="si">${</span><span class="nv">USER</span><span class="si">}</span> <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span>/rootfs/mountNFS.sh
</span></span><span class="line"><span class="cl">  cat <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span>/rootfs/mountNFS.sh &gt; <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span>/rootfs/mountNFS.sh
</span></span><span class="line"><span class="cl">  <span class="nb">echo</span> <span class="s2">&#34;ifconfig eth0 </span><span class="si">${</span><span class="nv">of_ip_var1</span><span class="si">}</span><span class="s2">.</span><span class="si">${</span><span class="nv">of_ip_var2</span><span class="si">}</span><span class="s2">.</span><span class="si">${</span><span class="nv">of_ip_var3</span><span class="si">}</span><span class="s2">.223&#34;</span> &gt;&gt; <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span>/rootfs/mountNFS.sh 
</span></span><span class="line"><span class="cl">  <span class="nb">echo</span> <span class="s2">&#34;mount -t nfs -o nolock </span><span class="si">${</span><span class="nv">of_ip_var1</span><span class="si">}</span><span class="s2">.</span><span class="si">${</span><span class="nv">of_ip_var2</span><span class="si">}</span><span class="s2">.</span><span class="si">${</span><span class="nv">of_ip_var3</span><span class="si">}</span><span class="s2">.</span><span class="si">${</span><span class="nv">of_ip_var4</span><span class="si">}</span><span class="s2">:</span><span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span><span class="s2"> /mnt&#34;</span> &gt;&gt; <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span>/rootfs/mountNFS.sh
</span></span><span class="line"><span class="cl">  sudo chown <span class="si">${</span><span class="nv">root</span><span class="si">}</span>:<span class="si">${</span><span class="nv">root</span><span class="si">}</span> <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span>/rootfs/mountNFS.sh
</span></span><span class="line"><span class="cl">  <span class="c1"># 进入qemu运行的虚拟机后通过以下命令运行脚本进行挂载nfs：&#34;sh mountNFS.sh&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nb">cd</span> <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># 制作rootfs.ext3，格式化rootfs.ext3为ext3文件系统类型，将rootfs.ext3挂载到/mnt，再将根文件系统拷贝到/mnt，然后解除/mnt挂载的rootfs.ext3，此时rootfs.ext3中已经有根文件系统了</span>
</span></span><span class="line"><span class="cl">  sudo dd <span class="k">if</span><span class="o">=</span>/dev/zero <span class="nv">of</span><span class="o">=</span>rootfs.ext3 <span class="nv">bs</span><span class="o">=</span>1M <span class="nv">count</span><span class="o">=</span><span class="m">32</span>
</span></span><span class="line"><span class="cl">  sudo mkfs.ext3 rootfs.ext3
</span></span><span class="line"><span class="cl">  sudo mount -t ext3 rootfs.ext3 /mnt -o loop
</span></span><span class="line"><span class="cl">  sudo cp -vrf <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span>/rootfs/* /mnt
</span></span><span class="line"><span class="cl">  sudo umount /mnt
</span></span><span class="line"><span class="cl">  <span class="nb">echo</span> -e  <span class="s2">&#34;\e[0m&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1"># tftpboot</span>
</span></span><span class="line"><span class="cl">  <span class="nb">echo</span> -e  <span class="s2">&#34;\e[96m&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># sudo chmod 775 $work_dir/$uboot/uImage;</span>
</span></span><span class="line"><span class="cl">  sudo rm -rf /tftpboot/*  
</span></span><span class="line"><span class="cl">  sudo cp -f <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span>/<span class="si">${</span><span class="nv">linux</span><span class="si">}</span>/arch/arm/boot/zImage /tftpboot<span class="p">;</span>
</span></span><span class="line"><span class="cl">  sudo cp -f <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span>/<span class="si">${</span><span class="nv">linux</span><span class="si">}</span>/arch/arm/boot/uImage /tftpboot<span class="p">;</span>
</span></span><span class="line"><span class="cl">  sudo cp -f <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span>/<span class="si">${</span><span class="nv">linux</span><span class="si">}</span>/arch/arm/boot/dts/vexpress-v2p-ca9.dtb /tftpboot<span class="p">;</span>
</span></span><span class="line"><span class="cl">  sudo cp -f <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span>/<span class="si">${</span><span class="nv">uboot</span><span class="si">}</span>/u-boot /tftpboot<span class="p">;</span>
</span></span><span class="line"><span class="cl">  sudo cp -f <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span>/rootfs.ext3 /tftpboot<span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nb">echo</span> -e  <span class="s2">&#34;\e[0m&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1"># QEMU运行虚拟机，通过sd卡加载linux内核</span>
</span></span><span class="line"><span class="cl">  <span class="nb">echo</span> -e  <span class="s2">&#34;\e[92m&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># qemu-system-arm -M vexpress-a9 -m 256M -kernel ${work_dir}/$linux/arch/arm/boot/zImage -dtb ${work_dir}/$linux/arch/arm/boot/dts/vexpress-v2p-ca9.dtb -nographic -append &#34;root=/dev/mmcblk0 rw console=ttyAMA0&#34; -sd ${work_dir}/rootfs.ext3;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1"># 在脚本外部执行，进入yenao_qemu_test目录执行下面的语句 </span>
</span></span><span class="line"><span class="cl">  <span class="c1"># qemu-system-arm -M vexpress-a9 -m 512M -kernel linux-4.4.232/arch/arm/boot/zImage -dtb linux-4.4.232/arch/arm/boot/dts/vexpress-v2p-ca9.dtb -nographic -append &#34;root=/dev/mmcblk0 rw console=ttyAMA0&#34; -sd rootfs.ext3</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1"># QEMU运行虚拟机，只加载u-boot</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># qemu-system-arm -M vexpress-a9 -m 256M -kernel ${work_dir}/${uboot}/u-boot  -nographic</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1"># 通过 u-boot 加载内核</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># cd /tftpboot</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># sudo qemu-system-arm -M vexpress-a9 -kernel u-boot -nographic -m 128M -net nic,vlan=0 -net tap,vlan=0,ifname=tap0 -sd rootfs.ext3</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$1</span><span class="s2">&#34;</span> <span class="o">=</span> <span class="s2">&#34;sd&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">	  <span class="c1"># QEMU运行虚拟机，通过sd卡加载linux内核	  </span>
</span></span><span class="line"><span class="cl">	  sudo qemu-system-arm -M vexpress-a9 -m 256M -kernel <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span>/<span class="nv">$linux</span>/arch/arm/boot/zImage -dtb <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span>/<span class="nv">$linux</span>/arch/arm/boot/dts/vexpress-v2p-ca9.dtb -nographic -append <span class="s2">&#34;root=/dev/mmcblk0 rw console=ttyAMA0&#34;</span> -sd <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span>/rootfs.ext3<span class="p">;</span>	  
</span></span><span class="line"><span class="cl">  <span class="k">elif</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$1</span><span class="s2">&#34;</span> <span class="o">=</span> <span class="s2">&#34;u-boot&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">	  <span class="nb">cd</span> /tftpboot
</span></span><span class="line"><span class="cl">	  sudo qemu-system-arm -M vexpress-a9 -kernel u-boot -nographic -m 128M -net nic,vlan<span class="o">=</span><span class="m">0</span> -net tap,vlan<span class="o">=</span>0,ifname<span class="o">=</span>tap0 -sd rootfs.ext3
</span></span><span class="line"><span class="cl">  <span class="k">elif</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$1</span><span class="s2">&#34;</span> <span class="o">=</span> <span class="s2">&#34;help&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">	  <span class="nb">echo</span> <span class="s2">&#34;sd start: </span><span class="si">${</span><span class="nv">cmdself</span><span class="si">}</span><span class="s2"> sd&#34;</span>
</span></span><span class="line"><span class="cl">	  <span class="nb">echo</span> <span class="s2">&#34;u-boot start: </span><span class="si">${</span><span class="nv">cmdself</span><span class="si">}</span><span class="s2"> u-boot&#34;</span>
</span></span><span class="line"><span class="cl">	  <span class="nb">echo</span> <span class="s2">&#34;out sd start var: </span><span class="si">${</span><span class="nv">cmdself</span><span class="si">}</span><span class="s2"> out sd&#34;</span>
</span></span><span class="line"><span class="cl">	  <span class="nb">echo</span> <span class="s2">&#34;out u-boot start var: </span><span class="si">${</span><span class="nv">cmdself</span><span class="si">}</span><span class="s2"> out u-boot&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="k">elif</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$1</span><span class="s2">&#34;</span> <span class="o">=</span> <span class="s2">&#34;out&#34;</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$2</span><span class="s2">&#34;</span> <span class="o">=</span> <span class="s2">&#34;sd&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">	  <span class="nb">echo</span> <span class="s2">&#34; qemu-system-arm -M vexpress-a9 -m 256M -kernel </span><span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span><span class="s2">/</span><span class="nv">$linux</span><span class="s2">/arch/arm/boot/zImage -dtb </span><span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span><span class="s2">/</span><span class="nv">$linux</span><span class="s2">/arch/arm/boot/dts/vexpress-v2p-ca9.dtb -nographic -append \&#34;root=/dev/mmcblk0 rw console=ttyAMA0\&#34; -sd </span><span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span><span class="s2">/rootfs.ext3;&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="k">elif</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$1</span><span class="s2">&#34;</span> <span class="o">=</span> <span class="s2">&#34;out&#34;</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$2</span><span class="s2">&#34;</span> <span class="o">=</span> <span class="s2">&#34;u-boot&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">	  <span class="nb">echo</span> <span class="s2">&#34;sudo qemu-system-arm -M vexpress-a9 -kernel u-boot -nographic -m 128M -net nic,vlan=0 -net tap,vlan=0,ifname=tap0 -sd rootfs.ext3&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="k">else</span>
</span></span><span class="line"><span class="cl">	  <span class="c1"># 默认通过u-boot加载linux内核</span>
</span></span><span class="line"><span class="cl">	  <span class="nb">cd</span> /tftpboot
</span></span><span class="line"><span class="cl">	  sudo qemu-system-arm -M vexpress-a9 -kernel u-boot -nographic -m 128M -net nic,vlan<span class="o">=</span><span class="m">0</span> -net tap,vlan<span class="o">=</span>0,ifname<span class="o">=</span>tap0 -sd rootfs.ext3
</span></span><span class="line"><span class="cl">  <span class="k">fi</span>
</span></span><span class="line"><span class="cl">  <span class="nb">echo</span> -e  <span class="s2">&#34;\e[0m&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># 部分参数说明</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># |----------------------------------------------------------------+--------------------------------------------------------------------------------------|</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># | 参数                                                           | 含义                                                                                 |</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># |----------------------------------------------------------------+--------------------------------------------------------------------------------------|</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># | M vexpress-a9`                                                 | 指定虚拟机的机型为 `vexpress-a9`，即使用 ARMv7 架构的 Versatile Express 开发板模型。 |</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># |----------------------------------------------------------------+--------------------------------------------------------------------------------------|</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># | m 512M`                                                        | 设置虚拟机的内存大小为 512MB。                                                       |</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># |----------------------------------------------------------------+--------------------------------------------------------------------------------------|</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># | kernel ${work_dir}/$linux/arch/arm/boot/zImage`                | 指定 Linux 内核镜像的路径和文件名。                                                  |</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># |----------------------------------------------------------------+--------------------------------------------------------------------------------------|</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># | dtb ${work_dir}/$linux/arch/arm/boot/dts/vexpress-v2p-ca9.dtb` | 指定设备树二进制文件（Device Tree Blob）的路径和文件名。                             |</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># |----------------------------------------------------------------+--------------------------------------------------------------------------------------|</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># | nographic`                                                     | 以无图形界面的方式运行虚拟机。                                                       |</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># |----------------------------------------------------------------+--------------------------------------------------------------------------------------|</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># | append &#34;root=/dev/mmcblk0 rw console=ttyAMA0&#34;`                 | 指定 Linux 内核启动参数，包括根文件系统的设备路径、读写权限和控制台终端。            |</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># |----------------------------------------------------------------+--------------------------------------------------------------------------------------|</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># | sd ${work_dir}/rootfs.ext3`                                    | 指定虚拟机的根文件系统镜像路径和文件名。                                             |</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># |----------------------------------------------------------------+--------------------------------------------------------------------------------------|</span></span></span></code></pre></td></tr></table>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-headline-9" class="outline-3">
<h3 id="headline-9">
内核编译
</h3>
<div id="outline-text-headline-9" class="outline-text-3">
<div class="src src-bash">
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">  <span class="nv">linux</span><span class="o">=</span><span class="s2">&#34;linux-4.4.232&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># linux=&#34;linux-4.4.76&#34;;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">busybox</span><span class="o">=</span><span class="s2">&#34;busybox-1.32.0&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">uboot</span><span class="o">=</span><span class="s2">&#34;u-boot-2017.05&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># uboot=&#34;u-boot-2020.07&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">file_linux</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">linux</span><span class="si">}</span><span class="s2">.tar.xz&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">file_busybox</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">busybox</span><span class="si">}</span><span class="s2">.tar.bz2&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">file_uboot</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">uboot</span><span class="si">}</span><span class="s2">.tar.bz2&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">work_dir_name</span><span class="o">=</span><span class="s2">&#34;yenao_qemu_test&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">work_dir</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span><span class="s2">/</span><span class="si">${</span><span class="nv">work_dir_name</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">Operate_Net_File</span><span class="o">=</span><span class="s2">&#34;/etc/network/interfaces&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">uboot_config_file</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span><span class="s2">/</span><span class="si">${</span><span class="nv">uboot</span><span class="si">}</span><span class="s2">/include/configs/vexpress_common.h&#34;</span>
</span></span><span class="line"><span class="cl">  mkdir -p <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nb">cd</span> <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">cpu_cores</span><span class="o">=</span><span class="k">$(</span>nproc<span class="k">)</span>
</span></span><span class="line"><span class="cl">  <span class="nv">jobs</span><span class="o">=</span><span class="k">$((</span>cpu_cores <span class="o">*</span> <span class="m">2</span><span class="k">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1"># 判断linux内核是否准备好</span>
</span></span><span class="line"><span class="cl">  <span class="k">while</span> true<span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">do</span>
</span></span><span class="line"><span class="cl">	  <span class="nv">result</span><span class="o">=</span><span class="k">$(</span>curl ipinfo.io <span class="p">|</span> grep <span class="s2">&#34;country&#34;</span> <span class="p">|</span> tr <span class="s1">&#39;&#34;&#39;</span> <span class="s1">&#39; &#39;</span> <span class="p">|</span> awk <span class="s1">&#39;{print $3}&#39;</span><span class="k">)</span>
</span></span><span class="line"><span class="cl">	  <span class="k">if</span> <span class="o">[</span> -z <span class="s2">&#34;</span><span class="si">${</span><span class="nv">result</span><span class="si">}</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">		  <span class="k">continue</span>
</span></span><span class="line"><span class="cl">	  <span class="k">else</span>
</span></span><span class="line"><span class="cl">		  <span class="nb">echo</span> -e <span class="s2">&#34;\e[32mcountry: </span><span class="si">${</span><span class="nv">result</span><span class="si">}</span><span class="s2">\e[0m&#34;</span>
</span></span><span class="line"><span class="cl">		  <span class="nb">break</span>
</span></span><span class="line"><span class="cl">	  <span class="k">fi</span>
</span></span><span class="line"><span class="cl">  <span class="k">done</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">while</span> true<span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">do</span>
</span></span><span class="line"><span class="cl">	  <span class="k">if</span> <span class="o">[</span> ! -f <span class="s2">&#34;</span><span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span><span class="s2">/</span><span class="nv">$file_linux</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>		  
</span></span><span class="line"><span class="cl">		  <span class="nb">echo</span> -e <span class="s2">&#34;\e[32m&#34;</span>
</span></span><span class="line"><span class="cl">		  <span class="k">if</span> <span class="o">[</span> <span class="si">${</span><span class="nv">result</span><span class="si">}</span> !<span class="o">=</span> <span class="s2">&#34;CN&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>				  
</span></span><span class="line"><span class="cl">			  <span class="c1"># wget https://cdn.kernel.org/pub/linux/kernel/v4.x/linux-4.4.232.tar.xz</span>
</span></span><span class="line"><span class="cl">			  wget https://cdn.kernel.org/pub/linux/kernel/v4.x/<span class="si">${</span><span class="nv">file_linux</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">		  <span class="k">else</span>
</span></span><span class="line"><span class="cl">			  <span class="c1"># wget https://mirrors.ustc.edu.cn/kernel.org/linux/kernel/v4.x/linux-4.4.232.tar.xz</span>
</span></span><span class="line"><span class="cl">			  wget https://mirrors.ustc.edu.cn/kernel.org/linux/kernel/v4.x/<span class="si">${</span><span class="nv">file_linux</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">		  <span class="k">fi</span>
</span></span><span class="line"><span class="cl">	  <span class="k">else</span>
</span></span><span class="line"><span class="cl">		  <span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="k">$(</span>sha256sum <span class="si">${</span><span class="nv">file_linux</span><span class="si">}</span><span class="k">)</span><span class="s2">&#34;</span> !<span class="o">=</span> <span class="s2">&#34;4eae8865deaf03f0d13bf5056e258d451a468cabc5158757b247b0e43518fd34  </span><span class="si">${</span><span class="nv">file_linux</span><span class="si">}</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">			  rm -rf <span class="si">${</span><span class="nv">file_linux</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">			  <span class="k">continue</span>
</span></span><span class="line"><span class="cl">		  <span class="k">else</span>
</span></span><span class="line"><span class="cl">			  <span class="nb">echo</span> -e <span class="s2">&#34;\e[32m</span><span class="si">${</span><span class="nv">file_linux</span><span class="si">}</span><span class="s2"> 已下载\e[0m&#34;</span>
</span></span><span class="line"><span class="cl">			  break<span class="p">;</span>
</span></span><span class="line"><span class="cl">		  <span class="k">fi</span>
</span></span><span class="line"><span class="cl">	  <span class="k">fi</span>
</span></span><span class="line"><span class="cl">	  <span class="nb">echo</span> -e  <span class="s2">&#34;\e[0m&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="k">done</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1"># 临时配置交叉编译环境</span>
</span></span><span class="line"><span class="cl">  <span class="nb">export</span> <span class="nv">ARCH</span><span class="o">=</span>arm <span class="o">&amp;&amp;</span> <span class="nb">export</span> <span class="nv">CROSS_COMPILE</span><span class="o">=</span>arm-linux-gnueabi-<span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1"># 判断linux内核是否解压</span>
</span></span><span class="line"><span class="cl">  <span class="nb">echo</span> -e  <span class="s2">&#34;\e[34m&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># kernel</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="o">[</span> -d <span class="s2">&#34;</span><span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span><span class="s2">/</span><span class="nv">$linux</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">	  <span class="nb">echo</span> <span class="s2">&#34;</span><span class="nv">$linux</span><span class="s2"> exists.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="k">else</span>
</span></span><span class="line"><span class="cl">	  tar xvf <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span>/<span class="nv">$file_linux</span> -C <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">fi</span>
</span></span><span class="line"><span class="cl">  <span class="nb">echo</span> -e  <span class="s2">&#34;\e[0m&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nv">cpu_cores</span><span class="o">=</span><span class="k">$(</span>nproc<span class="k">)</span>
</span></span><span class="line"><span class="cl">  <span class="nv">jobs</span><span class="o">=</span><span class="k">$((</span>cpu_cores <span class="o">*</span> <span class="m">2</span><span class="k">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1"># 编译linux内核</span>
</span></span><span class="line"><span class="cl">  <span class="nb">echo</span> -e  <span class="s2">&#34;\e[32m&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nb">cd</span>  <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span>/<span class="si">${</span><span class="nv">linux</span><span class="si">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  make distclean -j<span class="si">${</span><span class="nv">jobs</span><span class="si">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  make vexpress_defconfig -j<span class="si">${</span><span class="nv">jobs</span><span class="si">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  make zImage -j<span class="si">${</span><span class="nv">jobs</span><span class="si">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  make modules -j<span class="si">${</span><span class="nv">jobs</span><span class="si">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  make <span class="nv">LOADADDR</span><span class="o">=</span>0x60003000 uImage -j<span class="si">${</span><span class="nv">jobs</span><span class="si">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  make dtbs -j<span class="si">${</span><span class="nv">jobs</span><span class="si">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># mkimage -n &#39;mini2440&#39; -A arm -O linux -T kernel -C none -a 0x30008000 -e 0x30008040 -d  ${work_dir}/$linux/arch/arm/boot/zImage  ${work_dir}/$linux/arch/arm/boot/uImage</span>
</span></span><span class="line"><span class="cl">  <span class="nb">echo</span> -e  <span class="s2">&#34;\e[0m&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  sudo cp -vf <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span>/<span class="si">${</span><span class="nv">linux</span><span class="si">}</span>/arch/arm/boot/zImage /tftpboot<span class="p">;</span>
</span></span><span class="line"><span class="cl">  sudo cp -vf <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span>/<span class="si">${</span><span class="nv">linux</span><span class="si">}</span>/arch/arm/boot/uImage /tftpboot<span class="p">;</span>
</span></span><span class="line"><span class="cl">  sudo cp -vf <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span>/<span class="si">${</span><span class="nv">linux</span><span class="si">}</span>/arch/arm/boot/dts/vexpress-v2p-ca9.dtb /tftpboot<span class="p">;</span></span></span></code></pre></td></tr></table>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-headline-10" class="outline-3">
<h3 id="headline-10">
busybox 编译
</h3>
<div id="outline-text-headline-10" class="outline-text-3">
<div class="src src-bash">
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">  <span class="nv">linux</span><span class="o">=</span><span class="s2">&#34;linux-4.4.232&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># linux=&#34;linux-4.4.76&#34;;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">busybox</span><span class="o">=</span><span class="s2">&#34;busybox-1.32.0&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">uboot</span><span class="o">=</span><span class="s2">&#34;u-boot-2017.05&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># uboot=&#34;u-boot-2020.07&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">file_linux</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">linux</span><span class="si">}</span><span class="s2">.tar.xz&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">file_busybox</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">busybox</span><span class="si">}</span><span class="s2">.tar.bz2&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">file_uboot</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">uboot</span><span class="si">}</span><span class="s2">.tar.bz2&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">work_dir_name</span><span class="o">=</span><span class="s2">&#34;yenao_qemu_test&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">work_dir</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span><span class="s2">/</span><span class="si">${</span><span class="nv">work_dir_name</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">Operate_Net_File</span><span class="o">=</span><span class="s2">&#34;/etc/network/interfaces&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">uboot_config_file</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span><span class="s2">/</span><span class="si">${</span><span class="nv">uboot</span><span class="si">}</span><span class="s2">/include/configs/vexpress_common.h&#34;</span>
</span></span><span class="line"><span class="cl">  mkdir -p <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nb">cd</span> <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">cpu_cores</span><span class="o">=</span><span class="k">$(</span>nproc<span class="k">)</span>
</span></span><span class="line"><span class="cl">  <span class="nv">jobs</span><span class="o">=</span><span class="k">$((</span>cpu_cores <span class="o">*</span> <span class="m">2</span><span class="k">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1"># 判断busybox文件是否准备好</span>
</span></span><span class="line"><span class="cl">  <span class="k">while</span> true<span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">do</span>
</span></span><span class="line"><span class="cl">	  <span class="k">if</span> <span class="o">[</span> ! -f <span class="s2">&#34;</span><span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span><span class="s2">/</span><span class="nv">$file_busybox</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">		  <span class="nb">echo</span> -e  <span class="s2">&#34;\e[33m&#34;</span>
</span></span><span class="line"><span class="cl">		  <span class="c1"># wget --no-check-certificate https://busybox.net/downloads/busybox-1.32.0.tar.bz2</span>
</span></span><span class="line"><span class="cl">		  wget --no-check-certificate https://busybox.net/downloads/<span class="si">${</span><span class="nv">file_busybox</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">		  <span class="nb">echo</span> -e  <span class="s2">&#34;\e[0m&#34;</span>
</span></span><span class="line"><span class="cl">	  <span class="k">else</span>
</span></span><span class="line"><span class="cl">		  <span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="k">$(</span>sha256sum <span class="si">${</span><span class="nv">file_busybox</span><span class="si">}</span><span class="k">)</span><span class="s2">&#34;</span> !<span class="o">=</span> <span class="s2">&#34;c35d87f1d04b2b153d33c275c2632e40d388a88f19a9e71727e0bbbff51fe689  </span><span class="si">${</span><span class="nv">file_busybox</span><span class="si">}</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">			  rm -rf <span class="si">${</span><span class="nv">file_busybo</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">			  <span class="k">continue</span>
</span></span><span class="line"><span class="cl">		  <span class="k">else</span>
</span></span><span class="line"><span class="cl">			  <span class="nb">echo</span> -e <span class="s2">&#34;\e[32m</span><span class="nv">$file_busybox</span><span class="s2"> 已下载\e[0m&#34;</span>
</span></span><span class="line"><span class="cl">			  break<span class="p">;</span>
</span></span><span class="line"><span class="cl">		  <span class="k">fi</span>
</span></span><span class="line"><span class="cl">	  <span class="k">fi</span>	  	  
</span></span><span class="line"><span class="cl">  <span class="k">done</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1"># 临时配置交叉编译环境</span>
</span></span><span class="line"><span class="cl">  <span class="nb">export</span> <span class="nv">ARCH</span><span class="o">=</span>arm <span class="o">&amp;&amp;</span> <span class="nb">export</span> <span class="nv">CROSS_COMPILE</span><span class="o">=</span>arm-linux-gnueabi-<span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1"># 判断busybox文件是否解压</span>
</span></span><span class="line"><span class="cl">  <span class="nb">echo</span> -e  <span class="s2">&#34;\e[33m&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="o">[</span> -d <span class="s2">&#34;</span><span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span><span class="s2">/</span><span class="nv">$busybox</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">	  <span class="nb">echo</span> <span class="s2">&#34;</span><span class="nv">$busybox</span><span class="s2"> exists.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="k">else</span>
</span></span><span class="line"><span class="cl">	  tar xvf <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span>/<span class="nv">$file_busybox</span> -C <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">fi</span>
</span></span><span class="line"><span class="cl">  <span class="nb">echo</span> -e  <span class="s2">&#34;\e[0m&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nv">cpu_cores</span><span class="o">=</span><span class="k">$(</span>nproc<span class="k">)</span>
</span></span><span class="line"><span class="cl">  <span class="nv">jobs</span><span class="o">=</span><span class="k">$((</span>cpu_cores <span class="o">*</span> <span class="m">2</span><span class="k">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1"># 编译busybox</span>
</span></span><span class="line"><span class="cl">  <span class="nb">cd</span>  <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span>/<span class="si">${</span><span class="nv">busybox</span><span class="si">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  make distclean -j<span class="si">${</span><span class="nv">jobs</span><span class="si">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  make defconfig -j<span class="si">${</span><span class="nv">jobs</span><span class="si">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  make -j<span class="si">${</span><span class="nv">jobs</span><span class="si">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  make install -j<span class="si">${</span><span class="nv">jobs</span><span class="si">}</span><span class="p">;</span></span></span></code></pre></td></tr></table>
</div>
</div>
</div>
<div id="outline-container-headline-11" class="outline-4">
<h4 id="headline-11">
rootfs
</h4>
<div id="outline-text-headline-11" class="outline-text-4">
<div class="src src-bash">
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">  <span class="nv">linux</span><span class="o">=</span><span class="s2">&#34;linux-4.4.232&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># linux=&#34;linux-4.4.76&#34;;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">busybox</span><span class="o">=</span><span class="s2">&#34;busybox-1.32.0&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">uboot</span><span class="o">=</span><span class="s2">&#34;u-boot-2017.05&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># uboot=&#34;u-boot-2020.07&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">file_linux</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">linux</span><span class="si">}</span><span class="s2">.tar.xz&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">file_busybox</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">busybox</span><span class="si">}</span><span class="s2">.tar.bz2&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">file_uboot</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">uboot</span><span class="si">}</span><span class="s2">.tar.bz2&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">work_dir_name</span><span class="o">=</span><span class="s2">&#34;yenao_qemu_test&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">work_dir</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span><span class="s2">/</span><span class="si">${</span><span class="nv">work_dir_name</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">Operate_Net_File</span><span class="o">=</span><span class="s2">&#34;/etc/network/interfaces&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">uboot_config_file</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span><span class="s2">/</span><span class="si">${</span><span class="nv">uboot</span><span class="si">}</span><span class="s2">/include/configs/vexpress_common.h&#34;</span>
</span></span><span class="line"><span class="cl">  mkdir -p <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nb">cd</span> <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">cpu_cores</span><span class="o">=</span><span class="k">$(</span>nproc<span class="k">)</span>
</span></span><span class="line"><span class="cl">  <span class="nv">jobs</span><span class="o">=</span><span class="k">$((</span>cpu_cores <span class="o">*</span> <span class="m">2</span><span class="k">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="o">[</span> <span class="k">$(</span>ifconfig <span class="p">|</span> grep -w <span class="s2">&#34;br0&#34;</span> <span class="p">|</span> awk <span class="s1">&#39;{print $1}&#39;</span><span class="k">)</span> <span class="o">=</span> <span class="s2">&#34;br0&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">	  <span class="nv">of_ip_var1</span><span class="o">=</span><span class="k">$(</span>ifconfig <span class="p">|</span> grep -w -A <span class="m">1</span> <span class="s2">&#34;br0&#34;</span> <span class="p">|</span> grep -v <span class="s2">&#34;br0&#34;</span> <span class="p">|</span> awk <span class="s1">&#39;$1==&#34;inet&#34; {print $2}&#39;</span> <span class="p">|</span> grep -oE <span class="s2">&#34;\b([0-9]{1,3}\.){3}[0-9]{1,3}\b&#34;</span> <span class="p">|</span> awk -F <span class="s1">&#39;.&#39;</span> <span class="s1">&#39;{print $1}&#39;</span><span class="k">)</span><span class="p">;</span> <span class="nb">echo</span> <span class="si">${</span><span class="nv">of_ip_var1</span><span class="si">}</span> 
</span></span><span class="line"><span class="cl">	  <span class="nv">of_ip_var2</span><span class="o">=</span><span class="k">$(</span>ifconfig <span class="p">|</span> grep -w -A <span class="m">1</span> <span class="s2">&#34;br0&#34;</span> <span class="p">|</span> grep -v <span class="s2">&#34;br0&#34;</span> <span class="p">|</span> awk <span class="s1">&#39;$1==&#34;inet&#34; {print $2}&#39;</span> <span class="p">|</span> grep -oE <span class="s2">&#34;\b([0-9]{1,3}\.){3}[0-9]{1,3}\b&#34;</span> <span class="p">|</span> awk -F <span class="s1">&#39;.&#39;</span> <span class="s1">&#39;{print $2}&#39;</span><span class="k">)</span><span class="p">;</span> <span class="nb">echo</span> <span class="si">${</span><span class="nv">of_ip_var2</span><span class="si">}</span> 
</span></span><span class="line"><span class="cl">	  <span class="nv">of_ip_var3</span><span class="o">=</span><span class="k">$(</span>ifconfig <span class="p">|</span> grep -w -A <span class="m">1</span> <span class="s2">&#34;br0&#34;</span> <span class="p">|</span> grep -v <span class="s2">&#34;br0&#34;</span> <span class="p">|</span> awk <span class="s1">&#39;$1==&#34;inet&#34; {print $2}&#39;</span> <span class="p">|</span> grep -oE <span class="s2">&#34;\b([0-9]{1,3}\.){3}[0-9]{1,3}\b&#34;</span> <span class="p">|</span> awk -F <span class="s1">&#39;.&#39;</span> <span class="s1">&#39;{print $3}&#39;</span><span class="k">)</span><span class="p">;</span> <span class="nb">echo</span> <span class="si">${</span><span class="nv">of_ip_var3</span><span class="si">}</span> 
</span></span><span class="line"><span class="cl">	  <span class="nv">of_ip_var4</span><span class="o">=</span><span class="k">$(</span>ifconfig <span class="p">|</span> grep -w -A <span class="m">1</span> <span class="s2">&#34;br0&#34;</span> <span class="p">|</span> grep -v <span class="s2">&#34;br0&#34;</span> <span class="p">|</span> awk <span class="s1">&#39;$1==&#34;inet&#34; {print $2}&#39;</span> <span class="p">|</span> grep -oE <span class="s2">&#34;\b([0-9]{1,3}\.){3}[0-9]{1,3}\b&#34;</span> <span class="p">|</span> awk -F <span class="s1">&#39;.&#39;</span> <span class="s1">&#39;{print $4}&#39;</span><span class="k">)</span><span class="p">;</span> <span class="nb">echo</span> <span class="si">${</span><span class="nv">of_ip_var4</span><span class="si">}</span> 
</span></span><span class="line"><span class="cl">  <span class="k">else</span>
</span></span><span class="line"><span class="cl">	  <span class="nb">echo</span> <span class="s2">&#34;The br0 not exists.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="k">fi</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1"># 准备根文件系统</span>
</span></span><span class="line"><span class="cl">  <span class="nb">cd</span> <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  mkdir -p <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span>/rootfs/<span class="o">{</span>dev,etc/init.d,lib,mnt<span class="o">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  sudo cp -vrf <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span>/<span class="si">${</span><span class="nv">busybox</span><span class="si">}</span>/_install/* <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span>/rootfs/<span class="p">;</span>
</span></span><span class="line"><span class="cl">  sudo cp -vrf /usr/arm-linux-gnueabi/lib/* <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span>/rootfs/lib/<span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nb">cd</span> <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span>/rootfs/dev<span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># 创建字符设备类型的设备节点，这些设备节点的主设备号为4,次设备号为1..11</span>
</span></span><span class="line"><span class="cl">  sudo mknod -m <span class="m">666</span> console c <span class="m">4</span> 1<span class="p">;</span>
</span></span><span class="line"><span class="cl">  sudo mknod -m <span class="m">666</span> null c <span class="m">4</span> 2<span class="p">;</span>
</span></span><span class="line"><span class="cl">  sudo mknod -m <span class="m">666</span> tty1 c <span class="m">4</span> 3<span class="p">;</span>
</span></span><span class="line"><span class="cl">  sudo mknod -m <span class="m">666</span> tty2 c <span class="m">4</span> 4<span class="p">;</span>
</span></span><span class="line"><span class="cl">  sudo mknod -m <span class="m">666</span> tty3 c <span class="m">4</span> 5<span class="p">;</span>
</span></span><span class="line"><span class="cl">  sudo mknod -m <span class="m">666</span> tty4 c <span class="m">4</span> 6<span class="p">;</span>
</span></span><span class="line"><span class="cl">  sudo mknod -m <span class="m">666</span> tty5 c <span class="m">4</span> 7<span class="p">;</span>
</span></span><span class="line"><span class="cl">  sudo mknod -m <span class="m">666</span> tty6 c <span class="m">4</span> 8<span class="p">;</span>
</span></span><span class="line"><span class="cl">  sudo mknod -m <span class="m">666</span> tty7 c <span class="m">4</span> 9<span class="p">;</span>
</span></span><span class="line"><span class="cl">  sudo mknod -m <span class="m">666</span> tty8 c <span class="m">4</span> 10<span class="p">;</span>
</span></span><span class="line"><span class="cl">  sudo mknod -m <span class="m">666</span> tty9 c <span class="m">4</span> 11<span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1"># 在rootfs目录下准备挂载NFS脚本</span>
</span></span><span class="line"><span class="cl">  sudo touch <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span>/rootfs/mountNFS.sh
</span></span><span class="line"><span class="cl">  sudo chown <span class="si">${</span><span class="nv">USER</span><span class="si">}</span>:<span class="si">${</span><span class="nv">USER</span><span class="si">}</span> <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span>/rootfs/mountNFS.sh
</span></span><span class="line"><span class="cl">  cat <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span>/rootfs/mountNFS.sh &gt; <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span>/rootfs/mountNFS.sh
</span></span><span class="line"><span class="cl">  <span class="nb">echo</span> <span class="s2">&#34;ifconfig eth0 </span><span class="si">${</span><span class="nv">of_ip_var1</span><span class="si">}</span><span class="s2">.</span><span class="si">${</span><span class="nv">of_ip_var2</span><span class="si">}</span><span class="s2">.</span><span class="si">${</span><span class="nv">of_ip_var3</span><span class="si">}</span><span class="s2">.223&#34;</span> &gt;&gt; <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span>/rootfs/mountNFS.sh 
</span></span><span class="line"><span class="cl">  <span class="nb">echo</span> <span class="s2">&#34;mount -t nfs -o nolock </span><span class="si">${</span><span class="nv">of_ip_var1</span><span class="si">}</span><span class="s2">.</span><span class="si">${</span><span class="nv">of_ip_var2</span><span class="si">}</span><span class="s2">.</span><span class="si">${</span><span class="nv">of_ip_var3</span><span class="si">}</span><span class="s2">.</span><span class="si">${</span><span class="nv">of_ip_var4</span><span class="si">}</span><span class="s2">:</span><span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span><span class="s2"> /mnt&#34;</span> &gt;&gt; <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span>/rootfs/mountNFS.sh
</span></span><span class="line"><span class="cl">  sudo chown <span class="si">${</span><span class="nv">root</span><span class="si">}</span>:<span class="si">${</span><span class="nv">root</span><span class="si">}</span> <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span>/rootfs/mountNFS.sh
</span></span><span class="line"><span class="cl">  <span class="c1"># 进入qemu运行的虚拟机后通过以下命令运行脚本进行挂载nfs：&#34;sh mountNFS.sh&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nb">cd</span> <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># 制作rootfs.ext3，格式化rootfs.ext3为ext3文件系统类型，将rootfs.ext3挂载到/mnt，再将根文件系统拷贝到/mnt，然后解除/mnt挂载的rootfs.ext3，此时rootfs.ext3中已经有根文件系统了</span>
</span></span><span class="line"><span class="cl">  sudo dd <span class="k">if</span><span class="o">=</span>/dev/zero <span class="nv">of</span><span class="o">=</span>rootfs.ext3 <span class="nv">bs</span><span class="o">=</span>1M <span class="nv">count</span><span class="o">=</span><span class="m">32</span>
</span></span><span class="line"><span class="cl">  sudo mkfs.ext3 rootfs.ext3
</span></span><span class="line"><span class="cl">  sudo mount -t ext3 rootfs.ext3 /mnt -o loop
</span></span><span class="line"><span class="cl">  sudo cp -vrf <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span>/rootfs/* /mnt
</span></span><span class="line"><span class="cl">  sudo umount /mnt
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  sudo cp -vf <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span>/rootfs.ext3 /tftpboot</span></span></code></pre></td></tr></table>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-headline-12" class="outline-3">
<h3 id="headline-12">
u-boot 编译
</h3>
<div id="outline-text-headline-12" class="outline-text-3">
<div class="src src-bash">
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span><span class="lnt">90
</span><span class="lnt">91
</span><span class="lnt">92
</span><span class="lnt">93
</span><span class="lnt">94
</span><span class="lnt">95
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">  <span class="nv">linux</span><span class="o">=</span><span class="s2">&#34;linux-4.4.232&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># linux=&#34;linux-4.4.76&#34;;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">busybox</span><span class="o">=</span><span class="s2">&#34;busybox-1.32.0&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">uboot</span><span class="o">=</span><span class="s2">&#34;u-boot-2017.05&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># uboot=&#34;u-boot-2020.07&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">vuboot</span><span class="o">=</span><span class="s2">&#34;v2017.05&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">git_uboot</span><span class="o">=</span><span class="s2">&#34;v&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">file_linux</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">linux</span><span class="si">}</span><span class="s2">.tar.xz&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">file_busybox</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">busybox</span><span class="si">}</span><span class="s2">.tar.bz2&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">file_uboot</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">uboot</span><span class="si">}</span><span class="s2">.tar.bz2&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">file_vuboot</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">vuboot</span><span class="si">}</span><span class="s2">.tar.gz&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">bz2_uboot</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">file_uboot</span><span class="si">}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">gz_uboot</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">file_vuboot</span><span class="si">}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">work_dir_name</span><span class="o">=</span><span class="s2">&#34;yenao_qemu_test&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">work_dir</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span><span class="s2">/</span><span class="si">${</span><span class="nv">work_dir_name</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">Operate_Net_File</span><span class="o">=</span><span class="s2">&#34;/etc/network/interfaces&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">uboot_config_file</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span><span class="s2">/</span><span class="si">${</span><span class="nv">uboot</span><span class="si">}</span><span class="s2">/include/configs/vexpress_common.h&#34;</span>
</span></span><span class="line"><span class="cl">  mkdir -p <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nb">cd</span> <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">cpu_cores</span><span class="o">=</span><span class="k">$(</span>nproc<span class="k">)</span>
</span></span><span class="line"><span class="cl">  <span class="nv">jobs</span><span class="o">=</span><span class="k">$((</span>cpu_cores <span class="o">*</span> <span class="m">2</span><span class="k">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1"># 临时配置交叉编译环境</span>
</span></span><span class="line"><span class="cl">  <span class="nb">export</span> <span class="nv">ARCH</span><span class="o">=</span>arm <span class="o">&amp;&amp;</span> <span class="nb">export</span> <span class="nv">CROSS_COMPILE</span><span class="o">=</span>arm-linux-gnueabi-<span class="p">;</span>  
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1"># 判断u-boot文件是否准备好</span>
</span></span><span class="line"><span class="cl">  <span class="k">while</span> true<span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">do</span>
</span></span><span class="line"><span class="cl">	  <span class="nv">result</span><span class="o">=</span><span class="k">$(</span>curl ipinfo.io <span class="p">|</span> grep <span class="s2">&#34;country&#34;</span> <span class="p">|</span> tr <span class="s1">&#39;&#34;&#39;</span> <span class="s1">&#39; &#39;</span> <span class="p">|</span> awk <span class="s1">&#39;{print $3}&#39;</span><span class="k">)</span>
</span></span><span class="line"><span class="cl">	  <span class="k">if</span> <span class="o">[</span> -z <span class="s2">&#34;</span><span class="si">${</span><span class="nv">result</span><span class="si">}</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">		  <span class="k">continue</span>
</span></span><span class="line"><span class="cl">	  <span class="k">else</span>
</span></span><span class="line"><span class="cl">		  <span class="nb">echo</span> -e <span class="s2">&#34;\e[32mcountry: </span><span class="si">${</span><span class="nv">result</span><span class="si">}</span><span class="s2">\e[0m&#34;</span>
</span></span><span class="line"><span class="cl">		  <span class="nb">break</span>
</span></span><span class="line"><span class="cl">	  <span class="k">fi</span>
</span></span><span class="line"><span class="cl">  <span class="k">done</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nv">file_uboot</span><span class="o">=</span><span class="si">${</span><span class="nv">file_vuboot</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># echo &#34;https://codeload.github.com/u-boot/u-boot/tar.gz/refs/tags/v2017.05&#34; | awk -F &#39;/&#39; &#39;{print $5&#34;-&#34;$9&#34;.&#34;$6}&#39; | tr -d &#39;v&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">while</span> true<span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">do</span>
</span></span><span class="line"><span class="cl">	  <span class="k">if</span> <span class="o">[</span> ! -f <span class="s2">&#34;</span><span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span><span class="s2">/</span><span class="nv">$file_uboot</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">		  <span class="nb">echo</span> -e  <span class="s2">&#34;\e[34m&#34;</span>
</span></span><span class="line"><span class="cl">		  <span class="k">if</span> <span class="o">[</span> <span class="si">${</span><span class="nv">result</span><span class="si">}</span> !<span class="o">=</span> <span class="s2">&#34;CN&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">			  <span class="c1"># wget --no-check-certificate https://ftp.denx.de/pub/u-boot/u-boot-2017.05.tar.bz2 </span>
</span></span><span class="line"><span class="cl">			  <span class="c1"># wget --no-check-certificate https://ftp.denx.de/pub/u-boot/u-boot-2020.07.tar.bz2</span>
</span></span><span class="line"><span class="cl">			  <span class="c1"># wget --no-check-certificate https://ftp.denx.de/pub/u-boot/${file_uboot}</span>
</span></span><span class="line"><span class="cl">			  <span class="c1"># wget https://github.com/u-boot/u-boot/archive/refs/tags/v2017.05.tar.gz</span>
</span></span><span class="line"><span class="cl">			  wget  https://github.com/u-boot/u-boot/archive/refs/tags/<span class="si">${</span><span class="nv">file_uboot</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">		  <span class="k">else</span>
</span></span><span class="line"><span class="cl">			  wget https://hub.nuaa.cf/u-boot/u-boot/archive/refs/tags/<span class="si">${</span><span class="nv">file_uboot</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">		  <span class="k">fi</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	  <span class="k">else</span>
</span></span><span class="line"><span class="cl">		  <span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="k">$(</span>sha256sum <span class="si">${</span><span class="nv">file_uboot</span><span class="si">}</span><span class="k">)</span><span class="s2">&#34;</span> !<span class="o">=</span> <span class="s2">&#34;0f94a62c460fc136aeca9bcd9fde3bb1d3f25b953e1bee96be4497a06a39ae81  </span><span class="si">${</span><span class="nv">file_uboot</span><span class="si">}</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">			  rm -rf <span class="si">${</span><span class="nv">file_uboot</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">			  <span class="k">continue</span>
</span></span><span class="line"><span class="cl">		  <span class="k">else</span>
</span></span><span class="line"><span class="cl">			  <span class="nb">echo</span> -e <span class="s2">&#34;\e[32m</span><span class="nv">$file_uboot</span><span class="s2"> 已下载\e[0m&#34;</span>
</span></span><span class="line"><span class="cl">			  <span class="nb">break</span>
</span></span><span class="line"><span class="cl">		  <span class="k">fi</span>
</span></span><span class="line"><span class="cl">	  <span class="k">fi</span>
</span></span><span class="line"><span class="cl">	  <span class="nb">echo</span> -e  <span class="s2">&#34;\e[0m&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="k">done</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1"># 判断u-boot文件是否解压</span>
</span></span><span class="line"><span class="cl">  <span class="nb">echo</span> -e <span class="s2">&#34;\e[34m&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="o">[</span> -d <span class="s2">&#34;</span><span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span><span class="s2">/</span><span class="si">${</span><span class="nv">uboot</span><span class="si">}</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">	  <span class="nb">echo</span> <span class="s2">&#34;</span><span class="nv">$uboot</span><span class="s2"> exists.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="k">else</span>
</span></span><span class="line"><span class="cl">	  <span class="k">if</span> <span class="o">[</span> -f <span class="s2">&#34;</span><span class="si">${</span><span class="nv">bz2_uboot</span><span class="si">}</span><span class="s2">&#34;</span>  <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">		  tar xvf <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span>/<span class="nv">$file_uboot</span> -C <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		  <span class="k">if</span> <span class="o">[</span> -f <span class="s2">&#34;</span><span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span><span class="s2">/</span><span class="si">${</span><span class="nv">uboot</span><span class="si">}</span><span class="s2">/include/configs/vexpress_common.h&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">			  cp <span class="si">${</span><span class="nv">uboot_config_file</span><span class="si">}</span> <span class="si">${</span><span class="nv">uboot_config_file</span><span class="si">}</span>.old
</span></span><span class="line"><span class="cl">		  <span class="k">fi</span>
</span></span><span class="line"><span class="cl">	  <span class="k">elif</span> <span class="o">[</span> -f <span class="s2">&#34;</span><span class="si">${</span><span class="nv">gz_uboot</span><span class="si">}</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">		  tar zxvf <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span>/<span class="nv">$file_uboot</span> -C <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		  <span class="k">if</span> <span class="o">[</span> -f <span class="s2">&#34;</span><span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span><span class="s2">/</span><span class="si">${</span><span class="nv">uboot</span><span class="si">}</span><span class="s2">/include/configs/vexpress_common.h&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">			  cp <span class="si">${</span><span class="nv">uboot_config_file</span><span class="si">}</span> <span class="si">${</span><span class="nv">uboot_config_file</span><span class="si">}</span>.old
</span></span><span class="line"><span class="cl">		  <span class="k">fi</span>
</span></span><span class="line"><span class="cl">	  <span class="k">fi</span>
</span></span><span class="line"><span class="cl">	  <span class="nb">echo</span> -e <span class="s2">&#34;\e[0m&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="k">fi</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nv">cpu_cores</span><span class="o">=</span><span class="k">$(</span>nproc<span class="k">)</span>
</span></span><span class="line"><span class="cl">  <span class="nv">jobs</span><span class="o">=</span><span class="k">$((</span>cpu_cores <span class="o">*</span> <span class="m">2</span><span class="k">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1"># 编译u-boot，编译之后会在${uboot}目录下出现u-boot，传真u-boot示例：sudo qemu-system-arm -M vexpress-a9 -m 256 -kernel ./u-boot -nographic</span>
</span></span><span class="line"><span class="cl">  <span class="nb">cd</span>  <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span>/<span class="si">${</span><span class="nv">uboot</span><span class="si">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  make distclean -j<span class="si">${</span><span class="nv">jobs</span><span class="si">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  make vexpress_ca9x4_defconfig -j<span class="si">${</span><span class="nv">jobs</span><span class="si">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  make -j<span class="si">${</span><span class="nv">jobs</span><span class="si">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  sudo cp -vf <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span>/<span class="si">${</span><span class="nv">uboot</span><span class="si">}</span>/u-boot /tftpboot<span class="p">;</span></span></span></code></pre></td></tr></table>
</div>
</div>
</div>
<div id="outline-container-headline-13" class="outline-4">
<h4 id="headline-13">
搭建网络开发环境
</h4>
<div id="outline-text-headline-13" class="outline-text-4">
<div class="src src-bash">
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span><span class="lnt">90
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">  <span class="nv">linux</span><span class="o">=</span><span class="s2">&#34;linux-4.4.232&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># linux=&#34;linux-4.4.76&#34;;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">busybox</span><span class="o">=</span><span class="s2">&#34;busybox-1.32.0&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">uboot</span><span class="o">=</span><span class="s2">&#34;u-boot-2017.05&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># uboot=&#34;u-boot-2020.07&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">file_linux</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">linux</span><span class="si">}</span><span class="s2">.tar.xz&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">file_busybox</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">busybox</span><span class="si">}</span><span class="s2">.tar.bz2&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">file_uboot</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">uboot</span><span class="si">}</span><span class="s2">.tar.bz2&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">work_dir_name</span><span class="o">=</span><span class="s2">&#34;yenao_qemu_test&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">work_dir</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span><span class="s2">/</span><span class="si">${</span><span class="nv">work_dir_name</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">Operate_Net_File</span><span class="o">=</span><span class="s2">&#34;/etc/network/interfaces&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">uboot_config_file</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span><span class="s2">/</span><span class="si">${</span><span class="nv">uboot</span><span class="si">}</span><span class="s2">/include/configs/vexpress_common.h&#34;</span>
</span></span><span class="line"><span class="cl">  mkdir -p <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nb">cd</span> <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">cpu_cores</span><span class="o">=</span><span class="k">$(</span>nproc<span class="k">)</span>
</span></span><span class="line"><span class="cl">  <span class="nv">jobs</span><span class="o">=</span><span class="k">$((</span>cpu_cores <span class="o">*</span> <span class="m">2</span><span class="k">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1"># 搭建网络开发环境</span>
</span></span><span class="line"><span class="cl">  <span class="nb">echo</span> -e  <span class="s2">&#34;\e[95m&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="o">[</span> ! -f <span class="s2">&#34;</span><span class="nv">$Operate_Net_File</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">	  sudo touch <span class="si">${</span><span class="nv">Operate_Net_File</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">else</span>
</span></span><span class="line"><span class="cl">	  <span class="nb">echo</span> <span class="s2">&#34;</span><span class="si">${</span><span class="nv">uboot_config_file</span><span class="si">}</span><span class="s2"> is exists.&#34;</span>
</span></span><span class="line"><span class="cl">	  <span class="k">if</span> <span class="o">[</span> ! -f <span class="s2">&#34;</span><span class="nv">$Operate_Net_File</span><span class="s2">.old&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">		  sudo cp <span class="si">${</span><span class="nv">Operate_Net_File</span><span class="si">}</span> <span class="o">{</span><span class="nv">$Operate_Net_File</span><span class="o">}</span>.old
</span></span><span class="line"><span class="cl">	  <span class="k">else</span>
</span></span><span class="line"><span class="cl">		  <span class="nb">echo</span> <span class="s2">&#34;</span><span class="si">${</span><span class="nv">Operate_Net_File</span><span class="si">}</span><span class="s2">.old is exists.&#34;</span>
</span></span><span class="line"><span class="cl">	  <span class="k">fi</span>
</span></span><span class="line"><span class="cl">  <span class="k">fi</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  sudo chown <span class="si">${</span><span class="nv">USER</span><span class="si">}</span>:<span class="si">${</span><span class="nv">USER</span><span class="si">}</span> <span class="si">${</span><span class="nv">Operate_Net_File</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="o">[</span> ! <span class="s2">&#34;</span><span class="k">$(</span>cat /etc/network/interfaces <span class="p">|</span> grep -o <span class="s2">&#34;br0&#34;</span> <span class="p">|</span> head -n 1<span class="k">)</span><span class="s2">&#34;</span> <span class="o">=</span> <span class="s2">&#34;br0&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">	  <span class="nb">echo</span> <span class="s2">&#34;debug_1&#34;</span>
</span></span><span class="line"><span class="cl">	  cat <span class="si">${</span><span class="nv">Operate_Net_File</span><span class="si">}</span> &gt; <span class="si">${</span><span class="nv">Operate_Net_File</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">	  <span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="k">$(</span>ip addr <span class="p">|</span> grep -o <span class="s2">&#34;ens33&#34;</span> <span class="p">|</span> head -n 1<span class="k">)</span><span class="s2">&#34;</span> <span class="o">=</span> <span class="s2">&#34;ens33&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">		  <span class="nb">echo</span> <span class="s2">&#34;auto lo&#34;</span> &gt;&gt; <span class="si">${</span><span class="nv">Operate_Net_File</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">		  <span class="nb">echo</span> <span class="s2">&#34;iface lo inet loopback&#34;</span> &gt;&gt; <span class="si">${</span><span class="nv">Operate_Net_File</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">		  <span class="nb">echo</span> <span class="s2">&#34;&#34;</span> &gt;&gt; <span class="si">${</span><span class="nv">Operate_Net_File</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">		  <span class="nb">echo</span> <span class="s2">&#34;auto ens33&#34;</span> &gt;&gt; <span class="si">${</span><span class="nv">Operate_Net_File</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">		  <span class="nb">echo</span> <span class="s2">&#34;&#34;</span> &gt;&gt; <span class="si">${</span><span class="nv">Operate_Net_File</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">		  <span class="nb">echo</span> <span class="s2">&#34;auto br0&#34;</span> &gt;&gt; <span class="si">${</span><span class="nv">Operate_Net_File</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">		  <span class="nb">echo</span> <span class="s2">&#34;iface br0 inet dhcp&#34;</span> &gt;&gt; <span class="si">${</span><span class="nv">Operate_Net_File</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">		  <span class="nb">echo</span> <span class="s2">&#34;	bridge_ports ens33&#34;</span> &gt;&gt; <span class="si">${</span><span class="nv">Operate_Net_File</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">		  sudo chown <span class="si">${</span><span class="nv">root</span><span class="si">}</span>:<span class="si">${</span><span class="nv">root</span><span class="si">}</span> <span class="si">${</span><span class="nv">Operate_Net_File</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">		  sudo /etc/init.d/networking restart
</span></span><span class="line"><span class="cl">	  <span class="k">else</span>
</span></span><span class="line"><span class="cl">		  <span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="k">$(</span>ip addr <span class="p">|</span> grep -o <span class="s2">&#34;eth0&#34;</span><span class="k">)</span><span class="s2">&#34;</span> <span class="o">=</span> <span class="s2">&#34;eth0&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">			  <span class="nb">echo</span> <span class="s2">&#34;auto lo&#34;</span> &gt;&gt; <span class="si">${</span><span class="nv">Operate_Net_File</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">			  <span class="nb">echo</span> <span class="s2">&#34;iface lo inet loopback&#34;</span> &gt;&gt; <span class="si">${</span><span class="nv">Operate_Net_File</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">			  <span class="nb">echo</span> <span class="s2">&#34;&#34;</span> &gt;&gt; <span class="si">${</span><span class="nv">Operate_Net_File</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">			  <span class="nb">echo</span> <span class="s2">&#34;auto eth0&#34;</span> &gt;&gt; <span class="si">${</span><span class="nv">Operate_Net_File</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">			  <span class="nb">echo</span> <span class="s2">&#34;&#34;</span> &gt;&gt; <span class="si">${</span><span class="nv">Operate_Net_File</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">			  <span class="nb">echo</span> <span class="s2">&#34;auto br0&#34;</span> &gt;&gt; <span class="si">${</span><span class="nv">Operate_Net_File</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">			  <span class="nb">echo</span> <span class="s2">&#34;iface br0 inet dhcp&#34;</span> &gt;&gt; <span class="si">${</span><span class="nv">Operate_Net_File</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">			  <span class="nb">echo</span> <span class="s2">&#34;	bridge_ports eth0&#34;</span> &gt;&gt; <span class="si">${</span><span class="nv">Operate_Net_File</span><span class="si">}</span>			  
</span></span><span class="line"><span class="cl">			  sudo /etc/init.d/networking restart
</span></span><span class="line"><span class="cl">		  <span class="k">fi</span>
</span></span><span class="line"><span class="cl">	  <span class="k">fi</span>
</span></span><span class="line"><span class="cl">  <span class="k">else</span>
</span></span><span class="line"><span class="cl">	  <span class="nb">echo</span> <span class="s2">&#34;br0 exists.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="k">fi</span>  
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="k">$(</span>ifconfig <span class="p">|</span> grep -wo <span class="s2">&#34;br0&#34;</span><span class="k">)</span><span class="s2">&#34;</span> <span class="o">=</span> <span class="s2">&#34;br0&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">	  <span class="nv">of_ip_var1</span><span class="o">=</span><span class="k">$(</span>ifconfig <span class="p">|</span> grep -w -A <span class="m">1</span> <span class="s2">&#34;br0&#34;</span> <span class="p">|</span> grep -v <span class="s2">&#34;br0&#34;</span> <span class="p">|</span> awk <span class="s1">&#39;$1==&#34;inet&#34; {print $2}&#39;</span> <span class="p">|</span> grep -oE <span class="s2">&#34;\b([0-9]{1,3}\.){3}[0-9]{1,3}\b&#34;</span> <span class="p">|</span> awk -F <span class="s1">&#39;.&#39;</span> <span class="s1">&#39;{print $1}&#39;</span><span class="k">)</span><span class="p">;</span> <span class="nb">echo</span> <span class="si">${</span><span class="nv">of_ip_var1</span><span class="si">}</span> 
</span></span><span class="line"><span class="cl">	  <span class="nv">of_ip_var2</span><span class="o">=</span><span class="k">$(</span>ifconfig <span class="p">|</span> grep -w -A <span class="m">1</span> <span class="s2">&#34;br0&#34;</span> <span class="p">|</span> grep -v <span class="s2">&#34;br0&#34;</span> <span class="p">|</span> awk <span class="s1">&#39;$1==&#34;inet&#34; {print $2}&#39;</span> <span class="p">|</span> grep -oE <span class="s2">&#34;\b([0-9]{1,3}\.){3}[0-9]{1,3}\b&#34;</span> <span class="p">|</span> awk -F <span class="s1">&#39;.&#39;</span> <span class="s1">&#39;{print $2}&#39;</span><span class="k">)</span><span class="p">;</span> <span class="nb">echo</span> <span class="si">${</span><span class="nv">of_ip_var2</span><span class="si">}</span> 
</span></span><span class="line"><span class="cl">	  <span class="nv">of_ip_var3</span><span class="o">=</span><span class="k">$(</span>ifconfig <span class="p">|</span> grep -w -A <span class="m">1</span> <span class="s2">&#34;br0&#34;</span> <span class="p">|</span> grep -v <span class="s2">&#34;br0&#34;</span> <span class="p">|</span> awk <span class="s1">&#39;$1==&#34;inet&#34; {print $2}&#39;</span> <span class="p">|</span> grep -oE <span class="s2">&#34;\b([0-9]{1,3}\.){3}[0-9]{1,3}\b&#34;</span> <span class="p">|</span> awk -F <span class="s1">&#39;.&#39;</span> <span class="s1">&#39;{print $3}&#39;</span><span class="k">)</span><span class="p">;</span> <span class="nb">echo</span> <span class="si">${</span><span class="nv">of_ip_var3</span><span class="si">}</span> 
</span></span><span class="line"><span class="cl">	  <span class="nv">of_ip_var4</span><span class="o">=</span><span class="k">$(</span>ifconfig <span class="p">|</span> grep -w -A <span class="m">1</span> <span class="s2">&#34;br0&#34;</span> <span class="p">|</span> grep -v <span class="s2">&#34;br0&#34;</span> <span class="p">|</span> awk <span class="s1">&#39;$1==&#34;inet&#34; {print $2}&#39;</span> <span class="p">|</span> grep -oE <span class="s2">&#34;\b([0-9]{1,3}\.){3}[0-9]{1,3}\b&#34;</span> <span class="p">|</span> awk -F <span class="s1">&#39;.&#39;</span> <span class="s1">&#39;{print $4}&#39;</span><span class="k">)</span><span class="p">;</span> <span class="nb">echo</span> <span class="si">${</span><span class="nv">of_ip_var4</span><span class="si">}</span> 
</span></span><span class="line"><span class="cl">  <span class="k">else</span>
</span></span><span class="line"><span class="cl">	  <span class="nb">echo</span> <span class="s2">&#34;The br0 not exists.&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="k">fi</span>
</span></span><span class="line"><span class="cl">  sudo chown <span class="si">${</span><span class="nv">USER</span><span class="si">}</span>:<span class="si">${</span><span class="nv">USER</span><span class="si">}</span> <span class="si">${</span><span class="nv">Operate_Net_File</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="o">[</span> ! -f <span class="s2">&#34;</span><span class="si">${</span><span class="nv">uboot_config_file</span><span class="si">}</span><span class="s2">.old&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">	  cp <span class="si">${</span><span class="nv">uboot_config_file</span><span class="si">}</span> <span class="si">${</span><span class="nv">uboot_config_file</span><span class="si">}</span>.old
</span></span><span class="line"><span class="cl">  <span class="k">else</span>
</span></span><span class="line"><span class="cl">	  cat <span class="si">${</span><span class="nv">uboot_config_file</span><span class="si">}</span>.old &gt;  <span class="si">${</span><span class="nv">uboot_config_file</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">fi</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nv">uboot_config_file_var1</span><span class="o">=</span><span class="k">$(</span>grep -n <span class="s2">&#34;\/\* Basic environment settings \*\/&#34;</span> <span class="si">${</span><span class="nv">uboot_config_file</span><span class="si">}</span>.old <span class="p">|</span> tr <span class="s1">&#39;:&#39;</span> <span class="s1">&#39; &#39;</span> <span class="p">|</span> awk <span class="s1">&#39;{print $1}&#39;</span><span class="k">)</span>
</span></span><span class="line"><span class="cl">  <span class="nv">uboot_config_file_var2</span><span class="o">=</span><span class="k">$((</span>uboot_config_file_var1 <span class="o">+</span> <span class="m">1</span><span class="k">))</span>
</span></span><span class="line"><span class="cl">  cat <span class="si">${</span><span class="nv">uboot_config_file</span><span class="si">}</span>.old &gt; <span class="si">${</span><span class="nv">uboot_config_file</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">  sed -i <span class="s1">&#39;/CONFIG_BOOTCOMMAND\b/d&#39;</span> <span class="si">${</span><span class="nv">uboot_config_file</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">  sed -i <span class="s1">&#39;/run distro_bootcmd\b/d&#39;</span> <span class="si">${</span><span class="nv">uboot_config_file</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">  sed -i <span class="s1">&#39;/run bootflash\b/d&#39;</span> <span class="si">${</span><span class="nv">uboot_config_file</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">  sed -i  <span class="s2">&#34;</span><span class="si">${</span><span class="nv">uboot_config_file_var2</span><span class="si">}</span><span class="s2">i\#define CONFIG_SERVERIP </span><span class="si">${</span><span class="nv">of_ip_var1</span><span class="si">}</span><span class="s2">.</span><span class="si">${</span><span class="nv">of_ip_var2</span><span class="si">}</span><span class="s2">.</span><span class="si">${</span><span class="nv">of_ip_var3</span><span class="si">}</span><span class="s2">.</span><span class="si">${</span><span class="nv">of_ip_var4</span><span class="si">}</span><span class="s2">&#34;</span> <span class="si">${</span><span class="nv">uboot_config_file</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">  sed -i  <span class="s2">&#34;</span><span class="si">${</span><span class="nv">uboot_config_file_var2</span><span class="si">}</span><span class="s2">i\#define CONFIG_NETMASK 255.255.255.0&#34;</span> <span class="si">${</span><span class="nv">uboot_config_file</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">  sed -i  <span class="s2">&#34;</span><span class="si">${</span><span class="nv">uboot_config_file_var2</span><span class="si">}</span><span class="s2">i\#define CONFIG_IPADDR </span><span class="si">${</span><span class="nv">of_ip_var1</span><span class="si">}</span><span class="s2">.</span><span class="si">${</span><span class="nv">of_ip_var2</span><span class="si">}</span><span class="s2">.</span><span class="si">${</span><span class="nv">of_ip_var3</span><span class="si">}</span><span class="s2">.223&#34;</span> <span class="si">${</span><span class="nv">uboot_config_file</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">  sed -i  <span class="s2">&#34;</span><span class="si">${</span><span class="nv">uboot_config_file_var2</span><span class="si">}</span><span class="s2">i\/* netmask */&#34;</span> <span class="si">${</span><span class="nv">uboot_config_file</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">  sed -i  <span class="s2">&#34;</span><span class="si">${</span><span class="nv">uboot_config_file_var2</span><span class="si">}</span><span class="s2">i\#define CONFIG_BOOTCOMMAND \&#34;tftp 0x60003000 uImage;tftp 0x60500000 vexpress-v2p-ca9.dtb;setenv bootargs &#39;root=/dev/mmcblk0 console=ttyAMA0&#39;;bootm 0x60003000 - 0x60500000;\&#34; \\&#34;</span> <span class="si">${</span><span class="nv">uboot_config_file</span><span class="si">}</span></span></span></code></pre></td></tr></table>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-headline-14" class="outline-3">
<h3 id="headline-14">
启动
</h3>
<div id="outline-text-headline-14" class="outline-text-3">
<div class="src src-bash">
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">  <span class="nv">cmdself</span><span class="o">=</span><span class="nv">$0</span>
</span></span><span class="line"><span class="cl">  <span class="nv">linux</span><span class="o">=</span><span class="s2">&#34;linux-4.4.232&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># linux=&#34;linux-4.4.76&#34;;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">busybox</span><span class="o">=</span><span class="s2">&#34;busybox-1.32.0&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">uboot</span><span class="o">=</span><span class="s2">&#34;u-boot-2017.05&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># uboot=&#34;u-boot-2020.07&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">file_linux</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">linux</span><span class="si">}</span><span class="s2">.tar.xz&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">file_busybox</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">busybox</span><span class="si">}</span><span class="s2">.tar.bz2&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">file_uboot</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">uboot</span><span class="si">}</span><span class="s2">.tar.bz2&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">work_dir_name</span><span class="o">=</span><span class="s2">&#34;yenao_qemu_test&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">work_dir</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span><span class="s2">/</span><span class="si">${</span><span class="nv">work_dir_name</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">Operate_Net_File</span><span class="o">=</span><span class="s2">&#34;/etc/network/interfaces&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">uboot_config_file</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span><span class="s2">/</span><span class="si">${</span><span class="nv">uboot</span><span class="si">}</span><span class="s2">/include/configs/vexpress_common.h&#34;</span>
</span></span><span class="line"><span class="cl">  mkdir -p <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nb">cd</span> <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">cpu_cores</span><span class="o">=</span><span class="k">$(</span>nproc<span class="k">)</span>
</span></span><span class="line"><span class="cl">  <span class="nv">jobs</span><span class="o">=</span><span class="k">$((</span>cpu_cores <span class="o">*</span> <span class="m">2</span><span class="k">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  sudo rm -rf /tftpboot/*
</span></span><span class="line"><span class="cl">  sudo cp -f <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span>/<span class="si">${</span><span class="nv">linux</span><span class="si">}</span>/arch/arm/boot/zImage /tftpboot<span class="p">;</span>
</span></span><span class="line"><span class="cl">  sudo cp -f <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span>/<span class="si">${</span><span class="nv">linux</span><span class="si">}</span>/arch/arm/boot/uImage /tftpboot<span class="p">;</span>
</span></span><span class="line"><span class="cl">  sudo cp -f <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span>/<span class="si">${</span><span class="nv">linux</span><span class="si">}</span>/arch/arm/boot/dts/vexpress-v2p-ca9.dtb /tftpboot<span class="p">;</span>
</span></span><span class="line"><span class="cl">  sudo cp -f <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span>/<span class="si">${</span><span class="nv">uboot</span><span class="si">}</span>/u-boot /tftpboot<span class="p">;</span>
</span></span><span class="line"><span class="cl">  sudo cp -f <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span>/rootfs.ext3 /tftpboot<span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$1</span><span class="s2">&#34;</span> <span class="o">=</span> <span class="s2">&#34;sd&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">	  <span class="c1"># QEMU运行虚拟机，通过sd卡加载linux内核	  </span>
</span></span><span class="line"><span class="cl">	  sudo qemu-system-arm -M vexpress-a9 -m 256M -kernel <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span>/<span class="nv">$linux</span>/arch/arm/boot/zImage -dtb <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span>/<span class="nv">$linux</span>/arch/arm/boot/dts/vexpress-v2p-ca9.dtb -nographic -append <span class="s2">&#34;root=/dev/mmcblk0 rw console=ttyAMA0&#34;</span> -sd <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span>/rootfs.ext3<span class="p">;</span>	  
</span></span><span class="line"><span class="cl">  <span class="k">elif</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$1</span><span class="s2">&#34;</span> <span class="o">=</span> <span class="s2">&#34;u-boot&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">	  <span class="nb">cd</span> /tftpboot
</span></span><span class="line"><span class="cl">	  sudo qemu-system-arm -M vexpress-a9 -kernel u-boot -nographic -m 128M -net nic,vlan<span class="o">=</span><span class="m">0</span> -net tap,vlan<span class="o">=</span>0,ifname<span class="o">=</span>tap0 -sd rootfs.ext3
</span></span><span class="line"><span class="cl">  <span class="k">elif</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$1</span><span class="s2">&#34;</span> <span class="o">=</span> <span class="s2">&#34;help&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">	  <span class="nb">echo</span> <span class="s2">&#34;sd start: </span><span class="si">${</span><span class="nv">cmdself</span><span class="si">}</span><span class="s2"> sd&#34;</span>
</span></span><span class="line"><span class="cl">	  <span class="nb">echo</span> <span class="s2">&#34;u-boot start: </span><span class="si">${</span><span class="nv">cmdself</span><span class="si">}</span><span class="s2"> u-boot&#34;</span>
</span></span><span class="line"><span class="cl">	  <span class="nb">echo</span> <span class="s2">&#34;out sd start var: </span><span class="si">${</span><span class="nv">cmdself</span><span class="si">}</span><span class="s2"> out sd&#34;</span>
</span></span><span class="line"><span class="cl">	  <span class="nb">echo</span> <span class="s2">&#34;out u-boot start var: </span><span class="si">${</span><span class="nv">cmdself</span><span class="si">}</span><span class="s2"> out u-boot&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="k">elif</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$1</span><span class="s2">&#34;</span> <span class="o">=</span> <span class="s2">&#34;out&#34;</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$2</span><span class="s2">&#34;</span> <span class="o">=</span> <span class="s2">&#34;sd&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">	  <span class="nb">echo</span> <span class="s2">&#34; qemu-system-arm -M vexpress-a9 -m 256M -kernel </span><span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span><span class="s2">/</span><span class="nv">$linux</span><span class="s2">/arch/arm/boot/zImage -dtb </span><span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span><span class="s2">/</span><span class="nv">$linux</span><span class="s2">/arch/arm/boot/dts/vexpress-v2p-ca9.dtb -nographic -append \&#34;root=/dev/mmcblk0 rw console=ttyAMA0\&#34; -sd </span><span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span><span class="s2">/rootfs.ext3;&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="k">elif</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$1</span><span class="s2">&#34;</span> <span class="o">=</span> <span class="s2">&#34;out&#34;</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$2</span><span class="s2">&#34;</span> <span class="o">=</span> <span class="s2">&#34;u-boot&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">	  <span class="nb">echo</span> <span class="s2">&#34;sudo qemu-system-arm -M vexpress-a9 -kernel u-boot -nographic -m 128M -net nic,vlan=0 -net tap,vlan=0,ifname=tap0 -sd rootfs.ext3&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="k">else</span>
</span></span><span class="line"><span class="cl">	  <span class="c1"># 默认通过u-boot加载linux内核</span>
</span></span><span class="line"><span class="cl">	  <span class="nb">cd</span> /tftpboot
</span></span><span class="line"><span class="cl">	  sudo qemu-system-arm -M vexpress-a9 -kernel u-boot -nographic -m 128M -net nic,vlan<span class="o">=</span><span class="m">0</span> -net tap,vlan<span class="o">=</span>0,ifname<span class="o">=</span>tap0 -sd rootfs.ext3
</span></span><span class="line"><span class="cl">  <span class="k">fi</span></span></span></code></pre></td></tr></table>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-headline-15" class="outline-3">
<h3 id="headline-15">
开发环境
</h3>
<div id="outline-text-headline-15" class="outline-text-3">
<div class="src src-bash">
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">  <span class="c1"># 临时配置交叉编译环境</span>
</span></span><span class="line"><span class="cl">  <span class="nb">export</span> <span class="nv">ARCH</span><span class="o">=</span>arm <span class="o">&amp;&amp;</span> <span class="nb">export</span> <span class="nv">CROSS_COMPILE</span><span class="o">=</span>arm-linux-gnueabi-<span class="p">;</span></span></span></code></pre></td></tr></table>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-headline-16" class="outline-3">
<h3 id="headline-16">
qemu_ts
</h3>
<div id="outline-text-headline-16" class="outline-text-3">
<div class="src src-bash">
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">  <span class="nv">linux</span><span class="o">=</span><span class="s2">&#34;linux-4.4.232&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># linux=&#34;linux-4.4.76&#34;;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">busybox</span><span class="o">=</span><span class="s2">&#34;busybox-1.32.0&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">uboot</span><span class="o">=</span><span class="s2">&#34;u-boot-2017.05&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># uboot=&#34;u-boot-2020.07&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">file_linux</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">linux</span><span class="si">}</span><span class="s2">.tar.xz&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">file_busybox</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">busybox</span><span class="si">}</span><span class="s2">.tar.bz2&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">file_uboot</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">uboot</span><span class="si">}</span><span class="s2">.tar.bz2&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">work_dir_name</span><span class="o">=</span><span class="s2">&#34;yenao_qemu_test&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">work_dir</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span><span class="s2">/</span><span class="si">${</span><span class="nv">work_dir_name</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">Operate_Net_File</span><span class="o">=</span><span class="s2">&#34;/etc/network/interfaces&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">uboot_config_file</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span><span class="s2">/</span><span class="si">${</span><span class="nv">uboot</span><span class="si">}</span><span class="s2">/include/configs/vexpress_common.h&#34;</span>
</span></span><span class="line"><span class="cl">  mkdir -p <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nb">cd</span> <span class="si">${</span><span class="nv">work_dir</span><span class="si">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">cpu_cores</span><span class="o">=</span><span class="k">$(</span>nproc<span class="k">)</span>
</span></span><span class="line"><span class="cl">  <span class="nv">jobs</span><span class="o">=</span><span class="k">$((</span>cpu_cores <span class="o">*</span> <span class="m">2</span><span class="k">))</span></span></span></code></pre></td></tr></table>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-headline-17" class="outline-2">
<h2 id="headline-17">
参考链接
</h2>
<div id="outline-text-headline-17" class="outline-text-2">
<p>
<a href="https://blog.csdn.net/zhvngchvng/article/details/107856401">使用qemu搭建arm嵌入式linux开发环境</a></p>
<p>
<a href="https://blog.csdn.net/qq_23850025/article/details/115667774">使用QEMU搭建u-boot+Linux+NFS嵌入式开发环境</a></p>
<p>
<a href="https://www.programminghunter.com/article/39592174770/">ZYNQ：加速 PetaLinux 工程编译、复制 PetaLinux 工程</a></p>
<p>
<a href="https://zhuanlan.zhihu.com/p/340362172">一步步教你：如何用Qemu来模拟ARM系统</a></p>
<p>
<a href="https://cloud.tencent.com/developer/article/2347447">深入理解 Linux 启动过程 | QEMU 启动 linux 内核和自制根文件系统</a></p>
<p>
<a href="https://blog.csdn.net/qq_43644573/article/details/126998814">qemu安装及设备添加</a></p>
<p>
<a href="https://wiki.phytec.com/pages/viewpage.action?pageId=69501647">linux内核设备树修改指南 / linux kernel device tree modify guide</a></p>
<p>
<a href="https://developer.aliyun.com/article/972122">Linux设备树系列-GPIO驱动实践</a></p>
<p>
<a href="https://zhuanlan.zhihu.com/p/620384778">Linux内核设备驱动设备树概念与使用</a></p>
<p>
<a href="https://zhuanlan.zhihu.com/p/665624816">初学者教程：修改和理解设备树（dts）</a></p>
<p>
<a href="https://zhuanlan.zhihu.com/p/395145692">【嵌入式Linux驱动入门】一、基于QEMU的IMX6ULL虚拟开发环境搭建</a></p>
</div>
</div>

</section>


    <footer class="article-footer">
    

    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY-NC-SA 4.0</span>
    </section>
    </footer>


    
</article>

    

    

     
    
        
    <div class="disqus-container">
    <div id="disqus_thread"></div>
<script>
    window.disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "hugo-theme-stack" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>

<style>
    .disqus-container {
        background-color: var(--card-background);
        border-radius: var(--card-border-radius);
        box-shadow: var(--shadow-l1);
        padding: var(--card-padding);
    }
</style>

<script>
    window.addEventListener('onColorSchemeChange', (e) => {
        if (typeof DISQUS == 'object') {
            DISQUS.reset({
                reload: true
            });
        }
    })
</script>

    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2020 - 
        
        2025 Example Person
    </section>
    
    <section class="powerby">
        使用 <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> 构建 <br />
        主题 <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.30.0">Stack</a></b> 由 <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a> 设计
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
